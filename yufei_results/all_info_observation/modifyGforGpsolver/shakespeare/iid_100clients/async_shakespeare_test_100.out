The configuration filename is: ./async_shakespeare_bert.yml
 
clients:
# Type
type: simple

# The total number of clients
total_clients: 100

# The number of clients selected in each round
per_round: 10

# Should the clients compute test accuracy locally?
do_test: false

speed_simulation: true
simulation_distribution:
distribution: zipf
s: 1.2

sleep_simulation: true
avg_training_time: 10
random_seed: 1

server:
address: 127.0.0.1
port: 1200
random_seed: 1
#step_window: 2

# Should we operate in sychronous mode?
synchronous: false

# Should we simulate the wall-clock time on the server? Useful if max_concurrency is specified
simulate_wall_time: true

# What is the minimum number of clients that need to report before aggregation begins?
minimum_clients_aggregated: 5

# What is the staleness bound, beyond which the server should wait for stale clients?
staleness_bound: 10
checkpoint_path: checkpoints/huggingface/fedavg
model_path: models/huggingface/fedavg

data:
# The training and testing dataset
datasource: HuggingFace
dataset_name: tiny_shakespeare

# Number of samples in each partition
partition_size: 1009

# IID or non-IID?
sampler: iid

# The random seed for sampling data
random_seed: 1

trainer:
# The type of the trainer
type: HuggingFace

# The maximum number of training rounds
rounds: 100

# The maximum number of clients running concurrently
max_concurrency: 1

# The target perplexity
target_perplexity: 20

# The machine learning model
model_type: huggingface
model_name: bert-base-uncased

# Number of epoches for local training in each communication round
epochs: 5
batch_size: 32
optimizer: SGD

algorithm:
# Aggregation algorithm
type: fedavg

parameters:
optimizer:
lr: 0.01
momentum: 0.9
weight_decay: 0.0

results:
# Write the following parameter(s) into a CSV
types: round, elapsed_time, accuracy
result_path: /data/ykang/plato/results/Async_selection/shakespeare/test
[INFO][08:12:42]: [93m[1m[3536466] Logging runtime results to: /data/ykang/plato/results/Async_selection/shakespeare/test/3536466.csv.[0m
[INFO][08:12:42]: [Server #3536466] Started training on 100 clients with 10 per round.
[INFO][08:12:42]: [Server #3536466] Configuring the server...
[INFO][08:12:42]: Training: 100 rounds or perplexity below 20.0

[INFO][08:12:42]: Trainer: HuggingFace
If you want to use `BertLMHeadModel` as a standalone, add `is_decoder=True.`
Some weights of the model checkpoint at bert-base-uncased were not used when initializing BertLMHeadModel: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertLMHeadModel from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertLMHeadModel from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
[INFO][08:12:44]: Algorithm: fedavg
[INFO][08:12:44]: Data source: HuggingFace
[INFO][08:12:44]: Dataset: tiny_shakespeare
[WARNING][08:12:44]: num_proc must be <= 1. Reducing num_proc to 1 for dataset of size 1.
Running tokenizer on dataset:   0%|          | 0/1 [00:00<?, ?ba/s]Token indices sequence length is longer than the specified maximum sequence length for this model (258335 > 512). Running this sequence through the model will result in indexing errors
^^^^^^^^^^^^^^^^ Please ignore the warning above - this long input will be chunked into smaller bits before being passed to the model.
Running tokenizer on dataset:   0%|          | 0/1 [00:00<?, ?ba/s]
[WARNING][08:12:45]: num_proc must be <= 1. Reducing num_proc to 1 for dataset of size 1.
Grouping texts in chunks of 512:   0%|          | 0/1 [00:00<?, ?ba/s]Grouping texts in chunks of 512:   0%|          | 0/1 [00:00<?, ?ba/s]
[WARNING][08:12:46]: num_proc must be <= 1. Reducing num_proc to 1 for dataset of size 1.
Running tokenizer on dataset:   0%|          | 0/1 [00:00<?, ?ba/s]Running tokenizer on dataset:   0%|          | 0/1 [00:00<?, ?ba/s]
[WARNING][08:12:46]: num_proc must be <= 1. Reducing num_proc to 1 for dataset of size 1.
Grouping texts in chunks of 512:   0%|          | 0/1 [00:00<?, ?ba/s]Grouping texts in chunks of 512:   0%|          | 0/1 [00:00<?, ?ba/s]
[INFO][08:12:46]: Starting client #1's process.
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
[INFO][08:12:46]: Starting client #2's process.
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
[INFO][08:12:46]: Setting the random seed for selecting clients: 1
[INFO][08:12:46]: Starting a server at address 127.0.0.1 and port 1200.
[INFO][08:12:48]: Client: simple
[INFO][08:12:48]: Starting a simple client #2.
[INFO][08:12:48]: Trainer: HuggingFace
[INFO][08:12:49]: Client: simple
[INFO][08:12:49]: Starting a simple client #1.
[INFO][08:12:49]: Trainer: HuggingFace
If you want to use `BertLMHeadModel` as a standalone, add `is_decoder=True.`
If you want to use `BertLMHeadModel` as a standalone, add `is_decoder=True.`
Some weights of the model checkpoint at bert-base-uncased were not used when initializing BertLMHeadModel: ['cls.seq_relationship.bias', 'cls.seq_relationship.weight']
- This IS expected if you are initializing BertLMHeadModel from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertLMHeadModel from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
Some weights of the model checkpoint at bert-base-uncased were not used when initializing BertLMHeadModel: ['cls.seq_relationship.weight', 'cls.seq_relationship.bias']
- This IS expected if you are initializing BertLMHeadModel from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertLMHeadModel from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
[INFO][08:12:51]: Algorithm: fedavg
[INFO][08:12:51]: Algorithm: fedavg
[INFO][08:12:56]: [Client #2] Contacting the server.
[INFO][08:12:56]: [Client #2] Connecting to the server at http://127.0.0.1:1200.
[INFO][08:12:56]: 127.0.0.1 [22/Nov/2022:13:12:56 +0000] "GET /socket.io/?transport=polling&EIO=4&t=1669122776.1963482 HTTP/1.1" 200 293 "-" "Python/3.9 aiohttp/3.8.3"
[INFO][08:12:56]: [Server #3536466] A new client just connected.
[INFO][08:12:56]: [Client #2] Connected to the server.
[INFO][08:12:56]: [Client #2] Waiting to be selected.
[INFO][08:12:56]: [Server #3536466] New client with id #2 arrived.
[INFO][08:12:56]: [Client #1] Contacting the server.
[INFO][08:12:56]: [Client #1] Connecting to the server at http://127.0.0.1:1200.
[INFO][08:12:56]: 127.0.0.1 [22/Nov/2022:13:12:56 +0000] "GET /socket.io/?transport=polling&EIO=4&t=1669122776.26349 HTTP/1.1" 200 293 "-" "Python/3.9 aiohttp/3.8.3"
[INFO][08:12:56]: [Server #3536466] A new client just connected.
[INFO][08:12:56]: [Client #1] Connected to the server.
[INFO][08:12:56]: [Client #1] Waiting to be selected.
[INFO][08:12:56]: [Server #3536466] New client with id #1 arrived.
[INFO][08:12:56]: [Server #3536466] Starting training.
[INFO][08:12:56]: [93m[1m
[Server #3536466] Starting round 1/100.[0m
[INFO][08:12:56]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 47, in on_client_alive
    await self.plato_server.register_client(sid, data["id"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 353, in register_client
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 484, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01,
       0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01,
       0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01,
       0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01,
       0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01,
       0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01,
       0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01,
       0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01,
       0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01,
       0.01]),)
[INFO][08:12:56]: [Server #3536466] Selected clients: [38  8 99 19 82 88 69 57 17 47]
[INFO][08:12:56]: [Server #3536466] Selecting client #38 for training.
[INFO][08:12:56]: [Server #3536466] Sending the current model to client #38 (simulated).
[INFO][08:13:00]: [Server #3536466] Sending 507.38 MB of payload data to client #38 (simulated).
[INFO][08:13:00]: [Server #3536466] Selecting client #99 for training.
[INFO][08:13:00]: [Server #3536466] Sending the current model to client #99 (simulated).
[INFO][08:13:04]: [Server #3536466] Sending 507.38 MB of payload data to client #99 (simulated).
[INFO][08:13:04]: [Client #38] Selected by the server.
[INFO][08:13:04]: [Client #99] Selected by the server.
[INFO][08:13:04]: [Client #38] Loading its data source...
[INFO][08:13:04]: Data source: HuggingFace
[INFO][08:13:04]: [Client #99] Loading its data source...
[INFO][08:13:04]: Dataset: tiny_shakespeare
[INFO][08:13:04]: Data source: HuggingFace
[INFO][08:13:04]: Dataset: tiny_shakespeare
[WARNING][08:13:05]: num_proc must be <= 1. Reducing num_proc to 1 for dataset of size 1.
Running tokenizer on dataset:   0%|          | 0/1 [00:00<?, ?ba/s][WARNING][08:13:05]: num_proc must be <= 1. Reducing num_proc to 1 for dataset of size 1.
Running tokenizer on dataset:   0%|          | 0/1 [00:00<?, ?ba/s]Token indices sequence length is longer than the specified maximum sequence length for this model (258335 > 512). Running this sequence through the model will result in indexing errors
^^^^^^^^^^^^^^^^ Please ignore the warning above - this long input will be chunked into smaller bits before being passed to the model.
Running tokenizer on dataset:   0%|          | 0/1 [00:00<?, ?ba/s]
[WARNING][08:13:06]: num_proc must be <= 1. Reducing num_proc to 1 for dataset of size 1.
Grouping texts in chunks of 512:   0%|          | 0/1 [00:00<?, ?ba/s]Token indices sequence length is longer than the specified maximum sequence length for this model (258335 > 512). Running this sequence through the model will result in indexing errors
^^^^^^^^^^^^^^^^ Please ignore the warning above - this long input will be chunked into smaller bits before being passed to the model.
Running tokenizer on dataset:   0%|          | 0/1 [00:00<?, ?ba/s]
[WARNING][08:13:06]: num_proc must be <= 1. Reducing num_proc to 1 for dataset of size 1.
Grouping texts in chunks of 512:   0%|          | 0/1 [00:00<?, ?ba/s]Grouping texts in chunks of 512:   0%|          | 0/1 [00:00<?, ?ba/s]
[WARNING][08:13:06]: num_proc must be <= 1. Reducing num_proc to 1 for dataset of size 1.
Running tokenizer on dataset:   0%|          | 0/1 [00:00<?, ?ba/s]Running tokenizer on dataset:   0%|          | 0/1 [00:00<?, ?ba/s]
[WARNING][08:13:06]: num_proc must be <= 1. Reducing num_proc to 1 for dataset of size 1.
Grouping texts in chunks of 512:   0%|          | 0/1 [00:00<?, ?ba/s]Grouping texts in chunks of 512:   0%|          | 0/1 [00:00<?, ?ba/s]
[INFO][08:13:06]: [Client #99] Dataset size: 2018
[INFO][08:13:06]: [Client #99] Sampler: iid
Grouping texts in chunks of 512:   0%|          | 0/1 [00:00<?, ?ba/s]
[WARNING][08:13:06]: num_proc must be <= 1. Reducing num_proc to 1 for dataset of size 1.
[WARNING][08:13:06]: Loading cached processed dataset at /data/ykang/plato/data/tiny_shakespeare_None/validation/cache-836576d107e75433.arrow
[WARNING][08:13:06]: num_proc must be <= 1. Reducing num_proc to 1 for dataset of size 1.
[WARNING][08:13:06]: Loading cached processed dataset at /data/ykang/plato/data/tiny_shakespeare_None/validation/cache-2ff0a53fa728aab3.arrow
[INFO][08:13:06]: [Client #38] Dataset size: 2018
[INFO][08:13:06]: [Client #38] Sampler: iid
[INFO][08:13:07]: [Client #99] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:13:07]: [Client #99] Start to process inbound data.
[INFO][08:13:08]: [Client #38] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:13:08]: [Client #38] Start to process inbound data.
[INFO][08:13:08]: [93m[1m[Client #99] Started training in communication round #1.[0m
[INFO][08:13:09]: [93m[1m[Client #38] Started training in communication round #1.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:13,  4.12s/it]  2%|▏         | 1/48 [00:04<03:22,  4.31s/it]  4%|▍         | 2/48 [00:04<01:37,  2.13s/it]  4%|▍         | 2/48 [00:05<01:41,  2.21s/it]  6%|▋         | 3/48 [00:05<01:06,  1.48s/it]  6%|▋         | 3/48 [00:05<01:09,  1.54s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:06<00:54,  1.23s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:45,  1.05s/it] 12%|█▎        | 6/48 [00:07<00:38,  1.08it/s] 12%|█▎        | 6/48 [00:08<00:39,  1.06it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.16it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 17%|█▋        | 8/48 [00:09<00:32,  1.22it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 19%|█▉        | 9/48 [00:09<00:30,  1.26it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 21%|██        | 10/48 [00:10<00:29,  1.29it/s] 21%|██        | 10/48 [00:10<00:29,  1.29it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.34it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.35it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.35it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.42it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:16,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.32it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:23<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:32<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.31it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s]100%|██████████| 48/48 [00:38<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.39it/s]100%|██████████| 48/48 [00:38<00:00,  1.24it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][08:13:54]: [Client #38] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_38_3536584.pth.
{'train_runtime': 38.8162, 'train_samples_per_second': 155.966, 'train_steps_per_second': 1.237, 'train_loss': 5.671085357666016, 'epoch': 3.0}
[INFO][08:13:54]: [Client #99] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_99_3536585.pth.
{'train_runtime': 39.0083, 'train_samples_per_second': 155.198, 'train_steps_per_second': 1.231, 'train_loss': 5.631643931070964, 'epoch': 3.0}
[INFO][08:13:55]: [Client #38] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_38_3536584.pth.
[INFO][08:13:55]: [Client #99] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_99_3536585.pth.
[INFO][08:13:56]: [Client #38] Model trained.
[INFO][08:13:56]: [Client #38] Inbound data has been processed.
[INFO][08:13:56]: [Client #38] Outbound data is ready to be sent after being processed.
[INFO][08:13:56]: [Client #99] Model trained.
[INFO][08:13:56]: [Client #99] Inbound data has been processed.
[INFO][08:13:56]: [Client #99] Outbound data is ready to be sent after being processed.
[INFO][08:14:03]: [Client #38] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:14:04]: [Client #99] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:14:05]: [Server #3536466] Received 507.38 MB of payload data from client #38 (simulated).
[INFO][08:14:06]: [Server #3536466] Received 507.38 MB of payload data from client #99 (simulated).
[INFO][08:14:06]: [Server #3536466] Selecting client #8 for training.
[INFO][08:14:06]: [Server #3536466] Sending the current model to client #8 (simulated).
[INFO][08:14:11]: [Server #3536466] Sending 507.38 MB of payload data to client #8 (simulated).
[INFO][08:14:11]: [Server #3536466] Selecting client #69 for training.
[INFO][08:14:11]: [Server #3536466] Sending the current model to client #69 (simulated).
[INFO][08:14:16]: [Server #3536466] Sending 507.38 MB of payload data to client #69 (simulated).
[INFO][08:14:16]: [Client #8] Selected by the server.
[INFO][08:14:16]: [Client #8] Loading its data source...
[INFO][08:14:16]: [Client #8] Dataset size: 2018
[INFO][08:14:16]: [Client #8] Sampler: iid
[INFO][08:14:16]: [Client #69] Selected by the server.
[INFO][08:14:16]: [Client #69] Loading its data source...
[INFO][08:14:16]: [Client #69] Dataset size: 2018
[INFO][08:14:16]: [Client #69] Sampler: iid
[INFO][08:14:17]: [Client #8] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:14:17]: [Client #8] Start to process inbound data.
[INFO][08:14:17]: [Client #69] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:14:17]: [Client #69] Start to process inbound data.
[INFO][08:14:18]: [93m[1m[Client #8] Started training in communication round #1.[0m
[INFO][08:14:18]: [93m[1m[Client #69] Started training in communication round #1.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.19s/it]  2%|▏         | 1/48 [00:04<03:22,  4.30s/it]  4%|▍         | 2/48 [00:04<01:38,  2.14s/it]  4%|▍         | 2/48 [00:05<01:42,  2.22s/it]  6%|▋         | 3/48 [00:05<01:07,  1.51s/it]  6%|▋         | 3/48 [00:05<01:09,  1.55s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:06<00:54,  1.23s/it] 10%|█         | 5/48 [00:07<00:45,  1.05s/it] 10%|█         | 5/48 [00:07<00:45,  1.06s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:39,  1.05it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.14it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.33it/s] 60%|██████    | 29/48 [00:24<00:14,  1.31it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.32it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:35<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:38<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.37it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][08:15:03]: [Client #8] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_8_3536584.pth.
{'train_runtime': 38.9326, 'train_samples_per_second': 155.5, 'train_steps_per_second': 1.233, 'train_loss': 5.617499669392903, 'epoch': 3.0}
[INFO][08:15:03]: [Client #69] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536585.pth.
{'train_runtime': 39.0599, 'train_samples_per_second': 154.993, 'train_steps_per_second': 1.229, 'train_loss': 5.631659189860026, 'epoch': 3.0}
[INFO][08:15:04]: [Client #8] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_8_3536584.pth.
[INFO][08:15:04]: [Client #69] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536585.pth.
[INFO][08:15:04]: [Client #8] Model trained.
[INFO][08:15:04]: [Client #8] Inbound data has been processed.
[INFO][08:15:04]: [Client #8] Outbound data is ready to be sent after being processed.
[INFO][08:15:04]: [Client #69] Model trained.
[INFO][08:15:04]: [Client #69] Inbound data has been processed.
[INFO][08:15:04]: [Client #69] Outbound data is ready to be sent after being processed.
[INFO][08:15:13]: [Client #8] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:15:14]: [Client #69] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:15:14]: [Server #3536466] Received 507.38 MB of payload data from client #8 (simulated).
[INFO][08:15:15]: [Server #3536466] Received 507.38 MB of payload data from client #69 (simulated).
[INFO][08:15:15]: [Server #3536466] Selecting client #82 for training.
[INFO][08:15:15]: [Server #3536466] Sending the current model to client #82 (simulated).
[INFO][08:15:20]: [Server #3536466] Sending 507.38 MB of payload data to client #82 (simulated).
[INFO][08:15:20]: [Server #3536466] Selecting client #47 for training.
[INFO][08:15:20]: [Server #3536466] Sending the current model to client #47 (simulated).
[INFO][08:15:25]: [Server #3536466] Sending 507.38 MB of payload data to client #47 (simulated).
[INFO][08:15:25]: [Client #47] Selected by the server.
[INFO][08:15:25]: [Client #82] Selected by the server.
[INFO][08:15:25]: [Client #47] Loading its data source...
[INFO][08:15:25]: [Client #82] Loading its data source...
[INFO][08:15:25]: [Client #47] Dataset size: 2018
[INFO][08:15:25]: [Client #47] Sampler: iid
[INFO][08:15:25]: [Client #82] Dataset size: 2018
[INFO][08:15:25]: [Client #82] Sampler: iid
[INFO][08:15:26]: [Client #82] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:15:26]: [Client #82] Start to process inbound data.
[INFO][08:15:26]: [Client #47] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:15:26]: [Client #47] Start to process inbound data.
[INFO][08:15:27]: [93m[1m[Client #82] Started training in communication round #1.[0m
[INFO][08:15:27]: [93m[1m[Client #47] Started training in communication round #1.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:22,  4.31s/it]  2%|▏         | 1/48 [00:04<03:49,  4.89s/it]  4%|▍         | 2/48 [00:05<01:47,  2.33s/it]  4%|▍         | 2/48 [00:05<02:01,  2.64s/it]  6%|▋         | 3/48 [00:06<01:18,  1.75s/it]  6%|▋         | 3/48 [00:06<01:25,  1.89s/it]  8%|▊         | 4/48 [00:07<01:03,  1.45s/it]  8%|▊         | 4/48 [00:07<01:05,  1.49s/it] 10%|█         | 5/48 [00:08<00:52,  1.23s/it] 10%|█         | 5/48 [00:08<00:53,  1.24s/it] 12%|█▎        | 6/48 [00:08<00:44,  1.06s/it] 12%|█▎        | 6/48 [00:09<00:45,  1.08s/it] 15%|█▍        | 7/48 [00:09<00:38,  1.06it/s] 15%|█▍        | 7/48 [00:10<00:40,  1.01it/s] 17%|█▋        | 8/48 [00:10<00:35,  1.13it/s] 17%|█▋        | 8/48 [00:10<00:36,  1.09it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.18it/s] 19%|█▉        | 9/48 [00:11<00:33,  1.17it/s] 21%|██        | 10/48 [00:11<00:30,  1.23it/s] 21%|██        | 10/48 [00:12<00:31,  1.22it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.26it/s] 23%|██▎       | 11/48 [00:13<00:29,  1.24it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.26it/s] 27%|██▋       | 13/48 [00:14<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:14<00:27,  1.28it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:15<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:16<00:25,  1.31it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.36it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.39it/s] 35%|███▌      | 17/48 [00:17<00:23,  1.35it/s] 35%|███▌      | 17/48 [00:17<00:23,  1.34it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:18<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:19<00:21,  1.32it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.33it/s] 42%|████▏     | 20/48 [00:19<00:21,  1.33it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.33it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:21<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:22<00:18,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 50%|█████     | 24/48 [00:22<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:24<00:16,  1.32it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:25<00:16,  1.30it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.33it/s] 60%|██████    | 29/48 [00:26<00:14,  1.32it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:27<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:28<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:30<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:31<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.31it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:33<00:07,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:34<00:06,  1.30it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:36<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:37<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:39<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:40<00:00,  1.32it/s]100%|██████████| 48/48 [00:40<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.36it/s]100%|██████████| 48/48 [00:40<00:00,  1.19it/s]
100%|██████████| 48/48 [00:40<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.53it/s]100%|██████████| 48/48 [00:40<00:00,  1.18it/s]
[INFO][08:16:13]: [Client #82] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_82_3536584.pth.
{'train_runtime': 40.2001, 'train_samples_per_second': 150.596, 'train_steps_per_second': 1.194, 'train_loss': 5.653917948404948, 'epoch': 3.0}
[INFO][08:16:14]: [Client #47] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_47_3536585.pth.
{'train_runtime': 40.5365, 'train_samples_per_second': 149.347, 'train_steps_per_second': 1.184, 'train_loss': 5.61421012878418, 'epoch': 3.0}
[INFO][08:16:14]: [Client #82] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_82_3536584.pth.
[INFO][08:16:15]: [Client #47] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_47_3536585.pth.
[INFO][08:16:15]: [Client #82] Model trained.
[INFO][08:16:15]: [Client #82] Inbound data has been processed.
[INFO][08:16:15]: [Client #82] Outbound data is ready to be sent after being processed.
[INFO][08:16:15]: [Client #47] Model trained.
[INFO][08:16:15]: [Client #47] Inbound data has been processed.
[INFO][08:16:15]: [Client #47] Outbound data is ready to be sent after being processed.
[INFO][08:16:23]: [Client #82] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:16:24]: [Client #47] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:16:24]: [Server #3536466] Received 507.38 MB of payload data from client #82 (simulated).
[INFO][08:16:25]: [Server #3536466] Received 507.38 MB of payload data from client #47 (simulated).
[INFO][08:16:25]: [Server #3536466] Selecting client #88 for training.
[INFO][08:16:25]: [Server #3536466] Sending the current model to client #88 (simulated).
[INFO][08:16:30]: [Server #3536466] Sending 507.38 MB of payload data to client #88 (simulated).
[INFO][08:16:30]: [Server #3536466] Selecting client #17 for training.
[INFO][08:16:30]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][08:16:35]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][08:16:35]: [Client #88] Selected by the server.
[INFO][08:16:35]: [Client #17] Selected by the server.
[INFO][08:16:35]: [Client #88] Loading its data source...
[INFO][08:16:35]: [Client #17] Loading its data source...
[INFO][08:16:35]: [Client #88] Dataset size: 2018
[INFO][08:16:35]: [Client #17] Dataset size: 2018
[INFO][08:16:35]: [Client #88] Sampler: iid
[INFO][08:16:35]: [Client #17] Sampler: iid
[INFO][08:16:37]: [Client #88] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:16:37]: [Client #88] Start to process inbound data.
[INFO][08:16:37]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:16:37]: [Client #17] Start to process inbound data.
[INFO][08:16:38]: [93m[1m[Client #88] Started training in communication round #1.[0m
[INFO][08:16:38]: [93m[1m[Client #17] Started training in communication round #1.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:26,  4.39s/it]  2%|▏         | 1/48 [00:04<03:27,  4.41s/it]  4%|▍         | 2/48 [00:05<01:47,  2.33s/it]  4%|▍         | 2/48 [00:05<01:47,  2.35s/it]  6%|▋         | 3/48 [00:06<01:12,  1.61s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  8%|▊         | 4/48 [00:06<00:55,  1.26s/it]  8%|▊         | 4/48 [00:06<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.05it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.32it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][08:17:23]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 39.3592, 'train_samples_per_second': 153.814, 'train_steps_per_second': 1.22, 'train_loss': 5.6264292399088545, 'epoch': 3.0}
[INFO][08:17:23]: [Client #88] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_88_3536584.pth.
{'train_runtime': 39.4483, 'train_samples_per_second': 153.467, 'train_steps_per_second': 1.217, 'train_loss': 5.607434590657552, 'epoch': 3.0}
[INFO][08:17:24]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][08:17:24]: [Client #88] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_88_3536584.pth.
[INFO][08:17:24]: [Client #17] Model trained.
[INFO][08:17:24]: [Client #17] Inbound data has been processed.
[INFO][08:17:24]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][08:17:24]: [Client #88] Model trained.
[INFO][08:17:24]: [Client #88] Inbound data has been processed.
[INFO][08:17:24]: [Client #88] Outbound data is ready to be sent after being processed.
[INFO][08:17:33]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:17:33]: [Client #88] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:17:34]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][08:17:35]: [Server #3536466] Received 507.38 MB of payload data from client #88 (simulated).
[INFO][08:17:35]: [Server #3536466] Selecting client #19 for training.
[INFO][08:17:35]: [Server #3536466] Sending the current model to client #19 (simulated).
[INFO][08:17:40]: [Server #3536466] Sending 507.38 MB of payload data to client #19 (simulated).
[INFO][08:17:40]: [Server #3536466] Selecting client #57 for training.
[INFO][08:17:40]: [Server #3536466] Sending the current model to client #57 (simulated).
[INFO][08:17:45]: [Server #3536466] Sending 507.38 MB of payload data to client #57 (simulated).
[INFO][08:17:45]: [Client #19] Selected by the server.
[INFO][08:17:45]: [Client #19] Loading its data source...
[INFO][08:17:45]: [Client #19] Dataset size: 2018
[INFO][08:17:45]: [Client #19] Sampler: iid
[INFO][08:17:45]: [Client #57] Selected by the server.
[INFO][08:17:45]: [Client #57] Loading its data source...
[INFO][08:17:45]: [Client #57] Dataset size: 2018
[INFO][08:17:45]: [Client #57] Sampler: iid
[INFO][08:17:46]: [Client #19] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:17:46]: [Client #19] Start to process inbound data.
[INFO][08:17:46]: [Client #57] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:17:46]: [Client #57] Start to process inbound data.
[INFO][08:17:46]: [93m[1m[Client #19] Started training in communication round #1.[0m
[INFO][08:17:47]: [93m[1m[Client #57] Started training in communication round #1.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:14,  4.14s/it]  2%|▏         | 1/48 [00:04<03:16,  4.19s/it]  4%|▍         | 2/48 [00:04<01:38,  2.15s/it]  4%|▍         | 2/48 [00:04<01:39,  2.16s/it]  6%|▋         | 3/48 [00:05<01:07,  1.50s/it]  6%|▋         | 3/48 [00:05<01:08,  1.51s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:06<00:53,  1.20s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 12%|█▎        | 6/48 [00:07<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:07<00:39,  1.05it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 21%|██        | 10/48 [00:10<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][08:18:31]: [Client #19] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_19_3536584.pth.
{'train_runtime': 39.0192, 'train_samples_per_second': 155.155, 'train_steps_per_second': 1.23, 'train_loss': 5.627712885538737, 'epoch': 3.0}
[INFO][08:18:31]: [Client #57] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536585.pth.
{'train_runtime': 39.0398, 'train_samples_per_second': 155.073, 'train_steps_per_second': 1.23, 'train_loss': 5.6184126536051435, 'epoch': 3.0}
[INFO][08:18:32]: [Client #19] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_19_3536584.pth.
[INFO][08:18:32]: [Client #57] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536585.pth.
[INFO][08:18:33]: [Client #19] Model trained.
[INFO][08:18:33]: [Client #19] Inbound data has been processed.
[INFO][08:18:33]: [Client #19] Outbound data is ready to be sent after being processed.
[INFO][08:18:33]: [Client #57] Model trained.
[INFO][08:18:33]: [Client #57] Inbound data has been processed.
[INFO][08:18:33]: [Client #57] Outbound data is ready to be sent after being processed.
[INFO][08:18:43]: [Client #19] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:18:43]: [Client #57] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:18:44]: [Server #3536466] Received 507.38 MB of payload data from client #19 (simulated).
[INFO][08:18:45]: [Server #3536466] Received 507.38 MB of payload data from client #57 (simulated).
[INFO][08:18:45]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][08:18:45]: [Server #3536466] Adding client #57 to the list of clients for aggregation.
[INFO][08:18:45]: [Server #3536466] Adding client #88 to the list of clients for aggregation.
[INFO][08:18:45]: [Server #3536466] Adding client #69 to the list of clients for aggregation.
[INFO][08:18:45]: [Server #3536466] Adding client #8 to the list of clients for aggregation.
[INFO][08:18:45]: [Server #3536466] Aggregating 5 clients in total.
[INFO][08:18:45]: [Server #3536466] Updated weights have been received.
[INFO][08:18:45]: [Server #3536466] Aggregating model weight deltas.
[INFO][08:18:46]: [Server #3536466] Finished aggregating updated weights.
[INFO][08:18:46]: [Server #3536466] Started model testing.
======== Running on http://127.0.0.1:1200 ========
(Press CTRL+C to quit)
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00 -5.9913e+00  1e+02  1e+00  1e+00
 1: -5.9413e+00 -6.9913e+00  2e+00  1e-02  1e-02
 2: -6.0009e+00 -6.5097e+00  5e-01  4e-13  8e-14
 3: -6.0013e+00 -6.0063e+00  5e-03  4e-15  9e-16
 4: -6.0013e+00 -6.0013e+00  5e-05  6e-17  1e-17
 5: -6.0013e+00 -6.0013e+00  5e-07  4e-17  4e-19
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.1  0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.1  0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.26it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.73it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.08it/s]100%|██████████| 8/8 [00:00<00:00, 11.88it/s]
[INFO][08:18:56]: [93m[1m[Server #3536466] Global model perplexity: 139.42
[0m
[INFO][08:18:56]: [Server #3536466] All client reports have been processed.
[INFO][08:18:56]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_1.pth.
[INFO][08:18:59]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_1.pth.
[INFO][08:18:59]: [93m[1m
[Server #3536466] Starting round 2/100.[0m
[INFO][08:18:59]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 1.99999962e-01,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       1.99999962e-01, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 1.99999962e-01, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 1.99999962e-01, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 1.99999962e-01,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09, 2.10193373e-09,
       2.10193373e-09, 2.10193373e-09, 2.10193373e-09]),)
[INFO][08:18:59]: [Server #3536466] Selected clients: [17 57 88 69  8]
[INFO][08:18:59]: [Server #3536466] Selecting client #8 for training.
[INFO][08:18:59]: [Server #3536466] Sending the current model to client #8 (simulated).
[INFO][08:19:04]: [Server #3536466] Sending 507.38 MB of payload data to client #8 (simulated).
[INFO][08:19:04]: [Server #3536466] Selecting client #17 for training.
[INFO][08:19:04]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][08:19:09]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][08:19:09]: [Client #8] Selected by the server.
[INFO][08:19:09]: [Client #8] Loading its data source...
[INFO][08:19:09]: [Client #8] Dataset size: 2018
[INFO][08:19:09]: [Client #8] Sampler: iid
[INFO][08:19:09]: [Client #17] Selected by the server.
[INFO][08:19:09]: [Client #17] Loading its data source...
[INFO][08:19:09]: [Client #17] Dataset size: 2018
[INFO][08:19:09]: [Client #17] Sampler: iid
[INFO][08:19:10]: [Client #8] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:19:10]: [Client #8] Start to process inbound data.
[INFO][08:19:10]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:19:10]: [Client #17] Start to process inbound data.
[INFO][08:19:11]: [93m[1m[Client #8] Started training in communication round #2.[0m
[INFO][08:19:11]: [93m[1m[Client #17] Started training in communication round #2.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:20,  4.26s/it]  2%|▏         | 1/48 [00:04<03:18,  4.23s/it]  4%|▍         | 2/48 [00:04<01:40,  2.19s/it]  4%|▍         | 2/48 [00:05<01:41,  2.20s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  6%|▋         | 3/48 [00:05<01:09,  1.54s/it]  8%|▊         | 4/48 [00:06<00:53,  1.22s/it]  8%|▊         | 4/48 [00:06<00:53,  1.23s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 10%|█         | 5/48 [00:07<00:45,  1.05s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:07<00:39,  1.06it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 21%|██        | 10/48 [00:10<00:30,  1.27it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.32it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:19,  1.31it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.32it/s] 50%|█████     | 24/48 [00:21<00:18,  1.31it/s] 50%|█████     | 24/48 [00:21<00:18,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.32it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s]100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][08:19:56]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 39.0825, 'train_samples_per_second': 154.903, 'train_steps_per_second': 1.228, 'train_loss': 4.614436785380046, 'epoch': 3.0}
[INFO][08:19:56]: [Client #8] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_8_3536584.pth.
{'train_runtime': 39.1043, 'train_samples_per_second': 154.817, 'train_steps_per_second': 1.227, 'train_loss': 4.612068176269531, 'epoch': 3.0}
[INFO][08:19:57]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][08:19:57]: [Client #8] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_8_3536584.pth.
[INFO][08:19:57]: [Client #17] Model trained.
[INFO][08:19:57]: [Client #17] Inbound data has been processed.
[INFO][08:19:57]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][08:19:58]: [Client #8] Model trained.
[INFO][08:19:58]: [Client #8] Inbound data has been processed.
[INFO][08:19:58]: [Client #8] Outbound data is ready to be sent after being processed.
[INFO][08:20:07]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:20:07]: [Client #8] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:20:07]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][08:20:08]: [Server #3536466] Received 507.38 MB of payload data from client #8 (simulated).
[INFO][08:20:08]: [Server #3536466] Selecting client #88 for training.
[INFO][08:20:08]: [Server #3536466] Sending the current model to client #88 (simulated).
[INFO][08:20:12]: [Server #3536466] Sending 507.38 MB of payload data to client #88 (simulated).
[INFO][08:20:12]: [Server #3536466] Selecting client #69 for training.
[INFO][08:20:12]: [Server #3536466] Sending the current model to client #69 (simulated).
[INFO][08:20:17]: [Server #3536466] Sending 507.38 MB of payload data to client #69 (simulated).
[INFO][08:20:17]: [Client #69] Selected by the server.
[INFO][08:20:17]: [Client #69] Loading its data source...
[INFO][08:20:17]: [Client #88] Selected by the server.
[INFO][08:20:17]: [Client #88] Loading its data source...
[INFO][08:20:17]: [Client #69] Dataset size: 2018
[INFO][08:20:17]: [Client #69] Sampler: iid
[INFO][08:20:17]: [Client #88] Dataset size: 2018
[INFO][08:20:17]: [Client #88] Sampler: iid
[INFO][08:20:18]: [Client #69] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:20:18]: [Client #69] Start to process inbound data.
[INFO][08:20:18]: [93m[1m[Client #69] Started training in communication round #2.[0m
[INFO][08:20:18]: [Client #88] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:20:18]: [Client #88] Start to process inbound data.
[INFO][08:20:18]: [93m[1m[Client #88] Started training in communication round #2.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:20,  4.27s/it]  2%|▏         | 1/48 [00:04<03:52,  4.94s/it]  4%|▍         | 2/48 [00:04<01:40,  2.18s/it]  4%|▍         | 2/48 [00:05<01:53,  2.47s/it]  6%|▋         | 3/48 [00:05<01:08,  1.53s/it]  6%|▋         | 3/48 [00:06<01:15,  1.67s/it]  8%|▊         | 4/48 [00:06<00:53,  1.22s/it]  8%|▊         | 4/48 [00:07<00:57,  1.31s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.06it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.16it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:10<00:30,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.42it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.32it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][08:21:03]: [Client #69] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536585.pth.
{'train_runtime': 39.1343, 'train_samples_per_second': 154.698, 'train_steps_per_second': 1.227, 'train_loss': 4.597677866617839, 'epoch': 3.0}
[INFO][08:21:04]: [Client #88] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_88_3536584.pth.
{'train_runtime': 39.5533, 'train_samples_per_second': 153.059, 'train_steps_per_second': 1.214, 'train_loss': 4.601393381754558, 'epoch': 3.0}
[INFO][08:21:04]: [Client #69] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536585.pth.
[INFO][08:21:05]: [Client #69] Model trained.
[INFO][08:21:05]: [Client #69] Inbound data has been processed.
[INFO][08:21:05]: [Client #69] Outbound data is ready to be sent after being processed.
[INFO][08:21:05]: [Client #88] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_88_3536584.pth.
[INFO][08:21:05]: [Client #88] Model trained.
[INFO][08:21:05]: [Client #88] Inbound data has been processed.
[INFO][08:21:05]: [Client #88] Outbound data is ready to be sent after being processed.
[INFO][08:21:13]: [Client #69] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:21:14]: [Server #3536466] Received 507.38 MB of payload data from client #69 (simulated).
[INFO][08:21:14]: [Client #88] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:21:15]: [Server #3536466] Received 507.38 MB of payload data from client #88 (simulated).
[INFO][08:21:15]: [Server #3536466] Selecting client #57 for training.
[INFO][08:21:15]: [Server #3536466] Sending the current model to client #57 (simulated).
[INFO][08:21:20]: [Server #3536466] Sending 507.38 MB of payload data to client #57 (simulated).
[INFO][08:21:20]: [Client #57] Selected by the server.
[INFO][08:21:20]: [Client #57] Loading its data source...
[INFO][08:21:20]: [Client #57] Dataset size: 2018
[INFO][08:21:20]: [Client #57] Sampler: iid
[INFO][08:21:21]: [Client #57] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:21:21]: [Client #57] Start to process inbound data.
[INFO][08:21:21]: [93m[1m[Client #57] Started training in communication round #2.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<03:00,  3.84s/it]  4%|▍         | 2/48 [00:04<01:25,  1.87s/it]  6%|▋         | 3/48 [00:04<00:55,  1.23s/it]  8%|▊         | 4/48 [00:05<00:41,  1.06it/s] 10%|█         | 5/48 [00:05<00:33,  1.29it/s] 12%|█▎        | 6/48 [00:06<00:28,  1.48it/s] 15%|█▍        | 7/48 [00:06<00:25,  1.63it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.74it/s] 19%|█▉        | 9/48 [00:07<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:08<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.97it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.01it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.03it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.14it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.11it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.09it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.08it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.07it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.06it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.06it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.06it/s] 50%|█████     | 24/48 [00:14<00:11,  2.06it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.06it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.05it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.05it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.05it/s] 60%|██████    | 29/48 [00:17<00:09,  2.05it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.05it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.05it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.16it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.12it/s] 71%|███████   | 34/48 [00:19<00:06,  2.10it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.08it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.07it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.06it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.06it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.05it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.05it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.05it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.05it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.05it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.05it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.05it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.05it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.05it/s]100%|██████████| 48/48 [00:26<00:00,  2.15it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.15it/s]100%|██████████| 48/48 [00:26<00:00,  1.81it/s]
[INFO][08:21:53]: [Client #57] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536584.pth.
{'train_runtime': 26.5142, 'train_samples_per_second': 228.331, 'train_steps_per_second': 1.81, 'train_loss': 4.58954652150472, 'epoch': 3.0}
[INFO][08:21:54]: [Client #57] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536584.pth.
[INFO][08:21:55]: [Client #57] Model trained.
[INFO][08:21:55]: [Client #57] Inbound data has been processed.
[INFO][08:21:55]: [Client #57] Outbound data is ready to be sent after being processed.
[INFO][08:22:00]: [Client #57] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:22:01]: [Server #3536466] Received 507.38 MB of payload data from client #57 (simulated).
[INFO][08:22:01]: [Server #3536466] Adding client #38 to the list of clients for aggregation.
[INFO][08:22:01]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][08:22:01]: [Server #3536466] Adding client #57 to the list of clients for aggregation.
[INFO][08:22:01]: [Server #3536466] Adding client #88 to the list of clients for aggregation.
[INFO][08:22:01]: [Server #3536466] Adding client #69 to the list of clients for aggregation.
[INFO][08:22:01]: [Server #3536466] Aggregating 5 clients in total.
[INFO][08:22:01]: [Server #3536466] Updated weights have been received.
[INFO][08:22:01]: [Server #3536466] Aggregating model weight deltas.
[INFO][08:22:01]: [Server #3536466] Finished aggregating updated weights.
[INFO][08:22:01]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00 -2.9327e+00  1e+02  1e+00  1e+00
 1: -3.0680e+00 -3.9354e+00  2e+00  1e-02  1e-02
 2: -3.0289e+00 -3.4818e+00  5e-01  4e-05  3e-05
 3: -3.0433e+00 -3.1185e+00  8e-02  8e-06  5e-06
 4: -3.0863e+00 -3.1144e+00  3e-02  2e-05  1e-05
 5: -3.1141e+00 -3.1143e+00  3e-04  7e-06  5e-06
 6: -3.1143e+00 -3.1143e+00  3e-06  9e-08  6e-08
 7: -3.1143e+00 -3.1143e+00  3e-08  9e-10  6e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.1  0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.1  0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.14it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.55it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.07it/s]100%|██████████| 8/8 [00:00<00:00, 11.88it/s]
[INFO][08:22:11]: [93m[1m[Server #3536466] Global model perplexity: 80.85
[0m
[INFO][08:22:11]: [Server #3536466] All client reports have been processed.
[INFO][08:22:11]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_2.pth.
[INFO][08:22:14]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_2.pth.
[INFO][08:22:15]: [93m[1m
[Server #3536466] Starting round 3/100.[0m
[INFO][08:22:15]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 2.49999153e-01,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.55310677e-09,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 2.49999153e-01, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 2.49999153e-01, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 2.49999153e-01,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08, 3.76211980e-08,
       3.76211980e-08, 3.76211980e-08, 3.76211980e-08]),)
[INFO][08:22:15]: [Server #3536466] Selected clients: [17 57 69 88 42]
[INFO][08:22:15]: [Server #3536466] Selecting client #88 for training.
[INFO][08:22:15]: [Server #3536466] Sending the current model to client #88 (simulated).
[INFO][08:22:20]: [Server #3536466] Sending 507.38 MB of payload data to client #88 (simulated).
[INFO][08:22:20]: [Server #3536466] Selecting client #17 for training.
[INFO][08:22:20]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][08:22:25]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][08:22:25]: [Client #88] Selected by the server.
[INFO][08:22:25]: [Client #17] Selected by the server.
[INFO][08:22:25]: [Client #88] Loading its data source...
[INFO][08:22:25]: [Client #17] Loading its data source...
[INFO][08:22:25]: [Client #88] Dataset size: 2018
[INFO][08:22:25]: [Client #17] Dataset size: 2018
[INFO][08:22:25]: [Client #88] Sampler: iid
[INFO][08:22:25]: [Client #17] Sampler: iid
[INFO][08:22:26]: [Client #88] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:22:26]: [Client #88] Start to process inbound data.
[INFO][08:22:26]: [93m[1m[Client #88] Started training in communication round #3.[0m
[INFO][08:22:26]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:22:26]: [Client #17] Start to process inbound data.
[INFO][08:22:26]: [93m[1m[Client #17] Started training in communication round #3.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  2%|▏         | 1/48 [00:04<03:22,  4.31s/it]  4%|▍         | 2/48 [00:04<01:40,  2.18s/it]  4%|▍         | 2/48 [00:05<01:42,  2.23s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  6%|▋         | 3/48 [00:05<01:09,  1.55s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it]  8%|▊         | 4/48 [00:06<00:54,  1.23s/it] 10%|█         | 5/48 [00:07<00:45,  1.05s/it] 10%|█         | 5/48 [00:07<00:45,  1.06s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.06it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.05it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.31it/s] 60%|██████    | 29/48 [00:25<00:14,  1.32it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.31it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.32it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.35it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.35it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.35it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.31it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][08:23:11]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 39.0168, 'train_samples_per_second': 155.164, 'train_steps_per_second': 1.23, 'train_loss': 4.285652796427409, 'epoch': 3.0}
[INFO][08:23:11]: [Client #88] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_88_3536584.pth.
{'train_runtime': 39.1155, 'train_samples_per_second': 154.772, 'train_steps_per_second': 1.227, 'train_loss': 4.278087933858235, 'epoch': 3.0}
[INFO][08:23:12]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][08:23:12]: [Client #88] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_88_3536584.pth.
[INFO][08:23:12]: [Client #17] Model trained.
[INFO][08:23:12]: [Client #17] Inbound data has been processed.
[INFO][08:23:12]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][08:23:13]: [Client #88] Model trained.
[INFO][08:23:13]: [Client #88] Inbound data has been processed.
[INFO][08:23:13]: [Client #88] Outbound data is ready to be sent after being processed.
[INFO][08:23:21]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:23:22]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][08:23:22]: [Client #88] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:23:23]: [Server #3536466] Received 507.38 MB of payload data from client #88 (simulated).
[INFO][08:23:23]: [Server #3536466] Selecting client #42 for training.
[INFO][08:23:23]: [Server #3536466] Sending the current model to client #42 (simulated).
[INFO][08:23:28]: [Server #3536466] Sending 507.38 MB of payload data to client #42 (simulated).
[INFO][08:23:28]: [Server #3536466] Selecting client #69 for training.
[INFO][08:23:28]: [Server #3536466] Sending the current model to client #69 (simulated).
[INFO][08:23:33]: [Server #3536466] Sending 507.38 MB of payload data to client #69 (simulated).
[INFO][08:23:33]: [Client #42] Selected by the server.
[INFO][08:23:33]: [Client #42] Loading its data source...
[INFO][08:23:33]: [Client #69] Selected by the server.
[INFO][08:23:33]: [Client #42] Dataset size: 2018
[INFO][08:23:33]: [Client #69] Loading its data source...
[INFO][08:23:33]: [Client #42] Sampler: iid
[INFO][08:23:33]: [Client #69] Dataset size: 2018
[INFO][08:23:33]: [Client #69] Sampler: iid
[INFO][08:23:34]: [Client #69] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:23:34]: [Client #69] Start to process inbound data.
[INFO][08:23:34]: [Client #42] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:23:34]: [Client #42] Start to process inbound data.
[INFO][08:23:35]: [93m[1m[Client #69] Started training in communication round #3.[0m
[INFO][08:23:35]: [93m[1m[Client #42] Started training in communication round #3.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:21,  4.28s/it]  2%|▏         | 1/48 [00:04<03:22,  4.31s/it]  4%|▍         | 2/48 [00:05<01:40,  2.19s/it]  4%|▍         | 2/48 [00:05<01:42,  2.23s/it]  6%|▋         | 3/48 [00:05<01:08,  1.53s/it]  6%|▋         | 3/48 [00:05<01:09,  1.55s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it]  8%|▊         | 4/48 [00:06<00:54,  1.23s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 10%|█         | 5/48 [00:07<00:45,  1.05s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:39,  1.06it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:29,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.32it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.34it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s]100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][08:24:20]: [Client #42] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
{'train_runtime': 39.0236, 'train_samples_per_second': 155.137, 'train_steps_per_second': 1.23, 'train_loss': 4.359699249267578, 'epoch': 3.0}
[INFO][08:24:20]: [Client #69] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536585.pth.
{'train_runtime': 39.098, 'train_samples_per_second': 154.842, 'train_steps_per_second': 1.228, 'train_loss': 4.266502380371094, 'epoch': 3.0}
[INFO][08:24:21]: [Client #42] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
[INFO][08:24:21]: [Client #69] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536585.pth.
[INFO][08:24:21]: [Client #42] Model trained.
[INFO][08:24:21]: [Client #42] Inbound data has been processed.
[INFO][08:24:21]: [Client #42] Outbound data is ready to be sent after being processed.
[INFO][08:24:21]: [Client #69] Model trained.
[INFO][08:24:21]: [Client #69] Inbound data has been processed.
[INFO][08:24:21]: [Client #69] Outbound data is ready to be sent after being processed.
[INFO][08:24:31]: [Client #69] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:24:31]: [Client #42] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:24:31]: [Server #3536466] Received 507.38 MB of payload data from client #69 (simulated).
[INFO][08:24:32]: [Server #3536466] Received 507.38 MB of payload data from client #42 (simulated).
[INFO][08:24:32]: [Server #3536466] Selecting client #57 for training.
[INFO][08:24:32]: [Server #3536466] Sending the current model to client #57 (simulated).
[INFO][08:24:37]: [Server #3536466] Sending 507.38 MB of payload data to client #57 (simulated).
[INFO][08:24:37]: [Client #57] Selected by the server.
[INFO][08:24:37]: [Client #57] Loading its data source...
[INFO][08:24:37]: [Client #57] Dataset size: 2018
[INFO][08:24:37]: [Client #57] Sampler: iid
[INFO][08:24:39]: [Client #57] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:24:39]: [Client #57] Start to process inbound data.
[INFO][08:24:39]: [93m[1m[Client #57] Started training in communication round #3.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:56,  3.76s/it]  4%|▍         | 2/48 [00:04<01:24,  1.83s/it]  6%|▋         | 3/48 [00:04<00:54,  1.21s/it]  8%|▊         | 4/48 [00:05<00:40,  1.09it/s] 10%|█         | 5/48 [00:05<00:32,  1.31it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.51it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.87it/s] 21%|██        | 10/48 [00:08<00:19,  1.94it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:08<00:17,  2.02it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.06it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.19it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.16it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.14it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.12it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.11it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.10it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.10it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.09it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.09it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.09it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.19it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.16it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.12it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.11it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.10it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.09it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.09it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.09it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.08it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.08it/s]100%|██████████| 48/48 [00:26<00:00,  2.19it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.19it/s]100%|██████████| 48/48 [00:26<00:00,  1.85it/s]
[INFO][08:25:10]: [Client #57] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536584.pth.
{'train_runtime': 26.0136, 'train_samples_per_second': 232.724, 'train_steps_per_second': 1.845, 'train_loss': 4.260175704956055, 'epoch': 3.0}
[INFO][08:25:11]: [Client #57] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536584.pth.
[INFO][08:25:11]: [Client #57] Model trained.
[INFO][08:25:11]: [Client #57] Inbound data has been processed.
[INFO][08:25:11]: [Client #57] Outbound data is ready to be sent after being processed.
[INFO][08:25:16]: [Client #57] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:25:17]: [Server #3536466] Received 507.38 MB of payload data from client #57 (simulated).
[INFO][08:25:17]: [Server #3536466] Adding client #82 to the list of clients for aggregation.
[INFO][08:25:17]: [Server #3536466] Adding client #8 to the list of clients for aggregation.
[INFO][08:25:17]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][08:25:17]: [Server #3536466] Adding client #19 to the list of clients for aggregation.
[INFO][08:25:17]: [Server #3536466] Adding client #57 to the list of clients for aggregation.
[INFO][08:25:17]: [Server #3536466] Aggregating 5 clients in total.
[INFO][08:25:17]: [Server #3536466] Updated weights have been received.
[INFO][08:25:18]: [Server #3536466] Aggregating model weight deltas.
[INFO][08:25:18]: [Server #3536466] Finished aggregating updated weights.
[INFO][08:25:18]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00 -2.5607e+00  1e+02  1e+00  1e+00
 1: -2.3112e+00 -3.5540e+00  1e+01  1e-01  1e-01
 2: -2.5743e+00 -3.4837e+00  1e+00  1e-03  1e-03
 3: -2.5750e+00 -2.6938e+00  1e-01  4e-05  4e-05
 4: -2.6149e+00 -2.6835e+00  7e-02  9e-05  5e-06
 5: -2.6523e+00 -2.6796e+00  3e-02  1e-04  7e-06
 6: -2.6781e+00 -2.6791e+00  1e-03  5e-05  4e-06
 7: -2.6790e+00 -2.6790e+00  4e-05  1e-06  1e-07
 8: -2.6790e+00 -2.6790e+00  4e-07  1e-08  1e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.1  0.01 2.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.1  0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 2.1  0.01 0.01
 0.01 0.01 0.01 0.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.96it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.55it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.06it/s]100%|██████████| 8/8 [00:00<00:00, 11.88it/s]
[INFO][08:25:28]: [93m[1m[Server #3536466] Global model perplexity: 82.44
[0m
[INFO][08:25:28]: [Server #3536466] All client reports have been processed.
[INFO][08:25:28]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_3.pth.
[INFO][08:25:32]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_3.pth.
[INFO][08:25:32]: [93m[1m
[Server #3536466] Starting round 4/100.[0m
[INFO][08:25:32]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.34967290e-08,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       4.99993722e-01, 1.40737754e-07, 1.56486160e-09, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.34967290e-08, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 4.99993722e-01, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.56486160e-09, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07, 1.40737754e-07,
       1.40737754e-07, 1.40737754e-07, 1.40737754e-07]),)
[INFO][08:25:32]: [Server #3536466] Selected clients: [57 17 15 63 55]
[INFO][08:25:32]: [Server #3536466] Selecting client #17 for training.
[INFO][08:25:32]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][08:25:37]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][08:25:37]: [Server #3536466] Selecting client #55 for training.
[INFO][08:25:37]: [Server #3536466] Sending the current model to client #55 (simulated).
[INFO][08:25:42]: [Server #3536466] Sending 507.38 MB of payload data to client #55 (simulated).
[INFO][08:25:42]: [Client #17] Selected by the server.
[INFO][08:25:42]: [Client #17] Loading its data source...
[INFO][08:25:42]: [Client #55] Selected by the server.
[INFO][08:25:42]: [Client #17] Dataset size: 2018
[INFO][08:25:42]: [Client #55] Loading its data source...
[INFO][08:25:42]: [Client #17] Sampler: iid
[INFO][08:25:42]: [Client #55] Dataset size: 2018
[INFO][08:25:42]: [Client #55] Sampler: iid
[INFO][08:25:43]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:25:43]: [Client #17] Start to process inbound data.
[INFO][08:25:43]: [Client #55] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:25:43]: [Client #55] Start to process inbound data.
[INFO][08:25:44]: [93m[1m[Client #17] Started training in communication round #4.[0m
[INFO][08:25:44]: [93m[1m[Client #55] Started training in communication round #4.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:15,  4.17s/it]  2%|▏         | 1/48 [00:04<03:18,  4.22s/it]  4%|▍         | 2/48 [00:04<01:38,  2.15s/it]  4%|▍         | 2/48 [00:04<01:39,  2.17s/it]  6%|▋         | 3/48 [00:05<01:07,  1.50s/it]  6%|▋         | 3/48 [00:05<01:08,  1.51s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.08it/s] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.32it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:16,  1.31it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:24<00:14,  1.31it/s] 60%|██████    | 29/48 [00:24<00:14,  1.32it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.31it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s]100%|██████████| 48/48 [00:38<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.39it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
100%|██████████| 48/48 [00:38<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.41it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
[INFO][08:26:28]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536584.pth.
{'train_runtime': 38.9482, 'train_samples_per_second': 155.437, 'train_steps_per_second': 1.232, 'train_loss': 4.233879407246907, 'epoch': 3.0}
[INFO][08:26:28]: [Client #55] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_55_3536585.pth.
{'train_runtime': 38.9583, 'train_samples_per_second': 155.397, 'train_steps_per_second': 1.232, 'train_loss': 4.285786310831706, 'epoch': 3.0}
[INFO][08:26:29]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536584.pth.
[INFO][08:26:30]: [Client #55] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_55_3536585.pth.
[INFO][08:26:30]: [Client #17] Model trained.
[INFO][08:26:30]: [Client #17] Inbound data has been processed.
[INFO][08:26:30]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][08:26:30]: [Client #55] Model trained.
[INFO][08:26:30]: [Client #55] Inbound data has been processed.
[INFO][08:26:30]: [Client #55] Outbound data is ready to be sent after being processed.
[INFO][08:26:39]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:26:40]: [Client #55] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:26:40]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][08:26:41]: [Server #3536466] Received 507.38 MB of payload data from client #55 (simulated).
[INFO][08:26:41]: [Server #3536466] Selecting client #57 for training.
[INFO][08:26:41]: [Server #3536466] Sending the current model to client #57 (simulated).
[INFO][08:26:46]: [Server #3536466] Sending 507.38 MB of payload data to client #57 (simulated).
[INFO][08:26:46]: [Server #3536466] Selecting client #63 for training.
[INFO][08:26:46]: [Server #3536466] Sending the current model to client #63 (simulated).
[INFO][08:26:51]: [Server #3536466] Sending 507.38 MB of payload data to client #63 (simulated).
[INFO][08:26:51]: [Client #57] Selected by the server.
[INFO][08:26:51]: [Client #63] Selected by the server.
[INFO][08:26:51]: [Client #57] Loading its data source...
[INFO][08:26:51]: [Client #63] Loading its data source...
[INFO][08:26:51]: [Client #57] Dataset size: 2018
[INFO][08:26:51]: [Client #57] Sampler: iid
[INFO][08:26:51]: [Client #63] Dataset size: 2018
[INFO][08:26:51]: [Client #63] Sampler: iid
[INFO][08:26:52]: [Client #57] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:26:52]: [Client #57] Start to process inbound data.
[INFO][08:26:52]: [Client #63] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:26:52]: [Client #63] Start to process inbound data.
[INFO][08:26:53]: [93m[1m[Client #57] Started training in communication round #4.[0m
[INFO][08:26:53]: [93m[1m[Client #63] Started training in communication round #4.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:13,  4.11s/it]  2%|▏         | 1/48 [00:04<03:40,  4.69s/it]  4%|▍         | 2/48 [00:05<01:42,  2.23s/it]  4%|▍         | 2/48 [00:05<01:58,  2.57s/it]  6%|▋         | 3/48 [00:06<01:16,  1.71s/it]  6%|▋         | 3/48 [00:06<01:24,  1.88s/it]  8%|▊         | 4/48 [00:07<01:03,  1.45s/it]  8%|▊         | 4/48 [00:07<01:07,  1.54s/it] 10%|█         | 5/48 [00:08<00:54,  1.28s/it] 10%|█         | 5/48 [00:08<00:55,  1.28s/it] 12%|█▎        | 6/48 [00:08<00:45,  1.09s/it] 12%|█▎        | 6/48 [00:09<00:46,  1.11s/it] 15%|█▍        | 7/48 [00:09<00:39,  1.03it/s] 15%|█▍        | 7/48 [00:10<00:41,  1.00s/it] 17%|█▋        | 8/48 [00:10<00:35,  1.11it/s] 17%|█▋        | 8/48 [00:10<00:36,  1.09it/s] 19%|█▉        | 9/48 [00:11<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:11<00:33,  1.17it/s] 21%|██        | 10/48 [00:11<00:31,  1.22it/s] 21%|██        | 10/48 [00:12<00:31,  1.21it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.26it/s] 23%|██▎       | 11/48 [00:13<00:29,  1.26it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.28it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:15<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:16<00:25,  1.31it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.34it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:18<00:22,  1.32it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 40%|███▉      | 19/48 [00:19<00:22,  1.32it/s] 42%|████▏     | 20/48 [00:19<00:21,  1.32it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.33it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 46%|████▌     | 22/48 [00:21<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:22<00:18,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:24<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:25<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:27<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:28<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:30<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:31<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:09,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:33<00:07,  1.31it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:34<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:36<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:37<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.31it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.31it/s] 96%|█████████▌| 46/48 [00:39<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:40<00:00,  1.32it/s]100%|██████████| 48/48 [00:40<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.36it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
100%|██████████| 48/48 [00:40<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.53it/s]100%|██████████| 48/48 [00:40<00:00,  1.18it/s]
[INFO][08:27:39]: [Client #63] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_63_3536585.pth.
{'train_runtime': 40.1598, 'train_samples_per_second': 150.748, 'train_steps_per_second': 1.195, 'train_loss': 4.296271959940593, 'epoch': 3.0}
[INFO][08:27:39]: [Client #57] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536584.pth.
{'train_runtime': 40.5466, 'train_samples_per_second': 149.31, 'train_steps_per_second': 1.184, 'train_loss': 4.210360527038574, 'epoch': 3.0}
[INFO][08:27:40]: [Client #63] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_63_3536585.pth.
[INFO][08:27:40]: [Client #57] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536584.pth.
[INFO][08:27:41]: [Client #63] Model trained.
[INFO][08:27:41]: [Client #63] Inbound data has been processed.
[INFO][08:27:41]: [Client #63] Outbound data is ready to be sent after being processed.
[INFO][08:27:41]: [Client #57] Model trained.
[INFO][08:27:41]: [Client #57] Inbound data has been processed.
[INFO][08:27:41]: [Client #57] Outbound data is ready to be sent after being processed.
[INFO][08:27:50]: [Client #63] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:27:50]: [Client #57] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:27:51]: [Server #3536466] Received 507.38 MB of payload data from client #63 (simulated).
[INFO][08:27:52]: [Server #3536466] Received 507.38 MB of payload data from client #57 (simulated).
[INFO][08:27:52]: [Server #3536466] Selecting client #15 for training.
[INFO][08:27:52]: [Server #3536466] Sending the current model to client #15 (simulated).
[INFO][08:27:57]: [Server #3536466] Sending 507.38 MB of payload data to client #15 (simulated).
[INFO][08:27:57]: [Client #15] Selected by the server.
[INFO][08:27:57]: [Client #15] Loading its data source...
[INFO][08:27:57]: [Client #15] Dataset size: 2018
[INFO][08:27:57]: [Client #15] Sampler: iid
[INFO][08:27:58]: [Client #15] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:27:58]: [Client #15] Start to process inbound data.
[INFO][08:27:58]: [93m[1m[Client #15] Started training in communication round #4.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:56,  3.75s/it]  4%|▍         | 2/48 [00:04<01:24,  1.83s/it]  6%|▋         | 3/48 [00:04<00:54,  1.21s/it]  8%|▊         | 4/48 [00:05<00:40,  1.09it/s] 10%|█         | 5/48 [00:05<00:32,  1.32it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.51it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.77it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.86it/s] 21%|██        | 10/48 [00:08<00:19,  1.93it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:09<00:17,  2.01it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.05it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.18it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.16it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.14it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.13it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.12it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.10it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.10it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.10it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.10it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.10it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:17<00:08,  2.09it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.20it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.17it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.13it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.12it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.11it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.11it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.10it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.10it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.09it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:25<00:00,  2.19it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:25<00:00,  2.19it/s]100%|██████████| 48/48 [00:25<00:00,  1.85it/s]
[INFO][08:28:30]: [Client #15] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_15_3536584.pth.
{'train_runtime': 25.9819, 'train_samples_per_second': 233.008, 'train_steps_per_second': 1.847, 'train_loss': 4.304574330647786, 'epoch': 3.0}
[INFO][08:28:31]: [Client #15] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_15_3536584.pth.
[INFO][08:28:31]: [Client #15] Model trained.
[INFO][08:28:31]: [Client #15] Inbound data has been processed.
[INFO][08:28:31]: [Client #15] Outbound data is ready to be sent after being processed.
[INFO][08:28:36]: [Client #15] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:28:37]: [Server #3536466] Received 507.38 MB of payload data from client #15 (simulated).
[INFO][08:28:37]: [Server #3536466] Adding client #88 to the list of clients for aggregation.
[INFO][08:28:37]: [Server #3536466] Adding client #42 to the list of clients for aggregation.
[INFO][08:28:37]: [Server #3536466] Adding client #69 to the list of clients for aggregation.
[INFO][08:28:37]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][08:28:37]: [Server #3536466] Adding client #57 to the list of clients for aggregation.
[INFO][08:28:37]: [Server #3536466] Aggregating 5 clients in total.
[INFO][08:28:37]: [Server #3536466] Updated weights have been received.
[INFO][08:28:38]: [Server #3536466] Aggregating model weight deltas.
[INFO][08:28:38]: [Server #3536466] Finished aggregating updated weights.
[INFO][08:28:38]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00 -1.2468e+00  1e+02  1e+00  1e+00
 1: -1.1106e+00 -2.2295e+00  2e+01  2e-01  2e-01
 2: -1.2493e+00 -2.1881e+00  1e+00  5e-03  5e-03
 3: -1.2468e+00 -1.5623e+00  3e-01  5e-07  3e-07
 4: -1.2472e+00 -1.2832e+00  4e-02  7e-08  4e-08
 5: -1.2529e+00 -1.2781e+00  3e-02  3e-05  2e-05
 6: -1.2639e+00 -1.2751e+00  1e-02  9e-05  6e-05
 7: -1.2691e+00 -1.2739e+00  5e-03  6e-05  4e-05
 8: -1.2733e+00 -1.2736e+00  5e-04  2e-05  2e-05
 9: -1.2736e+00 -1.2736e+00  2e-05  1e-06  8e-07
10: -1.2736e+00 -1.2736e+00  3e-07  1e-08  9e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.1  0.01 2.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 2.1  0.01 0.01
 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.47it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.59it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.08it/s]100%|██████████| 8/8 [00:00<00:00, 11.90it/s]
[INFO][08:28:48]: [93m[1m[Server #3536466] Global model perplexity: 59.13
[0m
[INFO][08:28:48]: [Server #3536466] All client reports have been processed.
[INFO][08:28:48]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_4.pth.
[INFO][08:28:51]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_4.pth.
[INFO][08:28:51]: [93m[1m
[Server #3536466] Starting round 5/100.[0m
[INFO][08:28:51]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 3.93945317e-08,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 4.99987400e-01,
       2.90576689e-07, 6.38980245e-09, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       3.93945317e-08, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       3.93945317e-08, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 4.99987400e-01, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       3.93945317e-08, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 6.38980245e-09, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 3.93945317e-08,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07, 2.90576689e-07,
       2.90576689e-07, 2.90576689e-07, 2.90576689e-07]),)
[INFO][08:28:51]: [Server #3536466] Selected clients: [57 17 79  2 32]
[INFO][08:28:51]: [Server #3536466] Selecting client #32 for training.
[INFO][08:28:51]: [Server #3536466] Sending the current model to client #32 (simulated).
[INFO][08:28:57]: [Server #3536466] Sending 507.38 MB of payload data to client #32 (simulated).
[INFO][08:28:57]: [Server #3536466] Selecting client #17 for training.
[INFO][08:28:57]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][08:29:02]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][08:29:02]: [Client #32] Selected by the server.
[INFO][08:29:02]: [Client #32] Loading its data source...
[INFO][08:29:02]: [Client #32] Dataset size: 2018
[INFO][08:29:02]: [Client #32] Sampler: iid
[INFO][08:29:02]: [Client #17] Selected by the server.
[INFO][08:29:02]: [Client #17] Loading its data source...
[INFO][08:29:02]: [Client #17] Dataset size: 2018
[INFO][08:29:02]: [Client #17] Sampler: iid
[INFO][08:29:03]: [Client #32] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:29:03]: [Client #32] Start to process inbound data.
[INFO][08:29:03]: [93m[1m[Client #32] Started training in communication round #5.[0m
[INFO][08:29:03]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:29:03]: [Client #17] Start to process inbound data.
[INFO][08:29:04]: [93m[1m[Client #17] Started training in communication round #5.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<03:07,  3.98s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:33,  2.04s/it]  2%|▏         | 1/48 [00:04<03:33,  4.54s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  4%|▍         | 2/48 [00:05<01:50,  2.40s/it]  8%|▊         | 4/48 [00:06<00:56,  1.29s/it]  6%|▋         | 3/48 [00:06<01:16,  1.70s/it] 10%|█         | 5/48 [00:07<00:50,  1.16s/it]  8%|▊         | 4/48 [00:07<01:01,  1.39s/it] 12%|█▎        | 6/48 [00:08<00:45,  1.08s/it] 10%|█         | 5/48 [00:08<00:51,  1.19s/it] 15%|█▍        | 7/48 [00:09<00:41,  1.02s/it] 12%|█▎        | 6/48 [00:08<00:46,  1.10s/it] 17%|█▋        | 8/48 [00:10<00:39,  1.01it/s] 15%|█▍        | 7/48 [00:09<00:42,  1.05s/it] 19%|█▉        | 9/48 [00:11<00:37,  1.05it/s] 17%|█▋        | 8/48 [00:10<00:40,  1.00s/it] 21%|██        | 10/48 [00:11<00:35,  1.07it/s] 19%|█▉        | 9/48 [00:11<00:38,  1.01it/s] 23%|██▎       | 11/48 [00:12<00:34,  1.07it/s] 21%|██        | 10/48 [00:12<00:36,  1.06it/s] 25%|██▌       | 12/48 [00:13<00:33,  1.09it/s] 23%|██▎       | 11/48 [00:13<00:33,  1.09it/s] 27%|██▋       | 13/48 [00:14<00:32,  1.09it/s] 25%|██▌       | 12/48 [00:14<00:32,  1.09it/s] 29%|██▉       | 14/48 [00:15<00:30,  1.10it/s] 27%|██▋       | 13/48 [00:15<00:31,  1.10it/s] 31%|███▏      | 15/48 [00:16<00:30,  1.09it/s] 29%|██▉       | 14/48 [00:16<00:32,  1.06it/s] 33%|███▎      | 16/48 [00:17<00:28,  1.13it/s] 31%|███▏      | 15/48 [00:17<00:29,  1.11it/s] 35%|███▌      | 17/48 [00:18<00:26,  1.18it/s] 33%|███▎      | 16/48 [00:17<00:27,  1.18it/s] 38%|███▊      | 18/48 [00:18<00:26,  1.15it/s] 35%|███▌      | 17/48 [00:18<00:26,  1.15it/s] 40%|███▉      | 19/48 [00:19<00:25,  1.13it/s] 38%|███▊      | 18/48 [00:19<00:26,  1.15it/s] 42%|████▏     | 20/48 [00:20<00:24,  1.13it/s] 40%|███▉      | 19/48 [00:20<00:26,  1.11it/s] 44%|████▍     | 21/48 [00:21<00:23,  1.13it/s] 42%|████▏     | 20/48 [00:21<00:24,  1.13it/s] 46%|████▌     | 22/48 [00:22<00:23,  1.12it/s] 44%|████▍     | 21/48 [00:22<00:23,  1.14it/s] 48%|████▊     | 23/48 [00:23<00:22,  1.12it/s] 46%|████▌     | 22/48 [00:23<00:22,  1.14it/s] 50%|█████     | 24/48 [00:24<00:21,  1.13it/s] 48%|████▊     | 23/48 [00:24<00:21,  1.14it/s] 52%|█████▏    | 25/48 [00:25<00:20,  1.12it/s] 50%|█████     | 24/48 [00:25<00:21,  1.11it/s] 54%|█████▍    | 26/48 [00:26<00:19,  1.12it/s] 52%|█████▏    | 25/48 [00:25<00:20,  1.12it/s] 56%|█████▋    | 27/48 [00:27<00:18,  1.13it/s] 54%|█████▍    | 26/48 [00:26<00:19,  1.13it/s] 58%|█████▊    | 28/48 [00:27<00:17,  1.12it/s] 56%|█████▋    | 27/48 [00:27<00:19,  1.10it/s] 60%|██████    | 29/48 [00:28<00:17,  1.11it/s] 58%|█████▊    | 28/48 [00:28<00:18,  1.10it/s] 62%|██████▎   | 30/48 [00:29<00:16,  1.10it/s] 60%|██████    | 29/48 [00:29<00:17,  1.09it/s] 65%|██████▍   | 31/48 [00:30<00:15,  1.09it/s] 62%|██████▎   | 30/48 [00:30<00:17,  1.04it/s] 67%|██████▋   | 32/48 [00:31<00:14,  1.08it/s] 65%|██████▍   | 31/48 [00:31<00:15,  1.09it/s] 69%|██████▉   | 33/48 [00:32<00:13,  1.14it/s] 67%|██████▋   | 32/48 [00:32<00:14,  1.13it/s] 71%|███████   | 34/48 [00:33<00:12,  1.12it/s] 69%|██████▉   | 33/48 [00:33<00:13,  1.11it/s] 73%|███████▎  | 35/48 [00:34<00:11,  1.10it/s] 71%|███████   | 34/48 [00:34<00:12,  1.10it/s] 75%|███████▌  | 36/48 [00:35<00:11,  1.07it/s] 73%|███████▎  | 35/48 [00:35<00:11,  1.12it/s] 77%|███████▋  | 37/48 [00:36<00:10,  1.09it/s] 75%|███████▌  | 36/48 [00:36<00:11,  1.07it/s] 79%|███████▉  | 38/48 [00:37<00:09,  1.07it/s] 77%|███████▋  | 37/48 [00:36<00:10,  1.08it/s] 81%|████████▏ | 39/48 [00:38<00:08,  1.04it/s] 79%|███████▉  | 38/48 [00:37<00:09,  1.04it/s] 83%|████████▎ | 40/48 [00:39<00:07,  1.02it/s] 81%|████████▏ | 39/48 [00:38<00:08,  1.05it/s] 85%|████████▌ | 41/48 [00:40<00:06,  1.05it/s] 83%|████████▎ | 40/48 [00:39<00:07,  1.07it/s] 88%|████████▊ | 42/48 [00:40<00:05,  1.07it/s] 85%|████████▌ | 41/48 [00:40<00:06,  1.09it/s] 90%|████████▉ | 43/48 [00:41<00:04,  1.08it/s] 88%|████████▊ | 42/48 [00:41<00:05,  1.10it/s] 92%|█████████▏| 44/48 [00:42<00:03,  1.10it/s] 90%|████████▉ | 43/48 [00:42<00:04,  1.11it/s] 94%|█████████▍| 45/48 [00:43<00:02,  1.07it/s] 92%|█████████▏| 44/48 [00:43<00:03,  1.10it/s] 96%|█████████▌| 46/48 [00:44<00:01,  1.08it/s] 94%|█████████▍| 45/48 [00:44<00:02,  1.08it/s] 98%|█████████▊| 47/48 [00:45<00:00,  1.09it/s] 96%|█████████▌| 46/48 [00:45<00:01,  1.04it/s]100%|██████████| 48/48 [00:46<00:00,  1.11it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:46<00:00,  1.11it/s]100%|██████████| 48/48 [00:46<00:00,  1.04it/s]
 98%|█████████▊| 47/48 [00:46<00:00,  1.17it/s]100%|██████████| 48/48 [00:46<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:46<00:00,  1.39it/s]100%|██████████| 48/48 [00:46<00:00,  1.03it/s]
[INFO][08:29:55]: [Client #32] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_32_3536584.pth.
{'train_runtime': 46.3704, 'train_samples_per_second': 130.558, 'train_steps_per_second': 1.035, 'train_loss': 4.127873420715332, 'epoch': 3.0}
[INFO][08:29:56]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 46.416, 'train_samples_per_second': 130.429, 'train_steps_per_second': 1.034, 'train_loss': 3.990311940511068, 'epoch': 3.0}
[INFO][08:29:56]: [Client #32] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_32_3536584.pth.
[INFO][08:29:57]: [Client #32] Model trained.
[INFO][08:29:57]: [Client #32] Inbound data has been processed.
[INFO][08:29:57]: [Client #32] Outbound data is ready to be sent after being processed.
[INFO][08:29:57]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][08:29:58]: [Client #17] Model trained.
[INFO][08:29:58]: [Client #17] Inbound data has been processed.
[INFO][08:29:58]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][08:30:05]: [Client #32] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:30:06]: [Server #3536466] Received 507.38 MB of payload data from client #32 (simulated).
[INFO][08:30:06]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:30:07]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][08:30:07]: [Server #3536466] Selecting client #2 for training.
[INFO][08:30:07]: [Server #3536466] Sending the current model to client #2 (simulated).
[INFO][08:30:12]: [Server #3536466] Sending 507.38 MB of payload data to client #2 (simulated).
[INFO][08:30:12]: [Server #3536466] Selecting client #57 for training.
[INFO][08:30:12]: [Server #3536466] Sending the current model to client #57 (simulated).
[INFO][08:30:18]: [Server #3536466] Sending 507.38 MB of payload data to client #57 (simulated).
[INFO][08:30:18]: [Client #2] Selected by the server.
[INFO][08:30:18]: [Client #57] Selected by the server.
[INFO][08:30:18]: [Client #2] Loading its data source...
[INFO][08:30:18]: [Client #57] Loading its data source...
[INFO][08:30:18]: [Client #2] Dataset size: 2018
[INFO][08:30:18]: [Client #57] Dataset size: 2018
[INFO][08:30:18]: [Client #2] Sampler: iid
[INFO][08:30:18]: [Client #57] Sampler: iid
[INFO][08:30:19]: [Client #2] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:30:19]: [Client #2] Start to process inbound data.
[INFO][08:30:19]: [93m[1m[Client #2] Started training in communication round #5.[0m
[INFO][08:30:19]: [Client #57] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:30:19]: [Client #57] Start to process inbound data.
[INFO][08:30:20]: [93m[1m[Client #57] Started training in communication round #5.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<03:07,  3.98s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:35,  2.08s/it]  2%|▏         | 1/48 [00:04<03:24,  4.35s/it]  6%|▋         | 3/48 [00:05<01:10,  1.58s/it]  4%|▍         | 2/48 [00:05<01:51,  2.43s/it]  8%|▊         | 4/48 [00:06<00:58,  1.32s/it]  6%|▋         | 3/48 [00:06<01:19,  1.76s/it] 10%|█         | 5/48 [00:07<00:48,  1.13s/it]  8%|▊         | 4/48 [00:07<01:02,  1.43s/it] 12%|█▎        | 6/48 [00:08<00:43,  1.05s/it] 10%|█         | 5/48 [00:08<00:53,  1.25s/it] 15%|█▍        | 7/48 [00:09<00:41,  1.01s/it] 12%|█▎        | 6/48 [00:09<00:47,  1.13s/it] 17%|█▋        | 8/48 [00:10<00:38,  1.03it/s] 15%|█▍        | 7/48 [00:10<00:44,  1.09s/it] 19%|█▉        | 9/48 [00:11<00:38,  1.02it/s] 17%|█▋        | 8/48 [00:11<00:42,  1.06s/it] 21%|██        | 10/48 [00:12<00:37,  1.00it/s] 19%|█▉        | 9/48 [00:12<00:39,  1.02s/it] 23%|██▎       | 11/48 [00:13<00:35,  1.03it/s] 21%|██        | 10/48 [00:13<00:39,  1.03s/it] 25%|██▌       | 12/48 [00:14<00:35,  1.01it/s] 23%|██▎       | 11/48 [00:14<00:38,  1.05s/it] 27%|██▋       | 13/48 [00:15<00:35,  1.02s/it] 25%|██▌       | 12/48 [00:15<00:37,  1.03s/it] 29%|██▉       | 14/48 [00:16<00:34,  1.01s/it] 27%|██▋       | 13/48 [00:16<00:36,  1.03s/it] 31%|███▏      | 15/48 [00:17<00:33,  1.02s/it] 29%|██▉       | 14/48 [00:17<00:33,  1.01it/s] 33%|███▎      | 16/48 [00:17<00:29,  1.09it/s] 31%|███▏      | 15/48 [00:17<00:30,  1.09it/s] 35%|███▌      | 17/48 [00:18<00:26,  1.16it/s] 33%|███▎      | 16/48 [00:18<00:26,  1.21it/s] 38%|███▊      | 18/48 [00:19<00:24,  1.21it/s] 35%|███▌      | 17/48 [00:19<00:25,  1.22it/s] 40%|███▉      | 19/48 [00:20<00:23,  1.26it/s] 38%|███▊      | 18/48 [00:20<00:24,  1.24it/s] 42%|████▏     | 20/48 [00:20<00:21,  1.29it/s] 40%|███▉      | 19/48 [00:20<00:22,  1.27it/s] 44%|████▍     | 21/48 [00:21<00:20,  1.31it/s] 42%|████▏     | 20/48 [00:21<00:22,  1.27it/s] 46%|████▌     | 22/48 [00:22<00:19,  1.31it/s] 44%|████▍     | 21/48 [00:22<00:20,  1.30it/s] 48%|████▊     | 23/48 [00:23<00:19,  1.31it/s] 46%|████▌     | 22/48 [00:23<00:20,  1.29it/s] 50%|█████     | 24/48 [00:23<00:18,  1.31it/s] 48%|████▊     | 23/48 [00:23<00:19,  1.31it/s] 52%|█████▏    | 25/48 [00:24<00:17,  1.32it/s] 50%|█████     | 24/48 [00:24<00:18,  1.31it/s] 54%|█████▍    | 26/48 [00:25<00:16,  1.32it/s] 52%|█████▏    | 25/48 [00:25<00:17,  1.31it/s] 56%|█████▋    | 27/48 [00:26<00:15,  1.32it/s] 54%|█████▍    | 26/48 [00:26<00:16,  1.33it/s] 58%|█████▊    | 28/48 [00:26<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:26<00:15,  1.34it/s] 60%|██████    | 29/48 [00:27<00:14,  1.33it/s] 58%|█████▊    | 28/48 [00:27<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:28<00:13,  1.33it/s] 60%|██████    | 29/48 [00:28<00:14,  1.31it/s] 65%|██████▍   | 31/48 [00:29<00:12,  1.32it/s] 62%|██████▎   | 30/48 [00:29<00:13,  1.32it/s] 67%|██████▋   | 32/48 [00:29<00:11,  1.36it/s] 65%|██████▍   | 31/48 [00:29<00:13,  1.30it/s] 69%|██████▉   | 33/48 [00:30<00:11,  1.31it/s] 67%|██████▋   | 32/48 [00:30<00:11,  1.39it/s] 71%|███████   | 34/48 [00:31<00:10,  1.33it/s] 69%|██████▉   | 33/48 [00:31<00:11,  1.35it/s] 73%|███████▎  | 35/48 [00:32<00:09,  1.34it/s] 71%|███████   | 34/48 [00:32<00:10,  1.34it/s] 75%|███████▌  | 36/48 [00:32<00:08,  1.34it/s] 73%|███████▎  | 35/48 [00:32<00:09,  1.32it/s] 77%|███████▋  | 37/48 [00:33<00:08,  1.33it/s] 75%|███████▌  | 36/48 [00:33<00:09,  1.32it/s] 79%|███████▉  | 38/48 [00:34<00:07,  1.33it/s] 77%|███████▋  | 37/48 [00:34<00:08,  1.33it/s] 81%|████████▏ | 39/48 [00:35<00:06,  1.32it/s] 79%|███████▉  | 38/48 [00:35<00:07,  1.33it/s] 83%|████████▎ | 40/48 [00:35<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:35<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:36<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:36<00:06,  1.32it/s] 88%|████████▊ | 42/48 [00:37<00:04,  1.33it/s] 85%|████████▌ | 41/48 [00:37<00:05,  1.33it/s] 90%|████████▉ | 43/48 [00:38<00:03,  1.32it/s] 88%|████████▊ | 42/48 [00:38<00:04,  1.33it/s] 92%|█████████▏| 44/48 [00:38<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:38<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:39<00:02,  1.33it/s] 92%|█████████▏| 44/48 [00:39<00:03,  1.33it/s] 96%|█████████▌| 46/48 [00:40<00:01,  1.33it/s] 94%|█████████▍| 45/48 [00:40<00:02,  1.33it/s] 98%|█████████▊| 47/48 [00:41<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:41<00:01,  1.33it/s]100%|██████████| 48/48 [00:41<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:41<00:00,  1.37it/s]100%|██████████| 48/48 [00:41<00:00,  1.15it/s]
 98%|█████████▊| 47/48 [00:41<00:00,  1.48it/s]100%|██████████| 48/48 [00:42<00:00,  1.67it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:42<00:00,  1.67it/s]100%|██████████| 48/48 [00:42<00:00,  1.14it/s]
[INFO][08:31:07]: [Client #2] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
{'train_runtime': 41.8311, 'train_samples_per_second': 144.725, 'train_steps_per_second': 1.147, 'train_loss': 4.12146536509196, 'epoch': 3.0}
[INFO][08:31:07]: [Client #57] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536585.pth.
{'train_runtime': 42.0827, 'train_samples_per_second': 143.86, 'train_steps_per_second': 1.141, 'train_loss': 3.9620018005371094, 'epoch': 3.0}
[INFO][08:31:08]: [Client #2] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
[INFO][08:31:08]: [Client #2] Model trained.
[INFO][08:31:08]: [Client #2] Inbound data has been processed.
[INFO][08:31:08]: [Client #2] Outbound data is ready to be sent after being processed.
[INFO][08:31:09]: [Client #57] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536585.pth.
[INFO][08:31:09]: [Client #57] Model trained.
[INFO][08:31:09]: [Client #57] Inbound data has been processed.
[INFO][08:31:09]: [Client #57] Outbound data is ready to be sent after being processed.
[INFO][08:31:17]: [Client #2] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:31:17]: [Server #3536466] Received 507.38 MB of payload data from client #2 (simulated).
[INFO][08:31:18]: [Client #57] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:31:19]: [Server #3536466] Received 507.38 MB of payload data from client #57 (simulated).
[INFO][08:31:19]: [Server #3536466] Selecting client #79 for training.
[INFO][08:31:19]: [Server #3536466] Sending the current model to client #79 (simulated).
[INFO][08:31:24]: [Server #3536466] Sending 507.38 MB of payload data to client #79 (simulated).
[INFO][08:31:24]: [Client #79] Selected by the server.
[INFO][08:31:24]: [Client #79] Loading its data source...
[INFO][08:31:24]: [Client #79] Dataset size: 2018
[INFO][08:31:24]: [Client #79] Sampler: iid
[INFO][08:31:25]: [Client #79] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:31:25]: [Client #79] Start to process inbound data.
[INFO][08:31:25]: [93m[1m[Client #79] Started training in communication round #5.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:56,  3.76s/it]  4%|▍         | 2/48 [00:04<01:24,  1.83s/it]  6%|▋         | 3/48 [00:04<00:54,  1.21s/it]  8%|▊         | 4/48 [00:05<00:40,  1.08it/s] 10%|█         | 5/48 [00:05<00:32,  1.31it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.51it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.87it/s] 21%|██        | 10/48 [00:08<00:19,  1.93it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:09<00:17,  2.02it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.05it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.18it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.15it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.13it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.12it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.11it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.11it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.10it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.09it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.10it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.09it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.09it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.20it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.16it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.13it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.12it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.11it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.11it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.10it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.10it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.09it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:25<00:00,  2.20it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:25<00:00,  2.20it/s]100%|██████████| 48/48 [00:25<00:00,  1.85it/s]
[INFO][08:31:56]: [Client #79] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_79_3536584.pth.
{'train_runtime': 25.9833, 'train_samples_per_second': 232.995, 'train_steps_per_second': 1.847, 'train_loss': 4.093973795572917, 'epoch': 3.0}
[INFO][08:31:57]: [Client #79] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_79_3536584.pth.
[INFO][08:31:58]: [Client #79] Model trained.
[INFO][08:31:58]: [Client #79] Inbound data has been processed.
[INFO][08:31:58]: [Client #79] Outbound data is ready to be sent after being processed.
[INFO][08:32:03]: [Client #79] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:32:04]: [Server #3536466] Received 507.38 MB of payload data from client #79 (simulated).
[INFO][08:32:04]: [Server #3536466] Adding client #55 to the list of clients for aggregation.
[INFO][08:32:04]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][08:32:04]: [Server #3536466] Adding client #57 to the list of clients for aggregation.
[INFO][08:32:04]: [Server #3536466] Adding client #2 to the list of clients for aggregation.
[INFO][08:32:04]: [Server #3536466] Adding client #47 to the list of clients for aggregation.
[INFO][08:32:04]: [Server #3536466] Aggregating 5 clients in total.
[INFO][08:32:04]: [Server #3536466] Updated weights have been received.
[INFO][08:32:04]: [Server #3536466] Aggregating model weight deltas.
[INFO][08:32:05]: [Server #3536466] Finished aggregating updated weights.
[INFO][08:32:05]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00 -9.4174e-01  1e+02  1e+00  1e+00
 1: -8.6105e-01 -1.9219e+00  1e+01  1e-01  1e-01
 2: -9.4319e-01 -1.8649e+00  1e+00  1e-03  1e-03
 3: -9.4097e-01 -1.0500e+00  1e-01  7e-08  5e-08
 4: -9.4142e-01 -9.6728e-01  3e-02  7e-08  3e-08
 5: -9.4842e-01 -9.6929e-01  2e-02  5e-05  3e-05
 6: -9.5173e-01 -9.6280e-01  1e-02  3e-05  2e-05
 7: -9.5924e-01 -9.6155e-01  3e-03  7e-05  4e-05
 8: -9.6102e-01 -9.6145e-01  6e-04  2e-05  1e-05
 9: -9.6142e-01 -9.6144e-01  3e-05  1e-06  8e-07
10: -9.6144e-01 -9.6144e-01  4e-07  2e-08  1e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 0.1  0.01 0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.1  0.01 2.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 0.01 4.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 0.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 2.1  0.01 0.01
 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.00it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.47it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.03it/s]100%|██████████| 8/8 [00:00<00:00, 11.84it/s]
[INFO][08:32:14]: [93m[1m[Server #3536466] Global model perplexity: 59.08
[0m
[INFO][08:32:14]: [Server #3536466] All client reports have been processed.
[INFO][08:32:14]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_5.pth.
[INFO][08:32:18]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_5.pth.
[INFO][08:32:18]: [93m[1m
[Server #3536466] Starting round 6/100.[0m
[INFO][08:32:18]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([9.45018972e-09, 3.33333069e-01, 9.45018972e-09, 9.45018972e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 1.21314295e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 9.45018972e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 3.33333069e-01,
       9.45018972e-09, 1.52687492e-10, 9.45018972e-09, 9.45018972e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 9.45018972e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 9.45018972e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 9.45018972e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 1.21314295e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 1.21314295e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 9.45018972e-09,
       3.14878456e-11, 9.45018972e-09, 9.45018972e-09, 9.45018972e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 9.45018972e-09,
       1.21314295e-09, 9.45018972e-09, 3.33333069e-01, 9.45018972e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 9.45018972e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 9.45018972e-09,
       9.45018972e-09, 1.21314295e-09, 9.45018972e-09, 9.45018972e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 9.45018972e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 9.45018972e-09,
       9.45018972e-09, 1.52687492e-10, 9.45018972e-09, 9.45018972e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 1.21314295e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 9.45018972e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09, 9.45018972e-09,
       9.45018972e-09, 9.45018972e-09, 9.45018972e-09]),)
[INFO][08:32:18]: [Server #3536466] Selected clients: [57 17  2 67 72]
[INFO][08:32:18]: [Server #3536466] Selecting client #2 for training.
[INFO][08:32:18]: [Server #3536466] Sending the current model to client #2 (simulated).
[INFO][08:32:23]: [Server #3536466] Sending 507.38 MB of payload data to client #2 (simulated).
[INFO][08:32:23]: [Server #3536466] Selecting client #17 for training.
[INFO][08:32:23]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][08:32:28]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][08:32:28]: [Client #2] Selected by the server.
[INFO][08:32:28]: [Client #2] Loading its data source...
[INFO][08:32:28]: [Client #2] Dataset size: 2018
[INFO][08:32:28]: [Client #2] Sampler: iid
[INFO][08:32:28]: [Client #17] Selected by the server.
[INFO][08:32:28]: [Client #17] Loading its data source...
[INFO][08:32:28]: [Client #17] Dataset size: 2018
[INFO][08:32:28]: [Client #17] Sampler: iid
[INFO][08:32:29]: [Client #2] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:32:29]: [Client #2] Start to process inbound data.
[INFO][08:32:29]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:32:29]: [Client #17] Start to process inbound data.
[INFO][08:32:30]: [93m[1m[Client #2] Started training in communication round #6.[0m
[INFO][08:32:30]: [93m[1m[Client #17] Started training in communication round #6.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.25s/it]  2%|▏         | 1/48 [00:04<03:24,  4.35s/it]  4%|▍         | 2/48 [00:04<01:39,  2.17s/it]  4%|▍         | 2/48 [00:05<01:43,  2.24s/it]  6%|▋         | 3/48 [00:05<01:07,  1.51s/it]  6%|▋         | 3/48 [00:05<01:10,  1.56s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it]  8%|▊         | 4/48 [00:06<00:54,  1.23s/it] 10%|█         | 5/48 [00:07<00:45,  1.05s/it] 10%|█         | 5/48 [00:07<00:45,  1.06s/it] 12%|█▎        | 6/48 [00:07<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.37it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.32it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.35it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.35it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.35it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.35it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.35it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s]100%|██████████| 48/48 [00:38<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.40it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][08:33:15]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 38.9326, 'train_samples_per_second': 155.5, 'train_steps_per_second': 1.233, 'train_loss': 3.912112553914388, 'epoch': 3.0}
[INFO][08:33:15]: [Client #2] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
{'train_runtime': 39.0686, 'train_samples_per_second': 154.958, 'train_steps_per_second': 1.229, 'train_loss': 4.025694529215495, 'epoch': 3.0}
[INFO][08:33:16]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][08:33:16]: [Client #2] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
[INFO][08:33:17]: [Client #17] Model trained.
[INFO][08:33:17]: [Client #17] Inbound data has been processed.
[INFO][08:33:17]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][08:33:17]: [Client #2] Model trained.
[INFO][08:33:17]: [Client #2] Inbound data has been processed.
[INFO][08:33:17]: [Client #2] Outbound data is ready to be sent after being processed.
[INFO][08:33:27]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:33:27]: [Client #2] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:33:28]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][08:33:29]: [Server #3536466] Received 507.38 MB of payload data from client #2 (simulated).
[INFO][08:33:29]: [Server #3536466] Selecting client #72 for training.
[INFO][08:33:29]: [Server #3536466] Sending the current model to client #72 (simulated).
[INFO][08:33:34]: [Server #3536466] Sending 507.38 MB of payload data to client #72 (simulated).
[INFO][08:33:34]: [Server #3536466] Selecting client #67 for training.
[INFO][08:33:34]: [Server #3536466] Sending the current model to client #67 (simulated).
[INFO][08:33:39]: [Server #3536466] Sending 507.38 MB of payload data to client #67 (simulated).
[INFO][08:33:39]: [Client #72] Selected by the server.
[INFO][08:33:39]: [Client #72] Loading its data source...
[INFO][08:33:39]: [Client #67] Selected by the server.
[INFO][08:33:39]: [Client #72] Dataset size: 2018
[INFO][08:33:39]: [Client #72] Sampler: iid
[INFO][08:33:39]: [Client #67] Loading its data source...
[INFO][08:33:39]: [Client #67] Dataset size: 2018
[INFO][08:33:39]: [Client #67] Sampler: iid
[INFO][08:33:40]: [Client #72] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:33:40]: [Client #72] Start to process inbound data.
[INFO][08:33:40]: [Client #67] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:33:40]: [Client #67] Start to process inbound data.
[INFO][08:33:41]: [93m[1m[Client #72] Started training in communication round #6.[0m
[INFO][08:33:41]: [93m[1m[Client #67] Started training in communication round #6.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
  0%|          | 0/48 [00:00<?, ?it/s]***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:26,  4.39s/it]  2%|▏         | 1/48 [00:04<03:27,  4.41s/it]  4%|▍         | 2/48 [00:05<01:48,  2.36s/it]  4%|▍         | 2/48 [00:05<01:48,  2.37s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it]  6%|▋         | 3/48 [00:06<01:15,  1.67s/it]  8%|▊         | 4/48 [00:06<00:56,  1.29s/it]  8%|▊         | 4/48 [00:06<00:57,  1.32s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:18,  1.31it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][08:34:26]: [Client #67] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_67_3536585.pth.
{'train_runtime': 39.3604, 'train_samples_per_second': 153.809, 'train_steps_per_second': 1.219, 'train_loss': 4.055235544840495, 'epoch': 3.0}
[INFO][08:34:26]: [Client #72] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_72_3536584.pth.
{'train_runtime': 39.461, 'train_samples_per_second': 153.417, 'train_steps_per_second': 1.216, 'train_loss': 4.113497416178386, 'epoch': 3.0}
[INFO][08:34:27]: [Client #67] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_67_3536585.pth.
[INFO][08:34:28]: [Client #72] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_72_3536584.pth.
[INFO][08:34:28]: [Client #67] Model trained.
[INFO][08:34:28]: [Client #67] Inbound data has been processed.
[INFO][08:34:28]: [Client #67] Outbound data is ready to be sent after being processed.
[INFO][08:34:28]: [Client #72] Model trained.
[INFO][08:34:28]: [Client #72] Inbound data has been processed.
[INFO][08:34:28]: [Client #72] Outbound data is ready to be sent after being processed.
[INFO][08:34:37]: [Client #67] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:34:38]: [Server #3536466] Received 507.38 MB of payload data from client #67 (simulated).
[INFO][08:34:38]: [Client #72] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:34:39]: [Server #3536466] Received 507.38 MB of payload data from client #72 (simulated).
[INFO][08:34:39]: [Server #3536466] Selecting client #57 for training.
[INFO][08:34:39]: [Server #3536466] Sending the current model to client #57 (simulated).
[INFO][08:34:45]: [Server #3536466] Sending 507.38 MB of payload data to client #57 (simulated).
[INFO][08:34:45]: [Client #57] Selected by the server.
[INFO][08:34:45]: [Client #57] Loading its data source...
[INFO][08:34:45]: [Client #57] Dataset size: 2018
[INFO][08:34:45]: [Client #57] Sampler: iid
[INFO][08:34:46]: [Client #57] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:34:46]: [Client #57] Start to process inbound data.
[INFO][08:34:46]: [93m[1m[Client #57] Started training in communication round #6.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:58,  3.80s/it]  4%|▍         | 2/48 [00:04<01:24,  1.84s/it]  6%|▋         | 3/48 [00:04<00:54,  1.22s/it]  8%|▊         | 4/48 [00:05<00:40,  1.08it/s] 10%|█         | 5/48 [00:05<00:32,  1.31it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.50it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.86it/s] 21%|██        | 10/48 [00:08<00:19,  1.93it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:09<00:17,  2.02it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.06it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.19it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.16it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.14it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.13it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.12it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.11it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.10it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.10it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.10it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.09it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.09it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.20it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.16it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.12it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.11it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.10it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.09it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.09it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.09it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.08it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:26<00:00,  2.19it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.19it/s]100%|██████████| 48/48 [00:26<00:00,  1.84it/s]
[INFO][08:35:17]: [Client #57] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536584.pth.
{'train_runtime': 26.0288, 'train_samples_per_second': 232.588, 'train_steps_per_second': 1.844, 'train_loss': 3.8922764460245767, 'epoch': 3.0}
[INFO][08:35:18]: [Client #57] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536584.pth.
[INFO][08:35:19]: [Client #57] Model trained.
[INFO][08:35:19]: [Client #57] Inbound data has been processed.
[INFO][08:35:19]: [Client #57] Outbound data is ready to be sent after being processed.
[INFO][08:35:24]: [Client #57] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:35:25]: [Server #3536466] Received 507.38 MB of payload data from client #57 (simulated).
[INFO][08:35:25]: [Server #3536466] Adding client #99 to the list of clients for aggregation.
[INFO][08:35:25]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][08:35:25]: [Server #3536466] Adding client #57 to the list of clients for aggregation.
[INFO][08:35:25]: [Server #3536466] Adding client #2 to the list of clients for aggregation.
[INFO][08:35:25]: [Server #3536466] Adding client #15 to the list of clients for aggregation.
[INFO][08:35:25]: [Server #3536466] Aggregating 5 clients in total.
[INFO][08:35:25]: [Server #3536466] Updated weights have been received.
[INFO][08:35:26]: [Server #3536466] Aggregating model weight deltas.
[INFO][08:35:26]: [Server #3536466] Finished aggregating updated weights.
[INFO][08:35:26]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00 -2.4785e-01  1e+02  1e+00  1e+00
 1: -2.8815e-01 -1.2202e+00  2e+01  3e-01  3e-01
 2: -2.5526e-01 -1.2109e+00  2e+00  2e-02  2e-02
 3: -2.4568e-01 -8.3050e-01  6e-01  3e-06  6e-07
 4: -2.4625e-01 -2.6595e-01  2e-02  1e-07  2e-08
 5: -2.4728e-01 -2.6018e-01  1e-02  4e-07  2e-07
 6: -2.5294e-01 -2.6300e-01  1e-02  3e-05  2e-05
 7: -2.5483e-01 -2.5876e-01  4e-03  2e-05  1e-05
 8: -2.5752e-01 -2.5852e-01  1e-03  1e-05  9e-06
 9: -2.5848e-01 -2.5850e-01  5e-05  2e-06  1e-06
10: -2.5850e-01 -2.5850e-01  7e-07  3e-08  2e-08
11: -2.5850e-01 -2.5850e-01  7e-09  3e-10  2e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 0.1  0.01 0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01
 2.1  0.01 0.1  0.01 2.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 0.01 4.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 0.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 2.1  0.01 0.01
 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 5.1  0.01]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.01]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.61it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.52it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.12it/s]100%|██████████| 8/8 [00:00<00:00, 11.88it/s]
[INFO][08:35:36]: [93m[1m[Server #3536466] Global model perplexity: 57.98
[0m
[INFO][08:35:36]: [Server #3536466] All client reports have been processed.
[INFO][08:35:36]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_6.pth.
[INFO][08:35:40]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_6.pth.
[INFO][08:35:40]: [93m[1m
[Server #3536466] Starting round 7/100.[0m
[INFO][08:35:40]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([1.29487622e-08, 3.33332980e-01, 1.29487622e-08, 1.29487622e-08,
       1.29487622e-08, 1.29487622e-08, 1.29487622e-08, 1.67575175e-09,
       1.29487622e-08, 1.29487622e-08, 1.29487622e-08, 1.29487622e-08,
       1.29487622e-08, 1.29487622e-08, 2.04900120e-10, 1.29487622e-08,
       3.33332980e-01, 1.29487622e-08, 2.04900120e-10, 1.29487622e-08,
       1.29487622e-08, 1.29487622e-08, 1.29487622e-08, 1.29487622e-08,
       1.29487622e-08, 1.29487622e-08, 1.29487622e-08, 1.29487622e-08,
       1.29487622e-08, 1.29487622e-08, 1.29487622e-08, 1.29487622e-08,
       1.29487622e-08, 1.29487622e-08, 1.29487622e-08, 1.29487622e-08,
       1.67575175e-09, 1.29487622e-08, 1.29487622e-08, 1.29487622e-08,
       1.67575175e-09, 1.29487622e-08, 1.29487622e-08, 1.29487622e-08,
       1.29487622e-08, 4.18033971e-11, 1.29487622e-08, 1.29487622e-08,
       1.29487622e-08, 1.29487622e-08, 1.29487622e-08, 1.29487622e-08,
       1.29487622e-08, 1.67575175e-09, 1.29487622e-08, 3.33332980e-01,
       1.29487622e-08, 1.29487622e-08, 1.29487622e-08, 1.29487622e-08,
       1.29487622e-08, 1.29487622e-08, 1.29487622e-08, 1.29487622e-08,
       1.29487622e-08, 1.67575175e-09, 1.29487622e-08, 1.29487622e-08,
       1.29487622e-08, 1.29487622e-08, 1.29487622e-08, 1.29487622e-08,
       1.29487622e-08, 1.29487622e-08, 1.29487622e-08, 1.29487622e-08,
       2.04900120e-10, 1.29487622e-08, 1.29487622e-08, 1.29487622e-08,
       1.29487622e-08, 1.29487622e-08, 1.67575175e-09, 1.29487622e-08,
       1.29487622e-08, 1.29487622e-08, 1.29487622e-08, 1.29487622e-08,
       1.29487622e-08, 1.29487622e-08, 1.29487622e-08, 1.29487622e-08,
       1.29487622e-08, 2.61215704e-11, 1.29487622e-08]),)
[INFO][08:35:40]: [Server #3536466] Selected clients: [17 57  2 27 26]
[INFO][08:35:40]: [Server #3536466] Selecting client #2 for training.
[INFO][08:35:40]: [Server #3536466] Sending the current model to client #2 (simulated).
[INFO][08:35:45]: [Server #3536466] Sending 507.38 MB of payload data to client #2 (simulated).
[INFO][08:35:45]: [Server #3536466] Selecting client #17 for training.
[INFO][08:35:45]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][08:35:50]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][08:35:50]: [Client #2] Selected by the server.
[INFO][08:35:50]: [Client #2] Loading its data source...
[INFO][08:35:50]: [Client #2] Dataset size: 2018
[INFO][08:35:50]: [Client #2] Sampler: iid
[INFO][08:35:50]: [Client #17] Selected by the server.
[INFO][08:35:50]: [Client #17] Loading its data source...
[INFO][08:35:50]: [Client #17] Dataset size: 2018
[INFO][08:35:50]: [Client #17] Sampler: iid
[INFO][08:35:51]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:35:51]: [Client #17] Start to process inbound data.
[INFO][08:35:51]: [Client #2] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:35:51]: [Client #2] Start to process inbound data.
[INFO][08:35:51]: [93m[1m[Client #17] Started training in communication round #7.[0m
[INFO][08:35:52]: [93m[1m[Client #2] Started training in communication round #7.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.17s/it]  2%|▏         | 1/48 [00:04<03:22,  4.31s/it]  4%|▍         | 2/48 [00:05<01:41,  2.21s/it]  4%|▍         | 2/48 [00:05<01:43,  2.24s/it]  6%|▋         | 3/48 [00:05<01:09,  1.54s/it]  6%|▋         | 3/48 [00:05<01:10,  1.57s/it]  8%|▊         | 4/48 [00:06<00:53,  1.22s/it]  8%|▊         | 4/48 [00:06<00:54,  1.25s/it] 10%|█         | 5/48 [00:07<00:45,  1.06s/it] 10%|█         | 5/48 [00:07<00:46,  1.07s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.06it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.14it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:21,  1.33it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.30it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.31it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.30it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][08:36:36]: [Client #2] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
{'train_runtime': 39.1731, 'train_samples_per_second': 154.545, 'train_steps_per_second': 1.225, 'train_loss': 3.971954027811686, 'epoch': 3.0}
[INFO][08:36:36]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 39.3187, 'train_samples_per_second': 153.973, 'train_steps_per_second': 1.221, 'train_loss': 3.8713353474934897, 'epoch': 3.0}
[INFO][08:36:37]: [Client #2] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
[INFO][08:36:38]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][08:36:38]: [Client #2] Model trained.
[INFO][08:36:38]: [Client #2] Inbound data has been processed.
[INFO][08:36:38]: [Client #2] Outbound data is ready to be sent after being processed.
[INFO][08:36:39]: [Client #17] Model trained.
[INFO][08:36:39]: [Client #17] Inbound data has been processed.
[INFO][08:36:39]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][08:36:48]: [Client #2] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:36:48]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:36:49]: [Server #3536466] Received 507.38 MB of payload data from client #2 (simulated).
[INFO][08:36:50]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][08:36:50]: [Server #3536466] Selecting client #26 for training.
[INFO][08:36:50]: [Server #3536466] Sending the current model to client #26 (simulated).
[INFO][08:36:55]: [Server #3536466] Sending 507.38 MB of payload data to client #26 (simulated).
[INFO][08:36:55]: [Server #3536466] Selecting client #57 for training.
[INFO][08:36:55]: [Server #3536466] Sending the current model to client #57 (simulated).
[INFO][08:37:00]: [Server #3536466] Sending 507.38 MB of payload data to client #57 (simulated).
[INFO][08:37:00]: [Client #26] Selected by the server.
[INFO][08:37:00]: [Client #26] Loading its data source...
[INFO][08:37:00]: [Client #57] Selected by the server.
[INFO][08:37:00]: [Client #26] Dataset size: 2018
[INFO][08:37:00]: [Client #26] Sampler: iid
[INFO][08:37:00]: [Client #57] Loading its data source...
[INFO][08:37:00]: [Client #57] Dataset size: 2018
[INFO][08:37:00]: [Client #57] Sampler: iid
[INFO][08:37:01]: [Client #26] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:37:01]: [Client #26] Start to process inbound data.
[INFO][08:37:01]: [Client #57] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:37:01]: [Client #57] Start to process inbound data.
[INFO][08:37:02]: [93m[1m[Client #26] Started training in communication round #7.[0m
[INFO][08:37:02]: [93m[1m[Client #57] Started training in communication round #7.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:14,  4.13s/it]  2%|▏         | 1/48 [00:04<03:23,  4.32s/it]  4%|▍         | 2/48 [00:04<01:40,  2.18s/it]  4%|▍         | 2/48 [00:05<01:42,  2.23s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  6%|▋         | 3/48 [00:05<01:10,  1.56s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:06<00:54,  1.24s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:45,  1.05s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:39,  1.06it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 17%|█▋        | 8/48 [00:09<00:32,  1.21it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 21%|██        | 10/48 [00:10<00:29,  1.29it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.31it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.31it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 60%|██████    | 29/48 [00:24<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.32it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 83%|████████▎ | 40/48 [00:32<00:05,  1.35it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.35it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.35it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:35<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s]100%|██████████| 48/48 [00:38<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.39it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][08:37:47]: [Client #57] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536585.pth.
{'train_runtime': 38.8862, 'train_samples_per_second': 155.685, 'train_steps_per_second': 1.234, 'train_loss': 3.847592035929362, 'epoch': 3.0}
[INFO][08:37:47]: [Client #26] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_26_3536584.pth.
{'train_runtime': 39.0546, 'train_samples_per_second': 155.014, 'train_steps_per_second': 1.229, 'train_loss': 4.082468668619792, 'epoch': 3.0}
[INFO][08:37:48]: [Client #57] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536585.pth.
[INFO][08:37:48]: [Client #26] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_26_3536584.pth.
[INFO][08:37:48]: [Client #57] Model trained.
[INFO][08:37:48]: [Client #57] Inbound data has been processed.
[INFO][08:37:48]: [Client #57] Outbound data is ready to be sent after being processed.
[INFO][08:37:48]: [Client #26] Model trained.
[INFO][08:37:48]: [Client #26] Inbound data has been processed.
[INFO][08:37:48]: [Client #26] Outbound data is ready to be sent after being processed.
[INFO][08:37:58]: [Client #57] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:37:58]: [Client #26] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:37:59]: [Server #3536466] Received 507.38 MB of payload data from client #57 (simulated).
[INFO][08:38:00]: [Server #3536466] Received 507.38 MB of payload data from client #26 (simulated).
[INFO][08:38:00]: [Server #3536466] Selecting client #27 for training.
[INFO][08:38:00]: [Server #3536466] Sending the current model to client #27 (simulated).
[INFO][08:38:05]: [Server #3536466] Sending 507.38 MB of payload data to client #27 (simulated).
[INFO][08:38:05]: [Client #27] Selected by the server.
[INFO][08:38:05]: [Client #27] Loading its data source...
[INFO][08:38:05]: [Client #27] Dataset size: 2018
[INFO][08:38:05]: [Client #27] Sampler: iid
[INFO][08:38:06]: [Client #27] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:38:06]: [Client #27] Start to process inbound data.
[INFO][08:38:06]: [93m[1m[Client #27] Started training in communication round #7.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<03:00,  3.84s/it]  4%|▍         | 2/48 [00:04<01:25,  1.86s/it]  6%|▋         | 3/48 [00:04<00:55,  1.23s/it]  8%|▊         | 4/48 [00:05<00:41,  1.07it/s] 10%|█         | 5/48 [00:05<00:33,  1.30it/s] 12%|█▎        | 6/48 [00:06<00:28,  1.50it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.65it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.77it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.86it/s] 21%|██        | 10/48 [00:08<00:19,  1.93it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:09<00:17,  2.02it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.06it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.18it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.15it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.13it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.12it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.11it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.10it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.10it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.10it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.09it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.09it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.09it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.09it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.19it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.16it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.12it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.11it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.10it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.09it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.09it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.09it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.08it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.08it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.08it/s]100%|██████████| 48/48 [00:26<00:00,  2.19it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.19it/s]100%|██████████| 48/48 [00:26<00:00,  1.84it/s]
[INFO][08:38:38]: [Client #27] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_27_3536584.pth.
{'train_runtime': 26.104, 'train_samples_per_second': 231.919, 'train_steps_per_second': 1.839, 'train_loss': 4.038862228393555, 'epoch': 3.0}
[INFO][08:38:39]: [Client #27] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_27_3536584.pth.
[INFO][08:38:39]: [Client #27] Model trained.
[INFO][08:38:39]: [Client #27] Inbound data has been processed.
[INFO][08:38:39]: [Client #27] Outbound data is ready to be sent after being processed.
[INFO][08:38:44]: [Client #27] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:38:45]: [Server #3536466] Received 507.38 MB of payload data from client #27 (simulated).
[INFO][08:38:45]: [Server #3536466] Adding client #63 to the list of clients for aggregation.
[INFO][08:38:45]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][08:38:45]: [Server #3536466] Adding client #32 to the list of clients for aggregation.
[INFO][08:38:45]: [Server #3536466] Adding client #57 to the list of clients for aggregation.
[INFO][08:38:45]: [Server #3536466] Adding client #79 to the list of clients for aggregation.
[INFO][08:38:45]: [Server #3536466] Aggregating 5 clients in total.
[INFO][08:38:45]: [Server #3536466] Updated weights have been received.
[INFO][08:38:46]: [Server #3536466] Aggregating model weight deltas.
[INFO][08:38:46]: [Server #3536466] Finished aggregating updated weights.
[INFO][08:38:46]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.4276e-01  1e+02  1e+00  1e+00
 1:  1.5099e-01 -6.3234e-01  2e+01  2e-01  2e-01
 2:  3.2962e-01 -6.1275e-01  2e+00  1e-02  1e-02
 3:  3.4513e-01 -1.7409e-01  5e-01  2e-06  4e-07
 4:  3.4455e-01  3.3078e-01  1e-02  4e-08  1e-08
 5:  3.4363e-01  3.3589e-01  8e-03  2e-07  7e-08
 6:  3.4002e-01  3.3379e-01  6e-03  2e-05  1e-05
 7:  3.3897e-01  3.3672e-01  2e-03  9e-06  6e-06
 8:  3.3750e-01  3.3686e-01  7e-04  8e-06  5e-06
 9:  3.3689e-01  3.3687e-01  3e-05  1e-06  1e-06
10:  3.3687e-01  3.3687e-01  5e-07  3e-08  2e-08
11:  3.3687e-01  3.3687e-01  5e-09  3e-10  2e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 0.1  0.01 0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01
 2.1  0.01 0.1  0.01 2.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 2.1  0.01 0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 0.01 4.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 0.1  0.01 0.01 0.01 0.01 0.01 3.1  0.01 0.01 0.01 0.01 0.01 1.1  0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 2.1  0.01 0.01 2.1  0.01 0.01
 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 5.1  0.01]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.2  0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.01]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.13it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.61it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.09it/s]100%|██████████| 8/8 [00:00<00:00, 11.86it/s]
[INFO][08:38:56]: [93m[1m[Server #3536466] Global model perplexity: 49.68
[0m
[INFO][08:38:56]: [Server #3536466] All client reports have been processed.
[INFO][08:38:56]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_7.pth.
[INFO][08:39:00]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_7.pth.
[INFO][08:39:00]: [93m[1m
[Server #3536466] Starting round 8/100.[0m
[INFO][08:39:00]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([1.16058598e-07, 1.16058598e-07, 1.16058598e-07, 1.16058598e-07,
       1.16058598e-07, 1.16058598e-07, 1.12105207e-08, 1.16058598e-07,
       1.16058598e-07, 1.16058598e-07, 1.16058598e-07, 1.16058598e-07,
       1.16058598e-07, 1.29686382e-09, 1.16058598e-07, 4.99995378e-01,
       1.16058598e-07, 1.29686382e-09, 1.16058598e-07, 1.16058598e-07,
       1.16058598e-07, 1.16058598e-07, 1.16058598e-07, 1.16058598e-07,
       1.16058598e-07, 1.16058598e-07, 1.16058598e-07, 1.16058598e-07,
       1.29686382e-09, 1.16058598e-07, 1.16058598e-07, 1.16058598e-07,
       1.16058598e-07, 1.16058598e-07, 1.12105207e-08, 1.16058598e-07,
       1.16058598e-07, 1.16058598e-07, 1.12105207e-08, 1.16058598e-07,
       1.16058598e-07, 1.16058598e-07, 1.16058598e-07, 2.61273112e-10,
       1.16058598e-07, 1.16058598e-07, 1.16058598e-07, 1.16058598e-07,
       1.16058598e-07, 1.16058598e-07, 1.16058598e-07, 1.12105207e-08,
       1.16058598e-07, 4.99995378e-01, 1.16058598e-07, 1.16058598e-07,
       1.16058598e-07, 1.16058598e-07, 1.16058598e-07, 4.91219979e-10,
       1.16058598e-07, 1.16058598e-07, 1.16058598e-07, 1.16058598e-07,
       1.12105207e-08, 1.16058598e-07, 1.16058598e-07, 1.16058598e-07,
       1.16058598e-07, 1.16058598e-07, 1.16058598e-07, 1.16058598e-07,
       1.16058598e-07, 1.29686382e-09, 1.16058598e-07, 1.16058598e-07,
       1.29686382e-09, 1.16058598e-07, 1.16058598e-07, 1.16058598e-07,
       1.16058598e-07, 1.16058598e-07, 1.12105207e-08, 1.16058598e-07,
       1.16058598e-07, 1.16058598e-07, 1.16058598e-07, 1.16058598e-07,
       1.16058598e-07, 1.16058598e-07, 1.16058598e-07, 1.16058598e-07,
       1.16058598e-07, 1.63044754e-10, 1.16058598e-07]),)
[INFO][08:39:00]: [Server #3536466] Selected clients: [ 57  17 100  31  14]
[INFO][08:39:00]: [Server #3536466] Selecting client #100 for training.
[INFO][08:39:00]: [Server #3536466] Sending the current model to client #100 (simulated).
[INFO][08:39:05]: [Server #3536466] Sending 507.38 MB of payload data to client #100 (simulated).
[INFO][08:39:05]: [Server #3536466] Selecting client #17 for training.
[INFO][08:39:05]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][08:39:10]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][08:39:10]: [Client #100] Selected by the server.
[INFO][08:39:10]: [Client #17] Selected by the server.
[INFO][08:39:10]: [Client #100] Loading its data source...
[INFO][08:39:10]: [Client #17] Loading its data source...
[INFO][08:39:10]: [Client #100] Dataset size: 2018
[INFO][08:39:10]: [Client #17] Dataset size: 2018
[INFO][08:39:10]: [Client #100] Sampler: iid
[INFO][08:39:10]: [Client #17] Sampler: iid
[INFO][08:39:12]: [Client #100] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:39:12]: [Client #100] Start to process inbound data.
[INFO][08:39:12]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:39:12]: [Client #17] Start to process inbound data.
[INFO][08:39:12]: [93m[1m[Client #100] Started training in communication round #8.[0m
[INFO][08:39:13]: [93m[1m[Client #17] Started training in communication round #8.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<03:07,  3.98s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:34,  2.05s/it]  2%|▏         | 1/48 [00:04<03:17,  4.21s/it]  6%|▋         | 3/48 [00:05<01:10,  1.56s/it]  4%|▍         | 2/48 [00:05<01:46,  2.31s/it]  8%|▊         | 4/48 [00:06<00:58,  1.33s/it]  6%|▋         | 3/48 [00:06<01:16,  1.71s/it] 10%|█         | 5/48 [00:07<00:51,  1.19s/it]  8%|▊         | 4/48 [00:07<01:01,  1.41s/it] 12%|█▎        | 6/48 [00:08<00:45,  1.09s/it] 10%|█         | 5/48 [00:08<00:52,  1.23s/it] 15%|█▍        | 7/48 [00:09<00:40,  1.01it/s] 12%|█▎        | 6/48 [00:08<00:45,  1.08s/it] 17%|█▋        | 8/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:40,  1.02it/s] 19%|█▉        | 9/48 [00:10<00:33,  1.15it/s] 17%|█▋        | 8/48 [00:10<00:36,  1.10it/s] 21%|██        | 10/48 [00:11<00:31,  1.22it/s] 19%|█▉        | 9/48 [00:11<00:33,  1.16it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.26it/s] 21%|██        | 10/48 [00:11<00:31,  1.22it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.25it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.28it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.29it/s] 27%|██▋       | 13/48 [00:14<00:27,  1.28it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.29it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.29it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.30it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.34it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.33it/s] 35%|███▌      | 17/48 [00:17<00:23,  1.34it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.33it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.32it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.32it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 50%|█████     | 24/48 [00:21<00:18,  1.32it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 50%|█████     | 24/48 [00:22<00:18,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.31it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
 98%|█████████▊| 47/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.58it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.58it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
[INFO][08:39:57]: [Client #100] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_100_3536584.pth.
{'train_runtime': 39.724, 'train_samples_per_second': 152.402, 'train_steps_per_second': 1.208, 'train_loss': 3.992889404296875, 'epoch': 3.0}
[INFO][08:39:58]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 39.8359, 'train_samples_per_second': 151.973, 'train_steps_per_second': 1.205, 'train_loss': 3.764369010925293, 'epoch': 3.0}
[INFO][08:39:58]: [Client #100] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_100_3536584.pth.
[INFO][08:39:59]: [Client #100] Model trained.
[INFO][08:39:59]: [Client #100] Inbound data has been processed.
[INFO][08:39:59]: [Client #100] Outbound data is ready to be sent after being processed.
[INFO][08:39:59]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][08:39:59]: [Client #17] Model trained.
[INFO][08:39:59]: [Client #17] Inbound data has been processed.
[INFO][08:39:59]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][08:40:07]: [Client #100] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:40:08]: [Server #3536466] Received 507.38 MB of payload data from client #100 (simulated).
[INFO][08:40:09]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:40:10]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][08:40:10]: [Server #3536466] Selecting client #14 for training.
[INFO][08:40:10]: [Server #3536466] Sending the current model to client #14 (simulated).
[INFO][08:40:15]: [Server #3536466] Sending 507.38 MB of payload data to client #14 (simulated).
[INFO][08:40:15]: [Server #3536466] Selecting client #57 for training.
[INFO][08:40:15]: [Server #3536466] Sending the current model to client #57 (simulated).
[INFO][08:40:20]: [Server #3536466] Sending 507.38 MB of payload data to client #57 (simulated).
[INFO][08:40:20]: [Client #14] Selected by the server.
[INFO][08:40:20]: [Client #14] Loading its data source...
[INFO][08:40:20]: [Client #14] Dataset size: 2018
[INFO][08:40:20]: [Client #14] Sampler: iid
[INFO][08:40:20]: [Client #57] Selected by the server.
[INFO][08:40:20]: [Client #57] Loading its data source...
[INFO][08:40:20]: [Client #57] Dataset size: 2018
[INFO][08:40:20]: [Client #57] Sampler: iid
[INFO][08:40:22]: [Client #14] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:40:22]: [Client #14] Start to process inbound data.
[INFO][08:40:22]: [Client #57] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:40:22]: [Client #57] Start to process inbound data.
[INFO][08:40:22]: [93m[1m[Client #14] Started training in communication round #8.[0m
[INFO][08:40:22]: [93m[1m[Client #57] Started training in communication round #8.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:20,  4.27s/it]  2%|▏         | 1/48 [00:04<03:21,  4.29s/it]  4%|▍         | 2/48 [00:05<01:40,  2.19s/it]  4%|▍         | 2/48 [00:05<01:42,  2.22s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  6%|▋         | 3/48 [00:05<01:09,  1.55s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it]  8%|▊         | 4/48 [00:06<00:54,  1.23s/it] 10%|█         | 5/48 [00:07<00:44,  1.05s/it] 10%|█         | 5/48 [00:07<00:45,  1.05s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:39,  1.06it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:38<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.39it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][08:41:07]: [Client #57] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536585.pth.
{'train_runtime': 38.9906, 'train_samples_per_second': 155.268, 'train_steps_per_second': 1.231, 'train_loss': 3.737802823384603, 'epoch': 3.0}
[INFO][08:41:07]: [Client #14] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
{'train_runtime': 39.0552, 'train_samples_per_second': 155.011, 'train_steps_per_second': 1.229, 'train_loss': 3.995396614074707, 'epoch': 3.0}
[INFO][08:41:08]: [Client #57] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536585.pth.
[INFO][08:41:08]: [Client #14] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
[INFO][08:41:08]: [Client #57] Model trained.
[INFO][08:41:08]: [Client #57] Inbound data has been processed.
[INFO][08:41:08]: [Client #57] Outbound data is ready to be sent after being processed.
[INFO][08:41:09]: [Client #14] Model trained.
[INFO][08:41:09]: [Client #14] Inbound data has been processed.
[INFO][08:41:09]: [Client #14] Outbound data is ready to be sent after being processed.
[INFO][08:41:18]: [Client #57] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:41:19]: [Client #14] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:41:19]: [Server #3536466] Received 507.38 MB of payload data from client #57 (simulated).
[INFO][08:41:20]: [Server #3536466] Received 507.38 MB of payload data from client #14 (simulated).
[INFO][08:41:20]: [Server #3536466] Selecting client #31 for training.
[INFO][08:41:20]: [Server #3536466] Sending the current model to client #31 (simulated).
[INFO][08:41:25]: [Server #3536466] Sending 507.38 MB of payload data to client #31 (simulated).
[INFO][08:41:25]: [Client #31] Selected by the server.
[INFO][08:41:25]: [Client #31] Loading its data source...
[INFO][08:41:25]: [Client #31] Dataset size: 2018
[INFO][08:41:25]: [Client #31] Sampler: iid
[INFO][08:41:26]: [Client #31] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:41:26]: [Client #31] Start to process inbound data.
[INFO][08:41:26]: [93m[1m[Client #31] Started training in communication round #8.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:55,  3.74s/it]  4%|▍         | 2/48 [00:04<01:23,  1.82s/it]  6%|▋         | 3/48 [00:04<00:54,  1.21s/it]  8%|▊         | 4/48 [00:05<00:40,  1.09it/s] 10%|█         | 5/48 [00:05<00:32,  1.32it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.51it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.87it/s] 21%|██        | 10/48 [00:08<00:19,  1.93it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:08<00:17,  2.01it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.06it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.18it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.16it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.14it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.12it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.12it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.11it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.11it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.10it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.10it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.10it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.10it/s] 60%|██████    | 29/48 [00:17<00:09,  2.10it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.10it/s] 65%|██████▍   | 31/48 [00:17<00:08,  2.10it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.20it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.17it/s] 71%|███████   | 34/48 [00:19<00:06,  2.15it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.13it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.12it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.11it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.11it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.10it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.10it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.10it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:25<00:00,  2.20it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:25<00:00,  2.20it/s]100%|██████████| 48/48 [00:25<00:00,  1.85it/s]
[INFO][08:41:58]: [Client #31] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_31_3536584.pth.
{'train_runtime': 25.9552, 'train_samples_per_second': 233.248, 'train_steps_per_second': 1.849, 'train_loss': 3.9500099817911782, 'epoch': 3.0}
[INFO][08:41:59]: [Client #31] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_31_3536584.pth.
[INFO][08:41:59]: [Client #31] Model trained.
[INFO][08:41:59]: [Client #31] Inbound data has been processed.
[INFO][08:41:59]: [Client #31] Outbound data is ready to be sent after being processed.
[INFO][08:42:05]: [Client #31] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:42:06]: [Server #3536466] Received 507.38 MB of payload data from client #31 (simulated).
[INFO][08:42:06]: [Server #3536466] Adding client #2 to the list of clients for aggregation.
[INFO][08:42:06]: [Server #3536466] Adding client #27 to the list of clients for aggregation.
[INFO][08:42:06]: [Server #3536466] Adding client #14 to the list of clients for aggregation.
[INFO][08:42:06]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][08:42:06]: [Server #3536466] Adding client #57 to the list of clients for aggregation.
[INFO][08:42:06]: [Server #3536466] Aggregating 5 clients in total.
[INFO][08:42:06]: [Server #3536466] Updated weights have been received.
[INFO][08:42:06]: [Server #3536466] Aggregating model weight deltas.
[INFO][08:42:06]: [Server #3536466] Finished aggregating updated weights.
[INFO][08:42:06]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  5.8622e-01  1e+02  1e+00  1e+00
 1:  3.9292e-01 -3.8715e-01  2e+01  2e-01  2e-01
 2:  5.8057e-01 -3.5459e-01  1e+00  5e-03  5e-03
 3:  5.8925e-01  2.6365e-01  3e-01  3e-07  6e-08
 4:  5.8866e-01  5.7766e-01  1e-02  2e-08  4e-09
 5:  5.8756e-01  5.8085e-01  7e-03  2e-07  6e-08
 6:  5.8484e-01  5.7925e-01  6e-03  1e-05  1e-05
 7:  5.8402e-01  5.8171e-01  2e-03  7e-06  5e-06
 8:  5.8267e-01  5.8194e-01  8e-04  1e-05  8e-06
 9:  5.8201e-01  5.8197e-01  7e-05  3e-06  3e-06
10:  5.8197e-01  5.8197e-01  3e-06  1e-07  1e-07
11:  5.8197e-01  5.8197e-01  3e-08  2e-09  1e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  0.01 0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.1
 2.1  0.01 0.1  0.01 2.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 0.01 0.01 0.01 2.1  0.01 0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 0.01 4.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 0.1  0.01 0.01 0.01 0.01 0.01 3.1  0.01 0.01 0.01 0.01 0.01 1.1  0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 2.1  0.01 0.01 2.1  0.01 0.01
 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 5.1  0.01]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2
 0.2  0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.2  0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.01]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.42it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.68it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.13it/s]100%|██████████| 8/8 [00:00<00:00, 11.92it/s]
[INFO][08:42:16]: [93m[1m[Server #3536466] Global model perplexity: 44.99
[0m
[INFO][08:42:16]: [Server #3536466] All client reports have been processed.
[INFO][08:42:16]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_8.pth.
[INFO][08:42:20]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_8.pth.
[INFO][08:42:20]: [93m[1m
[Server #3536466] Starting round 9/100.[0m
[INFO][08:42:20]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([1.32589420e-06, 1.69057543e-07, 1.32589420e-06, 1.32589420e-06,
       1.32589420e-06, 1.32589420e-06, 1.32589420e-06, 1.69057543e-07,
       1.32589420e-06, 1.32589420e-06, 1.32589420e-06, 1.32589420e-06,
       1.32589420e-06, 3.33299254e-01, 2.06216001e-08, 1.32589420e-06,
       3.33299254e-01, 1.32589420e-06, 2.06216001e-08, 1.32589420e-06,
       1.32589420e-06, 1.32589420e-06, 1.32589420e-06, 1.32589420e-06,
       1.32589420e-06, 1.69057543e-07, 1.32589420e-06, 1.32589420e-06,
       1.32589420e-06, 2.06216001e-08, 1.32589420e-06, 1.32589420e-06,
       1.32589420e-06, 1.32589420e-06, 1.32589420e-06, 1.69057543e-07,
       1.32589420e-06, 1.32589420e-06, 1.32589420e-06, 1.69057543e-07,
       1.32589420e-06, 1.32589420e-06, 1.32589420e-06, 1.32589420e-06,
       4.20058161e-09, 1.32589420e-06, 1.32589420e-06, 1.32589420e-06,
       1.32589420e-06, 1.32589420e-06, 1.32589420e-06, 1.32589420e-06,
       1.69057543e-07, 1.32589420e-06, 3.33299254e-01, 1.32589420e-06,
       1.32589420e-06, 1.32589420e-06, 1.32589420e-06, 1.32589420e-06,
       7.85409386e-09, 1.32589420e-06, 1.32589420e-06, 1.32589420e-06,
       1.32589420e-06, 1.69057543e-07, 1.32589420e-06, 1.32589420e-06,
       1.32589420e-06, 1.32589420e-06, 1.32589420e-06, 1.32589420e-06,
       1.32589420e-06, 1.32589420e-06, 2.06216001e-08, 1.32589420e-06,
       1.32589420e-06, 2.06216001e-08, 1.32589420e-06, 1.32589420e-06,
       1.32589420e-06, 1.32589420e-06, 1.32589420e-06, 1.69057543e-07,
       1.32589420e-06, 1.32589420e-06, 1.32589420e-06, 1.32589420e-06,
       1.32589420e-06, 1.32589420e-06, 1.32589420e-06, 1.32589420e-06,
       1.32589420e-06, 1.32589420e-06, 2.62695821e-09]),)
[INFO][08:42:20]: [Server #3536466] Selected clients: [57 17 14 37  3]
[INFO][08:42:20]: [Server #3536466] Selecting client #14 for training.
[INFO][08:42:20]: [Server #3536466] Sending the current model to client #14 (simulated).
[INFO][08:42:25]: [Server #3536466] Sending 507.38 MB of payload data to client #14 (simulated).
[INFO][08:42:25]: [Server #3536466] Selecting client #17 for training.
[INFO][08:42:25]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][08:42:30]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][08:42:30]: [Client #14] Selected by the server.
[INFO][08:42:30]: [Client #14] Loading its data source...
[INFO][08:42:30]: [Client #14] Dataset size: 2018
[INFO][08:42:30]: [Client #14] Sampler: iid
[INFO][08:42:30]: [Client #17] Selected by the server.
[INFO][08:42:30]: [Client #17] Loading its data source...
[INFO][08:42:30]: [Client #17] Dataset size: 2018
[INFO][08:42:30]: [Client #17] Sampler: iid
[INFO][08:42:32]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:42:32]: [Client #17] Start to process inbound data.
[INFO][08:42:32]: [Client #14] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:42:32]: [Client #14] Start to process inbound data.
[INFO][08:42:32]: [93m[1m[Client #17] Started training in communication round #9.[0m
[INFO][08:42:32]: [93m[1m[Client #14] Started training in communication round #9.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:27,  4.42s/it]  2%|▏         | 1/48 [00:04<03:28,  4.44s/it]  4%|▍         | 2/48 [00:05<01:47,  2.33s/it]  4%|▍         | 2/48 [00:05<01:48,  2.35s/it]  6%|▋         | 3/48 [00:06<01:12,  1.60s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it]  8%|▊         | 4/48 [00:06<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.07s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.05it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.29it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.30it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.30it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.30it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][08:43:17]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 39.4199, 'train_samples_per_second': 153.577, 'train_steps_per_second': 1.218, 'train_loss': 3.6254905064900718, 'epoch': 3.0}
[INFO][08:43:17]: [Client #14] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
{'train_runtime': 39.5161, 'train_samples_per_second': 153.204, 'train_steps_per_second': 1.215, 'train_loss': 3.8399782180786133, 'epoch': 3.0}
[INFO][08:43:18]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][08:43:19]: [Client #14] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
[INFO][08:43:19]: [Client #17] Model trained.
[INFO][08:43:19]: [Client #17] Inbound data has been processed.
[INFO][08:43:19]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][08:43:19]: [Client #14] Model trained.
[INFO][08:43:19]: [Client #14] Inbound data has been processed.
[INFO][08:43:19]: [Client #14] Outbound data is ready to be sent after being processed.
[INFO][08:43:29]: [Client #14] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:43:29]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:43:29]: [Server #3536466] Received 507.38 MB of payload data from client #14 (simulated).
[INFO][08:43:30]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][08:43:30]: [Server #3536466] Selecting client #3 for training.
[INFO][08:43:30]: [Server #3536466] Sending the current model to client #3 (simulated).
[INFO][08:43:36]: [Server #3536466] Sending 507.38 MB of payload data to client #3 (simulated).
[INFO][08:43:36]: [Server #3536466] Selecting client #37 for training.
[INFO][08:43:36]: [Server #3536466] Sending the current model to client #37 (simulated).
[INFO][08:43:41]: [Server #3536466] Sending 507.38 MB of payload data to client #37 (simulated).
[INFO][08:43:41]: [Client #3] Selected by the server.
[INFO][08:43:41]: [Client #37] Selected by the server.
[INFO][08:43:41]: [Client #3] Loading its data source...
[INFO][08:43:41]: [Client #37] Loading its data source...
[INFO][08:43:41]: [Client #3] Dataset size: 2018
[INFO][08:43:41]: [Client #37] Dataset size: 2018
[INFO][08:43:41]: [Client #3] Sampler: iid
[INFO][08:43:41]: [Client #37] Sampler: iid
[INFO][08:43:42]: [Client #37] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:43:42]: [Client #37] Start to process inbound data.
[INFO][08:43:42]: [Client #3] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:43:42]: [Client #3] Start to process inbound data.
[INFO][08:43:43]: [93m[1m[Client #37] Started training in communication round #9.[0m
[INFO][08:43:43]: [93m[1m[Client #3] Started training in communication round #9.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:25,  4.36s/it]  2%|▏         | 1/48 [00:04<03:25,  4.36s/it]  4%|▍         | 2/48 [00:05<01:47,  2.34s/it]  4%|▍         | 2/48 [00:05<01:47,  2.35s/it]  6%|▋         | 3/48 [00:06<01:15,  1.68s/it]  6%|▋         | 3/48 [00:06<01:15,  1.69s/it]  8%|▊         | 4/48 [00:07<00:59,  1.35s/it]  8%|▊         | 4/48 [00:07<00:59,  1.35s/it] 10%|█         | 5/48 [00:07<00:48,  1.13s/it] 10%|█         | 5/48 [00:07<00:49,  1.15s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 12%|█▎        | 6/48 [00:08<00:42,  1.01s/it] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.08it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 21%|██        | 10/48 [00:11<00:30,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.31it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][08:44:28]: [Client #3] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_3_3536584.pth.
{'train_runtime': 39.5468, 'train_samples_per_second': 153.085, 'train_steps_per_second': 1.214, 'train_loss': 3.849135398864746, 'epoch': 3.0}
[INFO][08:44:28]: [Client #37] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_37_3536585.pth.
{'train_runtime': 39.6139, 'train_samples_per_second': 152.825, 'train_steps_per_second': 1.212, 'train_loss': 3.8471333185831704, 'epoch': 3.0}
[INFO][08:44:29]: [Client #3] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_3_3536584.pth.
[INFO][08:44:30]: [Client #37] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_37_3536585.pth.
[INFO][08:44:30]: [Client #3] Model trained.
[INFO][08:44:30]: [Client #3] Inbound data has been processed.
[INFO][08:44:30]: [Client #3] Outbound data is ready to be sent after being processed.
[INFO][08:44:30]: [Client #37] Model trained.
[INFO][08:44:30]: [Client #37] Inbound data has been processed.
[INFO][08:44:30]: [Client #37] Outbound data is ready to be sent after being processed.
[INFO][08:44:39]: [Client #3] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:44:40]: [Client #37] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:44:40]: [Server #3536466] Received 507.38 MB of payload data from client #3 (simulated).
[INFO][08:44:41]: [Server #3536466] Received 507.38 MB of payload data from client #37 (simulated).
[INFO][08:44:41]: [Server #3536466] Selecting client #57 for training.
[INFO][08:44:41]: [Server #3536466] Sending the current model to client #57 (simulated).
[INFO][08:44:47]: [Server #3536466] Sending 507.38 MB of payload data to client #57 (simulated).
[INFO][08:44:47]: [Client #57] Selected by the server.
[INFO][08:44:47]: [Client #57] Loading its data source...
[INFO][08:44:47]: [Client #57] Dataset size: 2018
[INFO][08:44:47]: [Client #57] Sampler: iid
[INFO][08:44:48]: [Client #57] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:44:48]: [Client #57] Start to process inbound data.
[INFO][08:44:48]: [93m[1m[Client #57] Started training in communication round #9.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:56,  3.75s/it]  4%|▍         | 2/48 [00:04<01:23,  1.83s/it]  6%|▋         | 3/48 [00:04<00:54,  1.21s/it]  8%|▊         | 4/48 [00:05<00:40,  1.09it/s] 10%|█         | 5/48 [00:05<00:32,  1.31it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.51it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.87it/s] 21%|██        | 10/48 [00:08<00:19,  1.93it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:08<00:17,  2.01it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.05it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.18it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.15it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.14it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.12it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.11it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.10it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.10it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.10it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.10it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.09it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:17<00:08,  2.09it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.20it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.16it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.12it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.11it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.11it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.10it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.10it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.10it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:25<00:00,  2.20it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:25<00:00,  2.20it/s]100%|██████████| 48/48 [00:25<00:00,  1.85it/s]
[INFO][08:45:19]: [Client #57] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536584.pth.
{'train_runtime': 25.9852, 'train_samples_per_second': 232.979, 'train_steps_per_second': 1.847, 'train_loss': 3.5969451268514, 'epoch': 3.0}
[INFO][08:45:20]: [Client #57] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536584.pth.
[INFO][08:45:20]: [Client #57] Model trained.
[INFO][08:45:20]: [Client #57] Inbound data has been processed.
[INFO][08:45:20]: [Client #57] Outbound data is ready to be sent after being processed.
[INFO][08:45:26]: [Client #57] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:45:27]: [Server #3536466] Received 507.38 MB of payload data from client #57 (simulated).
[INFO][08:45:27]: [Server #3536466] Adding client #100 to the list of clients for aggregation.
[INFO][08:45:27]: [Server #3536466] Adding client #67 to the list of clients for aggregation.
[INFO][08:45:27]: [Server #3536466] Adding client #72 to the list of clients for aggregation.
[INFO][08:45:27]: [Server #3536466] Adding client #14 to the list of clients for aggregation.
[INFO][08:45:27]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][08:45:27]: [Server #3536466] Aggregating 5 clients in total.
[INFO][08:45:27]: [Server #3536466] Updated weights have been received.
[INFO][08:45:27]: [Server #3536466] Aggregating model weight deltas.
[INFO][08:45:28]: [Server #3536466] Finished aggregating updated weights.
[INFO][08:45:28]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  6.2898e-01  1e+02  1e+00  1e+00
 1:  4.3780e-01 -3.4438e-01  2e+01  2e-01  2e-01
 2:  6.2448e-01 -3.0946e-01  1e+00  4e-03  4e-03
 3:  6.3196e-01  3.5073e-01  3e-01  2e-07  4e-08
 4:  6.3139e-01  6.2109e-01  1e-02  2e-08  4e-09
 5:  6.3023e-01  6.2385e-01  6e-03  2e-07  7e-08
 6:  6.2727e-01  6.2233e-01  5e-03  1e-05  8e-06
 7:  6.2635e-01  6.2444e-01  2e-03  6e-06  4e-06
 8:  6.2505e-01  6.2456e-01  6e-04  6e-06  4e-06
 9:  6.2458e-01  6.2457e-01  2e-05  1e-06  7e-07
10:  6.2457e-01  6.2457e-01  4e-07  2e-08  1e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  0.01 0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.1
 2.1  0.01 0.1  0.01 2.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 0.01 0.01 0.01 2.1  0.01 0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 0.01 4.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 0.1  0.01 0.01 0.01 0.01 0.01 3.1  0.01 0.01 0.01 3.1  0.01 1.1  0.01
 0.01 3.1  0.01 0.01 0.01 0.01 0.01 0.01 2.1  0.01 0.01 2.1  0.01 0.01
 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2
 0.2  0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.2  0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.62it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.65it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.08it/s]100%|██████████| 8/8 [00:00<00:00, 11.89it/s]
[INFO][08:45:37]: [93m[1m[Server #3536466] Global model perplexity: 43.61
[0m
[INFO][08:45:37]: [Server #3536466] All client reports have been processed.
[INFO][08:45:37]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_9.pth.
[INFO][08:45:41]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_9.pth.
[INFO][08:45:41]: [93m[1m
[Server #3536466] Starting round 10/100.[0m
[INFO][08:45:41]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([1.68382832e-07, 2.27030406e-08, 1.68382832e-07, 1.68382832e-07,
       1.68382832e-07, 1.68382832e-07, 2.27030406e-08, 1.68382832e-07,
       1.68382832e-07, 1.68382832e-07, 1.68382832e-07, 1.68382832e-07,
       4.99993656e-01, 3.60781760e-09, 1.68382832e-07, 4.99993656e-01,
       1.68382832e-07, 3.60781760e-09, 1.68382832e-07, 1.68382832e-07,
       1.68382832e-07, 1.68382832e-07, 1.68382832e-07, 1.68382832e-07,
       2.27030406e-08, 1.68382832e-07, 1.68382832e-07, 1.68382832e-07,
       3.60781760e-09, 1.68382832e-07, 1.68382832e-07, 1.68382832e-07,
       1.68382832e-07, 2.27030406e-08, 1.68382832e-07, 1.68382832e-07,
       1.68382832e-07, 2.27030406e-08, 1.68382832e-07, 1.68382832e-07,
       1.68382832e-07, 1.68382832e-07, 8.16517715e-10, 1.68382832e-07,
       1.68382832e-07, 1.68382832e-07, 1.68382832e-07, 1.68382832e-07,
       1.68382832e-07, 1.68382832e-07, 2.27030406e-08, 1.68382832e-07,
       1.68382832e-07, 1.68382832e-07, 1.68382832e-07, 1.68382832e-07,
       1.68382832e-07, 1.48536377e-09, 1.68382832e-07, 1.68382832e-07,
       1.68382832e-07, 1.48536377e-09, 1.68382832e-07, 2.27030406e-08,
       1.68382832e-07, 1.68382832e-07, 1.48536377e-09, 1.68382832e-07,
       1.68382832e-07, 1.68382832e-07, 1.68382832e-07, 1.68382832e-07,
       1.68382832e-07, 3.60781760e-09, 1.68382832e-07, 1.68382832e-07,
       3.60781760e-09, 1.68382832e-07, 1.68382832e-07, 1.68382832e-07,
       1.68382832e-07, 1.68382832e-07, 2.27030406e-08, 1.68382832e-07,
       1.68382832e-07, 1.68382832e-07, 1.68382832e-07, 1.68382832e-07,
       1.68382832e-07, 1.68382832e-07, 1.68382832e-07, 1.68382832e-07,
       1.68382832e-07, 5.18023574e-10, 2.27030406e-08]),)
[INFO][08:45:41]: [Server #3536466] Selected clients: [14 17 73 21 48]
[INFO][08:45:41]: [Server #3536466] Selecting client #48 for training.
[INFO][08:45:41]: [Server #3536466] Sending the current model to client #48 (simulated).
[INFO][08:45:47]: [Server #3536466] Sending 507.38 MB of payload data to client #48 (simulated).
[INFO][08:45:47]: [Server #3536466] Selecting client #17 for training.
[INFO][08:45:47]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][08:45:52]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][08:45:52]: [Client #48] Selected by the server.
[INFO][08:45:52]: [Client #48] Loading its data source...
[INFO][08:45:52]: [Client #48] Dataset size: 2018
[INFO][08:45:52]: [Client #48] Sampler: iid
[INFO][08:45:52]: [Client #17] Selected by the server.
[INFO][08:45:52]: [Client #17] Loading its data source...
[INFO][08:45:52]: [Client #17] Dataset size: 2018
[INFO][08:45:52]: [Client #17] Sampler: iid
[INFO][08:45:53]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:45:53]: [Client #17] Start to process inbound data.
[INFO][08:45:53]: [Client #48] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:45:53]: [Client #48] Start to process inbound data.
[INFO][08:45:54]: [93m[1m[Client #17] Started training in communication round #10.[0m
[INFO][08:45:54]: [93m[1m[Client #48] Started training in communication round #10.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:15,  4.17s/it]  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  4%|▍         | 2/48 [00:04<01:38,  2.13s/it]  4%|▍         | 2/48 [00:04<01:40,  2.19s/it]  6%|▋         | 3/48 [00:05<01:07,  1.49s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  8%|▊         | 4/48 [00:06<00:52,  1.19s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 12%|█▎        | 6/48 [00:07<00:38,  1.08it/s] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.34it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.33it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.34it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:32<00:05,  1.35it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.35it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.31it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:35<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:38<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.38it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
100%|██████████| 48/48 [00:38<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.40it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
[INFO][08:46:38]: [Client #48] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_48_3536584.pth.
{'train_runtime': 38.9149, 'train_samples_per_second': 155.57, 'train_steps_per_second': 1.233, 'train_loss': 3.864685376485189, 'epoch': 3.0}
[INFO][08:46:38]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 38.9999, 'train_samples_per_second': 155.231, 'train_steps_per_second': 1.231, 'train_loss': 3.5901848475138345, 'epoch': 3.0}
[INFO][08:46:39]: [Client #48] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_48_3536584.pth.
[INFO][08:46:40]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][08:46:40]: [Client #48] Model trained.
[INFO][08:46:40]: [Client #48] Inbound data has been processed.
[INFO][08:46:40]: [Client #48] Outbound data is ready to be sent after being processed.
[INFO][08:46:41]: [Client #17] Model trained.
[INFO][08:46:41]: [Client #17] Inbound data has been processed.
[INFO][08:46:41]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][08:46:47]: [Client #48] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:46:48]: [Server #3536466] Received 507.38 MB of payload data from client #48 (simulated).
[INFO][08:46:50]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:46:51]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][08:46:51]: [Server #3536466] Selecting client #14 for training.
[INFO][08:46:51]: [Server #3536466] Sending the current model to client #14 (simulated).
[INFO][08:46:56]: [Server #3536466] Sending 507.38 MB of payload data to client #14 (simulated).
[INFO][08:46:56]: [Server #3536466] Selecting client #21 for training.
[INFO][08:46:56]: [Server #3536466] Sending the current model to client #21 (simulated).
[INFO][08:47:01]: [Server #3536466] Sending 507.38 MB of payload data to client #21 (simulated).
[INFO][08:47:01]: [Client #14] Selected by the server.
[INFO][08:47:01]: [Client #21] Selected by the server.
[INFO][08:47:01]: [Client #14] Loading its data source...
[INFO][08:47:01]: [Client #21] Loading its data source...
[INFO][08:47:01]: [Client #14] Dataset size: 2018
[INFO][08:47:01]: [Client #21] Dataset size: 2018
[INFO][08:47:01]: [Client #14] Sampler: iid
[INFO][08:47:01]: [Client #21] Sampler: iid
[INFO][08:47:03]: [Client #14] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:47:03]: [Client #14] Start to process inbound data.
[INFO][08:47:03]: [Client #21] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:47:03]: [Client #21] Start to process inbound data.
[INFO][08:47:03]: [93m[1m[Client #14] Started training in communication round #10.[0m
[INFO][08:47:03]: [93m[1m[Client #21] Started training in communication round #10.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:13,  4.13s/it]  2%|▏         | 1/48 [00:04<03:28,  4.45s/it]  4%|▍         | 2/48 [00:04<01:38,  2.14s/it]  4%|▍         | 2/48 [00:05<01:49,  2.38s/it]  6%|▋         | 3/48 [00:05<01:12,  1.61s/it]  6%|▋         | 3/48 [00:06<01:17,  1.71s/it]  8%|▊         | 4/48 [00:06<00:58,  1.33s/it]  8%|▊         | 4/48 [00:07<01:00,  1.38s/it] 10%|█         | 5/48 [00:07<00:49,  1.16s/it] 10%|█         | 5/48 [00:08<00:51,  1.19s/it] 12%|█▎        | 6/48 [00:08<00:45,  1.08s/it] 12%|█▎        | 6/48 [00:08<00:45,  1.10s/it] 15%|█▍        | 7/48 [00:09<00:41,  1.00s/it] 15%|█▍        | 7/48 [00:09<00:41,  1.02s/it] 17%|█▋        | 8/48 [00:10<00:38,  1.03it/s] 17%|█▋        | 8/48 [00:10<00:40,  1.01s/it] 19%|█▉        | 9/48 [00:11<00:38,  1.02it/s] 19%|█▉        | 9/48 [00:11<00:39,  1.00s/it] 21%|██        | 10/48 [00:12<00:37,  1.02it/s] 21%|██        | 10/48 [00:12<00:37,  1.00it/s] 23%|██▎       | 11/48 [00:13<00:36,  1.03it/s] 23%|██▎       | 11/48 [00:13<00:35,  1.04it/s] 25%|██▌       | 12/48 [00:14<00:34,  1.05it/s] 25%|██▌       | 12/48 [00:14<00:34,  1.05it/s] 27%|██▋       | 13/48 [00:14<00:32,  1.08it/s] 27%|██▋       | 13/48 [00:15<00:33,  1.04it/s] 29%|██▉       | 14/48 [00:15<00:31,  1.07it/s] 29%|██▉       | 14/48 [00:16<00:31,  1.08it/s] 31%|███▏      | 15/48 [00:16<00:31,  1.06it/s] 31%|███▏      | 15/48 [00:17<00:32,  1.00it/s] 33%|███▎      | 16/48 [00:17<00:29,  1.07it/s] 33%|███▎      | 16/48 [00:18<00:28,  1.12it/s] 35%|███▌      | 17/48 [00:18<00:29,  1.07it/s] 35%|███▌      | 17/48 [00:19<00:28,  1.10it/s] 38%|███▊      | 18/48 [00:19<00:27,  1.10it/s] 38%|███▊      | 18/48 [00:20<00:27,  1.09it/s] 40%|███▉      | 19/48 [00:20<00:26,  1.09it/s] 40%|███▉      | 19/48 [00:21<00:27,  1.07it/s] 42%|████▏     | 20/48 [00:21<00:25,  1.09it/s] 42%|████▏     | 20/48 [00:21<00:25,  1.08it/s] 44%|████▍     | 21/48 [00:22<00:24,  1.10it/s] 44%|████▍     | 21/48 [00:22<00:24,  1.11it/s] 46%|████▌     | 22/48 [00:23<00:23,  1.10it/s] 46%|████▌     | 22/48 [00:23<00:23,  1.11it/s] 48%|████▊     | 23/48 [00:24<00:22,  1.12it/s] 48%|████▊     | 23/48 [00:24<00:22,  1.12it/s] 50%|█████     | 24/48 [00:25<00:22,  1.09it/s] 50%|█████     | 24/48 [00:25<00:21,  1.10it/s] 52%|█████▏    | 25/48 [00:25<00:20,  1.12it/s] 52%|█████▏    | 25/48 [00:26<00:20,  1.11it/s] 54%|█████▍    | 26/48 [00:26<00:20,  1.09it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.10it/s] 56%|█████▋    | 27/48 [00:27<00:19,  1.09it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.10it/s] 58%|█████▊    | 28/48 [00:28<00:17,  1.11it/s] 58%|█████▊    | 28/48 [00:29<00:17,  1.12it/s] 60%|██████    | 29/48 [00:29<00:16,  1.14it/s] 60%|██████    | 29/48 [00:29<00:16,  1.12it/s] 62%|██████▎   | 30/48 [00:30<00:15,  1.13it/s] 62%|██████▎   | 30/48 [00:30<00:16,  1.10it/s] 65%|██████▍   | 31/48 [00:31<00:15,  1.12it/s] 65%|██████▍   | 31/48 [00:32<00:16,  1.05it/s] 67%|██████▋   | 32/48 [00:32<00:14,  1.09it/s] 67%|██████▋   | 32/48 [00:32<00:13,  1.15it/s] 69%|██████▉   | 33/48 [00:33<00:13,  1.09it/s] 69%|██████▉   | 33/48 [00:33<00:13,  1.13it/s] 71%|███████   | 34/48 [00:34<00:13,  1.07it/s] 71%|███████   | 34/48 [00:34<00:12,  1.10it/s] 73%|███████▎  | 35/48 [00:35<00:11,  1.09it/s] 73%|███████▎  | 35/48 [00:35<00:12,  1.05it/s] 75%|███████▌  | 36/48 [00:36<00:11,  1.08it/s] 75%|███████▌  | 36/48 [00:36<00:11,  1.08it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.05it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.07it/s] 79%|███████▉  | 38/48 [00:37<00:09,  1.09it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.08it/s] 81%|████████▏ | 39/48 [00:38<00:08,  1.06it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.04it/s] 83%|████████▎ | 40/48 [00:39<00:07,  1.06it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.06it/s] 85%|████████▌ | 41/48 [00:40<00:06,  1.05it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.08it/s] 88%|████████▊ | 42/48 [00:41<00:05,  1.08it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.10it/s] 90%|████████▉ | 43/48 [00:42<00:04,  1.06it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.08it/s] 92%|█████████▏| 44/48 [00:43<00:03,  1.07it/s] 92%|█████████▏| 44/48 [00:43<00:03,  1.08it/s] 94%|█████████▍| 45/48 [00:44<00:02,  1.07it/s] 94%|█████████▍| 45/48 [00:44<00:02,  1.08it/s] 96%|█████████▌| 46/48 [00:45<00:01,  1.08it/s] 96%|█████████▌| 46/48 [00:45<00:01,  1.05it/s] 98%|█████████▊| 47/48 [00:46<00:00,  1.08it/s] 98%|█████████▊| 47/48 [00:46<00:00,  1.01it/s]100%|██████████| 48/48 [00:47<00:00,  1.08it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.08it/s]100%|██████████| 48/48 [00:47<00:00,  1.02it/s]
100%|██████████| 48/48 [00:47<00:00,  1.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.17it/s]100%|██████████| 48/48 [00:47<00:00,  1.01it/s]
[INFO][08:47:56]: [Client #21] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_21_3536585.pth.
{'train_runtime': 47.2511, 'train_samples_per_second': 128.124, 'train_steps_per_second': 1.016, 'train_loss': 3.8351500829060874, 'epoch': 3.0}
[INFO][08:47:56]: [Client #14] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
{'train_runtime': 47.512, 'train_samples_per_second': 127.42, 'train_steps_per_second': 1.01, 'train_loss': 3.765779177347819, 'epoch': 3.0}
[INFO][08:47:57]: [Client #21] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_21_3536585.pth.
[INFO][08:47:57]: [Client #14] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
[INFO][08:47:58]: [Client #21] Model trained.
[INFO][08:47:58]: [Client #21] Inbound data has been processed.
[INFO][08:47:58]: [Client #21] Outbound data is ready to be sent after being processed.
[INFO][08:47:58]: [Client #14] Model trained.
[INFO][08:47:58]: [Client #14] Inbound data has been processed.
[INFO][08:47:58]: [Client #14] Outbound data is ready to be sent after being processed.
[INFO][08:48:08]: [Client #21] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:48:09]: [Client #14] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:48:09]: [Server #3536466] Received 507.38 MB of payload data from client #21 (simulated).
[INFO][08:48:10]: [Server #3536466] Received 507.38 MB of payload data from client #14 (simulated).
[INFO][08:48:10]: [Server #3536466] Selecting client #73 for training.
[INFO][08:48:10]: [Server #3536466] Sending the current model to client #73 (simulated).
[INFO][08:48:15]: [Server #3536466] Sending 507.38 MB of payload data to client #73 (simulated).
[INFO][08:48:15]: [Client #73] Selected by the server.
[INFO][08:48:15]: [Client #73] Loading its data source...
[INFO][08:48:15]: [Client #73] Dataset size: 2018
[INFO][08:48:15]: [Client #73] Sampler: iid
[INFO][08:48:16]: [Client #73] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:48:16]: [Client #73] Start to process inbound data.
[INFO][08:48:17]: [93m[1m[Client #73] Started training in communication round #10.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:58,  3.80s/it]  4%|▍         | 2/48 [00:04<01:24,  1.85s/it]  6%|▋         | 3/48 [00:04<00:54,  1.22s/it]  8%|▊         | 4/48 [00:05<00:40,  1.08it/s] 10%|█         | 5/48 [00:05<00:32,  1.31it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.50it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.86it/s] 21%|██        | 10/48 [00:08<00:19,  1.93it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:09<00:17,  2.02it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.06it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.19it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.16it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.14it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.13it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.12it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.12it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.11it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.11it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.10it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.10it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.10it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.10it/s] 60%|██████    | 29/48 [00:17<00:09,  2.10it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.10it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.10it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.21it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.17it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.13it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.12it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.11it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.10it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.10it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.10it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.10it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:25<00:00,  2.20it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:25<00:00,  2.20it/s]100%|██████████| 48/48 [00:25<00:00,  1.85it/s]
[INFO][08:48:48]: [Client #73] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_73_3536584.pth.
{'train_runtime': 25.9902, 'train_samples_per_second': 232.934, 'train_steps_per_second': 1.847, 'train_loss': 3.829169591267904, 'epoch': 3.0}
[INFO][08:48:49]: [Client #73] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_73_3536584.pth.
[INFO][08:48:49]: [Client #73] Model trained.
[INFO][08:48:49]: [Client #73] Inbound data has been processed.
[INFO][08:48:49]: [Client #73] Outbound data is ready to be sent after being processed.
[INFO][08:48:55]: [Client #73] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:48:56]: [Server #3536466] Received 507.38 MB of payload data from client #73 (simulated).
[INFO][08:48:56]: [Server #3536466] Adding client #37 to the list of clients for aggregation.
[INFO][08:48:56]: [Server #3536466] Adding client #57 to the list of clients for aggregation.
[INFO][08:48:56]: [Server #3536466] Adding client #3 to the list of clients for aggregation.
[INFO][08:48:56]: [Server #3536466] Adding client #14 to the list of clients for aggregation.
[INFO][08:48:56]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][08:48:56]: [Server #3536466] Aggregating 5 clients in total.
[INFO][08:48:56]: [Server #3536466] Updated weights have been received.
[INFO][08:48:56]: [Server #3536466] Aggregating model weight deltas.
[INFO][08:48:56]: [Server #3536466] Finished aggregating updated weights.
[INFO][08:48:56]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  8.3467e-01  1e+02  1e+00  1e+00
 1:  6.4462e-01 -1.3937e-01  2e+01  2e-01  2e-01
 2:  8.3459e-01 -9.1519e-02  1e+00  2e-03  2e-03
 3:  8.3806e-01  7.1862e-01  1e-01  2e-08  6e-09
 4:  8.3715e-01  8.2935e-01  8e-03  4e-08  8e-09
 5:  8.3570e-01  8.3057e-01  5e-03  5e-07  2e-07
 6:  8.3381e-01  8.3010e-01  4e-03  7e-06  5e-06
 7:  8.3306e-01  8.3116e-01  2e-03  5e-06  4e-06
 8:  8.3168e-01  8.3135e-01  4e-04  1e-05  8e-06
 9:  8.3141e-01  8.3136e-01  7e-05  2e-06  2e-06
10:  8.3136e-01  8.3136e-01  3e-06  1e-07  9e-08
11:  8.3136e-01  8.3136e-01  3e-08  1e-09  1e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.1
 2.1  0.01 0.1  0.01 2.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 0.01 0.01 0.01 2.1  0.01 0.01 0.01 0.01 1.1  1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 0.01 4.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 0.01 0.01 0.01 3.1  0.01 0.01 0.01 3.1  0.01 1.1  0.01
 0.01 3.1  0.01 0.01 0.01 0.01 0.01 0.01 2.1  0.01 0.01 2.1  0.01 0.01
 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2
 0.2  0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.2  0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.15it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.57it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.00it/s]100%|██████████| 8/8 [00:00<00:00, 11.88it/s]
[INFO][08:49:06]: [93m[1m[Server #3536466] Global model perplexity: 40.56
[0m
[INFO][08:49:06]: [Server #3536466] All client reports have been processed.
[INFO][08:49:06]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_10.pth.
[INFO][08:49:10]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_10.pth.
[INFO][08:49:10]: [93m[1m
[Server #3536466] Starting round 11/100.[0m
[INFO][08:49:10]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([1.57519890e-07, 2.12333899e-08, 2.12333899e-08, 1.57519890e-07,
       1.57519890e-07, 1.57519890e-07, 1.57519890e-07, 2.12333899e-08,
       1.57519890e-07, 1.57519890e-07, 1.57519890e-07, 1.57519890e-07,
       1.57519890e-07, 4.99994270e-01, 3.36009568e-09, 1.57519890e-07,
       4.99994270e-01, 1.57519890e-07, 3.36009568e-09, 1.57519890e-07,
       1.57519890e-07, 1.57519890e-07, 1.57519890e-07, 1.57519890e-07,
       2.12333899e-08, 1.57519890e-07, 1.57519890e-07, 1.57519890e-07,
       3.36009568e-09, 1.57519890e-07, 1.57519890e-07, 1.57519890e-07,
       1.57519890e-07, 2.12333899e-08, 2.12333899e-08, 1.57519890e-07,
       1.57519890e-07, 1.57519890e-07, 2.12333899e-08, 1.57519890e-07,
       1.57519890e-07, 1.57519890e-07, 1.57519890e-07, 7.59158479e-10,
       1.57519890e-07, 1.57519890e-07, 1.57519890e-07, 1.57519890e-07,
       1.57519890e-07, 1.57519890e-07, 2.12333899e-08, 1.57519890e-07,
       2.12333899e-08, 1.57519890e-07, 1.57519890e-07, 1.57519890e-07,
       1.57519890e-07, 1.57519890e-07, 1.38166598e-09, 1.57519890e-07,
       1.57519890e-07, 1.57519890e-07, 1.38166598e-09, 1.57519890e-07,
       2.12333899e-08, 1.57519890e-07, 1.57519890e-07, 1.38166598e-09,
       1.57519890e-07, 1.57519890e-07, 1.57519890e-07, 1.57519890e-07,
       1.57519890e-07, 3.36009568e-09, 1.57519890e-07, 1.57519890e-07,
       3.36009568e-09, 1.57519890e-07, 1.57519890e-07, 1.57519890e-07,
       1.57519890e-07, 1.57519890e-07, 2.12333899e-08, 1.57519890e-07,
       1.57519890e-07, 1.57519890e-07, 1.57519890e-07, 1.57519890e-07,
       1.57519890e-07, 1.57519890e-07, 1.57519890e-07, 1.57519890e-07,
       1.57519890e-07, 4.81529579e-10, 2.12333899e-08]),)
[INFO][08:49:10]: [Server #3536466] Selected clients: [17 14 78 50  6]
[INFO][08:49:10]: [Server #3536466] Selecting client #50 for training.
[INFO][08:49:10]: [Server #3536466] Sending the current model to client #50 (simulated).
[INFO][08:49:15]: [Server #3536466] Sending 507.38 MB of payload data to client #50 (simulated).
[INFO][08:49:15]: [Server #3536466] Selecting client #17 for training.
[INFO][08:49:15]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][08:49:21]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][08:49:21]: [Client #50] Selected by the server.
[INFO][08:49:21]: [Client #50] Loading its data source...
[INFO][08:49:21]: [Client #50] Dataset size: 2018
[INFO][08:49:21]: [Client #50] Sampler: iid
[INFO][08:49:21]: [Client #17] Selected by the server.
[INFO][08:49:21]: [Client #17] Loading its data source...
[INFO][08:49:21]: [Client #17] Dataset size: 2018
[INFO][08:49:21]: [Client #17] Sampler: iid
[INFO][08:49:22]: [Client #50] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:49:22]: [Client #50] Start to process inbound data.
[INFO][08:49:22]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:49:22]: [Client #17] Start to process inbound data.
[INFO][08:49:23]: [93m[1m[Client #17] Started training in communication round #11.[0m
[INFO][08:49:23]: [93m[1m[Client #50] Started training in communication round #11.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:14,  4.15s/it]  2%|▏         | 1/48 [00:04<03:16,  4.18s/it]  4%|▍         | 2/48 [00:04<01:38,  2.14s/it]  4%|▍         | 2/48 [00:04<01:39,  2.16s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.08it/s] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.26it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 21%|██        | 10/48 [00:10<00:30,  1.26it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.33it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.33it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.32it/s] 60%|██████    | 29/48 [00:24<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.34it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.32it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][08:50:07]: [Client #50] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_50_3536584.pth.
{'train_runtime': 39.0444, 'train_samples_per_second': 155.054, 'train_steps_per_second': 1.229, 'train_loss': 3.8014065424601235, 'epoch': 3.0}
[INFO][08:50:08]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 39.0626, 'train_samples_per_second': 154.982, 'train_steps_per_second': 1.229, 'train_loss': 3.4533411661783853, 'epoch': 3.0}
[INFO][08:50:08]: [Client #50] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_50_3536584.pth.
[INFO][08:50:09]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][08:50:09]: [Client #50] Model trained.
[INFO][08:50:09]: [Client #50] Inbound data has been processed.
[INFO][08:50:09]: [Client #50] Outbound data is ready to be sent after being processed.
[INFO][08:50:09]: [Client #17] Model trained.
[INFO][08:50:09]: [Client #17] Inbound data has been processed.
[INFO][08:50:09]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][08:50:19]: [Client #50] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:50:19]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:50:20]: [Server #3536466] Received 507.38 MB of payload data from client #50 (simulated).
[INFO][08:50:21]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][08:50:21]: [Server #3536466] Selecting client #6 for training.
[INFO][08:50:21]: [Server #3536466] Sending the current model to client #6 (simulated).
[INFO][08:50:26]: [Server #3536466] Sending 507.38 MB of payload data to client #6 (simulated).
[INFO][08:50:26]: [Client #6] Selected by the server.
[INFO][08:50:26]: [Client #6] Loading its data source...
[INFO][08:50:26]: [Client #6] Dataset size: 2018
[INFO][08:50:26]: [Client #6] Sampler: iid
[INFO][08:50:27]: [Client #6] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:50:27]: [Client #6] Start to process inbound data.
[INFO][08:50:27]: [93m[1m[Client #6] Started training in communication round #11.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:57,  3.77s/it]  4%|▍         | 2/48 [00:04<01:24,  1.83s/it]  6%|▋         | 3/48 [00:04<00:54,  1.21s/it]  8%|▊         | 4/48 [00:05<00:40,  1.08it/s] 10%|█         | 5/48 [00:05<00:32,  1.31it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.51it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.87it/s] 21%|██        | 10/48 [00:08<00:19,  1.94it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:09<00:17,  2.02it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.06it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.18it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.15it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.13it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.12it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.11it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.10it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.10it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:14<00:11,  2.09it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.09it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.09it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.09it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.09it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.09it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.19it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.16it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.12it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.11it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.10it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.09it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.09it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.09it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:26<00:00,  2.19it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.19it/s]100%|██████████| 48/48 [00:26<00:00,  1.84it/s]
[INFO][08:50:59]: [Client #6] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_6_3536584.pth.
{'train_runtime': 26.018, 'train_samples_per_second': 232.685, 'train_steps_per_second': 1.845, 'train_loss': 3.8203907012939453, 'epoch': 3.0}
[INFO][08:50:59]: [Client #6] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_6_3536584.pth.
[INFO][08:51:00]: [Client #6] Model trained.
[INFO][08:51:00]: [Client #6] Inbound data has been processed.
[INFO][08:51:00]: [Client #6] Outbound data is ready to be sent after being processed.
[INFO][08:51:05]: [Client #6] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:51:06]: [Server #3536466] Received 507.38 MB of payload data from client #6 (simulated).
[INFO][08:51:06]: [Server #3536466] Selecting client #78 for training.
[INFO][08:51:06]: [Server #3536466] Sending the current model to client #78 (simulated).
[INFO][08:51:11]: [Server #3536466] Sending 507.38 MB of payload data to client #78 (simulated).
[INFO][08:51:11]: [Client #78] Selected by the server.
[INFO][08:51:11]: [Client #78] Loading its data source...
[INFO][08:51:11]: [Client #78] Dataset size: 2018
[INFO][08:51:11]: [Client #78] Sampler: iid
[INFO][08:51:12]: [Client #78] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:51:12]: [Client #78] Start to process inbound data.
[INFO][08:51:13]: [93m[1m[Client #78] Started training in communication round #11.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:58,  3.79s/it]  4%|▍         | 2/48 [00:04<01:24,  1.84s/it]  6%|▋         | 3/48 [00:04<00:54,  1.22s/it]  8%|▊         | 4/48 [00:05<00:40,  1.08it/s] 10%|█         | 5/48 [00:05<00:32,  1.31it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.50it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.87it/s] 21%|██        | 10/48 [00:08<00:19,  1.93it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:09<00:17,  2.01it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.06it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.19it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.16it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.13it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.12it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.11it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.10it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.10it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:14<00:11,  2.09it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.09it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.09it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.09it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.09it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.19it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.16it/s] 71%|███████   | 34/48 [00:19<00:06,  2.13it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.12it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.11it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.10it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.09it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.09it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.09it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.08it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.08it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:26<00:00,  2.19it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.19it/s]100%|██████████| 48/48 [00:26<00:00,  1.84it/s]
[INFO][08:51:44]: [Client #78] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
{'train_runtime': 26.058, 'train_samples_per_second': 232.328, 'train_steps_per_second': 1.842, 'train_loss': 3.8050594329833984, 'epoch': 3.0}
[INFO][08:51:45]: [Client #78] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
[INFO][08:51:46]: [Client #78] Model trained.
[INFO][08:51:46]: [Client #78] Inbound data has been processed.
[INFO][08:51:46]: [Client #78] Outbound data is ready to be sent after being processed.
[INFO][08:51:51]: [Client #78] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:51:52]: [Server #3536466] Received 507.38 MB of payload data from client #78 (simulated).
[INFO][08:51:52]: [Server #3536466] Selecting client #14 for training.
[INFO][08:51:52]: [Server #3536466] Sending the current model to client #14 (simulated).
[INFO][08:51:57]: [Server #3536466] Sending 507.38 MB of payload data to client #14 (simulated).
[INFO][08:51:57]: [Client #14] Selected by the server.
[INFO][08:51:57]: [Client #14] Loading its data source...
[INFO][08:51:57]: [Client #14] Dataset size: 2018
[INFO][08:51:57]: [Client #14] Sampler: iid
[INFO][08:51:58]: [Client #14] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:51:58]: [Client #14] Start to process inbound data.
[INFO][08:51:59]: [93m[1m[Client #14] Started training in communication round #11.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:55,  3.74s/it]  4%|▍         | 2/48 [00:04<01:23,  1.82s/it]  6%|▋         | 3/48 [00:04<00:54,  1.21s/it]  8%|▊         | 4/48 [00:05<00:40,  1.09it/s] 10%|█         | 5/48 [00:05<00:32,  1.31it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.51it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.87it/s] 21%|██        | 10/48 [00:08<00:19,  1.93it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:08<00:17,  2.01it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.06it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.19it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.15it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.13it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.13it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.12it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.11it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.10it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.09it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.09it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.09it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:17<00:08,  2.09it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.20it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.16it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.13it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.12it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.11it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.10it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.10it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.10it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:25<00:00,  2.20it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:25<00:00,  2.20it/s]100%|██████████| 48/48 [00:25<00:00,  1.85it/s]
[INFO][08:52:30]: [Client #14] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
{'train_runtime': 25.9775, 'train_samples_per_second': 233.048, 'train_steps_per_second': 1.848, 'train_loss': 3.6666088104248047, 'epoch': 3.0}
[INFO][08:52:31]: [Client #14] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
[INFO][08:52:31]: [Client #14] Model trained.
[INFO][08:52:31]: [Client #14] Inbound data has been processed.
[INFO][08:52:31]: [Client #14] Outbound data is ready to be sent after being processed.
[INFO][08:52:37]: [Client #14] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:52:37]: [Server #3536466] Received 507.38 MB of payload data from client #14 (simulated).
[INFO][08:52:37]: [Server #3536466] Adding client #21 to the list of clients for aggregation.
[INFO][08:52:37]: [Server #3536466] Adding client #48 to the list of clients for aggregation.
[INFO][08:52:37]: [Server #3536466] Adding client #14 to the list of clients for aggregation.
[INFO][08:52:37]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][08:52:37]: [Server #3536466] Adding client #78 to the list of clients for aggregation.
[INFO][08:52:37]: [Server #3536466] Aggregating 5 clients in total.
[INFO][08:52:37]: [Server #3536466] Updated weights have been received.
[INFO][08:52:38]: [Server #3536466] Aggregating model weight deltas.
[INFO][08:52:38]: [Server #3536466] Finished aggregating updated weights.
[INFO][08:52:38]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  8.7820e-01  1e+02  1e+00  1e+00
 1:  6.9119e-01 -9.6016e-02  2e+01  2e-01  2e-01
 2:  8.7841e-01 -4.5601e-02  1e+00  2e-03  1e-03
 3:  8.8171e-01  7.6663e-01  1e-01  2e-08  6e-09
 4:  8.8082e-01  8.7311e-01  8e-03  4e-08  8e-09
 5:  8.7929e-01  8.7429e-01  5e-03  5e-07  2e-07
 6:  8.7744e-01  8.7386e-01  4e-03  7e-06  5e-06
 7:  8.7668e-01  8.7485e-01  2e-03  5e-06  4e-06
 8:  8.7534e-01  8.7503e-01  4e-04  1e-05  7e-06
 9:  8.7508e-01  8.7504e-01  7e-05  2e-06  2e-06
10:  8.7504e-01  8.7504e-01  3e-06  1e-07  8e-08
11:  8.7504e-01  8.7504e-01  3e-08  1e-09  9e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  0.01 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.1
 2.1  0.01 0.1  0.01 2.1  0.01 1.1  0.01 0.01 0.01 0.01 0.01 1.1  0.01
 0.01 0.01 0.01 2.1  0.01 0.01 0.01 0.01 1.1  1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 0.01 4.1  1.1  0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 0.01 0.01 0.01 3.1  0.01 0.01 0.01 3.1  0.01 1.1  0.01
 0.01 3.1  0.01 0.01 0.01 0.01 0.01 0.1  2.1  0.01 0.01 2.1  0.01 0.01
 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2
 0.2  0.01 0.2  0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.33it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.64it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.09it/s]100%|██████████| 8/8 [00:00<00:00, 11.89it/s]
[INFO][08:52:48]: [93m[1m[Server #3536466] Global model perplexity: 37.85
[0m
[INFO][08:52:48]: [Server #3536466] All client reports have been processed.
[INFO][08:52:48]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_11.pth.
[INFO][08:52:52]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_11.pth.
[INFO][08:52:52]: [93m[1m
[Server #3536466] Starting round 12/100.[0m
[INFO][08:52:52]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([4.64386596e-07, 7.38953316e-08, 7.38953316e-08, 4.64386596e-07,
       4.64386596e-07, 4.64386596e-07, 7.38953316e-08, 4.64386596e-07,
       4.64386596e-07, 4.64386596e-07, 4.64386596e-07, 4.64386596e-07,
       3.33322437e-01, 1.14901334e-08, 4.64386596e-07, 3.33322437e-01,
       4.64386596e-07, 1.14901334e-08, 4.64386596e-07, 7.38953316e-08,
       4.64386596e-07, 4.64386596e-07, 4.64386596e-07, 4.64386596e-07,
       7.38953316e-08, 4.64386596e-07, 4.64386596e-07, 4.64386596e-07,
       1.14901334e-08, 4.64386596e-07, 4.64386596e-07, 4.64386596e-07,
       4.64386596e-07, 7.38953316e-08, 7.38953316e-08, 4.64386596e-07,
       4.64386596e-07, 4.64386596e-07, 7.38953316e-08, 4.64386596e-07,
       4.64386596e-07, 4.64386596e-07, 4.64386596e-07, 2.55138851e-09,
       7.38953316e-08, 4.64386596e-07, 4.64386596e-07, 4.64386596e-07,
       4.64386596e-07, 4.64386596e-07, 7.38953316e-08, 4.64386596e-07,
       7.38953316e-08, 4.64386596e-07, 4.64386596e-07, 4.64386596e-07,
       4.64386596e-07, 4.64386596e-07, 4.66783239e-09, 4.64386596e-07,
       4.64386596e-07, 4.64386596e-07, 4.66783239e-09, 4.64386596e-07,
       7.38953316e-08, 4.64386596e-07, 4.64386596e-07, 4.66783239e-09,
       4.64386596e-07, 4.64386596e-07, 4.64386596e-07, 4.64386596e-07,
       3.33322437e-01, 1.14901334e-08, 4.64386596e-07, 4.64386596e-07,
       1.14901334e-08, 4.64386596e-07, 4.64386596e-07, 4.64386596e-07,
       4.64386596e-07, 4.64386596e-07, 7.38953316e-08, 4.64386596e-07,
       4.64386596e-07, 4.64386596e-07, 4.64386596e-07, 4.64386596e-07,
       4.64386596e-07, 4.64386596e-07, 4.64386596e-07, 4.64386596e-07,
       4.64386596e-07, 1.61405419e-09, 7.38953316e-08]),)
[INFO][08:52:52]: [Server #3536466] Selected clients: [17 14 78 61 87]
[INFO][08:52:52]: [Server #3536466] Selecting client #78 for training.
[INFO][08:52:52]: [Server #3536466] Sending the current model to client #78 (simulated).
[INFO][08:52:57]: [Server #3536466] Sending 507.38 MB of payload data to client #78 (simulated).
[INFO][08:52:57]: [Server #3536466] Selecting client #17 for training.
[INFO][08:52:57]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][08:53:03]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][08:53:03]: [Client #78] Selected by the server.
[INFO][08:53:03]: [Client #17] Selected by the server.
[INFO][08:53:03]: [Client #78] Loading its data source...
[INFO][08:53:03]: [Client #17] Loading its data source...
[INFO][08:53:03]: [Client #78] Dataset size: 2018
[INFO][08:53:03]: [Client #78] Sampler: iid
[INFO][08:53:03]: [Client #17] Dataset size: 2018
[INFO][08:53:03]: [Client #17] Sampler: iid
[INFO][08:53:04]: [Client #78] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:53:04]: [Client #78] Start to process inbound data.
[INFO][08:53:04]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:53:04]: [Client #17] Start to process inbound data.
[INFO][08:53:05]: [93m[1m[Client #78] Started training in communication round #12.[0m
[INFO][08:53:05]: [93m[1m[Client #17] Started training in communication round #12.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:15,  4.15s/it]  2%|▏         | 1/48 [00:04<03:23,  4.33s/it]  4%|▍         | 2/48 [00:04<01:39,  2.16s/it]  4%|▍         | 2/48 [00:05<01:41,  2.21s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  6%|▋         | 3/48 [00:05<01:08,  1.53s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 21%|██        | 10/48 [00:10<00:30,  1.26it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:25,  1.30it/s] 31%|███▏      | 15/48 [00:14<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s]100%|██████████| 48/48 [00:38<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.39it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][08:53:49]: [Client #78] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
{'train_runtime': 38.9704, 'train_samples_per_second': 155.349, 'train_steps_per_second': 1.232, 'train_loss': 3.660908063252767, 'epoch': 3.0}
[INFO][08:53:50]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 39.0217, 'train_samples_per_second': 155.144, 'train_steps_per_second': 1.23, 'train_loss': 3.3839168548583984, 'epoch': 3.0}
[INFO][08:53:50]: [Client #78] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
[INFO][08:53:51]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][08:53:51]: [Client #78] Model trained.
[INFO][08:53:51]: [Client #78] Inbound data has been processed.
[INFO][08:53:51]: [Client #78] Outbound data is ready to be sent after being processed.
[INFO][08:53:51]: [Client #17] Model trained.
[INFO][08:53:51]: [Client #17] Inbound data has been processed.
[INFO][08:53:51]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][08:54:01]: [Client #78] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:54:01]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:54:02]: [Server #3536466] Received 507.38 MB of payload data from client #78 (simulated).
[INFO][08:54:03]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][08:54:03]: [Server #3536466] Selecting client #14 for training.
[INFO][08:54:03]: [Server #3536466] Sending the current model to client #14 (simulated).
[INFO][08:54:09]: [Server #3536466] Sending 507.38 MB of payload data to client #14 (simulated).
[INFO][08:54:09]: [Server #3536466] Selecting client #87 for training.
[INFO][08:54:09]: [Server #3536466] Sending the current model to client #87 (simulated).
[INFO][08:54:14]: [Server #3536466] Sending 507.38 MB of payload data to client #87 (simulated).
[INFO][08:54:14]: [Client #14] Selected by the server.
[INFO][08:54:14]: [Client #14] Loading its data source...
[INFO][08:54:14]: [Client #87] Selected by the server.
[INFO][08:54:14]: [Client #14] Dataset size: 2018
[INFO][08:54:14]: [Client #87] Loading its data source...
[INFO][08:54:14]: [Client #14] Sampler: iid
[INFO][08:54:14]: [Client #87] Dataset size: 2018
[INFO][08:54:14]: [Client #87] Sampler: iid
[INFO][08:54:15]: [Client #87] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:54:15]: [Client #87] Start to process inbound data.
[INFO][08:54:15]: [Client #14] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:54:15]: [Client #14] Start to process inbound data.
[INFO][08:54:16]: [93m[1m[Client #14] Started training in communication round #12.[0m
[INFO][08:54:16]: [93m[1m[Client #87] Started training in communication round #12.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.21s/it]  2%|▏         | 1/48 [00:04<03:17,  4.21s/it]  4%|▍         | 2/48 [00:04<01:39,  2.15s/it]  4%|▍         | 2/48 [00:04<01:40,  2.18s/it]  6%|▋         | 3/48 [00:05<01:07,  1.50s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it]  8%|▊         | 4/48 [00:06<00:53,  1.22s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 10%|█         | 5/48 [00:07<00:44,  1.05s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.06it/s] 12%|█▎        | 6/48 [00:07<00:39,  1.06it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.22it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 21%|██        | 10/48 [00:10<00:30,  1.26it/s] 21%|██        | 10/48 [00:10<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:11<00:29,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:28,  1.28it/s] 27%|██▋       | 13/48 [00:13<00:27,  1.28it/s] 27%|██▋       | 13/48 [00:13<00:27,  1.29it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.29it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.30it/s] 31%|███▏      | 15/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:25,  1.30it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:19,  1.31it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][08:55:01]: [Client #87] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_87_3536585.pth.
{'train_runtime': 39.1544, 'train_samples_per_second': 154.618, 'train_steps_per_second': 1.226, 'train_loss': 3.6949408849080405, 'epoch': 3.0}
[INFO][08:55:01]: [Client #14] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
{'train_runtime': 39.1819, 'train_samples_per_second': 154.51, 'train_steps_per_second': 1.225, 'train_loss': 3.546393076578776, 'epoch': 3.0}
[INFO][08:55:02]: [Client #87] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_87_3536585.pth.
[INFO][08:55:03]: [Client #14] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
[INFO][08:55:03]: [Client #87] Model trained.
[INFO][08:55:03]: [Client #87] Inbound data has been processed.
[INFO][08:55:03]: [Client #87] Outbound data is ready to be sent after being processed.
[INFO][08:55:03]: [Client #14] Model trained.
[INFO][08:55:03]: [Client #14] Inbound data has been processed.
[INFO][08:55:03]: [Client #14] Outbound data is ready to be sent after being processed.
[INFO][08:55:13]: [Client #87] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:55:13]: [Client #14] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:55:14]: [Server #3536466] Received 507.38 MB of payload data from client #87 (simulated).
[INFO][08:55:14]: [Server #3536466] Received 507.38 MB of payload data from client #14 (simulated).
[INFO][08:55:14]: [Server #3536466] Selecting client #61 for training.
[INFO][08:55:14]: [Server #3536466] Sending the current model to client #61 (simulated).
[INFO][08:55:20]: [Server #3536466] Sending 507.38 MB of payload data to client #61 (simulated).
[INFO][08:55:20]: [Client #61] Selected by the server.
[INFO][08:55:20]: [Client #61] Loading its data source...
[INFO][08:55:20]: [Client #61] Dataset size: 2018
[INFO][08:55:20]: [Client #61] Sampler: iid
[INFO][08:55:21]: [Client #61] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:55:21]: [Client #61] Start to process inbound data.
[INFO][08:55:21]: [93m[1m[Client #61] Started training in communication round #12.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:59,  3.82s/it]  4%|▍         | 2/48 [00:04<01:25,  1.85s/it]  6%|▋         | 3/48 [00:04<00:55,  1.22s/it]  8%|▊         | 4/48 [00:05<00:40,  1.08it/s] 10%|█         | 5/48 [00:05<00:32,  1.30it/s] 12%|█▎        | 6/48 [00:06<00:28,  1.50it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.65it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.77it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.86it/s] 21%|██        | 10/48 [00:08<00:19,  1.93it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:09<00:17,  2.01it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.05it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.06it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.18it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.15it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.14it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.13it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.12it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.10it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.10it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.10it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.10it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.10it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.09it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.20it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.16it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.12it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.11it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.11it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.10it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.10it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.09it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:26<00:00,  2.19it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.19it/s]100%|██████████| 48/48 [00:26<00:00,  1.84it/s]
[INFO][08:55:52]: [Client #61] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536584.pth.
{'train_runtime': 26.053, 'train_samples_per_second': 232.373, 'train_steps_per_second': 1.842, 'train_loss': 3.691718101501465, 'epoch': 3.0}
[INFO][08:55:53]: [Client #61] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536584.pth.
[INFO][08:55:54]: [Client #61] Model trained.
[INFO][08:55:54]: [Client #61] Inbound data has been processed.
[INFO][08:55:54]: [Client #61] Outbound data is ready to be sent after being processed.
[INFO][08:55:59]: [Client #61] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:56:00]: [Server #3536466] Received 507.38 MB of payload data from client #61 (simulated).
[INFO][08:56:00]: [Server #3536466] Adding client #14 to the list of clients for aggregation.
[INFO][08:56:00]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][08:56:00]: [Server #3536466] Adding client #78 to the list of clients for aggregation.
[INFO][08:56:00]: [Server #3536466] Adding client #61 to the list of clients for aggregation.
[INFO][08:56:00]: [Server #3536466] Adding client #6 to the list of clients for aggregation.
[INFO][08:56:00]: [Server #3536466] Aggregating 5 clients in total.
[INFO][08:56:00]: [Server #3536466] Updated weights have been received.
[INFO][08:56:00]: [Server #3536466] Aggregating model weight deltas.
[INFO][08:56:01]: [Server #3536466] Finished aggregating updated weights.
[INFO][08:56:01]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  9.1031e-01  1e+02  1e+00  1e+00
 1:  7.2530e-01 -6.4130e-02  2e+01  1e-01  1e-01
 2:  9.1065e-01 -1.1796e-02  1e+00  1e-03  1e-03
 3:  9.1384e-01  8.0186e-01  1e-01  2e-08  6e-09
 4:  9.1295e-01  9.0537e-01  8e-03  4e-08  8e-09
 5:  9.1118e-01  9.0652e-01  5e-03  7e-07  3e-07
 6:  9.0908e-01  9.0615e-01  3e-03  7e-06  5e-06
 7:  9.0824e-01  9.0691e-01  1e-03  5e-06  3e-06
 8:  9.0709e-01  9.0698e-01  2e-04  5e-06  3e-06
 9:  9.0699e-01  9.0698e-01  8e-06  3e-07  2e-07
10:  9.0698e-01  9.0698e-01  1e-07  4e-09  2e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  0.01 0.01 1.1  0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.1
 2.1  0.01 0.1  0.01 2.1  0.01 1.1  0.01 0.01 0.01 0.01 0.01 1.1  0.01
 0.01 0.01 0.01 2.1  0.01 0.01 0.01 0.01 1.1  1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 0.01 4.1  1.1  0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 0.01 0.1  0.01 3.1  0.01 0.01 0.01 3.1  0.01 1.1  0.01
 0.01 3.1  0.01 0.01 0.01 0.01 0.01 0.1  2.1  0.01 0.01 2.1  0.01 0.01
 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2
 0.2  0.01 0.2  0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.99it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.49it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.03it/s]100%|██████████| 8/8 [00:00<00:00, 11.87it/s]
[INFO][08:56:10]: [93m[1m[Server #3536466] Global model perplexity: 36.22
[0m
[INFO][08:56:10]: [Server #3536466] All client reports have been processed.
[INFO][08:56:11]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_12.pth.
[INFO][08:56:15]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_12.pth.
[INFO][08:56:15]: [93m[1m
[Server #3536466] Starting round 13/100.[0m
[INFO][08:56:15]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.63251044e-07, 5.99478667e-08, 5.99478667e-08, 2.63251044e-07,
       2.63251044e-07, 5.99478667e-08, 2.63251044e-07, 5.99478667e-08,
       2.63251044e-07, 2.63251044e-07, 2.63251044e-07, 2.63251044e-07,
       2.63251044e-07, 2.49995412e-01, 1.19058835e-08, 2.63251044e-07,
       2.49995412e-01, 2.63251044e-07, 1.19058835e-08, 2.63251044e-07,
       5.99478667e-08, 2.63251044e-07, 2.63251044e-07, 2.63251044e-07,
       2.63251044e-07, 5.99478667e-08, 2.63251044e-07, 2.63251044e-07,
       2.63251044e-07, 1.19058835e-08, 2.63251044e-07, 2.63251044e-07,
       2.63251044e-07, 2.63251044e-07, 5.99478667e-08, 5.99478667e-08,
       2.63251044e-07, 2.63251044e-07, 2.63251044e-07, 5.99478667e-08,
       2.63251044e-07, 2.63251044e-07, 2.63251044e-07, 2.63251044e-07,
       2.87092974e-09, 5.99478667e-08, 2.63251044e-07, 2.63251044e-07,
       2.63251044e-07, 2.63251044e-07, 2.63251044e-07, 5.99478667e-08,
       2.63251044e-07, 5.99478667e-08, 2.63251044e-07, 2.63251044e-07,
       2.63251044e-07, 2.49995412e-01, 2.63251044e-07, 5.12654528e-09,
       2.63251044e-07, 2.63251044e-07, 2.63251044e-07, 5.12654528e-09,
       2.63251044e-07, 5.99478667e-08, 2.63251044e-07, 2.63251044e-07,
       5.12654528e-09, 2.63251044e-07, 2.63251044e-07, 2.63251044e-07,
       2.63251044e-07, 2.49995412e-01, 1.19058835e-08, 2.63251044e-07,
       2.63251044e-07, 1.19058835e-08, 2.63251044e-07, 2.63251044e-07,
       2.63251044e-07, 2.63251044e-07, 5.99478667e-08, 2.63251044e-07,
       2.63251044e-07, 2.63251044e-07, 2.63251044e-07, 2.63251044e-07,
       2.63251044e-07, 2.63251044e-07, 2.63251044e-07, 2.63251044e-07,
       2.63251044e-07, 1.84033033e-09, 5.99478667e-08]),)
[INFO][08:56:15]: [Server #3536466] Selected clients: [17 61 78 14 74]
[INFO][08:56:15]: [Server #3536466] Selecting client #14 for training.
[INFO][08:56:15]: [Server #3536466] Sending the current model to client #14 (simulated).
[INFO][08:56:20]: [Server #3536466] Sending 507.38 MB of payload data to client #14 (simulated).
[INFO][08:56:20]: [Server #3536466] Selecting client #17 for training.
[INFO][08:56:20]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][08:56:26]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][08:56:26]: [Client #14] Selected by the server.
[INFO][08:56:26]: [Client #14] Loading its data source...
[INFO][08:56:26]: [Client #14] Dataset size: 2018
[INFO][08:56:26]: [Client #14] Sampler: iid
[INFO][08:56:26]: [Client #17] Selected by the server.
[INFO][08:56:26]: [Client #17] Loading its data source...
[INFO][08:56:26]: [Client #17] Dataset size: 2018
[INFO][08:56:26]: [Client #17] Sampler: iid
[INFO][08:56:27]: [Client #14] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:56:27]: [Client #14] Start to process inbound data.
[INFO][08:56:27]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:56:27]: [Client #17] Start to process inbound data.
[INFO][08:56:28]: [93m[1m[Client #14] Started training in communication round #13.[0m
[INFO][08:56:28]: [93m[1m[Client #17] Started training in communication round #13.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:14,  4.15s/it]  2%|▏         | 1/48 [00:04<03:20,  4.26s/it]  4%|▍         | 2/48 [00:04<01:38,  2.13s/it]  4%|▍         | 2/48 [00:05<01:41,  2.20s/it]  6%|▋         | 3/48 [00:05<01:07,  1.49s/it]  6%|▋         | 3/48 [00:05<01:09,  1.54s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it]  8%|▊         | 4/48 [00:06<00:53,  1.23s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:45,  1.05s/it] 12%|█▎        | 6/48 [00:07<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.05it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.36it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:16,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.36it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.31it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s]100%|██████████| 48/48 [00:38<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.40it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][08:57:12]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 38.9747, 'train_samples_per_second': 155.331, 'train_steps_per_second': 1.232, 'train_loss': 3.2873592376708984, 'epoch': 3.0}
[INFO][08:57:13]: [Client #14] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
{'train_runtime': 39.1199, 'train_samples_per_second': 154.755, 'train_steps_per_second': 1.227, 'train_loss': 3.4273856480916343, 'epoch': 3.0}
[INFO][08:57:13]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][08:57:14]: [Client #14] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
[INFO][08:57:14]: [Client #17] Model trained.
[INFO][08:57:14]: [Client #17] Inbound data has been processed.
[INFO][08:57:14]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][08:57:14]: [Client #14] Model trained.
[INFO][08:57:14]: [Client #14] Inbound data has been processed.
[INFO][08:57:14]: [Client #14] Outbound data is ready to be sent after being processed.
[INFO][08:57:24]: [Client #14] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:57:25]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:57:26]: [Server #3536466] Received 507.38 MB of payload data from client #14 (simulated).
[INFO][08:57:27]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][08:57:27]: [Server #3536466] Selecting client #74 for training.
[INFO][08:57:27]: [Server #3536466] Sending the current model to client #74 (simulated).
[INFO][08:57:32]: [Server #3536466] Sending 507.38 MB of payload data to client #74 (simulated).
[INFO][08:57:32]: [Server #3536466] Selecting client #61 for training.
[INFO][08:57:32]: [Server #3536466] Sending the current model to client #61 (simulated).
[INFO][08:57:38]: [Server #3536466] Sending 507.38 MB of payload data to client #61 (simulated).
[INFO][08:57:38]: [Client #74] Selected by the server.
[INFO][08:57:38]: [Client #74] Loading its data source...
[INFO][08:57:38]: [Client #61] Selected by the server.
[INFO][08:57:38]: [Client #61] Loading its data source...
[INFO][08:57:38]: [Client #74] Dataset size: 2018
[INFO][08:57:38]: [Client #61] Dataset size: 2018
[INFO][08:57:38]: [Client #74] Sampler: iid
[INFO][08:57:38]: [Client #61] Sampler: iid
[INFO][08:57:39]: [Client #61] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:57:39]: [Client #61] Start to process inbound data.
[INFO][08:57:39]: [Client #74] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:57:39]: [Client #74] Start to process inbound data.
[INFO][08:57:40]: [93m[1m[Client #74] Started training in communication round #13.[0m
[INFO][08:57:40]: [93m[1m[Client #61] Started training in communication round #13.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:14,  4.13s/it]  2%|▏         | 1/48 [00:04<03:20,  4.27s/it]  4%|▍         | 2/48 [00:04<01:38,  2.13s/it]  4%|▍         | 2/48 [00:05<01:40,  2.19s/it]  6%|▋         | 3/48 [00:05<01:08,  1.51s/it]  6%|▋         | 3/48 [00:05<01:08,  1.53s/it]  8%|▊         | 4/48 [00:06<00:53,  1.22s/it]  8%|▊         | 4/48 [00:06<00:53,  1.23s/it] 10%|█         | 5/48 [00:07<00:45,  1.06s/it] 10%|█         | 5/48 [00:07<00:45,  1.06s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.06it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.05it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.14it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.32it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.39it/s] 71%|███████   | 34/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.38it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.36it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.31it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s]100%|██████████| 48/48 [00:38<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.39it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
100%|██████████| 48/48 [00:38<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.41it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
[INFO][08:58:24]: [Client #61] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536585.pth.
{'train_runtime': 38.9061, 'train_samples_per_second': 155.605, 'train_steps_per_second': 1.234, 'train_loss': 3.5581432978312173, 'epoch': 3.0}
[INFO][08:58:24]: [Client #74] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_74_3536584.pth.
{'train_runtime': 38.9988, 'train_samples_per_second': 155.235, 'train_steps_per_second': 1.231, 'train_loss': 3.673410097757975, 'epoch': 3.0}
[INFO][08:58:25]: [Client #61] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536585.pth.
[INFO][08:58:26]: [Client #74] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_74_3536584.pth.
[INFO][08:58:26]: [Client #61] Model trained.
[INFO][08:58:26]: [Client #61] Inbound data has been processed.
[INFO][08:58:26]: [Client #61] Outbound data is ready to be sent after being processed.
[INFO][08:58:26]: [Client #74] Model trained.
[INFO][08:58:26]: [Client #74] Inbound data has been processed.
[INFO][08:58:26]: [Client #74] Outbound data is ready to be sent after being processed.
[INFO][08:58:36]: [Client #61] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:58:36]: [Client #74] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:58:37]: [Server #3536466] Received 507.38 MB of payload data from client #61 (simulated).
[INFO][08:58:38]: [Server #3536466] Received 507.38 MB of payload data from client #74 (simulated).
[INFO][08:58:38]: [Server #3536466] Selecting client #78 for training.
[INFO][08:58:38]: [Server #3536466] Sending the current model to client #78 (simulated).
[INFO][08:58:44]: [Server #3536466] Sending 507.38 MB of payload data to client #78 (simulated).
[INFO][08:58:44]: [Client #78] Selected by the server.
[INFO][08:58:44]: [Client #78] Loading its data source...
[INFO][08:58:44]: [Client #78] Dataset size: 2018
[INFO][08:58:44]: [Client #78] Sampler: iid
[INFO][08:58:45]: [Client #78] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:58:45]: [Client #78] Start to process inbound data.
[INFO][08:58:45]: [93m[1m[Client #78] Started training in communication round #13.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:59,  3.81s/it]  4%|▍         | 2/48 [00:04<01:25,  1.85s/it]  6%|▋         | 3/48 [00:04<00:55,  1.22s/it]  8%|▊         | 4/48 [00:05<00:40,  1.08it/s] 10%|█         | 5/48 [00:05<00:32,  1.31it/s] 12%|█▎        | 6/48 [00:06<00:28,  1.50it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.87it/s] 21%|██        | 10/48 [00:08<00:19,  1.93it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:09<00:17,  2.02it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.06it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.19it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.16it/s] 38%|███▊      | 18/48 [00:11<00:13,  2.14it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.13it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.12it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.11it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.10it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.10it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.10it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.10it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.09it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.20it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.17it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.13it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.11it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.11it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.10it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.10it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.09it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:26<00:00,  2.20it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.20it/s]100%|██████████| 48/48 [00:26<00:00,  1.85it/s]
[INFO][08:59:16]: [Client #78] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
{'train_runtime': 26.0118, 'train_samples_per_second': 232.74, 'train_steps_per_second': 1.845, 'train_loss': 3.540853182474772, 'epoch': 3.0}
[INFO][08:59:17]: [Client #78] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
[INFO][08:59:18]: [Client #78] Model trained.
[INFO][08:59:18]: [Client #78] Inbound data has been processed.
[INFO][08:59:18]: [Client #78] Outbound data is ready to be sent after being processed.
[INFO][08:59:23]: [Client #78] Sent 507.38 MB of payload data to the server (simulated).
[INFO][08:59:24]: [Server #3536466] Received 507.38 MB of payload data from client #78 (simulated).
[INFO][08:59:24]: [Server #3536466] Adding client #26 to the list of clients for aggregation.
[INFO][08:59:24]: [Server #3536466] Adding client #14 to the list of clients for aggregation.
[INFO][08:59:24]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][08:59:24]: [Server #3536466] Adding client #78 to the list of clients for aggregation.
[INFO][08:59:24]: [Server #3536466] Adding client #61 to the list of clients for aggregation.
[INFO][08:59:24]: [Server #3536466] Aggregating 5 clients in total.
[INFO][08:59:24]: [Server #3536466] Updated weights have been received.
[INFO][08:59:25]: [Server #3536466] Aggregating model weight deltas.
[INFO][08:59:25]: [Server #3536466] Finished aggregating updated weights.
[INFO][08:59:25]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  9.2800e-01  1e+02  1e+00  1e+00
 1:  7.4400e-01 -4.6596e-02  1e+01  1e-01  1e-01
 2:  9.2839e-01  6.8017e-03  1e+00  1e-03  1e-03
 3:  9.3151e-01  8.2120e-01  1e-01  1e-08  6e-09
 4:  9.3062e-01  9.2314e-01  7e-03  4e-08  8e-09
 5:  9.2865e-01  9.2427e-01  4e-03  9e-07  4e-07
 6:  9.2637e-01  9.2395e-01  2e-03  7e-06  4e-06
 7:  9.2550e-01  9.2456e-01  1e-03  4e-06  2e-06
 8:  9.2473e-01  9.2459e-01  2e-04  2e-06  1e-06
 9:  9.2459e-01  9.2459e-01  6e-06  1e-07  7e-08
10:  9.2459e-01  9.2459e-01  6e-08  2e-09  8e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  0.01 0.01 1.1  0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.1
 2.1  0.01 0.1  0.01 2.1  0.01 1.1  0.01 0.01 0.01 0.01 6.1  1.1  0.01
 0.01 0.01 0.01 2.1  0.01 0.01 0.01 0.01 1.1  1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 0.01 4.1  1.1  0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 0.01 0.1  0.01 3.1  0.01 0.01 0.01 3.1  0.01 1.1  0.01
 0.01 3.1  0.01 0.01 0.01 0.01 0.01 0.1  2.1  0.01 0.01 2.1  0.01 0.01
 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2
 0.2  0.01 0.2  0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.29it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.58it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.08it/s]100%|██████████| 8/8 [00:00<00:00, 11.87it/s]
[INFO][08:59:35]: [93m[1m[Server #3536466] Global model perplexity: 36.78
[0m
[INFO][08:59:35]: [Server #3536466] All client reports have been processed.
[INFO][08:59:35]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_13.pth.
[INFO][08:59:39]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_13.pth.
[INFO][08:59:39]: [93m[1m
[Server #3536466] Starting round 14/100.[0m
[INFO][08:59:39]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([3.03092199e-07, 5.35361342e-08, 5.35361342e-08, 3.03092199e-07,
       3.03092199e-07, 5.35361342e-08, 3.03092199e-07, 5.35361342e-08,
       3.03092199e-07, 3.03092199e-07, 3.03092199e-07, 3.03092199e-07,
       3.03092199e-07, 2.49994859e-01, 8.69837165e-09, 3.03092199e-07,
       2.49994859e-01, 3.03092199e-07, 8.69837165e-09, 3.03092199e-07,
       5.35361342e-08, 3.03092199e-07, 3.03092199e-07, 3.03092199e-07,
       3.03092199e-07, 8.79678844e-10, 5.35361342e-08, 3.03092199e-07,
       3.03092199e-07, 3.03092199e-07, 8.69837165e-09, 3.03092199e-07,
       3.03092199e-07, 3.03092199e-07, 3.03092199e-07, 5.35361342e-08,
       5.35361342e-08, 3.03092199e-07, 3.03092199e-07, 3.03092199e-07,
       5.35361342e-08, 3.03092199e-07, 3.03092199e-07, 3.03092199e-07,
       3.03092199e-07, 1.98695849e-09, 5.35361342e-08, 3.03092199e-07,
       3.03092199e-07, 3.03092199e-07, 3.03092199e-07, 3.03092199e-07,
       5.35361342e-08, 3.03092199e-07, 5.35361342e-08, 3.03092199e-07,
       3.03092199e-07, 3.03092199e-07, 2.49994859e-01, 3.03092199e-07,
       3.59487455e-09, 3.03092199e-07, 3.03092199e-07, 3.03092199e-07,
       3.59487455e-09, 3.03092199e-07, 5.35361342e-08, 3.03092199e-07,
       3.03092199e-07, 3.59487455e-09, 3.03092199e-07, 3.03092199e-07,
       3.03092199e-07, 2.49994859e-01, 8.69837165e-09, 3.03092199e-07,
       3.03092199e-07, 8.69837165e-09, 3.03092199e-07, 3.03092199e-07,
       3.03092199e-07, 3.03092199e-07, 5.35361342e-08, 3.03092199e-07,
       3.03092199e-07, 3.03092199e-07, 3.03092199e-07, 3.03092199e-07,
       3.03092199e-07, 3.03092199e-07, 3.03092199e-07, 3.03092199e-07,
       3.03092199e-07, 1.26747189e-09, 5.35361342e-08]),)
[INFO][08:59:39]: [Server #3536466] Selected clients: [17 78 14 61 64]
[INFO][08:59:39]: [Server #3536466] Selecting client #64 for training.
[INFO][08:59:39]: [Server #3536466] Sending the current model to client #64 (simulated).
[INFO][08:59:45]: [Server #3536466] Sending 507.38 MB of payload data to client #64 (simulated).
[INFO][08:59:45]: [Server #3536466] Selecting client #17 for training.
[INFO][08:59:45]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][08:59:51]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][08:59:51]: [Client #64] Selected by the server.
[INFO][08:59:51]: [Client #64] Loading its data source...
[INFO][08:59:51]: [Client #17] Selected by the server.
[INFO][08:59:51]: [Client #64] Dataset size: 2018
[INFO][08:59:51]: [Client #17] Loading its data source...
[INFO][08:59:51]: [Client #64] Sampler: iid
[INFO][08:59:51]: [Client #17] Dataset size: 2018
[INFO][08:59:51]: [Client #17] Sampler: iid
[INFO][08:59:52]: [Client #64] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:59:52]: [Client #64] Start to process inbound data.
[INFO][08:59:52]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][08:59:52]: [Client #17] Start to process inbound data.
[INFO][08:59:52]: [93m[1m[Client #64] Started training in communication round #14.[0m
[INFO][08:59:52]: [93m[1m[Client #17] Started training in communication round #14.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:13,  4.12s/it]  2%|▏         | 1/48 [00:04<03:23,  4.33s/it]  4%|▍         | 2/48 [00:04<01:38,  2.14s/it]  4%|▍         | 2/48 [00:05<01:41,  2.20s/it]  6%|▋         | 3/48 [00:05<01:07,  1.51s/it]  6%|▋         | 3/48 [00:05<01:08,  1.53s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.06it/s] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.14it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 50%|█████     | 24/48 [00:21<00:17,  1.36it/s] 50%|█████     | 24/48 [00:21<00:17,  1.36it/s] 52%|█████▏    | 25/48 [00:21<00:16,  1.36it/s] 52%|█████▏    | 25/48 [00:21<00:16,  1.36it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:24<00:14,  1.35it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.31it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:32<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.35it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.31it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:38<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.39it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][09:00:37]: [Client #64] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_64_3536584.pth.
{'train_runtime': 38.9106, 'train_samples_per_second': 155.588, 'train_steps_per_second': 1.234, 'train_loss': 3.678185780843099, 'epoch': 3.0}
[INFO][09:00:37]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 39.0092, 'train_samples_per_second': 155.194, 'train_steps_per_second': 1.23, 'train_loss': 3.2623888651529946, 'epoch': 3.0}
[INFO][09:00:38]: [Client #64] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_64_3536584.pth.
[INFO][09:00:38]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][09:00:39]: [Client #64] Model trained.
[INFO][09:00:39]: [Client #64] Inbound data has been processed.
[INFO][09:00:39]: [Client #64] Outbound data is ready to be sent after being processed.
[INFO][09:00:39]: [Client #17] Model trained.
[INFO][09:00:39]: [Client #17] Inbound data has been processed.
[INFO][09:00:39]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][09:00:50]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:00:50]: [Client #64] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:00:51]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][09:00:52]: [Server #3536466] Received 507.38 MB of payload data from client #64 (simulated).
[INFO][09:00:52]: [Server #3536466] Selecting client #14 for training.
[INFO][09:00:52]: [Server #3536466] Sending the current model to client #14 (simulated).
[INFO][09:00:57]: [Server #3536466] Sending 507.38 MB of payload data to client #14 (simulated).
[INFO][09:00:57]: [Server #3536466] Selecting client #61 for training.
[INFO][09:00:57]: [Server #3536466] Sending the current model to client #61 (simulated).
[INFO][09:01:03]: [Server #3536466] Sending 507.38 MB of payload data to client #61 (simulated).
[INFO][09:01:03]: [Client #61] Selected by the server.
[INFO][09:01:03]: [Client #61] Loading its data source...
[INFO][09:01:03]: [Client #61] Dataset size: 2018
[INFO][09:01:03]: [Client #61] Sampler: iid
[INFO][09:01:03]: [Client #14] Selected by the server.
[INFO][09:01:03]: [Client #14] Loading its data source...
[INFO][09:01:03]: [Client #14] Dataset size: 2018
[INFO][09:01:03]: [Client #14] Sampler: iid
[INFO][09:01:04]: [Client #14] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:01:04]: [Client #14] Start to process inbound data.
[INFO][09:01:04]: [Client #61] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:01:04]: [Client #61] Start to process inbound data.
[INFO][09:01:05]: [93m[1m[Client #61] Started training in communication round #14.[0m
[INFO][09:01:05]: [93m[1m[Client #14] Started training in communication round #14.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:10,  4.06s/it]  2%|▏         | 1/48 [00:04<03:38,  4.66s/it]  4%|▍         | 2/48 [00:04<01:40,  2.19s/it]  4%|▍         | 2/48 [00:05<01:55,  2.51s/it]  6%|▋         | 3/48 [00:05<01:14,  1.65s/it]  6%|▋         | 3/48 [00:06<01:19,  1.78s/it]  8%|▊         | 4/48 [00:06<00:59,  1.36s/it]  8%|▊         | 4/48 [00:07<01:02,  1.43s/it] 10%|█         | 5/48 [00:07<00:51,  1.20s/it] 10%|█         | 5/48 [00:08<00:53,  1.24s/it] 12%|█▎        | 6/48 [00:08<00:46,  1.10s/it] 12%|█▎        | 6/48 [00:09<00:47,  1.12s/it] 15%|█▍        | 7/48 [00:09<00:42,  1.03s/it] 15%|█▍        | 7/48 [00:10<00:42,  1.04s/it] 17%|█▋        | 8/48 [00:10<00:40,  1.02s/it] 17%|█▋        | 8/48 [00:11<00:40,  1.01s/it] 19%|█▉        | 9/48 [00:11<00:38,  1.02it/s] 19%|█▉        | 9/48 [00:11<00:37,  1.03it/s] 21%|██        | 10/48 [00:12<00:36,  1.05it/s] 21%|██        | 10/48 [00:12<00:36,  1.05it/s] 23%|██▎       | 11/48 [00:13<00:34,  1.06it/s] 23%|██▎       | 11/48 [00:13<00:34,  1.06it/s] 25%|██▌       | 12/48 [00:14<00:33,  1.08it/s] 25%|██▌       | 12/48 [00:14<00:33,  1.08it/s] 27%|██▋       | 13/48 [00:15<00:32,  1.06it/s] 27%|██▋       | 13/48 [00:15<00:32,  1.09it/s] 29%|██▉       | 14/48 [00:15<00:31,  1.09it/s] 29%|██▉       | 14/48 [00:16<00:31,  1.07it/s] 31%|███▏      | 15/48 [00:16<00:29,  1.10it/s] 31%|███▏      | 15/48 [00:17<00:32,  1.03it/s] 33%|███▎      | 16/48 [00:17<00:29,  1.08it/s] 33%|███▎      | 16/48 [00:18<00:28,  1.14it/s] 35%|███▌      | 17/48 [00:18<00:28,  1.07it/s] 35%|███▌      | 17/48 [00:19<00:28,  1.10it/s] 38%|███▊      | 18/48 [00:19<00:27,  1.09it/s] 38%|███▊      | 18/48 [00:20<00:27,  1.11it/s] 40%|███▉      | 19/48 [00:20<00:26,  1.09it/s] 40%|███▉      | 19/48 [00:21<00:26,  1.09it/s] 42%|████▏     | 20/48 [00:21<00:25,  1.11it/s] 42%|████▏     | 20/48 [00:21<00:25,  1.10it/s] 44%|████▍     | 21/48 [00:22<00:24,  1.09it/s] 44%|████▍     | 21/48 [00:22<00:24,  1.09it/s] 46%|████▌     | 22/48 [00:23<00:23,  1.11it/s] 46%|████▌     | 22/48 [00:23<00:24,  1.08it/s] 48%|████▊     | 23/48 [00:24<00:23,  1.07it/s] 48%|████▊     | 23/48 [00:24<00:23,  1.08it/s] 50%|█████     | 24/48 [00:25<00:22,  1.06it/s] 50%|█████     | 24/48 [00:25<00:22,  1.08it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.08it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.09it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.09it/s] 54%|█████▍    | 26/48 [00:27<00:19,  1.10it/s] 56%|█████▋    | 27/48 [00:27<00:19,  1.07it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.05it/s] 58%|█████▊    | 28/48 [00:28<00:18,  1.07it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.07it/s] 60%|██████    | 29/48 [00:29<00:17,  1.08it/s] 60%|██████    | 29/48 [00:30<00:17,  1.06it/s] 62%|██████▎   | 30/48 [00:30<00:16,  1.09it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.08it/s] 65%|██████▍   | 31/48 [00:31<00:15,  1.08it/s] 65%|██████▍   | 31/48 [00:32<00:16,  1.02it/s] 67%|██████▋   | 32/48 [00:32<00:14,  1.08it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.13it/s] 69%|██████▉   | 33/48 [00:33<00:13,  1.09it/s] 69%|██████▉   | 33/48 [00:34<00:13,  1.10it/s] 71%|███████   | 34/48 [00:34<00:12,  1.09it/s] 71%|███████   | 34/48 [00:34<00:12,  1.08it/s] 73%|███████▎  | 35/48 [00:35<00:11,  1.08it/s] 73%|███████▎  | 35/48 [00:35<00:12,  1.07it/s] 75%|███████▌  | 36/48 [00:36<00:10,  1.09it/s] 75%|███████▌  | 36/48 [00:36<00:10,  1.09it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.09it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.10it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.07it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.09it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.09it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.06it/s] 83%|████████▎ | 40/48 [00:39<00:07,  1.09it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.08it/s] 85%|████████▌ | 41/48 [00:40<00:06,  1.07it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.08it/s] 88%|████████▊ | 42/48 [00:41<00:05,  1.09it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.08it/s] 90%|████████▉ | 43/48 [00:42<00:04,  1.09it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.09it/s] 92%|█████████▏| 44/48 [00:43<00:03,  1.08it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.10it/s] 94%|█████████▍| 45/48 [00:44<00:02,  1.09it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.08it/s] 96%|█████████▌| 46/48 [00:45<00:01,  1.07it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.08it/s] 98%|█████████▊| 47/48 [00:46<00:00,  1.06it/s] 98%|█████████▊| 47/48 [00:47<00:00,  1.02it/s]100%|██████████| 48/48 [00:47<00:00,  1.07it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.07it/s]100%|██████████| 48/48 [00:47<00:00,  1.01it/s]
100%|██████████| 48/48 [00:47<00:00,  1.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.18it/s]100%|██████████| 48/48 [00:47<00:00,  1.01it/s]
[INFO][09:01:58]: [Client #61] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536585.pth.
{'train_runtime': 47.421, 'train_samples_per_second': 127.665, 'train_steps_per_second': 1.012, 'train_loss': 3.5007689793904624, 'epoch': 3.0}
[INFO][09:01:58]: [Client #14] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
{'train_runtime': 47.7264, 'train_samples_per_second': 126.848, 'train_steps_per_second': 1.006, 'train_loss': 3.394497871398926, 'epoch': 3.0}
[INFO][09:01:59]: [Client #61] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536585.pth.
[INFO][09:01:59]: [Client #14] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
[INFO][09:02:00]: [Client #61] Model trained.
[INFO][09:02:00]: [Client #61] Inbound data has been processed.
[INFO][09:02:00]: [Client #61] Outbound data is ready to be sent after being processed.
[INFO][09:02:00]: [Client #14] Model trained.
[INFO][09:02:00]: [Client #14] Inbound data has been processed.
[INFO][09:02:00]: [Client #14] Outbound data is ready to be sent after being processed.
[INFO][09:02:11]: [Client #14] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:02:11]: [Client #61] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:02:12]: [Server #3536466] Received 507.38 MB of payload data from client #14 (simulated).
[INFO][09:02:13]: [Server #3536466] Received 507.38 MB of payload data from client #61 (simulated).
[INFO][09:02:13]: [Server #3536466] Selecting client #78 for training.
[INFO][09:02:13]: [Server #3536466] Sending the current model to client #78 (simulated).
[INFO][09:02:19]: [Server #3536466] Sending 507.38 MB of payload data to client #78 (simulated).
[INFO][09:02:19]: [Client #78] Selected by the server.
[INFO][09:02:19]: [Client #78] Loading its data source...
[INFO][09:02:19]: [Client #78] Dataset size: 2018
[INFO][09:02:19]: [Client #78] Sampler: iid
[INFO][09:02:20]: [Client #78] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:02:20]: [Client #78] Start to process inbound data.
[INFO][09:02:20]: [93m[1m[Client #78] Started training in communication round #14.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:57,  3.79s/it]  4%|▍         | 2/48 [00:04<01:24,  1.84s/it]  6%|▋         | 3/48 [00:04<00:54,  1.22s/it]  8%|▊         | 4/48 [00:05<00:40,  1.08it/s] 10%|█         | 5/48 [00:05<00:32,  1.31it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.51it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.87it/s] 21%|██        | 10/48 [00:08<00:19,  1.94it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:09<00:17,  2.02it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.06it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.19it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.16it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.14it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.13it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.12it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.11it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.09it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.09it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.09it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.09it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.09it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.20it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.17it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.13it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.12it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.12it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.11it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.10it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.09it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.09it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.08it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.08it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.08it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:25<00:00,  2.20it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:25<00:00,  2.20it/s]100%|██████████| 48/48 [00:25<00:00,  1.85it/s]
[INFO][09:02:51]: [Client #78] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
{'train_runtime': 25.9932, 'train_samples_per_second': 232.907, 'train_steps_per_second': 1.847, 'train_loss': 3.483923594156901, 'epoch': 3.0}
[INFO][09:02:52]: [Client #78] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
[INFO][09:02:53]: [Client #78] Model trained.
[INFO][09:02:53]: [Client #78] Inbound data has been processed.
[INFO][09:02:53]: [Client #78] Outbound data is ready to be sent after being processed.
[INFO][09:02:58]: [Client #78] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:02:59]: [Server #3536466] Received 507.38 MB of payload data from client #78 (simulated).
[INFO][09:02:59]: [Server #3536466] Adding client #31 to the list of clients for aggregation.
[INFO][09:02:59]: [Server #3536466] Adding client #74 to the list of clients for aggregation.
[INFO][09:02:59]: [Server #3536466] Adding client #14 to the list of clients for aggregation.
[INFO][09:02:59]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][09:02:59]: [Server #3536466] Adding client #78 to the list of clients for aggregation.
[INFO][09:02:59]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:02:59]: [Server #3536466] Updated weights have been received.
[INFO][09:03:00]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:03:00]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:03:00]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  1.1889e+00  1e+02  1e+00  1e+00
 1:  9.3908e-01  2.1482e-01  2e+01  2e-01  2e-01
 2:  1.1882e+00  2.6204e-01  1e+00  2e-03  2e-03
 3:  1.1924e+00  1.0717e+00  1e-01  2e-08  6e-09
 4:  1.1915e+00  1.1849e+00  7e-03  3e-08  7e-09
 5:  1.1900e+00  1.1860e+00  4e-03  4e-07  1e-07
 6:  1.1880e+00  1.1854e+00  3e-03  5e-06  3e-06
 7:  1.1873e+00  1.1863e+00  1e-03  3e-06  2e-06
 8:  1.1865e+00  1.1863e+00  2e-04  2e-06  1e-06
 9:  1.1863e+00  1.1863e+00  5e-06  2e-07  9e-08
10:  1.1863e+00  1.1863e+00  5e-08  2e-09  1e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  0.01 0.01 1.1  0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.1
 2.1  0.01 0.1  0.01 2.1  0.01 1.1  0.01 0.01 0.01 0.01 6.1  1.1  0.01
 0.01 0.01 6.1  2.1  0.01 0.01 0.01 0.01 1.1  1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 0.01 4.1  1.1  0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 0.01 0.1  0.01 3.1  0.01 0.01 0.01 3.1  0.01 1.1  0.01
 0.01 3.1  0.01 1.1  0.01 0.01 0.01 0.1  2.1  0.01 0.01 2.1  0.01 0.01
 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.2
 0.2  0.01 0.2  0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01
 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.02it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.59it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.07it/s]100%|██████████| 8/8 [00:00<00:00, 11.88it/s]
[INFO][09:03:10]: [93m[1m[Server #3536466] Global model perplexity: 36.27
[0m
[INFO][09:03:10]: [Server #3536466] All client reports have been processed.
[INFO][09:03:10]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_14.pth.
[INFO][09:03:14]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_14.pth.
[INFO][09:03:14]: [93m[1m
[Server #3536466] Starting round 15/100.[0m
[INFO][09:03:14]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([5.26345781e-07, 6.82034808e-08, 6.82034808e-08, 5.26345781e-07,
       5.26345781e-07, 6.82034808e-08, 5.26345781e-07, 6.82034808e-08,
       5.26345781e-07, 5.26345781e-07, 5.26345781e-07, 5.26345781e-07,
       5.26345781e-07, 3.33321720e-01, 9.40564698e-09, 5.26345781e-07,
       3.33321720e-01, 5.26345781e-07, 9.40564698e-09, 5.26345781e-07,
       6.82034808e-08, 5.26345781e-07, 5.26345781e-07, 5.26345781e-07,
       5.26345781e-07, 8.85413862e-10, 6.82034808e-08, 5.26345781e-07,
       5.26345781e-07, 5.26345781e-07, 8.85413862e-10, 9.40564698e-09,
       5.26345781e-07, 5.26345781e-07, 5.26345781e-07, 5.26345781e-07,
       6.82034808e-08, 6.82034808e-08, 5.26345781e-07, 5.26345781e-07,
       5.26345781e-07, 6.82034808e-08, 5.26345781e-07, 5.26345781e-07,
       5.26345781e-07, 5.26345781e-07, 2.03409477e-09, 6.82034808e-08,
       5.26345781e-07, 5.26345781e-07, 5.26345781e-07, 5.26345781e-07,
       5.26345781e-07, 6.82034808e-08, 5.26345781e-07, 6.82034808e-08,
       5.26345781e-07, 5.26345781e-07, 5.26345781e-07, 5.26345781e-07,
       3.74528823e-09, 5.26345781e-07, 5.26345781e-07, 3.74528823e-09,
       5.26345781e-07, 6.82034808e-08, 5.26345781e-07, 5.26345781e-07,
       3.74528823e-09, 6.82034808e-08, 5.26345781e-07, 5.26345781e-07,
       5.26345781e-07, 3.33321720e-01, 9.40564698e-09, 5.26345781e-07,
       5.26345781e-07, 9.40564698e-09, 5.26345781e-07, 5.26345781e-07,
       5.26345781e-07, 5.26345781e-07, 6.82034808e-08, 5.26345781e-07,
       5.26345781e-07, 5.26345781e-07, 5.26345781e-07, 5.26345781e-07,
       5.26345781e-07, 5.26345781e-07, 5.26345781e-07, 5.26345781e-07,
       5.26345781e-07, 1.28343641e-09, 6.82034808e-08]),)
[INFO][09:03:14]: [Server #3536466] Selected clients: [78 17 14 13  9]
[INFO][09:03:14]: [Server #3536466] Selecting client #14 for training.
[INFO][09:03:14]: [Server #3536466] Sending the current model to client #14 (simulated).
[INFO][09:03:20]: [Server #3536466] Sending 507.38 MB of payload data to client #14 (simulated).
[INFO][09:03:20]: [Server #3536466] Selecting client #17 for training.
[INFO][09:03:20]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][09:03:26]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][09:03:26]: [Client #14] Selected by the server.
[INFO][09:03:26]: [Client #14] Loading its data source...
[INFO][09:03:26]: [Client #14] Dataset size: 2018
[INFO][09:03:26]: [Client #17] Selected by the server.
[INFO][09:03:26]: [Client #14] Sampler: iid
[INFO][09:03:26]: [Client #17] Loading its data source...
[INFO][09:03:26]: [Client #17] Dataset size: 2018
[INFO][09:03:26]: [Client #17] Sampler: iid
[INFO][09:03:27]: [Client #14] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:03:27]: [Client #14] Start to process inbound data.
[INFO][09:03:27]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:03:27]: [Client #17] Start to process inbound data.
[INFO][09:03:27]: [93m[1m[Client #14] Started training in communication round #15.[0m
[INFO][09:03:28]: [93m[1m[Client #17] Started training in communication round #15.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<03:04,  3.93s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:33,  2.02s/it]  2%|▏         | 1/48 [00:04<03:19,  4.25s/it]  6%|▋         | 3/48 [00:05<01:08,  1.53s/it]  4%|▍         | 2/48 [00:05<01:46,  2.31s/it]  8%|▊         | 4/48 [00:06<00:55,  1.27s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it]  8%|▊         | 4/48 [00:06<00:57,  1.32s/it] 12%|█▎        | 6/48 [00:07<00:40,  1.05it/s] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 15%|█▍        | 7/48 [00:08<00:36,  1.14it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.22it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 21%|██        | 10/48 [00:10<00:30,  1.27it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.22it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.35it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.35it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.34it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 71%|███████   | 34/48 [00:28<00:10,  1.34it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.32it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
 98%|█████████▊| 47/48 [00:38<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.58it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.58it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][09:04:12]: [Client #14] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
{'train_runtime': 39.0271, 'train_samples_per_second': 155.123, 'train_steps_per_second': 1.23, 'train_loss': 3.370037396748861, 'epoch': 3.0}
[INFO][09:04:13]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 39.21, 'train_samples_per_second': 154.399, 'train_steps_per_second': 1.224, 'train_loss': 3.2375364303588867, 'epoch': 3.0}
[INFO][09:04:13]: [Client #14] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
[INFO][09:04:14]: [Client #14] Model trained.
[INFO][09:04:14]: [Client #14] Inbound data has been processed.
[INFO][09:04:14]: [Client #14] Outbound data is ready to be sent after being processed.
[INFO][09:04:14]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][09:04:14]: [Client #17] Model trained.
[INFO][09:04:14]: [Client #17] Inbound data has been processed.
[INFO][09:04:14]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][09:04:23]: [Client #14] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:04:24]: [Server #3536466] Received 507.38 MB of payload data from client #14 (simulated).
[INFO][09:04:25]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:04:25]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][09:04:25]: [Server #3536466] Selecting client #78 for training.
[INFO][09:04:25]: [Server #3536466] Sending the current model to client #78 (simulated).
[INFO][09:04:31]: [Server #3536466] Sending 507.38 MB of payload data to client #78 (simulated).
[INFO][09:04:31]: [Server #3536466] Selecting client #9 for training.
[INFO][09:04:31]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:04:37]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:04:37]: [Client #78] Selected by the server.
[INFO][09:04:37]: [Client #9] Selected by the server.
[INFO][09:04:37]: [Client #78] Loading its data source...
[INFO][09:04:37]: [Client #9] Loading its data source...
[INFO][09:04:37]: [Client #78] Dataset size: 2018
[INFO][09:04:37]: [Client #78] Sampler: iid
[INFO][09:04:37]: [Client #9] Dataset size: 2018
[INFO][09:04:37]: [Client #9] Sampler: iid
[INFO][09:04:38]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:04:38]: [Client #9] Start to process inbound data.
[INFO][09:04:38]: [Client #78] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:04:38]: [Client #78] Start to process inbound data.
[INFO][09:04:39]: [93m[1m[Client #9] Started training in communication round #15.[0m
[INFO][09:04:39]: [93m[1m[Client #78] Started training in communication round #15.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:27,  4.42s/it]  2%|▏         | 1/48 [00:04<03:28,  4.43s/it]  4%|▍         | 2/48 [00:05<01:47,  2.34s/it]  4%|▍         | 2/48 [00:05<01:48,  2.35s/it]  6%|▋         | 3/48 [00:06<01:12,  1.60s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it]  8%|▊         | 4/48 [00:06<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.07s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s]100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][09:05:24]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.2706, 'train_samples_per_second': 154.161, 'train_steps_per_second': 1.222, 'train_loss': 3.6116724014282227, 'epoch': 3.0}
[INFO][09:05:24]: [Client #78] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
{'train_runtime': 39.3504, 'train_samples_per_second': 153.848, 'train_steps_per_second': 1.22, 'train_loss': 3.437895139058431, 'epoch': 3.0}
[INFO][09:05:24]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][09:05:25]: [Client #78] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
[INFO][09:05:25]: [Client #9] Model trained.
[INFO][09:05:25]: [Client #9] Inbound data has been processed.
[INFO][09:05:25]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:05:25]: [Client #78] Model trained.
[INFO][09:05:25]: [Client #78] Inbound data has been processed.
[INFO][09:05:25]: [Client #78] Outbound data is ready to be sent after being processed.
[INFO][09:05:33]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:05:34]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:05:36]: [Client #78] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:05:37]: [Server #3536466] Received 507.38 MB of payload data from client #78 (simulated).
[INFO][09:05:37]: [Server #3536466] Selecting client #13 for training.
[INFO][09:05:37]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:05:42]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:05:42]: [Client #13] Selected by the server.
[INFO][09:05:42]: [Client #13] Loading its data source...
[INFO][09:05:42]: [Client #13] Dataset size: 2018
[INFO][09:05:42]: [Client #13] Sampler: iid
[INFO][09:05:43]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:05:43]: [Client #13] Start to process inbound data.
[INFO][09:05:44]: [93m[1m[Client #13] Started training in communication round #15.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:55,  3.72s/it]  4%|▍         | 2/48 [00:04<01:23,  1.81s/it]  6%|▋         | 3/48 [00:04<00:54,  1.20s/it]  8%|▊         | 4/48 [00:05<00:40,  1.09it/s] 10%|█         | 5/48 [00:05<00:32,  1.32it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.51it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.87it/s] 21%|██        | 10/48 [00:08<00:19,  1.93it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:08<00:17,  2.01it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.06it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.18it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.15it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.13it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.12it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.11it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.10it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.10it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:14<00:11,  2.09it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.09it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.09it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.09it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.09it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:17<00:08,  2.09it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.20it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.16it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.13it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.12it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.11it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.10it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.10it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.10it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:25<00:00,  2.19it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:25<00:00,  2.19it/s]100%|██████████| 48/48 [00:25<00:00,  1.85it/s]
[INFO][09:06:15]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
{'train_runtime': 25.9564, 'train_samples_per_second': 233.237, 'train_steps_per_second': 1.849, 'train_loss': 3.6331443786621094, 'epoch': 3.0}
[INFO][09:06:16]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
[INFO][09:06:17]: [Client #13] Model trained.
[INFO][09:06:17]: [Client #13] Inbound data has been processed.
[INFO][09:06:17]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:06:22]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:06:23]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:06:23]: [Server #3536466] Adding client #61 to the list of clients for aggregation.
[INFO][09:06:23]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:06:23]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:06:23]: [Server #3536466] Adding client #14 to the list of clients for aggregation.
[INFO][09:06:23]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][09:06:23]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:06:23]: [Server #3536466] Updated weights have been received.
[INFO][09:06:24]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:06:25]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:06:25]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  1.4016e+00  1e+02  1e+00  1e+00
 1:  1.1478e+00  4.2410e-01  1e+01  1e-01  1e-01
 2:  1.4010e+00  4.8614e-01  1e+00  1e-03  1e-03
 3:  1.4048e+00  1.3020e+00  1e-01  1e-06  1e-06
 4:  1.4040e+00  1.3983e+00  6e-03  9e-08  7e-08
 5:  1.4027e+00  1.3993e+00  3e-03  3e-07  1e-07
 6:  1.4011e+00  1.3987e+00  2e-03  4e-06  3e-06
 7:  1.4006e+00  1.3995e+00  1e-03  3e-06  2e-06
 8:  1.3997e+00  1.3996e+00  2e-04  4e-06  2e-06
 9:  1.3996e+00  1.3996e+00  5e-06  2e-07  2e-07
10:  1.3996e+00  1.3996e+00  7e-08  3e-09  2e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  0.01 0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  0.1
 2.1  0.01 0.1  0.01 2.1  0.01 1.1  0.01 0.01 0.01 0.01 6.1  1.1  0.01
 0.01 0.01 6.1  2.1  0.01 0.01 0.01 0.01 1.1  1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 0.01 4.1  1.1  0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 0.01 1.1  0.01 3.1  0.01 0.01 0.01 3.1  0.01 1.1  0.01
 0.01 3.1  0.01 1.1  0.01 0.01 0.01 0.1  2.1  0.01 0.01 2.1  0.01 0.01
 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.01 0.2  0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01
 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.42it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.45it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.05it/s]100%|██████████| 8/8 [00:00<00:00, 11.87it/s]
[INFO][09:06:35]: [93m[1m[Server #3536466] Global model perplexity: 34.64
[0m
[INFO][09:06:35]: [Server #3536466] All client reports have been processed.
[INFO][09:06:35]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_15.pth.
[INFO][09:06:39]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_15.pth.
[INFO][09:06:39]: [93m[1m
[Server #3536466] Starting round 16/100.[0m
[INFO][09:06:39]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([3.22953474e-07, 5.76594084e-08, 5.76594084e-08, 3.22953474e-07,
       3.22953474e-07, 5.76594084e-08, 3.22953474e-07, 5.76594084e-08,
       2.49994733e-01, 3.22953474e-07, 3.22953474e-07, 3.22953474e-07,
       2.49994733e-01, 2.49994733e-01, 9.41930051e-09, 3.22953474e-07,
       2.49994733e-01, 3.22953474e-07, 9.41930051e-09, 3.22953474e-07,
       5.76594084e-08, 3.22953474e-07, 3.22953474e-07, 3.22953474e-07,
       3.22953474e-07, 9.54660595e-10, 5.76594084e-08, 3.22953474e-07,
       3.22953474e-07, 3.22953474e-07, 9.54660595e-10, 9.41930051e-09,
       3.22953474e-07, 3.22953474e-07, 3.22953474e-07, 3.22953474e-07,
       5.76594084e-08, 5.76594084e-08, 3.22953474e-07, 3.22953474e-07,
       3.22953474e-07, 5.76594084e-08, 3.22953474e-07, 3.22953474e-07,
       3.22953474e-07, 3.22953474e-07, 2.15369852e-09, 5.76594084e-08,
       3.22953474e-07, 3.22953474e-07, 3.22953474e-07, 3.22953474e-07,
       3.22953474e-07, 5.76594084e-08, 3.22953474e-07, 5.76594084e-08,
       3.22953474e-07, 3.22953474e-07, 3.22953474e-07, 5.76594084e-08,
       3.22953474e-07, 3.89668843e-09, 3.22953474e-07, 3.22953474e-07,
       3.89668843e-09, 3.22953474e-07, 5.76594084e-08, 3.22953474e-07,
       3.22953474e-07, 3.89668843e-09, 5.76594084e-08, 3.22953474e-07,
       3.22953474e-07, 3.22953474e-07, 9.41930051e-09, 3.22953474e-07,
       3.22953474e-07, 9.41930051e-09, 3.22953474e-07, 3.22953474e-07,
       3.22953474e-07, 3.22953474e-07, 5.76594084e-08, 3.22953474e-07,
       3.22953474e-07, 3.22953474e-07, 3.22953474e-07, 3.22953474e-07,
       3.22953474e-07, 3.22953474e-07, 3.22953474e-07, 3.22953474e-07,
       3.22953474e-07, 1.37385226e-09, 5.76594084e-08]),)
[INFO][09:06:39]: [Server #3536466] Selected clients: [ 9 13 17 14 46]
[INFO][09:06:39]: [Server #3536466] Selecting client #14 for training.
[INFO][09:06:39]: [Server #3536466] Sending the current model to client #14 (simulated).
[INFO][09:06:45]: [Server #3536466] Sending 507.38 MB of payload data to client #14 (simulated).
[INFO][09:06:45]: [Server #3536466] Selecting client #17 for training.
[INFO][09:06:45]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][09:06:50]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][09:06:50]: [Client #14] Selected by the server.
[INFO][09:06:50]: [Client #14] Loading its data source...
[INFO][09:06:50]: [Client #14] Dataset size: 2018
[INFO][09:06:50]: [Client #14] Sampler: iid
[INFO][09:06:50]: [Client #17] Selected by the server.
[INFO][09:06:50]: [Client #17] Loading its data source...
[INFO][09:06:50]: [Client #17] Dataset size: 2018
[INFO][09:06:50]: [Client #17] Sampler: iid
[INFO][09:06:51]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:06:51]: [Client #17] Start to process inbound data.
[INFO][09:06:52]: [Client #14] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:06:52]: [Client #14] Start to process inbound data.
[INFO][09:06:52]: [93m[1m[Client #14] Started training in communication round #16.[0m
[INFO][09:06:52]: [93m[1m[Client #17] Started training in communication round #16.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:12,  4.09s/it]  2%|▏         | 1/48 [00:04<03:22,  4.31s/it]  4%|▍         | 2/48 [00:04<01:38,  2.14s/it]  4%|▍         | 2/48 [00:05<01:40,  2.19s/it]  6%|▋         | 3/48 [00:05<01:08,  1.51s/it]  6%|▋         | 3/48 [00:05<01:08,  1.53s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.06it/s] 12%|█▎        | 6/48 [00:07<00:39,  1.06it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.31it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:25,  1.30it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 50%|█████     | 24/48 [00:21<00:17,  1.36it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:16,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.41it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.39it/s] 71%|███████   | 34/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.31it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:35<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s]100%|██████████| 48/48 [00:38<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.39it/s]100%|██████████| 48/48 [00:38<00:00,  1.24it/s]
100%|██████████| 48/48 [00:38<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.41it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
[INFO][09:07:37]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 38.8274, 'train_samples_per_second': 155.921, 'train_steps_per_second': 1.236, 'train_loss': 3.1325159072875977, 'epoch': 3.0}
[INFO][09:07:37]: [Client #14] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
{'train_runtime': 38.9192, 'train_samples_per_second': 155.553, 'train_steps_per_second': 1.233, 'train_loss': 3.2713648478190103, 'epoch': 3.0}
[INFO][09:07:38]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][09:07:38]: [Client #14] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
[INFO][09:07:38]: [Client #17] Model trained.
[INFO][09:07:38]: [Client #17] Inbound data has been processed.
[INFO][09:07:38]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][09:07:39]: [Client #14] Model trained.
[INFO][09:07:39]: [Client #14] Inbound data has been processed.
[INFO][09:07:39]: [Client #14] Outbound data is ready to be sent after being processed.
[INFO][09:07:49]: [Client #14] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:07:49]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:07:50]: [Server #3536466] Received 507.38 MB of payload data from client #14 (simulated).
[INFO][09:07:50]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][09:07:50]: [Server #3536466] Selecting client #46 for training.
[INFO][09:07:50]: [Server #3536466] Sending the current model to client #46 (simulated).
[INFO][09:07:56]: [Server #3536466] Sending 507.38 MB of payload data to client #46 (simulated).
[INFO][09:07:56]: [Server #3536466] Selecting client #9 for training.
[INFO][09:07:56]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:08:01]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:08:01]: [Client #46] Selected by the server.
[INFO][09:08:01]: [Client #46] Loading its data source...
[INFO][09:08:01]: [Client #9] Selected by the server.
[INFO][09:08:01]: [Client #9] Loading its data source...
[INFO][09:08:01]: [Client #46] Dataset size: 2018
[INFO][09:08:01]: [Client #46] Sampler: iid
[INFO][09:08:01]: [Client #9] Dataset size: 2018
[INFO][09:08:01]: [Client #9] Sampler: iid
[INFO][09:08:02]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:08:02]: [Client #9] Start to process inbound data.
[INFO][09:08:03]: [Client #46] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:08:03]: [Client #46] Start to process inbound data.
[INFO][09:08:03]: [93m[1m[Client #9] Started training in communication round #16.[0m
[INFO][09:08:03]: [93m[1m[Client #46] Started training in communication round #16.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:13,  4.11s/it]  2%|▏         | 1/48 [00:04<03:13,  4.11s/it]  4%|▍         | 2/48 [00:04<01:37,  2.13s/it]  4%|▍         | 2/48 [00:04<01:37,  2.13s/it]  6%|▋         | 3/48 [00:05<01:07,  1.50s/it]  6%|▋         | 3/48 [00:05<01:07,  1.50s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.31it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:38<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.39it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
100%|██████████| 48/48 [00:38<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.40it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
[INFO][09:08:48]: [Client #46] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
{'train_runtime': 38.9136, 'train_samples_per_second': 155.576, 'train_steps_per_second': 1.234, 'train_loss': 3.611128489176432, 'epoch': 3.0}
[INFO][09:08:48]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 38.8955, 'train_samples_per_second': 155.648, 'train_steps_per_second': 1.234, 'train_loss': 3.467320760091146, 'epoch': 3.0}
[INFO][09:08:49]: [Client #46] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
[INFO][09:08:49]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][09:08:49]: [Client #46] Model trained.
[INFO][09:08:49]: [Client #46] Inbound data has been processed.
[INFO][09:08:49]: [Client #46] Outbound data is ready to be sent after being processed.
[INFO][09:08:49]: [Client #9] Model trained.
[INFO][09:08:49]: [Client #9] Inbound data has been processed.
[INFO][09:08:49]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:08:58]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:08:58]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:09:00]: [Client #46] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:09:01]: [Server #3536466] Received 507.38 MB of payload data from client #46 (simulated).
[INFO][09:09:01]: [Server #3536466] Selecting client #13 for training.
[INFO][09:09:01]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:09:07]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:09:07]: [Client #13] Selected by the server.
[INFO][09:09:07]: [Client #13] Loading its data source...
[INFO][09:09:07]: [Client #13] Dataset size: 2018
[INFO][09:09:07]: [Client #13] Sampler: iid
[INFO][09:09:08]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:09:08]: [Client #13] Start to process inbound data.
[INFO][09:09:08]: [93m[1m[Client #13] Started training in communication round #16.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:57,  3.78s/it]  4%|▍         | 2/48 [00:04<01:24,  1.84s/it]  6%|▋         | 3/48 [00:04<00:54,  1.22s/it]  8%|▊         | 4/48 [00:05<00:40,  1.08it/s] 10%|█         | 5/48 [00:05<00:32,  1.31it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.50it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.77it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.86it/s] 21%|██        | 10/48 [00:08<00:19,  1.93it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:09<00:17,  2.01it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.05it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.06it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.18it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.15it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.14it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.12it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.11it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.10it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.09it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.09it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.09it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.09it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.09it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.20it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.16it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.13it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.12it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.11it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.10it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.09it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.09it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:26<00:00,  2.20it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.20it/s]100%|██████████| 48/48 [00:26<00:00,  1.84it/s]
[INFO][09:09:39]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
{'train_runtime': 26.0271, 'train_samples_per_second': 232.604, 'train_steps_per_second': 1.844, 'train_loss': 3.4844347635904946, 'epoch': 3.0}
[INFO][09:09:40]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
[INFO][09:09:41]: [Client #13] Model trained.
[INFO][09:09:41]: [Client #13] Inbound data has been processed.
[INFO][09:09:41]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:09:46]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:09:47]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:09:47]: [Server #3536466] Adding client #78 to the list of clients for aggregation.
[INFO][09:09:47]: [Server #3536466] Adding client #73 to the list of clients for aggregation.
[INFO][09:09:47]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:09:47]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:09:47]: [Server #3536466] Adding client #14 to the list of clients for aggregation.
[INFO][09:09:47]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:09:47]: [Server #3536466] Updated weights have been received.
[INFO][09:09:48]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:09:49]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:09:49]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  1.4125e+00  1e+02  1e+00  1e+00
 1:  1.1603e+00  4.3492e-01  1e+01  1e-01  1e-01
 2:  1.4119e+00  4.9761e-01  1e+00  1e-03  1e-03
 3:  1.4157e+00  1.3138e+00  1e-01  1e-06  1e-06
 4:  1.4149e+00  1.4092e+00  6e-03  1e-07  8e-08
 5:  1.4135e+00  1.4102e+00  3e-03  4e-07  1e-07
 6:  1.4118e+00  1.4096e+00  2e-03  4e-06  2e-06
 7:  1.4112e+00  1.4104e+00  9e-04  2e-06  1e-06
 8:  1.4105e+00  1.4104e+00  2e-04  2e-06  1e-06
 9:  1.4104e+00  1.4104e+00  4e-06  1e-07  8e-08
10:  1.4104e+00  1.4104e+00  4e-08  2e-09  9e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  0.01 0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  0.1
 2.1  0.01 0.1  0.01 2.1  0.01 1.1  0.01 0.01 0.01 0.01 6.1  1.1  0.01
 0.01 0.01 6.1  2.1  0.01 0.01 0.01 0.01 1.1  1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 0.01 4.1  1.1  0.01 0.01 0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 0.01 1.1  0.01 3.1  0.01 0.01 0.01 3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  0.01 0.01 0.01 1.1  2.1  0.01 0.01 2.1  0.01 0.01
 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.01 0.2  0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01
 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.75it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.47it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.03it/s]100%|██████████| 8/8 [00:00<00:00, 11.84it/s]
[INFO][09:09:58]: [93m[1m[Server #3536466] Global model perplexity: 33.98
[0m
[INFO][09:09:58]: [Server #3536466] All client reports have been processed.
[INFO][09:09:58]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_16.pth.
[INFO][09:10:03]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_16.pth.
[INFO][09:10:03]: [93m[1m
[Server #3536466] Starting round 17/100.[0m
[INFO][09:10:03]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([6.05842211e-07, 8.41755215e-08, 8.41755215e-08, 6.05842211e-07,
       6.05842211e-07, 8.41755215e-08, 6.05842211e-07, 8.41755215e-08,
       3.33320481e-01, 6.05842211e-07, 6.05842211e-07, 6.05842211e-07,
       3.33320481e-01, 3.33320481e-01, 1.22483373e-08, 6.05842211e-07,
       6.05842211e-07, 1.22483373e-08, 6.05842211e-07, 8.41755215e-08,
       6.05842211e-07, 6.05842211e-07, 6.05842211e-07, 6.05842211e-07,
       1.17683292e-09, 8.41755215e-08, 6.05842211e-07, 6.05842211e-07,
       6.05842211e-07, 1.17683292e-09, 1.22483373e-08, 6.05842211e-07,
       6.05842211e-07, 6.05842211e-07, 6.05842211e-07, 8.41755215e-08,
       8.41755215e-08, 6.05842211e-07, 6.05842211e-07, 6.05842211e-07,
       8.41755215e-08, 6.05842211e-07, 6.05842211e-07, 6.05842211e-07,
       2.69454296e-09, 8.41755215e-08, 6.05842211e-07, 6.05842211e-07,
       6.05842211e-07, 6.05842211e-07, 6.05842211e-07, 8.41755215e-08,
       6.05842211e-07, 8.41755215e-08, 6.05842211e-07, 6.05842211e-07,
       6.05842211e-07, 8.41755215e-08, 6.05842211e-07, 4.93861634e-09,
       6.05842211e-07, 6.05842211e-07, 4.93861634e-09, 6.05842211e-07,
       8.41755215e-08, 6.05842211e-07, 6.05842211e-07, 4.93861634e-09,
       1.17683292e-09, 8.41755215e-08, 6.05842211e-07, 6.05842211e-07,
       6.05842211e-07, 8.41755215e-08, 1.22483373e-08, 6.05842211e-07,
       6.05842211e-07, 1.22483373e-08, 6.05842211e-07, 6.05842211e-07,
       6.05842211e-07, 6.05842211e-07, 8.41755215e-08, 6.05842211e-07,
       6.05842211e-07, 6.05842211e-07, 6.05842211e-07, 6.05842211e-07,
       6.05842211e-07, 6.05842211e-07, 6.05842211e-07, 6.05842211e-07,
       6.05842211e-07, 1.70379085e-09, 8.41755215e-08]),)
[INFO][09:10:03]: [Server #3536466] Selected clients: [13 14  9 16 65]
[INFO][09:10:03]: [Server #3536466] Selecting client #16 for training.
[INFO][09:10:03]: [Server #3536466] Sending the current model to client #16 (simulated).
[INFO][09:10:08]: [Server #3536466] Sending 507.38 MB of payload data to client #16 (simulated).
[INFO][09:10:08]: [Server #3536466] Selecting client #65 for training.
[INFO][09:10:08]: [Server #3536466] Sending the current model to client #65 (simulated).
[INFO][09:10:14]: [Server #3536466] Sending 507.38 MB of payload data to client #65 (simulated).
[INFO][09:10:14]: [Client #16] Selected by the server.
[INFO][09:10:14]: [Client #16] Loading its data source...
[INFO][09:10:14]: [Client #65] Selected by the server.
[INFO][09:10:14]: [Client #16] Dataset size: 2018
[INFO][09:10:14]: [Client #65] Loading its data source...
[INFO][09:10:14]: [Client #16] Sampler: iid
[INFO][09:10:14]: [Client #65] Dataset size: 2018
[INFO][09:10:14]: [Client #65] Sampler: iid
[INFO][09:10:15]: [Client #65] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:10:15]: [Client #65] Start to process inbound data.
[INFO][09:10:15]: [Client #16] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:10:15]: [Client #16] Start to process inbound data.
[INFO][09:10:15]: [93m[1m[Client #16] Started training in communication round #17.[0m
[INFO][09:10:15]: [93m[1m[Client #65] Started training in communication round #17.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:22,  4.31s/it]  2%|▏         | 1/48 [00:04<03:52,  4.96s/it]  4%|▍         | 2/48 [00:05<01:41,  2.20s/it]  4%|▍         | 2/48 [00:05<01:53,  2.46s/it]  6%|▋         | 3/48 [00:05<01:09,  1.54s/it]  6%|▋         | 3/48 [00:06<01:15,  1.68s/it]  8%|▊         | 4/48 [00:06<00:54,  1.23s/it]  8%|▊         | 4/48 [00:07<00:57,  1.30s/it] 10%|█         | 5/48 [00:07<00:45,  1.05s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:08<00:39,  1.06it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.31it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.32it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.31it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:24<00:16,  1.31it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.31it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.32it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.30it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.30it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.31it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.31it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.54it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.54it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][09:11:00]: [Client #16] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_16_3536584.pth.
{'train_runtime': 39.3106, 'train_samples_per_second': 154.004, 'train_steps_per_second': 1.221, 'train_loss': 3.6184638341267905, 'epoch': 3.0}
[INFO][09:11:01]: [Client #65] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_65_3536585.pth.
{'train_runtime': 39.6795, 'train_samples_per_second': 152.573, 'train_steps_per_second': 1.21, 'train_loss': 3.5679283142089844, 'epoch': 3.0}
[INFO][09:11:01]: [Client #16] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_16_3536584.pth.
[INFO][09:11:02]: [Client #65] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_65_3536585.pth.
[INFO][09:11:02]: [Client #16] Model trained.
[INFO][09:11:02]: [Client #16] Inbound data has been processed.
[INFO][09:11:02]: [Client #16] Outbound data is ready to be sent after being processed.
[INFO][09:11:02]: [Client #65] Model trained.
[INFO][09:11:02]: [Client #65] Inbound data has been processed.
[INFO][09:11:02]: [Client #65] Outbound data is ready to be sent after being processed.
[INFO][09:11:12]: [Client #65] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:11:12]: [Server #3536466] Received 507.38 MB of payload data from client #65 (simulated).
[INFO][09:11:13]: [Client #16] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:11:14]: [Server #3536466] Received 507.38 MB of payload data from client #16 (simulated).
[INFO][09:11:14]: [Server #3536466] Selecting client #14 for training.
[INFO][09:11:14]: [Server #3536466] Sending the current model to client #14 (simulated).
[INFO][09:11:19]: [Server #3536466] Sending 507.38 MB of payload data to client #14 (simulated).
[INFO][09:11:19]: [Server #3536466] Selecting client #9 for training.
[INFO][09:11:19]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:11:25]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:11:25]: [Client #14] Selected by the server.
[INFO][09:11:25]: [Client #14] Loading its data source...
[INFO][09:11:25]: [Client #9] Selected by the server.
[INFO][09:11:25]: [Client #9] Loading its data source...
[INFO][09:11:25]: [Client #14] Dataset size: 2018
[INFO][09:11:25]: [Client #14] Sampler: iid
[INFO][09:11:25]: [Client #9] Dataset size: 2018
[INFO][09:11:25]: [Client #9] Sampler: iid
[INFO][09:11:26]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:11:26]: [Client #9] Start to process inbound data.
[INFO][09:11:26]: [Client #14] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:11:26]: [Client #14] Start to process inbound data.
[INFO][09:11:27]: [93m[1m[Client #9] Started training in communication round #17.[0m
[INFO][09:11:27]: [93m[1m[Client #14] Started training in communication round #17.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:26,  4.40s/it]  2%|▏         | 1/48 [00:04<03:29,  4.46s/it]  4%|▍         | 2/48 [00:05<01:48,  2.37s/it]  4%|▍         | 2/48 [00:05<01:50,  2.40s/it]  6%|▋         | 3/48 [00:06<01:15,  1.68s/it]  6%|▋         | 3/48 [00:06<01:16,  1.71s/it]  8%|▊         | 4/48 [00:06<00:57,  1.32s/it]  8%|▊         | 4/48 [00:07<00:59,  1.35s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 10%|█         | 5/48 [00:07<00:48,  1.13s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.00it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.14it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.20it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.36it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.32it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][09:12:12]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.6268, 'train_samples_per_second': 152.775, 'train_steps_per_second': 1.211, 'train_loss': 3.4080378214518228, 'epoch': 3.0}
[INFO][09:12:12]: [Client #14] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
{'train_runtime': 39.7616, 'train_samples_per_second': 152.258, 'train_steps_per_second': 1.207, 'train_loss': 3.259343147277832, 'epoch': 3.0}
[INFO][09:12:13]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][09:12:13]: [Client #14] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
[INFO][09:12:13]: [Client #9] Model trained.
[INFO][09:12:13]: [Client #9] Inbound data has been processed.
[INFO][09:12:13]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:12:14]: [Client #14] Model trained.
[INFO][09:12:14]: [Client #14] Inbound data has been processed.
[INFO][09:12:14]: [Client #14] Outbound data is ready to be sent after being processed.
[INFO][09:12:24]: [Client #14] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:12:24]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:12:25]: [Server #3536466] Received 507.38 MB of payload data from client #14 (simulated).
[INFO][09:12:26]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:12:26]: [Server #3536466] Selecting client #13 for training.
[INFO][09:12:26]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:12:31]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:12:31]: [Client #13] Selected by the server.
[INFO][09:12:31]: [Client #13] Loading its data source...
[INFO][09:12:31]: [Client #13] Dataset size: 2018
[INFO][09:12:31]: [Client #13] Sampler: iid
[INFO][09:12:32]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:12:32]: [Client #13] Start to process inbound data.
[INFO][09:12:33]: [93m[1m[Client #13] Started training in communication round #17.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:57,  3.77s/it]  4%|▍         | 2/48 [00:04<01:24,  1.83s/it]  6%|▋         | 3/48 [00:04<00:54,  1.21s/it]  8%|▊         | 4/48 [00:05<00:40,  1.08it/s] 10%|█         | 5/48 [00:05<00:32,  1.31it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.51it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.87it/s] 21%|██        | 10/48 [00:08<00:19,  1.94it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:09<00:17,  2.02it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.06it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.19it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.16it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.14it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.13it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.12it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.11it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.11it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.10it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.10it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.10it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.10it/s] 60%|██████    | 29/48 [00:17<00:09,  2.10it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.10it/s] 65%|██████▍   | 31/48 [00:17<00:08,  2.10it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.21it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.17it/s] 71%|███████   | 34/48 [00:19<00:06,  2.15it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.13it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.12it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.11it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.10it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.10it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.09it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:25<00:00,  2.20it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:25<00:00,  2.20it/s]100%|██████████| 48/48 [00:25<00:00,  1.85it/s]
[INFO][09:13:04]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
{'train_runtime': 25.9611, 'train_samples_per_second': 233.195, 'train_steps_per_second': 1.849, 'train_loss': 3.4309962590535483, 'epoch': 3.0}
[INFO][09:13:05]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
[INFO][09:13:05]: [Client #13] Model trained.
[INFO][09:13:05]: [Client #13] Inbound data has been processed.
[INFO][09:13:05]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:13:11]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:13:12]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:13:12]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][09:13:12]: [Server #3536466] Adding client #46 to the list of clients for aggregation.
[INFO][09:13:12]: [Server #3536466] Adding client #50 to the list of clients for aggregation.
[INFO][09:13:12]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:13:12]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:13:12]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:13:12]: [Server #3536466] Updated weights have been received.
[INFO][09:13:12]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:13:13]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:13:13]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  1.5860e+00  1e+02  1e+00  1e+00
 1:  1.3406e+00  6.0700e-01  1e+01  1e-01  1e-01
 2:  1.5857e+00  6.8219e-01  1e+00  1e-03  1e-03
 3:  1.5890e+00  1.5005e+00  9e-02  3e-06  3e-06
 4:  1.5883e+00  1.5832e+00  5e-03  2e-07  2e-07
 5:  1.5870e+00  1.5841e+00  3e-03  3e-07  1e-07
 6:  1.5857e+00  1.5836e+00  2e-03  3e-06  2e-06
 7:  1.5852e+00  1.5843e+00  9e-04  2e-06  1e-06
 8:  1.5844e+00  1.5843e+00  1e-04  3e-06  2e-06
 9:  1.5843e+00  1.5843e+00  5e-06  2e-07  1e-07
10:  1.5843e+00  1.5843e+00  6e-08  3e-09  2e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  0.01 0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  0.1
 2.1  0.01 1.1  0.01 2.1  0.01 1.1  0.01 0.01 0.01 0.01 6.1  1.1  0.01
 0.01 0.01 6.1  2.1  0.01 0.01 0.01 0.01 1.1  1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 1.1  4.1  1.1  0.01 6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 0.01 1.1  0.01 3.1  0.01 0.01 0.01 3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  0.01 0.01 0.01 1.1  2.1  0.01 0.01 2.1  0.01 0.01
 0.01 0.01 0.01 1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.01 0.2  0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01
 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.01
 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.97it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.56it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.08it/s]100%|██████████| 8/8 [00:00<00:00, 11.87it/s]
[INFO][09:13:22]: [93m[1m[Server #3536466] Global model perplexity: 33.79
[0m
[INFO][09:13:22]: [Server #3536466] All client reports have been processed.
[INFO][09:13:22]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_17.pth.
[INFO][09:13:26]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_17.pth.
[INFO][09:13:26]: [93m[1m
[Server #3536466] Starting round 18/100.[0m
[INFO][09:13:26]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.98704418e-07, 4.08811741e-08, 4.08811741e-08, 2.98704418e-07,
       2.98704418e-07, 4.08811741e-08, 2.98704418e-07, 4.08811741e-08,
       4.99990757e-01, 2.98704418e-07, 2.98704418e-07, 2.98704418e-07,
       4.99990757e-01, 6.52275724e-09, 4.08811741e-08, 2.98704418e-07,
       6.52275724e-09, 2.98704418e-07, 4.08811741e-08, 2.98704418e-07,
       2.98704418e-07, 2.98704418e-07, 2.98704418e-07, 6.50561616e-10,
       4.08811741e-08, 2.98704418e-07, 2.98704418e-07, 2.98704418e-07,
       6.50561616e-10, 6.52275724e-09, 2.98704418e-07, 2.98704418e-07,
       2.98704418e-07, 2.98704418e-07, 4.08811741e-08, 4.08811741e-08,
       2.98704418e-07, 2.98704418e-07, 2.98704418e-07, 4.08811741e-08,
       2.98704418e-07, 2.98704418e-07, 2.98704418e-07, 4.08811741e-08,
       1.48092424e-09, 4.08811741e-08, 2.98704418e-07, 6.50561616e-10,
       2.98704418e-07, 2.98704418e-07, 2.98704418e-07, 2.98704418e-07,
       4.08811741e-08, 2.98704418e-07, 4.08811741e-08, 2.98704418e-07,
       2.98704418e-07, 2.98704418e-07, 4.08811741e-08, 2.98704418e-07,
       2.69147437e-09, 2.98704418e-07, 2.69147437e-09, 2.98704418e-07,
       4.08811741e-08, 2.98704418e-07, 2.98704418e-07, 2.69147437e-09,
       6.50561616e-10, 4.08811741e-08, 2.98704418e-07, 2.98704418e-07,
       2.98704418e-07, 4.08811741e-08, 6.52275724e-09, 2.98704418e-07,
       2.98704418e-07, 6.52275724e-09, 2.98704418e-07, 2.98704418e-07,
       2.98704418e-07, 2.98704418e-07, 4.08811741e-08, 2.98704418e-07,
       2.98704418e-07, 2.98704418e-07, 2.98704418e-07, 2.98704418e-07,
       2.98704418e-07, 2.98704418e-07, 2.98704418e-07, 2.98704418e-07,
       2.98704418e-07, 9.39993356e-10, 4.08811741e-08]),)
[INFO][09:13:27]: [Server #3536466] Selected clients: [ 9 13 84 93 20]
[INFO][09:13:27]: [Server #3536466] Selecting client #20 for training.
[INFO][09:13:27]: [Server #3536466] Sending the current model to client #20 (simulated).
[INFO][09:13:32]: [Server #3536466] Sending 507.38 MB of payload data to client #20 (simulated).
[INFO][09:13:32]: [Server #3536466] Selecting client #93 for training.
[INFO][09:13:32]: [Server #3536466] Sending the current model to client #93 (simulated).
[INFO][09:13:38]: [Server #3536466] Sending 507.38 MB of payload data to client #93 (simulated).
[INFO][09:13:38]: [Client #20] Selected by the server.
[INFO][09:13:38]: [Client #20] Loading its data source...
[INFO][09:13:38]: [Client #20] Dataset size: 2018
[INFO][09:13:38]: [Client #20] Sampler: iid
[INFO][09:13:38]: [Client #93] Selected by the server.
[INFO][09:13:38]: [Client #93] Loading its data source...
[INFO][09:13:38]: [Client #93] Dataset size: 2018
[INFO][09:13:38]: [Client #93] Sampler: iid
[INFO][09:13:39]: [Client #20] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:13:39]: [Client #20] Start to process inbound data.
[INFO][09:13:39]: [Client #93] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:13:39]: [Client #93] Start to process inbound data.
[INFO][09:13:39]: [93m[1m[Client #20] Started training in communication round #18.[0m
[INFO][09:13:40]: [93m[1m[Client #93] Started training in communication round #18.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:11,  4.07s/it]  2%|▏         | 1/48 [00:04<03:35,  4.58s/it]  4%|▍         | 2/48 [00:04<01:42,  2.22s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  6%|▋         | 3/48 [00:05<01:13,  1.63s/it]  6%|▋         | 3/48 [00:06<01:18,  1.75s/it]  8%|▊         | 4/48 [00:06<01:00,  1.37s/it]  8%|▊         | 4/48 [00:07<01:01,  1.40s/it] 10%|█         | 5/48 [00:07<00:51,  1.20s/it] 10%|█         | 5/48 [00:08<00:52,  1.22s/it] 12%|█▎        | 6/48 [00:08<00:45,  1.09s/it] 12%|█▎        | 6/48 [00:09<00:46,  1.10s/it] 15%|█▍        | 7/48 [00:09<00:42,  1.02s/it] 15%|█▍        | 7/48 [00:09<00:42,  1.04s/it] 17%|█▋        | 8/48 [00:10<00:39,  1.02it/s] 17%|█▋        | 8/48 [00:10<00:39,  1.01it/s] 19%|█▉        | 9/48 [00:11<00:38,  1.02it/s] 19%|█▉        | 9/48 [00:11<00:38,  1.01it/s] 21%|██        | 10/48 [00:12<00:36,  1.04it/s] 21%|██        | 10/48 [00:12<00:36,  1.04it/s] 23%|██▎       | 11/48 [00:13<00:34,  1.06it/s] 23%|██▎       | 11/48 [00:13<00:35,  1.04it/s] 25%|██▌       | 12/48 [00:14<00:34,  1.03it/s] 25%|██▌       | 12/48 [00:14<00:34,  1.04it/s] 27%|██▋       | 13/48 [00:15<00:32,  1.06it/s] 27%|██▋       | 13/48 [00:15<00:33,  1.04it/s] 29%|██▉       | 14/48 [00:16<00:31,  1.07it/s] 29%|██▉       | 14/48 [00:16<00:31,  1.07it/s] 31%|███▏      | 15/48 [00:16<00:30,  1.07it/s] 31%|███▏      | 15/48 [00:17<00:31,  1.03it/s] 33%|███▎      | 16/48 [00:17<00:29,  1.08it/s] 33%|███▎      | 16/48 [00:18<00:28,  1.12it/s] 35%|███▌      | 17/48 [00:18<00:27,  1.11it/s] 35%|███▌      | 17/48 [00:19<00:27,  1.14it/s] 38%|███▊      | 18/48 [00:19<00:27,  1.10it/s] 38%|███▊      | 18/48 [00:20<00:27,  1.11it/s] 40%|███▉      | 19/48 [00:20<00:26,  1.09it/s] 40%|███▉      | 19/48 [00:21<00:26,  1.08it/s] 42%|████▏     | 20/48 [00:21<00:25,  1.10it/s] 42%|████▏     | 20/48 [00:21<00:25,  1.09it/s] 44%|████▍     | 21/48 [00:22<00:24,  1.10it/s] 44%|████▍     | 21/48 [00:22<00:24,  1.11it/s] 46%|████▌     | 22/48 [00:23<00:23,  1.09it/s] 46%|████▌     | 22/48 [00:23<00:24,  1.07it/s] 48%|████▊     | 23/48 [00:24<00:23,  1.07it/s] 48%|████▊     | 23/48 [00:24<00:22,  1.09it/s] 50%|█████     | 24/48 [00:25<00:22,  1.06it/s] 50%|█████     | 24/48 [00:25<00:21,  1.09it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.06it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.07it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.08it/s] 54%|█████▍    | 26/48 [00:27<00:21,  1.04it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.08it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.08it/s] 58%|█████▊    | 28/48 [00:28<00:18,  1.09it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.09it/s] 60%|██████    | 29/48 [00:29<00:17,  1.10it/s] 60%|██████    | 29/48 [00:30<00:17,  1.07it/s] 62%|██████▎   | 30/48 [00:30<00:16,  1.09it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.07it/s] 65%|██████▍   | 31/48 [00:31<00:15,  1.07it/s] 65%|██████▍   | 31/48 [00:32<00:16,  1.02it/s] 67%|██████▋   | 32/48 [00:32<00:15,  1.06it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.13it/s] 69%|██████▉   | 33/48 [00:33<00:13,  1.07it/s] 69%|██████▉   | 33/48 [00:33<00:13,  1.10it/s] 71%|███████   | 34/48 [00:34<00:12,  1.09it/s] 71%|███████   | 34/48 [00:34<00:13,  1.08it/s] 73%|███████▎  | 35/48 [00:35<00:12,  1.08it/s] 73%|███████▎  | 35/48 [00:35<00:11,  1.10it/s] 75%|███████▌  | 36/48 [00:36<00:11,  1.06it/s] 75%|███████▌  | 36/48 [00:36<00:11,  1.09it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.05it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.07it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.07it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.08it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.08it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.09it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.11it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.10it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.09it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.10it/s] 88%|████████▊ | 42/48 [00:41<00:05,  1.10it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.07it/s] 90%|████████▉ | 43/48 [00:42<00:04,  1.08it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.07it/s] 92%|█████████▏| 44/48 [00:43<00:03,  1.09it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.06it/s] 94%|█████████▍| 45/48 [00:44<00:02,  1.05it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.04it/s] 96%|█████████▌| 46/48 [00:45<00:01,  1.06it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.07it/s] 98%|█████████▊| 47/48 [00:46<00:00,  1.05it/s] 98%|█████████▊| 47/48 [00:47<00:00,  1.01it/s]100%|██████████| 48/48 [00:47<00:00,  1.07it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.07it/s]100%|██████████| 48/48 [00:47<00:00,  1.01it/s]
100%|██████████| 48/48 [00:47<00:00,  1.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.17it/s]100%|██████████| 48/48 [00:47<00:00,  1.00it/s]
[INFO][09:14:33]: [Client #20] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_20_3536584.pth.
{'train_runtime': 47.5828, 'train_samples_per_second': 127.231, 'train_steps_per_second': 1.009, 'train_loss': 3.5705865224202475, 'epoch': 3.0}
[INFO][09:14:33]: [Client #93] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_93_3536585.pth.
{'train_runtime': 47.7687, 'train_samples_per_second': 126.736, 'train_steps_per_second': 1.005, 'train_loss': 3.5274829864501953, 'epoch': 3.0}
[INFO][09:14:34]: [Client #20] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_20_3536584.pth.
[INFO][09:14:34]: [Client #93] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_93_3536585.pth.
[INFO][09:14:34]: [Client #20] Model trained.
[INFO][09:14:34]: [Client #20] Inbound data has been processed.
[INFO][09:14:34]: [Client #20] Outbound data is ready to be sent after being processed.
[INFO][09:14:34]: [Client #93] Model trained.
[INFO][09:14:34]: [Client #93] Inbound data has been processed.
[INFO][09:14:34]: [Client #93] Outbound data is ready to be sent after being processed.
[INFO][09:14:44]: [Client #93] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:14:45]: [Client #20] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:14:45]: [Server #3536466] Received 507.38 MB of payload data from client #93 (simulated).
[INFO][09:14:46]: [Server #3536466] Received 507.38 MB of payload data from client #20 (simulated).
[INFO][09:14:46]: [Server #3536466] Selecting client #84 for training.
[INFO][09:14:46]: [Server #3536466] Sending the current model to client #84 (simulated).
[INFO][09:14:52]: [Server #3536466] Sending 507.38 MB of payload data to client #84 (simulated).
[INFO][09:14:52]: [Server #3536466] Selecting client #9 for training.
[INFO][09:14:52]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:14:57]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:14:57]: [Client #84] Selected by the server.
[INFO][09:14:57]: [Client #84] Loading its data source...
[INFO][09:14:57]: [Client #9] Selected by the server.
[INFO][09:14:57]: [Client #84] Dataset size: 2018
[INFO][09:14:57]: [Client #84] Sampler: iid
[INFO][09:14:57]: [Client #9] Loading its data source...
[INFO][09:14:57]: [Client #9] Dataset size: 2018
[INFO][09:14:57]: [Client #9] Sampler: iid
[INFO][09:14:58]: [Client #84] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:14:58]: [Client #84] Start to process inbound data.
[INFO][09:14:59]: [93m[1m[Client #84] Started training in communication round #18.[0m
[INFO][09:14:59]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:14:59]: [Client #9] Start to process inbound data.
[INFO][09:14:59]: [93m[1m[Client #9] Started training in communication round #18.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<03:03,  3.90s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:31,  1.99s/it]  2%|▏         | 1/48 [00:04<03:32,  4.51s/it]  6%|▋         | 3/48 [00:05<01:04,  1.42s/it]  4%|▍         | 2/48 [00:05<01:44,  2.27s/it]  8%|▊         | 4/48 [00:06<00:51,  1.16s/it]  6%|▋         | 3/48 [00:05<01:10,  1.57s/it] 10%|█         | 5/48 [00:06<00:43,  1.01s/it]  8%|▊         | 4/48 [00:06<00:54,  1.24s/it] 12%|█▎        | 6/48 [00:07<00:38,  1.09it/s] 10%|█         | 5/48 [00:07<00:45,  1.06s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.17it/s] 12%|█▎        | 6/48 [00:08<00:39,  1.06it/s] 17%|█▋        | 8/48 [00:09<00:32,  1.22it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.14it/s] 19%|█▉        | 9/48 [00:09<00:30,  1.26it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 21%|██        | 10/48 [00:10<00:29,  1.29it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.31it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:11<00:27,  1.32it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.33it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:14<00:23,  1.37it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 35%|███▌      | 17/48 [00:15<00:23,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.34it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.33it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.34it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.32it/s] 42%|████▏     | 20/48 [00:17<00:20,  1.34it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.34it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 50%|█████     | 24/48 [00:20<00:17,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:19,  1.30it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.33it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 58%|█████▊    | 28/48 [00:23<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.37it/s] 65%|██████▍   | 31/48 [00:26<00:13,  1.30it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.33it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 71%|███████   | 34/48 [00:29<00:10,  1.34it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.34it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 83%|████████▎ | 40/48 [00:32<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 92%|█████████▏| 44/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s]100%|██████████| 48/48 [00:38<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.36it/s]100%|██████████| 48/48 [00:38<00:00,  1.24it/s]
 98%|█████████▊| 47/48 [00:38<00:00,  1.48it/s]100%|██████████| 48/48 [00:38<00:00,  1.68it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.68it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
[INFO][09:15:43]: [Client #84] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_84_3536584.pth.
{'train_runtime': 38.8157, 'train_samples_per_second': 155.968, 'train_steps_per_second': 1.237, 'train_loss': 3.5944801966349282, 'epoch': 3.0}
[INFO][09:15:44]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 38.9458, 'train_samples_per_second': 155.447, 'train_steps_per_second': 1.232, 'train_loss': 3.3510522842407227, 'epoch': 3.0}
[INFO][09:15:44]: [Client #84] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_84_3536584.pth.
[INFO][09:15:45]: [Client #84] Model trained.
[INFO][09:15:45]: [Client #84] Inbound data has been processed.
[INFO][09:15:45]: [Client #84] Outbound data is ready to be sent after being processed.
[INFO][09:15:45]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][09:15:46]: [Client #9] Model trained.
[INFO][09:15:46]: [Client #9] Inbound data has been processed.
[INFO][09:15:46]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:15:54]: [Client #84] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:15:55]: [Server #3536466] Received 507.38 MB of payload data from client #84 (simulated).
[INFO][09:15:56]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:15:57]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:15:57]: [Server #3536466] Selecting client #13 for training.
[INFO][09:15:57]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:16:02]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:16:02]: [Client #13] Selected by the server.
[INFO][09:16:02]: [Client #13] Loading its data source...
[INFO][09:16:02]: [Client #13] Dataset size: 2018
[INFO][09:16:02]: [Client #13] Sampler: iid
[INFO][09:16:03]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:16:03]: [Client #13] Start to process inbound data.
[INFO][09:16:03]: [93m[1m[Client #13] Started training in communication round #18.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:57,  3.78s/it]  4%|▍         | 2/48 [00:04<01:24,  1.84s/it]  6%|▋         | 3/48 [00:04<00:54,  1.21s/it]  8%|▊         | 4/48 [00:05<00:40,  1.08it/s] 10%|█         | 5/48 [00:05<00:32,  1.31it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.51it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.87it/s] 21%|██        | 10/48 [00:08<00:19,  1.93it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:09<00:17,  2.02it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.06it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.19it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.16it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.14it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.13it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.12it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.10it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.10it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.10it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.10it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.10it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.09it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.20it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.16it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.12it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.11it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.10it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.09it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.09it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.09it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.08it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.08it/s]100%|██████████| 48/48 [00:26<00:00,  2.19it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.19it/s]100%|██████████| 48/48 [00:26<00:00,  1.85it/s]
[INFO][09:16:35]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
{'train_runtime': 26.0126, 'train_samples_per_second': 232.733, 'train_steps_per_second': 1.845, 'train_loss': 3.369884490966797, 'epoch': 3.0}
[INFO][09:16:35]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
[INFO][09:16:36]: [Client #13] Model trained.
[INFO][09:16:36]: [Client #13] Inbound data has been processed.
[INFO][09:16:36]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:16:41]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:16:42]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:16:42]: [Server #3536466] Adding client #14 to the list of clients for aggregation.
[INFO][09:16:42]: [Server #3536466] Adding client #87 to the list of clients for aggregation.
[INFO][09:16:42]: [Server #3536466] Adding client #16 to the list of clients for aggregation.
[INFO][09:16:42]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:16:42]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:16:42]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:16:42]: [Server #3536466] Updated weights have been received.
[INFO][09:16:44]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:16:44]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:16:44]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  1.7399e+00  1e+02  1e+00  1e+00
 1:  1.5065e+00  7.6017e-01  1e+01  1e-01  1e-01
 2:  1.7399e+00  8.4733e-01  1e+00  1e-03  9e-04
 3:  1.7428e+00  1.6657e+00  8e-02  4e-06  4e-06
 4:  1.7420e+00  1.7375e+00  5e-03  3e-07  2e-07
 5:  1.7409e+00  1.7382e+00  3e-03  3e-07  1e-07
 6:  1.7398e+00  1.7378e+00  2e-03  3e-06  2e-06
 7:  1.7394e+00  1.7384e+00  1e-03  2e-06  1e-06
 8:  1.7387e+00  1.7385e+00  2e-04  5e-06  3e-06
 9:  1.7386e+00  1.7385e+00  4e-05  1e-06  9e-07
10:  1.7385e+00  1.7385e+00  2e-06  7e-08  5e-08
11:  1.7385e+00  1.7385e+00  2e-08  8e-10  6e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  0.01 0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  1.1
 2.1  1.1  1.1  0.01 2.1  0.01 1.1  0.01 0.01 0.01 0.01 6.1  1.1  0.01
 0.01 0.01 6.1  2.1  0.01 0.01 0.01 0.01 1.1  1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 1.1  4.1  1.1  0.01 6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 0.01 1.1  0.01 3.1  0.01 0.01 0.01 3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  0.01 0.01 0.01 1.1  2.1  0.01 0.01 2.1  0.01 0.01
 0.01 0.01 6.1  1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01
 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.01
 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.61it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.60it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.03it/s]100%|██████████| 8/8 [00:00<00:00, 11.87it/s]
[INFO][09:16:53]: [93m[1m[Server #3536466] Global model perplexity: 32.59
[0m
[INFO][09:16:53]: [Server #3536466] All client reports have been processed.
[INFO][09:16:54]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_18.pth.
[INFO][09:16:58]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_18.pth.
[INFO][09:16:58]: [93m[1m
[Server #3536466] Starting round 19/100.[0m
[INFO][09:16:58]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.49026875e-05, 3.54050217e-06, 3.54050217e-06, 2.49026875e-05,
       2.49026875e-05, 3.54050217e-06, 2.49026875e-05, 3.54050217e-06,
       4.99261754e-01, 2.49026875e-05, 2.49026875e-05, 2.49026875e-05,
       4.99261754e-01, 3.54050217e-06, 5.69716359e-07, 3.54050217e-06,
       3.54050217e-06, 2.49026875e-05, 5.69716359e-07, 3.54050217e-06,
       2.49026875e-05, 2.49026875e-05, 2.49026875e-05, 2.49026875e-05,
       5.68938582e-08, 3.54050217e-06, 2.49026875e-05, 2.49026875e-05,
       2.49026875e-05, 5.68938582e-08, 5.69716359e-07, 2.49026875e-05,
       2.49026875e-05, 2.49026875e-05, 2.49026875e-05, 3.54050217e-06,
       3.54050217e-06, 2.49026875e-05, 2.49026875e-05, 2.49026875e-05,
       3.54050217e-06, 2.49026875e-05, 2.49026875e-05, 2.49026875e-05,
       3.54050217e-06, 1.29488295e-07, 3.54050217e-06, 2.49026875e-05,
       5.68938582e-08, 2.49026875e-05, 2.49026875e-05, 2.49026875e-05,
       2.49026875e-05, 3.54050217e-06, 2.49026875e-05, 3.54050217e-06,
       2.49026875e-05, 2.49026875e-05, 2.49026875e-05, 3.54050217e-06,
       2.49026875e-05, 2.35277595e-07, 2.49026875e-05, 2.35277595e-07,
       2.49026875e-05, 3.54050217e-06, 2.49026875e-05, 2.49026875e-05,
       2.35277595e-07, 5.68938582e-08, 3.54050217e-06, 2.49026875e-05,
       2.49026875e-05, 2.49026875e-05, 3.54050217e-06, 5.69716359e-07,
       2.49026875e-05, 2.49026875e-05, 5.69716359e-07, 2.49026875e-05,
       2.49026875e-05, 2.49026875e-05, 5.68938582e-08, 3.54050217e-06,
       2.49026875e-05, 2.49026875e-05, 2.49026875e-05, 2.49026875e-05,
       2.49026875e-05, 2.49026875e-05, 2.49026875e-05, 2.49026875e-05,
       2.49026875e-05, 8.22000881e-08, 3.54050217e-06]),)
[INFO][09:16:58]: [Server #3536466] Selected clients: [ 9 13 75 76 92]
[INFO][09:16:58]: [Server #3536466] Selecting client #76 for training.
[INFO][09:16:58]: [Server #3536466] Sending the current model to client #76 (simulated).
[INFO][09:17:04]: [Server #3536466] Sending 507.38 MB of payload data to client #76 (simulated).
[INFO][09:17:04]: [Server #3536466] Selecting client #9 for training.
[INFO][09:17:04]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:17:09]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:17:09]: [Client #76] Selected by the server.
[INFO][09:17:09]: [Client #76] Loading its data source...
[INFO][09:17:09]: [Client #76] Dataset size: 2018
[INFO][09:17:09]: [Client #76] Sampler: iid
[INFO][09:17:09]: [Client #9] Selected by the server.
[INFO][09:17:09]: [Client #9] Loading its data source...
[INFO][09:17:09]: [Client #9] Dataset size: 2018
[INFO][09:17:09]: [Client #9] Sampler: iid
[INFO][09:17:10]: [Client #76] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:17:10]: [Client #76] Start to process inbound data.
[INFO][09:17:10]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:17:10]: [Client #9] Start to process inbound data.
[INFO][09:17:11]: [93m[1m[Client #76] Started training in communication round #19.[0m
[INFO][09:17:11]: [93m[1m[Client #9] Started training in communication round #19.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:13,  4.12s/it]  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  4%|▍         | 2/48 [00:04<01:39,  2.15s/it]  4%|▍         | 2/48 [00:04<01:40,  2.18s/it]  6%|▋         | 3/48 [00:05<01:07,  1.50s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  8%|▊         | 4/48 [00:06<00:52,  1.19s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 12%|█▎        | 6/48 [00:07<00:38,  1.08it/s] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.16it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 17%|█▋        | 8/48 [00:09<00:32,  1.22it/s] 17%|█▋        | 8/48 [00:09<00:32,  1.21it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 21%|██        | 10/48 [00:10<00:29,  1.29it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.31it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.33it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.33it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.33it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:32<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:35<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:38<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.39it/s]100%|██████████| 48/48 [00:38<00:00,  1.24it/s]
100%|██████████| 48/48 [00:38<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.41it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
[INFO][09:17:56]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 38.8441, 'train_samples_per_second': 155.854, 'train_steps_per_second': 1.236, 'train_loss': 3.29954465230306, 'epoch': 3.0}
[INFO][09:17:56]: [Client #76] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_76_3536584.pth.
{'train_runtime': 38.9087, 'train_samples_per_second': 155.595, 'train_steps_per_second': 1.234, 'train_loss': 3.5623947779337564, 'epoch': 3.0}
[INFO][09:17:57]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][09:17:57]: [Client #76] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_76_3536584.pth.
[INFO][09:17:58]: [Client #9] Model trained.
[INFO][09:17:58]: [Client #9] Inbound data has been processed.
[INFO][09:17:58]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:17:58]: [Client #76] Model trained.
[INFO][09:17:58]: [Client #76] Inbound data has been processed.
[INFO][09:17:58]: [Client #76] Outbound data is ready to be sent after being processed.
[INFO][09:18:08]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:18:09]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:18:09]: [Client #76] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:18:10]: [Server #3536466] Received 507.38 MB of payload data from client #76 (simulated).
[INFO][09:18:10]: [Server #3536466] Selecting client #92 for training.
[INFO][09:18:10]: [Server #3536466] Sending the current model to client #92 (simulated).
[INFO][09:18:16]: [Server #3536466] Sending 507.38 MB of payload data to client #92 (simulated).
[INFO][09:18:16]: [Server #3536466] Selecting client #75 for training.
[INFO][09:18:16]: [Server #3536466] Sending the current model to client #75 (simulated).
[INFO][09:18:21]: [Server #3536466] Sending 507.38 MB of payload data to client #75 (simulated).
[INFO][09:18:21]: [Client #92] Selected by the server.
[INFO][09:18:21]: [Client #92] Loading its data source...
[INFO][09:18:21]: [Client #75] Selected by the server.
[INFO][09:18:21]: [Client #92] Dataset size: 2018
[INFO][09:18:21]: [Client #92] Sampler: iid
[INFO][09:18:21]: [Client #75] Loading its data source...
[INFO][09:18:21]: [Client #75] Dataset size: 2018
[INFO][09:18:21]: [Client #75] Sampler: iid
[INFO][09:18:23]: [Client #92] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:18:23]: [Client #92] Start to process inbound data.
[INFO][09:18:23]: [Client #75] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:18:23]: [Client #75] Start to process inbound data.
[INFO][09:18:24]: [93m[1m[Client #92] Started training in communication round #19.[0m
[INFO][09:18:24]: [93m[1m[Client #75] Started training in communication round #19.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.19s/it]  2%|▏         | 1/48 [00:04<03:42,  4.74s/it]  4%|▍         | 2/48 [00:05<01:45,  2.28s/it]  4%|▍         | 2/48 [00:05<01:58,  2.58s/it]  6%|▋         | 3/48 [00:06<01:17,  1.73s/it]  6%|▋         | 3/48 [00:06<01:25,  1.89s/it]  8%|▊         | 4/48 [00:07<01:04,  1.47s/it]  8%|▊         | 4/48 [00:07<01:08,  1.57s/it] 10%|█         | 5/48 [00:08<00:56,  1.32s/it] 10%|█         | 5/48 [00:09<00:59,  1.39s/it] 12%|█▎        | 6/48 [00:09<00:51,  1.24s/it] 12%|█▎        | 6/48 [00:10<00:53,  1.28s/it] 15%|█▍        | 7/48 [00:10<00:48,  1.18s/it] 15%|█▍        | 7/48 [00:11<00:49,  1.20s/it] 17%|█▋        | 8/48 [00:11<00:44,  1.12s/it] 17%|█▋        | 8/48 [00:11<00:42,  1.07s/it] 19%|█▉        | 9/48 [00:12<00:39,  1.00s/it] 19%|█▉        | 9/48 [00:12<00:38,  1.01it/s] 21%|██        | 10/48 [00:12<00:34,  1.09it/s] 21%|██        | 10/48 [00:13<00:34,  1.09it/s] 23%|██▎       | 11/48 [00:13<00:31,  1.16it/s] 23%|██▎       | 11/48 [00:14<00:31,  1.16it/s] 25%|██▌       | 12/48 [00:14<00:29,  1.22it/s] 25%|██▌       | 12/48 [00:14<00:29,  1.21it/s] 27%|██▋       | 13/48 [00:15<00:27,  1.26it/s] 27%|██▋       | 13/48 [00:15<00:27,  1.25it/s] 29%|██▉       | 14/48 [00:15<00:26,  1.28it/s] 29%|██▉       | 14/48 [00:16<00:26,  1.26it/s] 31%|███▏      | 15/48 [00:16<00:25,  1.30it/s] 31%|███▏      | 15/48 [00:17<00:25,  1.29it/s] 33%|███▎      | 16/48 [00:17<00:23,  1.35it/s] 33%|███▎      | 16/48 [00:17<00:23,  1.38it/s] 35%|███▌      | 17/48 [00:18<00:23,  1.34it/s] 35%|███▌      | 17/48 [00:18<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:18<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:19<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:19<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:20<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:20<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:20<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:20<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:21<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:21<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:22<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:22<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:23<00:18,  1.35it/s] 50%|█████     | 24/48 [00:23<00:17,  1.35it/s] 50%|█████     | 24/48 [00:23<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:24<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:24<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:25<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:25<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:26<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:26<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:26<00:15,  1.33it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 60%|██████    | 29/48 [00:27<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:27<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:28<00:13,  1.35it/s] 65%|██████▍   | 31/48 [00:28<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:29<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:29<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:29<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:29<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:30<00:10,  1.37it/s] 71%|███████   | 34/48 [00:30<00:10,  1.36it/s] 71%|███████   | 34/48 [00:31<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:31<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:31<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:32<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:32<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:33<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:33<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:34<00:07,  1.31it/s] 81%|████████▏ | 39/48 [00:34<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:34<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:35<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:35<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:36<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:36<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:37<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:37<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:37<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:38<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:38<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:39<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:39<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:40<00:01,  1.31it/s] 98%|█████████▊| 47/48 [00:40<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:41<00:00,  1.31it/s]100%|██████████| 48/48 [00:41<00:00,  1.35it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:41<00:00,  1.35it/s]100%|██████████| 48/48 [00:41<00:00,  1.17it/s]
100%|██████████| 48/48 [00:41<00:00,  1.52it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:41<00:00,  1.52it/s]100%|██████████| 48/48 [00:41<00:00,  1.16it/s]
[INFO][09:19:10]: [Client #92] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_92_3536584.pth.
{'train_runtime': 41.1138, 'train_samples_per_second': 147.25, 'train_steps_per_second': 1.167, 'train_loss': 3.5571276346842446, 'epoch': 3.0}
[INFO][09:19:11]: [Client #75] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_75_3536585.pth.
{'train_runtime': 41.4399, 'train_samples_per_second': 146.091, 'train_steps_per_second': 1.158, 'train_loss': 3.479452133178711, 'epoch': 3.0}
[INFO][09:19:11]: [Client #92] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_92_3536584.pth.
[INFO][09:19:12]: [Client #92] Model trained.
[INFO][09:19:12]: [Client #92] Inbound data has been processed.
[INFO][09:19:12]: [Client #92] Outbound data is ready to be sent after being processed.
[INFO][09:19:12]: [Client #75] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_75_3536585.pth.
[INFO][09:19:12]: [Client #75] Model trained.
[INFO][09:19:12]: [Client #75] Inbound data has been processed.
[INFO][09:19:12]: [Client #75] Outbound data is ready to be sent after being processed.
[INFO][09:19:22]: [Client #92] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:19:22]: [Client #75] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:19:23]: [Server #3536466] Received 507.38 MB of payload data from client #92 (simulated).
[INFO][09:19:24]: [Server #3536466] Received 507.38 MB of payload data from client #75 (simulated).
[INFO][09:19:24]: [Server #3536466] Selecting client #13 for training.
[INFO][09:19:24]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:19:29]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:19:29]: [Client #13] Selected by the server.
[INFO][09:19:29]: [Client #13] Loading its data source...
[INFO][09:19:29]: [Client #13] Dataset size: 2018
[INFO][09:19:29]: [Client #13] Sampler: iid
[INFO][09:19:31]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:19:31]: [Client #13] Start to process inbound data.
[INFO][09:19:31]: [93m[1m[Client #13] Started training in communication round #19.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:56,  3.75s/it]  4%|▍         | 2/48 [00:04<01:23,  1.82s/it]  6%|▋         | 3/48 [00:04<00:54,  1.21s/it]  8%|▊         | 4/48 [00:05<00:40,  1.09it/s] 10%|█         | 5/48 [00:05<00:32,  1.32it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.51it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.87it/s] 21%|██        | 10/48 [00:08<00:19,  1.93it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:08<00:17,  2.01it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.06it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.18it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.15it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.13it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.12it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.11it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.10it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:14<00:11,  2.09it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.09it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.09it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.19it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.16it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.12it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.11it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.09it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.09it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.09it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:26<00:00,  2.19it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.19it/s]100%|██████████| 48/48 [00:26<00:00,  1.84it/s]
[INFO][09:20:02]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
{'train_runtime': 26.0279, 'train_samples_per_second': 232.597, 'train_steps_per_second': 1.844, 'train_loss': 3.315655072530111, 'epoch': 3.0}
[INFO][09:20:03]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
[INFO][09:20:03]: [Client #13] Model trained.
[INFO][09:20:03]: [Client #13] Inbound data has been processed.
[INFO][09:20:03]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:20:09]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:20:10]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:20:10]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:20:10]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:20:10]: [Server #3536466] Adding client #76 to the list of clients for aggregation.
[INFO][09:20:10]: [Server #3536466] Adding client #64 to the list of clients for aggregation.
[INFO][09:20:10]: [Server #3536466] Adding client #84 to the list of clients for aggregation.
[INFO][09:20:10]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:20:10]: [Server #3536466] Updated weights have been received.
[INFO][09:20:11]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:20:12]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:20:12]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  1.8748e+00  1e+02  1e+00  1e+00
 1:  1.6546e+00  8.9469e-01  9e+00  9e-02  9e-02
 2:  1.8751e+00  9.9341e-01  1e+00  8e-04  8e-04
 3:  1.8775e+00  1.8102e+00  7e-02  5e-06  5e-06
 4:  1.8768e+00  1.8726e+00  4e-03  3e-07  3e-07
 5:  1.8757e+00  1.8733e+00  2e-03  3e-07  1e-07
 6:  1.8748e+00  1.8730e+00  2e-03  2e-06  2e-06
 7:  1.8744e+00  1.8735e+00  9e-04  2e-06  1e-06
 8:  1.8737e+00  1.8736e+00  2e-04  4e-06  3e-06
 9:  1.8736e+00  1.8736e+00  4e-05  1e-06  7e-07
10:  1.8736e+00  1.8736e+00  2e-06  6e-08  4e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  0.01 0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  1.1
 2.1  1.1  1.1  0.01 2.1  0.01 1.1  0.01 0.01 0.01 0.01 6.1  1.1  0.01
 0.01 0.01 6.1  2.1  0.01 0.01 0.01 0.01 1.1  1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 1.1  4.1  1.1  0.01 6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 0.01 1.1  0.01 3.1  5.1  0.01 0.01 3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  0.01 0.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 0.01 6.1  1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01
 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.63it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.76it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.15it/s]100%|██████████| 8/8 [00:00<00:00, 11.92it/s]
[INFO][09:20:21]: [93m[1m[Server #3536466] Global model perplexity: 31.21
[0m
[INFO][09:20:21]: [Server #3536466] All client reports have been processed.
[INFO][09:20:21]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_19.pth.
[INFO][09:20:26]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_19.pth.
[INFO][09:20:26]: [93m[1m
[Server #3536466] Starting round 20/100.[0m
[INFO][09:20:26]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([7.19685222e-07, 1.16107298e-07, 1.16107298e-07, 7.19685222e-07,
       7.19685222e-07, 1.16107298e-07, 7.19685222e-07, 1.16107298e-07,
       3.33319685e-01, 7.19685222e-07, 7.19685222e-07, 7.19685222e-07,
       3.33319685e-01, 1.16107298e-07, 1.83294742e-08, 1.16107298e-07,
       1.16107298e-07, 7.19685222e-07, 1.83294742e-08, 1.16107298e-07,
       7.19685222e-07, 7.19685222e-07, 7.19685222e-07, 7.19685222e-07,
       1.80253615e-09, 1.16107298e-07, 7.19685222e-07, 7.19685222e-07,
       7.19685222e-07, 1.80253615e-09, 1.83294742e-08, 7.19685222e-07,
       7.19685222e-07, 7.19685222e-07, 7.19685222e-07, 1.16107298e-07,
       1.16107298e-07, 7.19685222e-07, 7.19685222e-07, 7.19685222e-07,
       1.16107298e-07, 7.19685222e-07, 7.19685222e-07, 7.19685222e-07,
       1.16107298e-07, 4.11247100e-09, 1.16107298e-07, 7.19685222e-07,
       1.80253615e-09, 7.19685222e-07, 7.19685222e-07, 7.19685222e-07,
       7.19685222e-07, 1.16107298e-07, 7.19685222e-07, 1.16107298e-07,
       7.19685222e-07, 7.19685222e-07, 7.19685222e-07, 1.16107298e-07,
       7.19685222e-07, 7.49961691e-09, 2.60633944e-09, 7.19685222e-07,
       7.49961691e-09, 7.19685222e-07, 1.16107298e-07, 7.19685222e-07,
       7.19685222e-07, 7.49961691e-09, 1.80253615e-09, 1.16107298e-07,
       3.33319685e-01, 7.19685222e-07, 1.16107298e-07, 1.83294742e-08,
       7.19685222e-07, 7.19685222e-07, 1.83294742e-08, 7.19685222e-07,
       1.16107298e-07, 7.19685222e-07, 7.19685222e-07, 1.80253615e-09,
       1.16107298e-07, 7.19685222e-07, 7.19685222e-07, 7.19685222e-07,
       7.19685222e-07, 7.19685222e-07, 7.19685222e-07, 7.19685222e-07,
       7.19685222e-07, 2.60633944e-09, 1.16107298e-07]),)
[INFO][09:20:26]: [Server #3536466] Selected clients: [13  9 76 18 29]
[INFO][09:20:26]: [Server #3536466] Selecting client #18 for training.
[INFO][09:20:26]: [Server #3536466] Sending the current model to client #18 (simulated).
[INFO][09:20:31]: [Server #3536466] Sending 507.38 MB of payload data to client #18 (simulated).
[INFO][09:20:31]: [Server #3536466] Selecting client #29 for training.
[INFO][09:20:31]: [Server #3536466] Sending the current model to client #29 (simulated).
[INFO][09:20:37]: [Server #3536466] Sending 507.38 MB of payload data to client #29 (simulated).
[INFO][09:20:37]: [Client #18] Selected by the server.
[INFO][09:20:37]: [Client #29] Selected by the server.
[INFO][09:20:37]: [Client #18] Loading its data source...
[INFO][09:20:37]: [Client #29] Loading its data source...
[INFO][09:20:37]: [Client #18] Dataset size: 2018
[INFO][09:20:37]: [Client #29] Dataset size: 2018
[INFO][09:20:37]: [Client #18] Sampler: iid
[INFO][09:20:37]: [Client #29] Sampler: iid
[INFO][09:20:38]: [Client #18] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:20:38]: [Client #18] Start to process inbound data.
[INFO][09:20:38]: [Client #29] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:20:38]: [Client #29] Start to process inbound data.
[INFO][09:20:39]: [93m[1m[Client #18] Started training in communication round #20.[0m
[INFO][09:20:39]: [93m[1m[Client #29] Started training in communication round #20.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:14,  4.14s/it]  2%|▏         | 1/48 [00:04<03:26,  4.38s/it]  4%|▍         | 2/48 [00:04<01:41,  2.21s/it]  4%|▍         | 2/48 [00:05<01:49,  2.38s/it]  6%|▋         | 3/48 [00:05<01:12,  1.62s/it]  6%|▋         | 3/48 [00:06<01:17,  1.72s/it]  8%|▊         | 4/48 [00:06<00:58,  1.32s/it]  8%|▊         | 4/48 [00:07<01:01,  1.40s/it] 10%|█         | 5/48 [00:07<00:49,  1.16s/it] 10%|█         | 5/48 [00:08<00:52,  1.22s/it] 12%|█▎        | 6/48 [00:08<00:46,  1.10s/it] 12%|█▎        | 6/48 [00:09<00:46,  1.11s/it] 15%|█▍        | 7/48 [00:09<00:41,  1.02s/it] 15%|█▍        | 7/48 [00:09<00:42,  1.04s/it] 17%|█▋        | 8/48 [00:10<00:38,  1.04it/s] 17%|█▋        | 8/48 [00:10<00:40,  1.00s/it] 19%|█▉        | 9/48 [00:11<00:36,  1.06it/s] 19%|█▉        | 9/48 [00:11<00:37,  1.04it/s] 21%|██        | 10/48 [00:12<00:35,  1.07it/s] 21%|██        | 10/48 [00:12<00:35,  1.08it/s] 23%|██▎       | 11/48 [00:13<00:33,  1.09it/s] 23%|██▎       | 11/48 [00:13<00:34,  1.08it/s] 25%|██▌       | 12/48 [00:13<00:33,  1.09it/s] 25%|██▌       | 12/48 [00:14<00:32,  1.10it/s] 27%|██▋       | 13/48 [00:14<00:31,  1.12it/s] 27%|██▋       | 13/48 [00:15<00:31,  1.12it/s] 29%|██▉       | 14/48 [00:15<00:30,  1.11it/s] 29%|██▉       | 14/48 [00:16<00:30,  1.12it/s] 31%|███▏      | 15/48 [00:16<00:29,  1.13it/s] 31%|███▏      | 15/48 [00:17<00:31,  1.06it/s] 33%|███▎      | 16/48 [00:17<00:28,  1.12it/s] 33%|███▎      | 16/48 [00:17<00:27,  1.16it/s] 35%|███▌      | 17/48 [00:18<00:27,  1.14it/s] 35%|███▌      | 17/48 [00:18<00:27,  1.14it/s] 38%|███▊      | 18/48 [00:19<00:26,  1.12it/s] 38%|███▊      | 18/48 [00:19<00:26,  1.13it/s] 40%|███▉      | 19/48 [00:20<00:25,  1.15it/s] 40%|███▉      | 19/48 [00:20<00:25,  1.12it/s] 42%|████▏     | 20/48 [00:20<00:24,  1.13it/s] 42%|████▏     | 20/48 [00:21<00:24,  1.14it/s] 44%|████▍     | 21/48 [00:21<00:23,  1.13it/s] 44%|████▍     | 21/48 [00:22<00:23,  1.13it/s] 46%|████▌     | 22/48 [00:22<00:23,  1.12it/s] 46%|████▌     | 22/48 [00:23<00:22,  1.14it/s] 48%|████▊     | 23/48 [00:23<00:22,  1.11it/s] 48%|████▊     | 23/48 [00:24<00:22,  1.13it/s] 50%|█████     | 24/48 [00:24<00:21,  1.09it/s] 50%|█████     | 24/48 [00:24<00:21,  1.11it/s] 52%|█████▏    | 25/48 [00:25<00:20,  1.11it/s] 52%|█████▏    | 25/48 [00:25<00:20,  1.11it/s] 54%|█████▍    | 26/48 [00:26<00:19,  1.12it/s] 54%|█████▍    | 26/48 [00:26<00:19,  1.12it/s] 56%|█████▋    | 27/48 [00:27<00:18,  1.12it/s] 56%|█████▋    | 27/48 [00:27<00:19,  1.10it/s] 58%|█████▊    | 28/48 [00:28<00:18,  1.10it/s] 58%|█████▊    | 28/48 [00:28<00:18,  1.10it/s] 60%|██████    | 29/48 [00:29<00:17,  1.11it/s] 60%|██████    | 29/48 [00:29<00:17,  1.11it/s] 62%|██████▎   | 30/48 [00:30<00:16,  1.09it/s] 62%|██████▎   | 30/48 [00:30<00:16,  1.10it/s] 65%|██████▍   | 31/48 [00:30<00:15,  1.11it/s] 65%|██████▍   | 31/48 [00:31<00:16,  1.02it/s] 67%|██████▋   | 32/48 [00:31<00:14,  1.09it/s] 67%|██████▋   | 32/48 [00:32<00:14,  1.14it/s] 69%|██████▉   | 33/48 [00:32<00:13,  1.11it/s] 69%|██████▉   | 33/48 [00:33<00:13,  1.11it/s] 71%|███████   | 34/48 [00:33<00:12,  1.10it/s] 71%|███████   | 34/48 [00:34<00:12,  1.11it/s] 73%|███████▎  | 35/48 [00:34<00:11,  1.13it/s] 73%|███████▎  | 35/48 [00:34<00:11,  1.13it/s] 75%|███████▌  | 36/48 [00:35<00:10,  1.13it/s] 75%|███████▌  | 36/48 [00:35<00:10,  1.11it/s] 77%|███████▋  | 37/48 [00:36<00:09,  1.13it/s] 77%|███████▋  | 37/48 [00:36<00:10,  1.10it/s] 79%|███████▉  | 38/48 [00:37<00:09,  1.09it/s] 79%|███████▉  | 38/48 [00:37<00:09,  1.10it/s] 81%|████████▏ | 39/48 [00:38<00:08,  1.09it/s] 81%|████████▏ | 39/48 [00:38<00:08,  1.08it/s] 83%|████████▎ | 40/48 [00:39<00:07,  1.09it/s] 83%|████████▎ | 40/48 [00:39<00:07,  1.09it/s] 85%|████████▌ | 41/48 [00:39<00:06,  1.10it/s] 85%|████████▌ | 41/48 [00:40<00:06,  1.10it/s] 88%|████████▊ | 42/48 [00:40<00:05,  1.11it/s] 88%|████████▊ | 42/48 [00:41<00:05,  1.10it/s] 90%|████████▉ | 43/48 [00:41<00:04,  1.09it/s] 90%|████████▉ | 43/48 [00:42<00:04,  1.11it/s] 92%|█████████▏| 44/48 [00:42<00:03,  1.08it/s] 92%|█████████▏| 44/48 [00:43<00:03,  1.10it/s] 94%|█████████▍| 45/48 [00:43<00:02,  1.10it/s] 94%|█████████▍| 45/48 [00:44<00:02,  1.10it/s] 96%|█████████▌| 46/48 [00:44<00:01,  1.09it/s] 96%|█████████▌| 46/48 [00:45<00:01,  1.09it/s] 98%|█████████▊| 47/48 [00:45<00:00,  1.09it/s] 98%|█████████▊| 47/48 [00:46<00:00,  1.02it/s]100%|██████████| 48/48 [00:46<00:00,  1.07it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:46<00:00,  1.07it/s]100%|██████████| 48/48 [00:46<00:00,  1.03it/s]
100%|██████████| 48/48 [00:46<00:00,  1.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:46<00:00,  1.18it/s]100%|██████████| 48/48 [00:46<00:00,  1.03it/s]
[INFO][09:21:31]: [Client #18] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
{'train_runtime': 46.4512, 'train_samples_per_second': 130.33, 'train_steps_per_second': 1.033, 'train_loss': 3.53925355275472, 'epoch': 3.0}
[INFO][09:21:31]: [Client #29] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_29_3536585.pth.
{'train_runtime': 46.6866, 'train_samples_per_second': 129.673, 'train_steps_per_second': 1.028, 'train_loss': 3.481074015299479, 'epoch': 3.0}
[INFO][09:21:32]: [Client #18] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
[INFO][09:21:32]: [Client #29] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_29_3536585.pth.
[INFO][09:21:33]: [Client #18] Model trained.
[INFO][09:21:33]: [Client #18] Inbound data has been processed.
[INFO][09:21:33]: [Client #18] Outbound data is ready to be sent after being processed.
[INFO][09:21:33]: [Client #29] Model trained.
[INFO][09:21:33]: [Client #29] Inbound data has been processed.
[INFO][09:21:33]: [Client #29] Outbound data is ready to be sent after being processed.
[INFO][09:21:43]: [Client #29] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:21:44]: [Client #18] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:21:44]: [Server #3536466] Received 507.38 MB of payload data from client #29 (simulated).
[INFO][09:21:45]: [Server #3536466] Received 507.38 MB of payload data from client #18 (simulated).
[INFO][09:21:45]: [Server #3536466] Selecting client #76 for training.
[INFO][09:21:45]: [Server #3536466] Sending the current model to client #76 (simulated).
[INFO][09:21:51]: [Server #3536466] Sending 507.38 MB of payload data to client #76 (simulated).
[INFO][09:21:51]: [Server #3536466] Selecting client #9 for training.
[INFO][09:21:51]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:21:57]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:21:57]: [Client #76] Selected by the server.
[INFO][09:21:57]: [Client #76] Loading its data source...
[INFO][09:21:57]: [Client #76] Dataset size: 2018
[INFO][09:21:57]: [Client #76] Sampler: iid
[INFO][09:21:57]: [Client #9] Selected by the server.
[INFO][09:21:57]: [Client #9] Loading its data source...
[INFO][09:21:57]: [Client #9] Dataset size: 2018
[INFO][09:21:57]: [Client #9] Sampler: iid
[INFO][09:21:58]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:21:58]: [Client #9] Start to process inbound data.
[INFO][09:21:58]: [Client #76] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:21:58]: [Client #76] Start to process inbound data.
[INFO][09:21:59]: [93m[1m[Client #76] Started training in communication round #20.[0m
[INFO][09:21:59]: [93m[1m[Client #9] Started training in communication round #20.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:34,  4.56s/it]  2%|▏         | 1/48 [00:04<03:33,  4.54s/it]  4%|▍         | 2/48 [00:05<01:52,  2.45s/it]  4%|▍         | 2/48 [00:05<01:52,  2.45s/it]  6%|▋         | 3/48 [00:06<01:17,  1.72s/it]  6%|▋         | 3/48 [00:06<01:17,  1.73s/it]  8%|▊         | 4/48 [00:07<00:58,  1.33s/it]  8%|▊         | 4/48 [00:07<00:59,  1.36s/it] 10%|█         | 5/48 [00:07<00:48,  1.13s/it] 10%|█         | 5/48 [00:07<00:49,  1.14s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 12%|█▎        | 6/48 [00:08<00:42,  1.01s/it] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.08it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.16it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.20it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:16,  1.31it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.31it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.29it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.31it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
[INFO][09:22:44]: [Client #76] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_76_3536584.pth.
{'train_runtime': 39.7937, 'train_samples_per_second': 152.135, 'train_steps_per_second': 1.206, 'train_loss': 3.431302070617676, 'epoch': 3.0}
[INFO][09:22:45]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.8501, 'train_samples_per_second': 151.919, 'train_steps_per_second': 1.205, 'train_loss': 3.2419281005859375, 'epoch': 3.0}
[INFO][09:22:45]: [Client #76] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_76_3536584.pth.
[INFO][09:22:46]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][09:22:46]: [Client #76] Model trained.
[INFO][09:22:46]: [Client #76] Inbound data has been processed.
[INFO][09:22:46]: [Client #76] Outbound data is ready to be sent after being processed.
[INFO][09:22:46]: [Client #9] Model trained.
[INFO][09:22:46]: [Client #9] Inbound data has been processed.
[INFO][09:22:46]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:22:57]: [Client #76] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:22:57]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:22:58]: [Server #3536466] Received 507.38 MB of payload data from client #76 (simulated).
[INFO][09:22:58]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:22:58]: [Server #3536466] Selecting client #13 for training.
[INFO][09:22:58]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:23:04]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:23:04]: [Client #13] Selected by the server.
[INFO][09:23:04]: [Client #13] Loading its data source...
[INFO][09:23:04]: [Client #13] Dataset size: 2018
[INFO][09:23:04]: [Client #13] Sampler: iid
[INFO][09:23:05]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:23:05]: [Client #13] Start to process inbound data.
[INFO][09:23:05]: [93m[1m[Client #13] Started training in communication round #20.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:56,  3.75s/it]  4%|▍         | 2/48 [00:04<01:23,  1.83s/it]  6%|▋         | 3/48 [00:04<00:54,  1.21s/it]  8%|▊         | 4/48 [00:05<00:40,  1.09it/s] 10%|█         | 5/48 [00:05<00:32,  1.32it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.51it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.87it/s] 21%|██        | 10/48 [00:08<00:19,  1.94it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:08<00:17,  2.02it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.06it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.19it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.16it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.14it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.13it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.12it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.11it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.10it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.10it/s] 56%|█████▋    | 27/48 [00:16<00:09,  2.10it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.10it/s] 60%|██████    | 29/48 [00:17<00:09,  2.10it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.10it/s] 65%|██████▍   | 31/48 [00:17<00:08,  2.10it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.20it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.17it/s] 71%|███████   | 34/48 [00:19<00:06,  2.15it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.13it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.12it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.11it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.10it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.10it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.10it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.10it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.10it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.10it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:25<00:00,  2.20it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:25<00:00,  2.20it/s]100%|██████████| 48/48 [00:25<00:00,  1.85it/s]
[INFO][09:23:37]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
{'train_runtime': 25.9388, 'train_samples_per_second': 233.395, 'train_steps_per_second': 1.851, 'train_loss': 3.2592735290527344, 'epoch': 3.0}
[INFO][09:23:38]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
[INFO][09:23:38]: [Client #13] Model trained.
[INFO][09:23:38]: [Client #13] Inbound data has been processed.
[INFO][09:23:38]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:23:44]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:23:45]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:23:45]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:23:45]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:23:45]: [Server #3536466] Adding client #76 to the list of clients for aggregation.
[INFO][09:23:45]: [Server #3536466] Adding client #18 to the list of clients for aggregation.
[INFO][09:23:45]: [Server #3536466] Adding client #65 to the list of clients for aggregation.
[INFO][09:23:45]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:23:45]: [Server #3536466] Updated weights have been received.
[INFO][09:23:46]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:23:46]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:23:46]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  1.9592e+00  1e+02  1e+00  1e+00
 1:  1.7505e+00  9.7918e-01  9e+00  8e-02  8e-02
 2:  1.9600e+00  1.0858e+00  9e-01  7e-04  7e-04
 3:  1.9621e+00  1.9008e+00  6e-02  5e-06  5e-06
 4:  1.9613e+00  1.9573e+00  4e-03  3e-07  3e-07
 5:  1.9600e+00  1.9579e+00  2e-03  4e-07  1e-07
 6:  1.9590e+00  1.9576e+00  1e-03  2e-06  2e-06
 7:  1.9586e+00  1.9580e+00  6e-04  2e-06  1e-06
 8:  1.9581e+00  1.9580e+00  8e-05  2e-06  1e-06
 9:  1.9580e+00  1.9580e+00  4e-06  1e-07  8e-08
10:  1.9580e+00  1.9580e+00  5e-08  2e-09  1e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  0.01 0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  1.1
 2.1  1.1  1.1  0.1  2.1  0.01 1.1  0.01 0.01 0.01 0.01 6.1  1.1  0.01
 0.01 0.01 6.1  2.1  0.01 0.01 0.01 0.01 1.1  1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 1.1  4.1  1.1  0.01 6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 0.01 1.1  0.01 3.1  5.1  3.1  0.01 3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  0.01 0.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 0.01 6.1  1.1  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01
 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.52it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.58it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.09it/s]100%|██████████| 8/8 [00:00<00:00, 11.93it/s]
[INFO][09:23:56]: [93m[1m[Server #3536466] Global model perplexity: 30.38
[0m
[INFO][09:23:56]: [Server #3536466] All client reports have been processed.
[INFO][09:23:56]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_20.pth.
[INFO][09:24:00]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_20.pth.
[INFO][09:24:00]: [93m[1m
[Server #3536466] Starting round 21/100.[0m
[INFO][09:24:00]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([3.79217571e-07, 8.59538898e-08, 8.59538898e-08, 3.79217571e-07,
       3.79217571e-07, 8.59538898e-08, 3.79217571e-07, 8.59538898e-08,
       2.49994638e-01, 3.79217571e-07, 3.79217571e-07, 3.79217571e-07,
       2.49994638e-01, 8.59538898e-08, 1.67753638e-08, 8.59538898e-08,
       8.59538898e-08, 2.49994638e-01, 1.67753638e-08, 8.59538898e-08,
       3.79217571e-07, 3.79217571e-07, 3.79217571e-07, 3.79217571e-07,
       1.78937322e-09, 8.59538898e-08, 3.79217571e-07, 3.79217571e-07,
       1.78937322e-09, 1.67753638e-08, 3.79217571e-07, 3.79217571e-07,
       3.79217571e-07, 3.79217571e-07, 8.59538898e-08, 8.59538898e-08,
       3.79217571e-07, 3.79217571e-07, 3.79217571e-07, 8.59538898e-08,
       3.79217571e-07, 3.79217571e-07, 3.79217571e-07, 8.59538898e-08,
       4.01832036e-09, 8.59538898e-08, 3.79217571e-07, 1.78937322e-09,
       3.79217571e-07, 3.79217571e-07, 3.79217571e-07, 3.79217571e-07,
       8.59538898e-08, 3.79217571e-07, 8.59538898e-08, 3.79217571e-07,
       3.79217571e-07, 3.79217571e-07, 8.59538898e-08, 3.79217571e-07,
       7.19481850e-09, 2.57131860e-09, 7.19481850e-09, 3.79217571e-07,
       7.19481850e-09, 3.79217571e-07, 8.59538898e-08, 3.79217571e-07,
       3.79217571e-07, 7.19481850e-09, 1.78937322e-09, 8.59538898e-08,
       2.49994638e-01, 3.79217571e-07, 8.59538898e-08, 1.67753638e-08,
       3.79217571e-07, 3.79217571e-07, 1.67753638e-08, 3.79217571e-07,
       8.59538898e-08, 3.79217571e-07, 3.79217571e-07, 1.78937322e-09,
       8.59538898e-08, 3.79217571e-07, 3.79217571e-07, 3.79217571e-07,
       3.79217571e-07, 3.79217571e-07, 3.79217571e-07, 3.79217571e-07,
       3.79217571e-07, 2.57131860e-09, 8.59538898e-08]),)
[INFO][09:24:00]: [Server #3536466] Selected clients: [76 13 18  9 40]
[INFO][09:24:00]: [Server #3536466] Selecting client #18 for training.
[INFO][09:24:00]: [Server #3536466] Sending the current model to client #18 (simulated).
[INFO][09:24:06]: [Server #3536466] Sending 507.38 MB of payload data to client #18 (simulated).
[INFO][09:24:06]: [Server #3536466] Selecting client #9 for training.
[INFO][09:24:06]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:24:12]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:24:12]: [Client #18] Selected by the server.
[INFO][09:24:12]: [Client #18] Loading its data source...
[INFO][09:24:12]: [Client #18] Dataset size: 2018
[INFO][09:24:12]: [Client #18] Sampler: iid
[INFO][09:24:12]: [Client #9] Selected by the server.
[INFO][09:24:12]: [Client #9] Loading its data source...
[INFO][09:24:12]: [Client #9] Dataset size: 2018
[INFO][09:24:12]: [Client #9] Sampler: iid
[INFO][09:24:13]: [Client #18] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:24:13]: [Client #18] Start to process inbound data.
[INFO][09:24:13]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:24:13]: [Client #9] Start to process inbound data.
[INFO][09:24:14]: [93m[1m[Client #18] Started training in communication round #21.[0m
[INFO][09:24:14]: [93m[1m[Client #9] Started training in communication round #21.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:20,  4.26s/it]  2%|▏         | 1/48 [00:04<03:44,  4.77s/it]  4%|▍         | 2/48 [00:05<01:46,  2.31s/it]  4%|▍         | 2/48 [00:05<01:54,  2.50s/it]  6%|▋         | 3/48 [00:06<01:17,  1.72s/it]  6%|▋         | 3/48 [00:06<01:21,  1.81s/it]  8%|▊         | 4/48 [00:07<01:01,  1.41s/it]  8%|▊         | 4/48 [00:07<01:04,  1.46s/it] 10%|█         | 5/48 [00:08<00:52,  1.23s/it] 10%|█         | 5/48 [00:08<00:53,  1.25s/it] 12%|█▎        | 6/48 [00:08<00:47,  1.13s/it] 12%|█▎        | 6/48 [00:09<00:47,  1.13s/it] 15%|█▍        | 7/48 [00:09<00:43,  1.06s/it] 15%|█▍        | 7/48 [00:10<00:43,  1.05s/it] 17%|█▋        | 8/48 [00:10<00:40,  1.00s/it] 17%|█▋        | 8/48 [00:11<00:39,  1.00it/s] 19%|█▉        | 9/48 [00:11<00:37,  1.04it/s] 19%|█▉        | 9/48 [00:12<00:38,  1.01it/s] 21%|██        | 10/48 [00:12<00:36,  1.04it/s] 21%|██        | 10/48 [00:13<00:36,  1.04it/s] 23%|██▎       | 11/48 [00:13<00:34,  1.07it/s] 23%|██▎       | 11/48 [00:13<00:34,  1.09it/s] 25%|██▌       | 12/48 [00:14<00:32,  1.10it/s] 25%|██▌       | 12/48 [00:14<00:32,  1.09it/s] 27%|██▋       | 13/48 [00:15<00:31,  1.11it/s] 27%|██▋       | 13/48 [00:15<00:31,  1.11it/s] 29%|██▉       | 14/48 [00:16<00:30,  1.11it/s] 29%|██▉       | 14/48 [00:16<00:30,  1.11it/s] 31%|███▏      | 15/48 [00:17<00:29,  1.11it/s] 31%|███▏      | 15/48 [00:17<00:31,  1.05it/s] 33%|███▎      | 16/48 [00:17<00:29,  1.10it/s] 33%|███▎      | 16/48 [00:18<00:27,  1.16it/s] 35%|███▌      | 17/48 [00:19<00:29,  1.05it/s] 35%|███▌      | 17/48 [00:19<00:28,  1.08it/s] 38%|███▊      | 18/48 [00:19<00:28,  1.06it/s] 38%|███▊      | 18/48 [00:20<00:28,  1.05it/s] 40%|███▉      | 19/48 [00:20<00:26,  1.08it/s] 40%|███▉      | 19/48 [00:21<00:27,  1.07it/s] 42%|████▏     | 20/48 [00:21<00:25,  1.09it/s] 42%|████▏     | 20/48 [00:22<00:25,  1.09it/s] 44%|████▍     | 21/48 [00:22<00:25,  1.07it/s] 44%|████▍     | 21/48 [00:23<00:24,  1.08it/s] 46%|████▌     | 22/48 [00:23<00:23,  1.10it/s] 46%|████▌     | 22/48 [00:23<00:24,  1.07it/s] 48%|████▊     | 23/48 [00:24<00:22,  1.10it/s] 48%|████▊     | 23/48 [00:24<00:22,  1.09it/s] 50%|█████     | 24/48 [00:25<00:22,  1.07it/s] 50%|█████     | 24/48 [00:25<00:21,  1.10it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.07it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.08it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.09it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.09it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.08it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.09it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.10it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.10it/s] 60%|██████    | 29/48 [00:29<00:17,  1.10it/s] 60%|██████    | 29/48 [00:30<00:17,  1.10it/s] 62%|██████▎   | 30/48 [00:30<00:16,  1.10it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.10it/s] 65%|██████▍   | 31/48 [00:31<00:15,  1.10it/s] 65%|██████▍   | 31/48 [00:32<00:16,  1.02it/s] 67%|██████▋   | 32/48 [00:32<00:14,  1.09it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.13it/s] 69%|██████▉   | 33/48 [00:33<00:13,  1.08it/s] 69%|██████▉   | 33/48 [00:33<00:13,  1.11it/s] 71%|███████   | 34/48 [00:34<00:13,  1.07it/s] 71%|███████   | 34/48 [00:34<00:12,  1.09it/s] 73%|███████▎  | 35/48 [00:35<00:12,  1.06it/s] 73%|███████▎  | 35/48 [00:35<00:12,  1.08it/s] 75%|███████▌  | 36/48 [00:36<00:11,  1.06it/s] 75%|███████▌  | 36/48 [00:36<00:11,  1.06it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.06it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.04it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.05it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.03it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.06it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.05it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.06it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.07it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.07it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.09it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.08it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.07it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.09it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.08it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.07it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.05it/s] 94%|█████████▍| 45/48 [00:44<00:02,  1.08it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.08it/s] 96%|█████████▌| 46/48 [00:45<00:01,  1.06it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.09it/s] 98%|█████████▊| 47/48 [00:46<00:00,  1.07it/s] 98%|█████████▊| 47/48 [00:47<00:00,  1.02it/s]100%|██████████| 48/48 [00:47<00:00,  1.08it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.08it/s]100%|██████████| 48/48 [00:47<00:00,  1.01it/s]
100%|██████████| 48/48 [00:47<00:00,  1.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.18it/s]100%|██████████| 48/48 [00:47<00:00,  1.00it/s]
[INFO][09:25:08]: [Client #18] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
{'train_runtime': 47.7019, 'train_samples_per_second': 126.913, 'train_steps_per_second': 1.006, 'train_loss': 3.4246342976888022, 'epoch': 3.0}
[INFO][09:25:08]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 47.8841, 'train_samples_per_second': 126.43, 'train_steps_per_second': 1.002, 'train_loss': 3.146081288655599, 'epoch': 3.0}
[INFO][09:25:09]: [Client #18] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
[INFO][09:25:09]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][09:25:09]: [Client #18] Model trained.
[INFO][09:25:09]: [Client #18] Inbound data has been processed.
[INFO][09:25:09]: [Client #18] Outbound data is ready to be sent after being processed.
[INFO][09:25:10]: [Client #9] Model trained.
[INFO][09:25:10]: [Client #9] Inbound data has been processed.
[INFO][09:25:10]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:25:20]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:25:21]: [Client #18] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:25:21]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:25:22]: [Server #3536466] Received 507.38 MB of payload data from client #18 (simulated).
[INFO][09:25:22]: [Server #3536466] Selecting client #40 for training.
[INFO][09:25:22]: [Server #3536466] Sending the current model to client #40 (simulated).
[INFO][09:25:28]: [Server #3536466] Sending 507.38 MB of payload data to client #40 (simulated).
[INFO][09:25:28]: [Server #3536466] Selecting client #13 for training.
[INFO][09:25:28]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:25:34]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:25:34]: [Client #13] Selected by the server.
[INFO][09:25:34]: [Client #40] Selected by the server.
[INFO][09:25:34]: [Client #13] Loading its data source...
[INFO][09:25:34]: [Client #40] Loading its data source...
[INFO][09:25:34]: [Client #13] Dataset size: 2018
[INFO][09:25:34]: [Client #13] Sampler: iid
[INFO][09:25:34]: [Client #40] Dataset size: 2018
[INFO][09:25:34]: [Client #40] Sampler: iid
[INFO][09:25:35]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:25:35]: [Client #13] Start to process inbound data.
[INFO][09:25:35]: [Client #40] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:25:35]: [Client #40] Start to process inbound data.
[INFO][09:25:36]: [93m[1m[Client #13] Started training in communication round #21.[0m
[INFO][09:25:36]: [93m[1m[Client #40] Started training in communication round #21.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:33,  4.55s/it]  2%|▏         | 1/48 [00:04<03:38,  4.65s/it]  4%|▍         | 2/48 [00:05<01:44,  2.28s/it]  4%|▍         | 2/48 [00:05<01:49,  2.38s/it]  6%|▋         | 3/48 [00:05<01:11,  1.58s/it]  6%|▋         | 3/48 [00:06<01:13,  1.62s/it]  8%|▊         | 4/48 [00:06<00:54,  1.25s/it]  8%|▊         | 4/48 [00:06<00:56,  1.27s/it] 10%|█         | 5/48 [00:07<00:45,  1.07s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.05it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.29it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.34it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.34it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.31it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.31it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][09:26:22]: [Client #40] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_40_3536584.pth.
{'train_runtime': 39.4387, 'train_samples_per_second': 153.504, 'train_steps_per_second': 1.217, 'train_loss': 3.507749875386556, 'epoch': 3.0}
[INFO][09:26:22]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536585.pth.
{'train_runtime': 39.5862, 'train_samples_per_second': 152.932, 'train_steps_per_second': 1.213, 'train_loss': 3.1606483459472656, 'epoch': 3.0}
[INFO][09:26:23]: [Client #40] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_40_3536584.pth.
[INFO][09:26:23]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536585.pth.
[INFO][09:26:24]: [Client #40] Model trained.
[INFO][09:26:24]: [Client #40] Inbound data has been processed.
[INFO][09:26:24]: [Client #40] Outbound data is ready to be sent after being processed.
[INFO][09:26:24]: [Client #13] Model trained.
[INFO][09:26:24]: [Client #13] Inbound data has been processed.
[INFO][09:26:24]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:26:33]: [Client #40] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:26:34]: [Server #3536466] Received 507.38 MB of payload data from client #40 (simulated).
[INFO][09:26:34]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:26:35]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:26:35]: [Server #3536466] Selecting client #76 for training.
[INFO][09:26:35]: [Server #3536466] Sending the current model to client #76 (simulated).
[INFO][09:26:39]: [Server #3536466] Sending 507.38 MB of payload data to client #76 (simulated).
[INFO][09:26:39]: [Client #76] Selected by the server.
[INFO][09:26:39]: [Client #76] Loading its data source...
[INFO][09:26:39]: [Client #76] Dataset size: 2018
[INFO][09:26:39]: [Client #76] Sampler: iid
[INFO][09:26:40]: [Client #76] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:26:40]: [Client #76] Start to process inbound data.
[INFO][09:26:40]: [93m[1m[Client #76] Started training in communication round #21.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:55,  3.74s/it]  4%|▍         | 2/48 [00:04<01:23,  1.82s/it]  6%|▋         | 3/48 [00:04<00:54,  1.21s/it]  8%|▊         | 4/48 [00:05<00:40,  1.09it/s] 10%|█         | 5/48 [00:05<00:32,  1.32it/s] 12%|█▎        | 6/48 [00:06<00:27,  1.51it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.66it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.78it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.87it/s] 21%|██        | 10/48 [00:08<00:19,  1.94it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.98it/s] 25%|██▌       | 12/48 [00:08<00:17,  2.02it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.04it/s] 29%|██▉       | 14/48 [00:09<00:16,  2.06it/s] 31%|███▏      | 15/48 [00:10<00:15,  2.07it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.19it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.15it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.14it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.12it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.12it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.11it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.10it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.10it/s] 56%|█████▋    | 27/48 [00:16<00:09,  2.10it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.10it/s] 60%|██████    | 29/48 [00:17<00:09,  2.10it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:17<00:08,  2.10it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.21it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.17it/s] 71%|███████   | 34/48 [00:19<00:06,  2.15it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.13it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.12it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.12it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.11it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.11it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.10it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.10it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.10it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.09it/s]100%|██████████| 48/48 [00:25<00:00,  2.20it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:25<00:00,  2.20it/s]100%|██████████| 48/48 [00:25<00:00,  1.85it/s]
[INFO][09:27:12]: [Client #76] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_76_3536584.pth.
{'train_runtime': 25.9254, 'train_samples_per_second': 233.516, 'train_steps_per_second': 1.851, 'train_loss': 3.333611488342285, 'epoch': 3.0}
[INFO][09:27:12]: [Client #76] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_76_3536584.pth.
[INFO][09:27:13]: [Client #76] Model trained.
[INFO][09:27:13]: [Client #76] Inbound data has been processed.
[INFO][09:27:13]: [Client #76] Outbound data is ready to be sent after being processed.
[INFO][09:27:17]: [Client #76] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:27:18]: [Server #3536466] Received 507.38 MB of payload data from client #76 (simulated).
[INFO][09:27:18]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:27:18]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:27:18]: [Server #3536466] Adding client #20 to the list of clients for aggregation.
[INFO][09:27:18]: [Server #3536466] Adding client #93 to the list of clients for aggregation.
[INFO][09:27:18]: [Server #3536466] Adding client #76 to the list of clients for aggregation.
[INFO][09:27:18]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:27:18]: [Server #3536466] Updated weights have been received.
[INFO][09:27:19]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:27:19]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:27:19]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  1.9887e+00  1e+02  1e+00  1e+00
 1:  1.7852e+00  1.0087e+00  9e+00  8e-02  8e-02
 2:  1.9897e+00  1.1183e+00  9e-01  7e-04  7e-04
 3:  1.9918e+00  1.9325e+00  6e-02  5e-06  5e-06
 4:  1.9908e+00  1.9868e+00  4e-03  3e-07  3e-07
 5:  1.9893e+00  1.9874e+00  2e-03  5e-07  2e-07
 6:  1.9883e+00  1.9872e+00  1e-03  2e-06  1e-06
 7:  1.9879e+00  1.9875e+00  4e-04  1e-06  8e-07
 8:  1.9876e+00  1.9875e+00  7e-05  8e-07  4e-07
 9:  1.9875e+00  1.9875e+00  3e-06  5e-08  3e-08
10:  1.9875e+00  1.9875e+00  3e-08  6e-10  4e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  0.01 0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  1.1
 2.1  1.1  1.1  0.1  2.1  3.1  1.1  0.01 0.01 0.01 0.01 6.1  1.1  0.01
 0.01 0.01 6.1  2.1  0.01 0.01 0.01 0.01 1.1  1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 1.1  4.1  1.1  0.01 6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 0.01 1.1  0.01 3.1  5.1  3.1  0.01 3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  0.01 0.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 0.01 6.1  1.1  0.01 0.01 0.01 0.01 3.1  0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01
 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.50it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.53it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.03it/s]100%|██████████| 8/8 [00:00<00:00, 11.85it/s]
[INFO][09:27:29]: [93m[1m[Server #3536466] Global model perplexity: 30.29
[0m
[INFO][09:27:29]: [Server #3536466] All client reports have been processed.
[INFO][09:27:29]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_21.pth.
[INFO][09:27:32]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_21.pth.
[INFO][09:27:32]: [93m[1m
[Server #3536466] Starting round 22/100.[0m
[INFO][09:27:32]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([3.14616682e-05, 5.00649732e-06, 5.00649732e-06, 3.14616682e-05,
       3.14616682e-05, 5.00649732e-06, 3.14616682e-05, 5.00649732e-06,
       3.32768545e-01, 3.14616682e-05, 3.14616682e-05, 3.14616682e-05,
       3.32768545e-01, 5.00649732e-06, 7.34661549e-07, 5.00649732e-06,
       5.00649732e-06, 7.34661549e-07, 2.92596157e-07, 5.00649732e-06,
       3.14616682e-05, 3.14616682e-05, 3.14616682e-05, 3.14616682e-05,
       6.89030626e-08, 5.00649732e-06, 3.14616682e-05, 3.14616682e-05,
       6.89030626e-08, 7.34661549e-07, 3.14616682e-05, 3.14616682e-05,
       3.14616682e-05, 3.14616682e-05, 5.00649732e-06, 5.00649732e-06,
       3.14616682e-05, 3.14616682e-05, 5.00649732e-06, 3.14616682e-05,
       3.14616682e-05, 3.14616682e-05, 5.00649732e-06, 1.58640220e-07,
       5.00649732e-06, 3.14616682e-05, 6.89030626e-08, 3.14616682e-05,
       3.14616682e-05, 3.14616682e-05, 3.14616682e-05, 5.00649732e-06,
       3.14616682e-05, 5.00649732e-06, 3.14616682e-05, 3.14616682e-05,
       3.14616682e-05, 5.00649732e-06, 3.14616682e-05, 2.92596157e-07,
       9.99640933e-08, 2.92596157e-07, 3.14616682e-05, 2.92596157e-07,
       3.14616682e-05, 5.00649732e-06, 3.14616682e-05, 3.14616682e-05,
       2.92596157e-07, 6.89030626e-08, 5.00649732e-06, 3.32768545e-01,
       3.14616682e-05, 5.00649732e-06, 7.34661549e-07, 3.14616682e-05,
       3.14616682e-05, 7.34661549e-07, 3.14616682e-05, 5.00649732e-06,
       3.14616682e-05, 3.14616682e-05, 6.89030626e-08, 5.00649732e-06,
       3.14616682e-05, 3.14616682e-05, 3.14616682e-05, 2.92596157e-07,
       3.14616682e-05, 3.14616682e-05, 3.14616682e-05, 3.14616682e-05,
       3.14616682e-05, 9.99640933e-08, 5.00649732e-06]),)
[INFO][09:27:32]: [Server #3536466] Selected clients: [13 76  9 91  4]
[INFO][09:27:32]: [Server #3536466] Selecting client #4 for training.
[INFO][09:27:32]: [Server #3536466] Sending the current model to client #4 (simulated).
[INFO][09:27:36]: [Server #3536466] Sending 507.38 MB of payload data to client #4 (simulated).
[INFO][09:27:36]: [Server #3536466] Selecting client #9 for training.
[INFO][09:27:36]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:27:40]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:27:40]: [Client #4] Selected by the server.
[INFO][09:27:40]: [Client #4] Loading its data source...
[INFO][09:27:40]: [Client #4] Dataset size: 2018
[INFO][09:27:40]: [Client #4] Sampler: iid
[INFO][09:27:40]: [Client #9] Selected by the server.
[INFO][09:27:40]: [Client #9] Loading its data source...
[INFO][09:27:40]: [Client #9] Dataset size: 2018
[INFO][09:27:40]: [Client #9] Sampler: iid
[INFO][09:27:41]: [Client #4] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:27:41]: [Client #4] Start to process inbound data.
[INFO][09:27:41]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:27:41]: [Client #9] Start to process inbound data.
[INFO][09:27:42]: [93m[1m[Client #4] Started training in communication round #22.[0m
[INFO][09:27:42]: [93m[1m[Client #9] Started training in communication round #22.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:34,  4.57s/it]  2%|▏         | 1/48 [00:04<03:41,  4.72s/it]  4%|▍         | 2/48 [00:05<01:46,  2.32s/it]  4%|▍         | 2/48 [00:05<01:48,  2.36s/it]  6%|▋         | 3/48 [00:06<01:12,  1.61s/it]  6%|▋         | 3/48 [00:06<01:13,  1.62s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it] 10%|█         | 5/48 [00:07<00:46,  1.07s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][09:28:27]: [Client #4] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_4_3536584.pth.
{'train_runtime': 39.3882, 'train_samples_per_second': 153.701, 'train_steps_per_second': 1.219, 'train_loss': 3.4812234242757163, 'epoch': 3.0}
[INFO][09:28:27]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.4758, 'train_samples_per_second': 153.36, 'train_steps_per_second': 1.216, 'train_loss': 3.1045004526774087, 'epoch': 3.0}
[INFO][09:28:28]: [Client #4] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_4_3536584.pth.
[INFO][09:28:29]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][09:28:29]: [Client #4] Model trained.
[INFO][09:28:29]: [Client #4] Inbound data has been processed.
[INFO][09:28:29]: [Client #4] Outbound data is ready to be sent after being processed.
[INFO][09:28:29]: [Client #9] Model trained.
[INFO][09:28:29]: [Client #9] Inbound data has been processed.
[INFO][09:28:29]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:28:35]: [Client #4] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:28:36]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:28:36]: [Server #3536466] Received 507.38 MB of payload data from client #4 (simulated).
[INFO][09:28:37]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:28:37]: [Server #3536466] Selecting client #76 for training.
[INFO][09:28:37]: [Server #3536466] Sending the current model to client #76 (simulated).
[INFO][09:28:41]: [Server #3536466] Sending 507.38 MB of payload data to client #76 (simulated).
[INFO][09:28:41]: [Server #3536466] Selecting client #91 for training.
[INFO][09:28:41]: [Server #3536466] Sending the current model to client #91 (simulated).
[INFO][09:28:45]: [Server #3536466] Sending 507.38 MB of payload data to client #91 (simulated).
[INFO][09:28:45]: [Client #91] Selected by the server.
[INFO][09:28:45]: [Client #91] Loading its data source...
[INFO][09:28:45]: [Client #91] Dataset size: 2018
[INFO][09:28:45]: [Client #91] Sampler: iid
[INFO][09:28:45]: [Client #76] Selected by the server.
[INFO][09:28:45]: [Client #76] Loading its data source...
[INFO][09:28:45]: [Client #76] Dataset size: 2018
[INFO][09:28:45]: [Client #76] Sampler: iid
[INFO][09:28:46]: [Client #76] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:28:46]: [Client #76] Start to process inbound data.
[INFO][09:28:46]: [Client #91] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:28:46]: [Client #91] Start to process inbound data.
[INFO][09:28:46]: [93m[1m[Client #76] Started training in communication round #22.[0m
[INFO][09:28:47]: [93m[1m[Client #91] Started training in communication round #22.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:42,  4.74s/it]  2%|▏         | 1/48 [00:04<03:46,  4.81s/it]  4%|▍         | 2/48 [00:05<01:50,  2.39s/it]  4%|▍         | 2/48 [00:05<01:51,  2.41s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][09:29:32]: [Client #91] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_91_3536585.pth.
{'train_runtime': 39.5772, 'train_samples_per_second': 152.967, 'train_steps_per_second': 1.213, 'train_loss': 3.3978589375813804, 'epoch': 3.0}
[INFO][09:29:32]: [Client #76] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_76_3536584.pth.
{'train_runtime': 39.5974, 'train_samples_per_second': 152.889, 'train_steps_per_second': 1.212, 'train_loss': 3.300609270731608, 'epoch': 3.0}
[INFO][09:29:33]: [Client #91] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_91_3536585.pth.
[INFO][09:29:33]: [Client #76] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_76_3536584.pth.
[INFO][09:29:34]: [Client #91] Model trained.
[INFO][09:29:34]: [Client #91] Inbound data has been processed.
[INFO][09:29:34]: [Client #91] Outbound data is ready to be sent after being processed.
[INFO][09:29:34]: [Client #76] Model trained.
[INFO][09:29:34]: [Client #76] Inbound data has been processed.
[INFO][09:29:34]: [Client #76] Outbound data is ready to be sent after being processed.
[INFO][09:29:40]: [Client #76] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:29:41]: [Client #91] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:29:41]: [Server #3536466] Received 507.38 MB of payload data from client #76 (simulated).
[INFO][09:29:42]: [Server #3536466] Received 507.38 MB of payload data from client #91 (simulated).
[INFO][09:29:42]: [Server #3536466] Selecting client #13 for training.
[INFO][09:29:42]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:29:46]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:29:46]: [Client #13] Selected by the server.
[INFO][09:29:46]: [Client #13] Loading its data source...
[INFO][09:29:46]: [Client #13] Dataset size: 2018
[INFO][09:29:46]: [Client #13] Sampler: iid
[INFO][09:29:47]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:29:47]: [Client #13] Start to process inbound data.
[INFO][09:29:47]: [93m[1m[Client #13] Started training in communication round #22.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:03<02:59,  3.82s/it]  4%|▍         | 2/48 [00:04<01:25,  1.85s/it]  6%|▋         | 3/48 [00:04<00:55,  1.23s/it]  8%|▊         | 4/48 [00:05<00:40,  1.08it/s] 10%|█         | 5/48 [00:05<00:32,  1.31it/s] 12%|█▎        | 6/48 [00:06<00:28,  1.50it/s] 15%|█▍        | 7/48 [00:06<00:24,  1.65it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.77it/s] 19%|█▉        | 9/48 [00:07<00:20,  1.86it/s] 21%|██        | 10/48 [00:08<00:19,  1.92it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.97it/s] 25%|██▌       | 12/48 [00:09<00:17,  2.00it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.03it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.05it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.06it/s] 33%|███▎      | 16/48 [00:10<00:14,  2.18it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.15it/s] 38%|███▊      | 18/48 [00:11<00:14,  2.13it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.12it/s] 42%|████▏     | 20/48 [00:12<00:13,  2.11it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:13<00:12,  2.10it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:14<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.09it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.09it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.09it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.09it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.09it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.19it/s] 69%|██████▉   | 33/48 [00:18<00:06,  2.16it/s] 71%|███████   | 34/48 [00:19<00:06,  2.13it/s] 73%|███████▎  | 35/48 [00:19<00:06,  2.12it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.11it/s] 77%|███████▋  | 37/48 [00:20<00:05,  2.11it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:21<00:04,  2.09it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.09it/s] 85%|████████▌ | 41/48 [00:22<00:03,  2.09it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:23<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.08it/s] 94%|█████████▍| 45/48 [00:24<00:01,  2.08it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.08it/s] 98%|█████████▊| 47/48 [00:25<00:00,  2.08it/s]100%|██████████| 48/48 [00:26<00:00,  2.19it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.19it/s]100%|██████████| 48/48 [00:26<00:00,  1.84it/s]
[INFO][09:30:19]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
{'train_runtime': 26.1043, 'train_samples_per_second': 231.916, 'train_steps_per_second': 1.839, 'train_loss': 3.1167122522989907, 'epoch': 3.0}
[INFO][09:30:20]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
[INFO][09:30:21]: [Client #13] Model trained.
[INFO][09:30:21]: [Client #13] Inbound data has been processed.
[INFO][09:30:21]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:30:25]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:30:25]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:30:25]: [Server #3536466] Adding client #18 to the list of clients for aggregation.
[INFO][09:30:25]: [Server #3536466] Adding client #75 to the list of clients for aggregation.
[INFO][09:30:25]: [Server #3536466] Adding client #92 to the list of clients for aggregation.
[INFO][09:30:25]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:30:25]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:30:25]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:30:25]: [Server #3536466] Updated weights have been received.
[INFO][09:30:27]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:30:27]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:30:27]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.0413e+00  1e+02  1e+00  1e+00
 1:  1.8470e+00  1.0614e+00  8e+00  8e-02  8e-02
 2:  2.0428e+00  1.1766e+00  9e-01  7e-04  6e-04
 3:  2.0446e+00  1.9891e+00  6e-02  5e-06  4e-06
 4:  2.0436e+00  2.0395e+00  4e-03  4e-07  3e-07
 5:  2.0417e+00  2.0400e+00  2e-03  6e-07  2e-07
 6:  2.0410e+00  2.0400e+00  1e-03  3e-06  2e-06
 7:  2.0406e+00  2.0402e+00  5e-04  2e-06  1e-06
 8:  2.0402e+00  2.0402e+00  4e-05  1e-06  7e-07
 9:  2.0402e+00  2.0402e+00  2e-06  7e-08  4e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  0.01 0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  0.01 0.01 0.01 0.01 6.1  1.1  0.01
 0.01 0.01 6.1  2.1  0.01 0.01 0.01 0.01 1.1  1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 1.1  4.1  1.1  0.01 6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 0.01 1.1  0.01 3.1  5.1  3.1  0.01 3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  3.1  0.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 0.01 6.1  1.1  0.01 0.01 0.01 3.1  3.1  0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01
 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.86it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.35it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.78it/s]100%|██████████| 8/8 [00:00<00:00, 11.59it/s]
[INFO][09:30:38]: [93m[1m[Server #3536466] Global model perplexity: 30.19
[0m
[INFO][09:30:38]: [Server #3536466] All client reports have been processed.
[INFO][09:30:38]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_22.pth.
[INFO][09:30:41]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_22.pth.
[INFO][09:30:41]: [93m[1m
[Server #3536466] Starting round 23/100.[0m
[INFO][09:30:41]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.40180859e-05, 3.16458199e-06, 3.16458199e-06, 2.40180859e-05,
       3.16458199e-06, 2.40180859e-05, 3.16458199e-06, 4.99383247e-01,
       2.40180859e-05, 2.40180859e-05, 2.40180859e-05, 4.99383247e-01,
       3.16458199e-06, 5.03191121e-07, 3.16458199e-06, 3.16458199e-06,
       3.16458199e-06, 5.03191121e-07, 2.07614842e-07, 3.16458199e-06,
       2.40180859e-05, 2.40180859e-05, 2.40180859e-05, 2.40180859e-05,
       5.02109225e-08, 3.16458199e-06, 2.40180859e-05, 2.40180859e-05,
       5.02109225e-08, 5.03191121e-07, 2.40180859e-05, 2.40180859e-05,
       2.40180859e-05, 2.40180859e-05, 3.16458199e-06, 3.16458199e-06,
       2.40180859e-05, 2.40180859e-05, 3.16458199e-06, 2.40180859e-05,
       2.40180859e-05, 2.40180859e-05, 3.16458199e-06, 1.14248957e-07,
       3.16458199e-06, 2.40180859e-05, 5.02109225e-08, 2.40180859e-05,
       2.40180859e-05, 2.40180859e-05, 2.40180859e-05, 3.16458199e-06,
       2.40180859e-05, 3.16458199e-06, 2.40180859e-05, 2.40180859e-05,
       2.40180859e-05, 3.16458199e-06, 2.40180859e-05, 2.07614842e-07,
       7.25333291e-08, 2.07614842e-07, 2.40180859e-05, 2.07614842e-07,
       2.40180859e-05, 3.16458199e-06, 2.40180859e-05, 2.40180859e-05,
       2.07614842e-07, 5.02109225e-08, 3.16458199e-06, 2.07614842e-07,
       2.40180859e-05, 3.16458199e-06, 5.03191121e-07, 2.40180859e-05,
       2.40180859e-05, 5.03191121e-07, 2.40180859e-05, 3.16458199e-06,
       2.40180859e-05, 2.40180859e-05, 5.02109225e-08, 3.16458199e-06,
       2.40180859e-05, 2.40180859e-05, 2.07614842e-07, 2.07614842e-07,
       2.40180859e-05, 2.40180859e-05, 2.40180859e-05, 2.40180859e-05,
       2.40180859e-05, 7.25333291e-08, 3.16458199e-06]),)
[INFO][09:30:41]: [Server #3536466] Selected clients: [13  9 49 60 34]
[INFO][09:30:41]: [Server #3536466] Selecting client #34 for training.
[INFO][09:30:41]: [Server #3536466] Sending the current model to client #34 (simulated).
[INFO][09:30:45]: [Server #3536466] Sending 507.38 MB of payload data to client #34 (simulated).
[INFO][09:30:45]: [Server #3536466] Selecting client #49 for training.
[INFO][09:30:45]: [Server #3536466] Sending the current model to client #49 (simulated).
[INFO][09:30:49]: [Server #3536466] Sending 507.38 MB of payload data to client #49 (simulated).
[INFO][09:30:49]: [Client #34] Selected by the server.
[INFO][09:30:49]: [Client #34] Loading its data source...
[INFO][09:30:49]: [Client #49] Selected by the server.
[INFO][09:30:49]: [Client #34] Dataset size: 2018
[INFO][09:30:49]: [Client #34] Sampler: iid
[INFO][09:30:49]: [Client #49] Loading its data source...
[INFO][09:30:49]: [Client #49] Dataset size: 2018
[INFO][09:30:49]: [Client #49] Sampler: iid
[INFO][09:30:50]: [Client #34] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:30:50]: [Client #34] Start to process inbound data.
[INFO][09:30:50]: [Client #49] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:30:50]: [Client #49] Start to process inbound data.
[INFO][09:30:51]: [93m[1m[Client #49] Started training in communication round #23.[0m
[INFO][09:30:51]: [93m[1m[Client #34] Started training in communication round #23.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:48,  4.86s/it]  2%|▏         | 1/48 [00:04<03:51,  4.92s/it]  4%|▍         | 2/48 [00:05<01:52,  2.44s/it]  4%|▍         | 2/48 [00:05<01:54,  2.48s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  6%|▋         | 3/48 [00:06<01:15,  1.69s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it]  8%|▊         | 4/48 [00:07<00:57,  1.31s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:21,  1.33it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:16,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.35it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 71%|███████   | 34/48 [00:29<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.35it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.35it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s]100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][09:31:37]: [Client #34] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_34_3536584.pth.
{'train_runtime': 39.5147, 'train_samples_per_second': 153.209, 'train_steps_per_second': 1.215, 'train_loss': 3.4712117513020835, 'epoch': 3.0}
[INFO][09:31:37]: [Client #49] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_49_3536585.pth.
{'train_runtime': 39.614, 'train_samples_per_second': 152.825, 'train_steps_per_second': 1.212, 'train_loss': 3.4059953689575195, 'epoch': 3.0}
[INFO][09:31:38]: [Client #34] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_34_3536584.pth.
[INFO][09:31:38]: [Client #49] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_49_3536585.pth.
[INFO][09:31:38]: [Client #34] Model trained.
[INFO][09:31:38]: [Client #34] Inbound data has been processed.
[INFO][09:31:38]: [Client #34] Outbound data is ready to be sent after being processed.
[INFO][09:31:39]: [Client #49] Model trained.
[INFO][09:31:39]: [Client #49] Inbound data has been processed.
[INFO][09:31:39]: [Client #49] Outbound data is ready to be sent after being processed.
[INFO][09:31:45]: [Client #34] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:31:45]: [Client #49] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:31:46]: [Server #3536466] Received 507.38 MB of payload data from client #34 (simulated).
[INFO][09:31:47]: [Server #3536466] Received 507.38 MB of payload data from client #49 (simulated).
[INFO][09:31:47]: [Server #3536466] Selecting client #60 for training.
[INFO][09:31:47]: [Server #3536466] Sending the current model to client #60 (simulated).
[INFO][09:31:50]: [Server #3536466] Sending 507.38 MB of payload data to client #60 (simulated).
[INFO][09:31:50]: [Server #3536466] Selecting client #9 for training.
[INFO][09:31:50]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:31:54]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:31:54]: [Client #60] Selected by the server.
[INFO][09:31:54]: [Client #60] Loading its data source...
[INFO][09:31:54]: [Client #60] Dataset size: 2018
[INFO][09:31:54]: [Client #60] Sampler: iid
[INFO][09:31:54]: [Client #9] Selected by the server.
[INFO][09:31:54]: [Client #9] Loading its data source...
[INFO][09:31:54]: [Client #9] Dataset size: 2018
[INFO][09:31:54]: [Client #9] Sampler: iid
[INFO][09:31:55]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:31:55]: [Client #9] Start to process inbound data.
[INFO][09:31:55]: [Client #60] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:31:55]: [Client #60] Start to process inbound data.
[INFO][09:31:56]: [93m[1m[Client #60] Started training in communication round #23.[0m
[INFO][09:31:56]: [93m[1m[Client #9] Started training in communication round #23.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:45,  4.79s/it]  2%|▏         | 1/48 [00:05<04:10,  5.34s/it]  4%|▍         | 2/48 [00:05<01:55,  2.51s/it]  4%|▍         | 2/48 [00:06<02:10,  2.83s/it]  6%|▋         | 3/48 [00:06<01:23,  1.86s/it]  6%|▋         | 3/48 [00:07<01:31,  2.03s/it]  8%|▊         | 4/48 [00:07<01:08,  1.55s/it]  8%|▊         | 4/48 [00:08<01:12,  1.66s/it] 10%|█         | 5/48 [00:08<00:59,  1.38s/it] 10%|█         | 5/48 [00:09<01:00,  1.41s/it] 12%|█▎        | 6/48 [00:09<00:53,  1.27s/it] 12%|█▎        | 6/48 [00:10<00:51,  1.23s/it] 15%|█▍        | 7/48 [00:10<00:46,  1.13s/it] 15%|█▍        | 7/48 [00:11<00:45,  1.11s/it] 17%|█▋        | 8/48 [00:11<00:42,  1.06s/it] 17%|█▋        | 8/48 [00:12<00:42,  1.05s/it] 19%|█▉        | 9/48 [00:12<00:39,  1.01s/it] 19%|█▉        | 9/48 [00:13<00:39,  1.01s/it] 21%|██        | 10/48 [00:13<00:37,  1.03it/s] 21%|██        | 10/48 [00:14<00:37,  1.02it/s] 23%|██▎       | 11/48 [00:14<00:35,  1.05it/s] 23%|██▎       | 11/48 [00:14<00:35,  1.06it/s] 25%|██▌       | 12/48 [00:15<00:34,  1.04it/s] 25%|██▌       | 12/48 [00:15<00:33,  1.06it/s] 27%|██▋       | 13/48 [00:16<00:32,  1.08it/s] 27%|██▋       | 13/48 [00:16<00:32,  1.08it/s] 29%|██▉       | 14/48 [00:17<00:31,  1.08it/s] 29%|██▉       | 14/48 [00:17<00:30,  1.10it/s] 31%|███▏      | 15/48 [00:18<00:30,  1.08it/s] 31%|███▏      | 15/48 [00:18<00:31,  1.05it/s] 33%|███▎      | 16/48 [00:18<00:28,  1.11it/s] 33%|███▎      | 16/48 [00:19<00:27,  1.16it/s] 35%|███▌      | 17/48 [00:19<00:27,  1.11it/s] 35%|███▌      | 17/48 [00:20<00:27,  1.11it/s] 38%|███▊      | 18/48 [00:20<00:26,  1.12it/s] 38%|███▊      | 18/48 [00:21<00:26,  1.13it/s] 40%|███▉      | 19/48 [00:21<00:25,  1.13it/s] 40%|███▉      | 19/48 [00:22<00:25,  1.13it/s] 42%|████▏     | 20/48 [00:22<00:25,  1.10it/s] 42%|████▏     | 20/48 [00:22<00:24,  1.12it/s] 44%|████▍     | 21/48 [00:23<00:24,  1.08it/s] 44%|████▍     | 21/48 [00:23<00:24,  1.10it/s] 46%|████▌     | 22/48 [00:24<00:24,  1.07it/s] 46%|████▌     | 22/48 [00:24<00:24,  1.08it/s] 48%|████▊     | 23/48 [00:25<00:23,  1.09it/s] 48%|████▊     | 23/48 [00:25<00:22,  1.09it/s] 50%|█████     | 24/48 [00:26<00:21,  1.11it/s] 50%|█████     | 24/48 [00:26<00:22,  1.08it/s] 52%|█████▏    | 25/48 [00:27<00:21,  1.07it/s] 52%|█████▏    | 25/48 [00:27<00:21,  1.08it/s] 54%|█████▍    | 26/48 [00:28<00:20,  1.09it/s] 54%|█████▍    | 26/48 [00:28<00:20,  1.08it/s] 56%|█████▋    | 27/48 [00:29<00:19,  1.10it/s] 56%|█████▋    | 27/48 [00:29<00:19,  1.07it/s] 58%|█████▊    | 28/48 [00:30<00:18,  1.06it/s] 58%|█████▊    | 28/48 [00:30<00:18,  1.08it/s] 60%|██████    | 29/48 [00:30<00:17,  1.06it/s] 60%|██████    | 29/48 [00:31<00:18,  1.04it/s] 62%|██████▎   | 30/48 [00:31<00:17,  1.04it/s] 62%|██████▎   | 30/48 [00:32<00:16,  1.07it/s] 65%|██████▍   | 31/48 [00:32<00:16,  1.04it/s] 65%|██████▍   | 31/48 [00:33<00:16,  1.01it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.08it/s] 67%|██████▋   | 32/48 [00:34<00:14,  1.12it/s] 69%|██████▉   | 33/48 [00:34<00:13,  1.09it/s] 69%|██████▉   | 33/48 [00:35<00:13,  1.11it/s] 71%|███████   | 34/48 [00:35<00:12,  1.09it/s] 71%|███████   | 34/48 [00:35<00:12,  1.10it/s] 73%|███████▎  | 35/48 [00:36<00:11,  1.11it/s] 73%|███████▎  | 35/48 [00:36<00:11,  1.10it/s] 75%|███████▌  | 36/48 [00:37<00:10,  1.12it/s] 75%|███████▌  | 36/48 [00:37<00:10,  1.11it/s] 77%|███████▋  | 37/48 [00:38<00:09,  1.11it/s] 77%|███████▋  | 37/48 [00:38<00:09,  1.11it/s] 79%|███████▉  | 38/48 [00:39<00:08,  1.12it/s] 79%|███████▉  | 38/48 [00:39<00:09,  1.10it/s] 81%|████████▏ | 39/48 [00:40<00:08,  1.11it/s] 81%|████████▏ | 39/48 [00:40<00:08,  1.07it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.10it/s] 83%|████████▎ | 40/48 [00:41<00:07,  1.09it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.10it/s] 85%|████████▌ | 41/48 [00:42<00:06,  1.11it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.08it/s] 88%|████████▊ | 42/48 [00:43<00:05,  1.11it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.08it/s] 90%|████████▉ | 43/48 [00:44<00:04,  1.10it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.08it/s] 92%|█████████▏| 44/48 [00:45<00:03,  1.06it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.06it/s] 94%|█████████▍| 45/48 [00:46<00:02,  1.07it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.05it/s] 96%|█████████▌| 46/48 [00:47<00:01,  1.04it/s] 98%|█████████▊| 47/48 [00:47<00:00,  1.07it/s] 98%|█████████▊| 47/48 [00:48<00:00,  1.00it/s]100%|██████████| 48/48 [00:48<00:00,  1.06it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:48<00:00,  1.06it/s]100%|██████████| 48/48 [00:48<00:00,  1.01s/it]
100%|██████████| 48/48 [00:48<00:00,  1.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:48<00:00,  1.17it/s]100%|██████████| 48/48 [00:48<00:00,  1.02s/it]
[INFO][09:32:51]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 48.7469, 'train_samples_per_second': 124.192, 'train_steps_per_second': 0.985, 'train_loss': 3.0665035247802734, 'epoch': 3.0}
[INFO][09:32:51]: [Client #60] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
{'train_runtime': 48.5278, 'train_samples_per_second': 124.753, 'train_steps_per_second': 0.989, 'train_loss': 3.4520486195882163, 'epoch': 3.0}
[INFO][09:32:52]: [Client #60] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
[INFO][09:32:53]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][09:32:53]: [Client #60] Model trained.
[INFO][09:32:53]: [Client #60] Inbound data has been processed.
[INFO][09:32:53]: [Client #60] Outbound data is ready to be sent after being processed.
[INFO][09:32:53]: [Client #9] Model trained.
[INFO][09:32:53]: [Client #9] Inbound data has been processed.
[INFO][09:32:53]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:33:00]: [Client #60] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:33:00]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:33:01]: [Server #3536466] Received 507.38 MB of payload data from client #60 (simulated).
[INFO][09:33:02]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:33:02]: [Server #3536466] Selecting client #13 for training.
[INFO][09:33:02]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:33:06]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:33:06]: [Client #13] Selected by the server.
[INFO][09:33:06]: [Client #13] Loading its data source...
[INFO][09:33:06]: [Client #13] Dataset size: 2018
[INFO][09:33:06]: [Client #13] Sampler: iid
[INFO][09:33:07]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:33:07]: [Client #13] Start to process inbound data.
[INFO][09:33:07]: [93m[1m[Client #13] Started training in communication round #23.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:20,  4.26s/it]  4%|▍         | 2/48 [00:04<01:33,  2.04s/it]  6%|▋         | 3/48 [00:05<00:59,  1.33s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.91it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.95it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.98it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.00it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.14it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.12it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.09it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.07it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.11it/s] 71%|███████   | 34/48 [00:20<00:06,  2.10it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.08it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.08it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][09:33:40]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
{'train_runtime': 26.8023, 'train_samples_per_second': 225.876, 'train_steps_per_second': 1.791, 'train_loss': 3.079524040222168, 'epoch': 3.0}
[INFO][09:33:41]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
[INFO][09:33:42]: [Client #13] Model trained.
[INFO][09:33:42]: [Client #13] Inbound data has been processed.
[INFO][09:33:42]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:33:46]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:33:47]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:33:47]: [Server #3536466] Adding client #76 to the list of clients for aggregation.
[INFO][09:33:47]: [Server #3536466] Adding client #91 to the list of clients for aggregation.
[INFO][09:33:47]: [Server #3536466] Adding client #4 to the list of clients for aggregation.
[INFO][09:33:47]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:33:47]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:33:47]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:33:47]: [Server #3536466] Updated weights have been received.
[INFO][09:33:48]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:33:48]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:33:48]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.0954e+00  1e+02  1e+00  1e+00
 1:  1.9102e+00  1.1156e+00  8e+00  7e-02  7e-02
 2:  2.0974e+00  1.2368e+00  9e-01  6e-04  6e-04
 3:  2.0991e+00  2.0473e+00  5e-02  4e-06  4e-06
 4:  2.0980e+00  2.0937e+00  4e-03  4e-07  4e-07
 5:  2.0960e+00  2.0941e+00  2e-03  5e-07  2e-07
 6:  2.0957e+00  2.0943e+00  1e-03  6e-07  3e-07
 7:  2.0950e+00  2.0944e+00  6e-04  4e-06  3e-06
 8:  2.0947e+00  2.0944e+00  3e-04  2e-06  2e-06
 9:  2.0945e+00  2.0945e+00  3e-05  8e-07  6e-07
10:  2.0945e+00  2.0945e+00  1e-06  4e-08  3e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  1.1  0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  0.01 0.01 0.01 0.01 6.1  1.1  0.01
 0.01 0.01 6.1  2.1  0.01 0.01 0.01 0.01 1.1  1.1  0.01 0.01 0.01 1.1
 0.01 0.01 0.01 1.1  4.1  1.1  0.01 6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 0.01 1.1  0.01 3.1  5.1  3.1  0.01 3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 0.01 6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01
 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.01 0.2
 0.01 0.01 0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.01 0.2  0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.41it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.33it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.85it/s]100%|██████████| 8/8 [00:00<00:00, 11.59it/s]
[INFO][09:33:59]: [93m[1m[Server #3536466] Global model perplexity: 29.24
[0m
[INFO][09:34:00]: [Server #3536466] All client reports have been processed.
[INFO][09:34:00]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_23.pth.
[INFO][09:34:02]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_23.pth.
[INFO][09:34:02]: [93m[1m
[Server #3536466] Starting round 24/100.[0m
[INFO][09:34:02]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.67502484e-05, 3.52122251e-06, 3.52122251e-06, 3.52122251e-06,
       2.67502484e-05, 3.52122251e-06, 2.67502484e-05, 3.52122251e-06,
       4.99347984e-01, 2.67502484e-05, 2.67502484e-05, 2.67502484e-05,
       4.99347984e-01, 3.52122251e-06, 5.58119131e-07, 3.52122251e-06,
       3.52122251e-06, 3.52122251e-06, 5.58119131e-07, 2.30123413e-07,
       3.52122251e-06, 2.67502484e-05, 2.67502484e-05, 2.67502484e-05,
       2.67502484e-05, 5.56289184e-08, 3.52122251e-06, 2.67502484e-05,
       2.67502484e-05, 5.56289184e-08, 5.58119131e-07, 2.67502484e-05,
       2.67502484e-05, 2.67502484e-05, 3.52122251e-06, 3.52122251e-06,
       2.67502484e-05, 2.67502484e-05, 3.52122251e-06, 2.67502484e-05,
       2.67502484e-05, 2.67502484e-05, 3.52122251e-06, 1.26603010e-07,
       3.52122251e-06, 5.56289184e-08, 2.67502484e-05, 2.67502484e-05,
       2.67502484e-05, 2.67502484e-05, 3.52122251e-06, 2.67502484e-05,
       3.52122251e-06, 2.67502484e-05, 2.67502484e-05, 3.52122251e-06,
       2.67502484e-05, 2.30123413e-07, 8.03661765e-08, 2.30123413e-07,
       2.67502484e-05, 2.30123413e-07, 2.67502484e-05, 3.52122251e-06,
       2.67502484e-05, 2.67502484e-05, 2.30123413e-07, 5.56289184e-08,
       3.52122251e-06, 2.30123413e-07, 3.52122251e-06, 2.67502484e-05,
       3.52122251e-06, 5.58119131e-07, 2.67502484e-05, 2.67502484e-05,
       5.58119131e-07, 2.67502484e-05, 3.52122251e-06, 2.67502484e-05,
       2.67502484e-05, 5.56289184e-08, 3.52122251e-06, 2.67502484e-05,
       2.67502484e-05, 3.52122251e-06, 2.30123413e-07, 2.30123413e-07,
       2.67502484e-05, 2.67502484e-05, 2.67502484e-05, 2.67502484e-05,
       2.67502484e-05, 8.03661765e-08, 3.52122251e-06]),)
[INFO][09:34:02]: [Server #3536466] Selected clients: [ 9 13 44 28 41]
[INFO][09:34:02]: [Server #3536466] Selecting client #28 for training.
[INFO][09:34:02]: [Server #3536466] Sending the current model to client #28 (simulated).
[INFO][09:34:07]: [Server #3536466] Sending 507.38 MB of payload data to client #28 (simulated).
[INFO][09:34:07]: [Server #3536466] Selecting client #9 for training.
[INFO][09:34:07]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:34:10]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:34:10]: [Client #9] Selected by the server.
[INFO][09:34:10]: [Client #9] Loading its data source...
[INFO][09:34:10]: [Client #9] Dataset size: 2018
[INFO][09:34:10]: [Client #9] Sampler: iid
[INFO][09:34:10]: [Client #28] Selected by the server.
[INFO][09:34:10]: [Client #28] Loading its data source...
[INFO][09:34:10]: [Client #28] Dataset size: 2018
[INFO][09:34:10]: [Client #28] Sampler: iid
[INFO][09:34:12]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:34:12]: [Client #9] Start to process inbound data.
[INFO][09:34:12]: [Client #28] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:34:12]: [Client #28] Start to process inbound data.
[INFO][09:34:13]: [93m[1m[Client #9] Started training in communication round #24.[0m
[INFO][09:34:13]: [93m[1m[Client #28] Started training in communication round #24.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:21,  4.29s/it]  2%|▏         | 1/48 [00:04<03:49,  4.88s/it]  4%|▍         | 2/48 [00:04<01:40,  2.18s/it]  4%|▍         | 2/48 [00:05<01:52,  2.46s/it]  6%|▋         | 3/48 [00:05<01:07,  1.51s/it]  6%|▋         | 3/48 [00:06<01:15,  1.67s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:07<00:58,  1.32s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.33it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.32it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.31it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][09:34:59]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.2229, 'train_samples_per_second': 154.349, 'train_steps_per_second': 1.224, 'train_loss': 2.9805002212524414, 'epoch': 3.0}
[INFO][09:34:59]: [Client #28] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_28_3536584.pth.
{'train_runtime': 39.6657, 'train_samples_per_second': 152.626, 'train_steps_per_second': 1.21, 'train_loss': 3.4339011510213218, 'epoch': 3.0}
[INFO][09:35:00]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][09:35:00]: [Client #28] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_28_3536584.pth.
[INFO][09:35:00]: [Client #9] Model trained.
[INFO][09:35:00]: [Client #9] Inbound data has been processed.
[INFO][09:35:00]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:35:01]: [Client #28] Model trained.
[INFO][09:35:01]: [Client #28] Inbound data has been processed.
[INFO][09:35:01]: [Client #28] Outbound data is ready to be sent after being processed.
[INFO][09:35:07]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:35:08]: [Client #28] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:35:08]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:35:09]: [Server #3536466] Received 507.38 MB of payload data from client #28 (simulated).
[INFO][09:35:09]: [Server #3536466] Selecting client #44 for training.
[INFO][09:35:09]: [Server #3536466] Sending the current model to client #44 (simulated).
[INFO][09:35:13]: [Server #3536466] Sending 507.38 MB of payload data to client #44 (simulated).
[INFO][09:35:13]: [Server #3536466] Selecting client #13 for training.
[INFO][09:35:13]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:35:16]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:35:16]: [Client #44] Selected by the server.
[INFO][09:35:16]: [Client #13] Selected by the server.
[INFO][09:35:16]: [Client #44] Loading its data source...
[INFO][09:35:16]: [Client #13] Loading its data source...
[INFO][09:35:16]: [Client #44] Dataset size: 2018
[INFO][09:35:16]: [Client #13] Dataset size: 2018
[INFO][09:35:16]: [Client #44] Sampler: iid
[INFO][09:35:16]: [Client #13] Sampler: iid
[INFO][09:35:18]: [Client #44] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:35:18]: [Client #44] Start to process inbound data.
[INFO][09:35:18]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:35:18]: [Client #13] Start to process inbound data.
[INFO][09:35:19]: [93m[1m[Client #44] Started training in communication round #24.[0m
[INFO][09:35:19]: [93m[1m[Client #13] Started training in communication round #24.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:53,  4.98s/it]  2%|▏         | 1/48 [00:05<03:55,  5.00s/it]  4%|▍         | 2/48 [00:05<01:58,  2.58s/it]  4%|▍         | 2/48 [00:05<01:59,  2.60s/it]  6%|▋         | 3/48 [00:06<01:18,  1.75s/it]  6%|▋         | 3/48 [00:06<01:20,  1.78s/it]  8%|▊         | 4/48 [00:07<00:59,  1.34s/it]  8%|▊         | 4/48 [00:07<01:00,  1.37s/it] 10%|█         | 5/48 [00:08<00:48,  1.13s/it] 10%|█         | 5/48 [00:08<00:49,  1.15s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 12%|█▎        | 6/48 [00:08<00:42,  1.01s/it] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.08it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.16it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.22it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.21it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.29it/s] 27%|██▋       | 13/48 [00:14<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:14<00:27,  1.29it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.30it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.30it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.30it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.31it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.31it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.30it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.31it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.31it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.31it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:40<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.38it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
100%|██████████| 48/48 [00:40<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.39it/s]100%|██████████| 48/48 [00:40<00:00,  1.19it/s]
[INFO][09:36:05]: [Client #44] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_44_3536584.pth.
{'train_runtime': 40.1478, 'train_samples_per_second': 150.793, 'train_steps_per_second': 1.196, 'train_loss': 3.4465936024983725, 'epoch': 3.0}
[INFO][09:36:05]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536585.pth.
{'train_runtime': 40.2533, 'train_samples_per_second': 150.398, 'train_steps_per_second': 1.192, 'train_loss': 2.98499329884847, 'epoch': 3.0}
[INFO][09:36:06]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536585.pth.
[INFO][09:36:06]: [Client #44] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_44_3536584.pth.
[INFO][09:36:07]: [Client #13] Model trained.
[INFO][09:36:07]: [Client #13] Inbound data has been processed.
[INFO][09:36:07]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:36:07]: [Client #44] Model trained.
[INFO][09:36:07]: [Client #44] Inbound data has been processed.
[INFO][09:36:07]: [Client #44] Outbound data is ready to be sent after being processed.
[INFO][09:36:13]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:36:14]: [Client #44] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:36:14]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:36:16]: [Server #3536466] Received 507.38 MB of payload data from client #44 (simulated).
[INFO][09:36:16]: [Server #3536466] Selecting client #41 for training.
[INFO][09:36:16]: [Server #3536466] Sending the current model to client #41 (simulated).
[INFO][09:36:19]: [Server #3536466] Sending 507.38 MB of payload data to client #41 (simulated).
[INFO][09:36:19]: [Client #41] Selected by the server.
[INFO][09:36:19]: [Client #41] Loading its data source...
[INFO][09:36:19]: [Client #41] Dataset size: 2018
[INFO][09:36:19]: [Client #41] Sampler: iid
[INFO][09:36:21]: [Client #41] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:36:21]: [Client #41] Start to process inbound data.
[INFO][09:36:21]: [93m[1m[Client #41] Started training in communication round #24.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:24,  4.35s/it]  4%|▍         | 2/48 [00:04<01:35,  2.08s/it]  6%|▋         | 3/48 [00:05<01:00,  1.36s/it]  8%|▊         | 4/48 [00:05<00:44,  1.01s/it] 10%|█         | 5/48 [00:06<00:35,  1.21it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.42it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.58it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.07it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.07it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.06it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.05it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.05it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.05it/s] 88%|████████▊ | 42/48 [00:24<00:02,  2.05it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.05it/s] 92%|█████████▏| 44/48 [00:25<00:01,  2.04it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.04it/s] 96%|█████████▌| 46/48 [00:26<00:00,  2.04it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.04it/s]100%|██████████| 48/48 [00:26<00:00,  2.15it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.15it/s]100%|██████████| 48/48 [00:26<00:00,  1.78it/s]
[INFO][09:36:54]: [Client #41] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536584.pth.
{'train_runtime': 26.9226, 'train_samples_per_second': 224.867, 'train_steps_per_second': 1.783, 'train_loss': 3.387174606323242, 'epoch': 3.0}
[INFO][09:36:55]: [Client #41] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536584.pth.
[INFO][09:36:56]: [Client #41] Model trained.
[INFO][09:36:56]: [Client #41] Inbound data has been processed.
[INFO][09:36:56]: [Client #41] Outbound data is ready to be sent after being processed.
[INFO][09:37:00]: [Client #41] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:37:01]: [Server #3536466] Received 507.38 MB of payload data from client #41 (simulated).
[INFO][09:37:01]: [Server #3536466] Adding client #60 to the list of clients for aggregation.
[INFO][09:37:01]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:37:01]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:37:01]: [Server #3536466] Adding client #41 to the list of clients for aggregation.
[INFO][09:37:01]: [Server #3536466] Adding client #29 to the list of clients for aggregation.
[INFO][09:37:01]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:37:01]: [Server #3536466] Updated weights have been received.
[INFO][09:37:02]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:37:02]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:37:02]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.1079e+00  1e+02  1e+00  1e+00
 1:  1.9248e+00  1.1281e+00  8e+00  7e-02  7e-02
 2:  2.1100e+00  1.2506e+00  9e-01  6e-04  6e-04
 3:  2.1116e+00  2.0607e+00  5e-02  4e-06  4e-06
 4:  2.1106e+00  2.1063e+00  4e-03  4e-07  4e-07
 5:  2.1086e+00  2.1066e+00  2e-03  5e-07  2e-07
 6:  2.1083e+00  2.1068e+00  1e-03  6e-07  3e-07
 7:  2.1075e+00  2.1069e+00  7e-04  3e-06  3e-06
 8:  2.1072e+00  2.1070e+00  3e-04  2e-06  2e-06
 9:  2.1070e+00  2.1070e+00  3e-05  8e-07  6e-07
10:  2.1070e+00  2.1070e+00  1e-06  4e-08  3e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  1.1  0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  0.01 0.01 0.01 0.01 6.1  1.1  0.01
 4.1  0.01 6.1  2.1  0.01 0.01 0.01 0.01 1.1  1.1  0.01 0.01 0.1  1.1
 0.01 0.01 0.01 1.1  4.1  1.1  0.01 6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 1.1  1.1  0.01 3.1  5.1  3.1  0.01 3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 0.01 6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01
 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.2
 0.01 0.01 0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.2  0.2  0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.82it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.37it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.79it/s]100%|██████████| 8/8 [00:00<00:00, 11.59it/s]
[INFO][09:37:14]: [93m[1m[Server #3536466] Global model perplexity: 29.43
[0m
[INFO][09:37:14]: [Server #3536466] All client reports have been processed.
[INFO][09:37:14]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_24.pth.
[INFO][09:37:16]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_24.pth.
[INFO][09:37:16]: [93m[1m
[Server #3536466] Starting round 25/100.[0m
[INFO][09:37:16]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([8.07425319e-06, 1.70292154e-06, 1.70292154e-06, 1.70292154e-06,
       8.07425319e-06, 1.70292154e-06, 8.07425319e-06, 1.70292154e-06,
       3.33203321e-01, 8.07425319e-06, 8.07425319e-06, 8.07425319e-06,
       3.33203321e-01, 1.70292154e-06, 3.31840558e-07, 1.70292154e-06,
       1.70292154e-06, 1.70292154e-06, 3.31840558e-07, 1.42391745e-07,
       1.70292154e-06, 8.07425319e-06, 8.07425319e-06, 8.07425319e-06,
       8.07425319e-06, 3.52833659e-08, 1.70292154e-06, 7.94662382e-08,
       8.07425319e-06, 3.52833659e-08, 3.31840558e-07, 8.07425319e-06,
       8.07425319e-06, 8.07425319e-06, 1.70292154e-06, 1.70292154e-06,
       8.07425319e-06, 3.33203321e-01, 1.70292154e-06, 8.07425319e-06,
       8.07425319e-06, 1.70292154e-06, 7.94662382e-08, 1.70292154e-06,
       3.52833659e-08, 8.07425319e-06, 8.07425319e-06, 8.07425319e-06,
       8.07425319e-06, 1.70292154e-06, 8.07425319e-06, 1.70292154e-06,
       8.07425319e-06, 8.07425319e-06, 1.70292154e-06, 1.70292154e-06,
       8.07425319e-06, 1.42391745e-07, 5.07851011e-08, 1.42391745e-07,
       8.07425319e-06, 1.42391745e-07, 8.07425319e-06, 1.70292154e-06,
       8.07425319e-06, 8.07425319e-06, 1.42391745e-07, 3.52833659e-08,
       1.70292154e-06, 1.42391745e-07, 1.70292154e-06, 8.07425319e-06,
       1.70292154e-06, 3.31840558e-07, 8.07425319e-06, 8.07425319e-06,
       3.31840558e-07, 8.07425319e-06, 1.70292154e-06, 8.07425319e-06,
       8.07425319e-06, 3.52833659e-08, 1.70292154e-06, 8.07425319e-06,
       8.07425319e-06, 1.70292154e-06, 1.42391745e-07, 1.42391745e-07,
       8.07425319e-06, 8.07425319e-06, 8.07425319e-06, 8.07425319e-06,
       8.07425319e-06, 5.07851011e-08, 1.70292154e-06]),)
[INFO][09:37:16]: [Server #3536466] Selected clients: [41  9 13 22 62]
[INFO][09:37:16]: [Server #3536466] Selecting client #22 for training.
[INFO][09:37:16]: [Server #3536466] Sending the current model to client #22 (simulated).
[INFO][09:37:20]: [Server #3536466] Sending 507.38 MB of payload data to client #22 (simulated).
[INFO][09:37:20]: [Server #3536466] Selecting client #41 for training.
[INFO][09:37:20]: [Server #3536466] Sending the current model to client #41 (simulated).
[INFO][09:37:24]: [Server #3536466] Sending 507.38 MB of payload data to client #41 (simulated).
[INFO][09:37:24]: [Client #22] Selected by the server.
[INFO][09:37:24]: [Client #22] Loading its data source...
[INFO][09:37:24]: [Client #22] Dataset size: 2018
[INFO][09:37:24]: [Client #22] Sampler: iid
[INFO][09:37:24]: [Client #41] Selected by the server.
[INFO][09:37:24]: [Client #41] Loading its data source...
[INFO][09:37:24]: [Client #41] Dataset size: 2018
[INFO][09:37:24]: [Client #41] Sampler: iid
[INFO][09:37:26]: [Client #41] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:37:26]: [Client #41] Start to process inbound data.
[INFO][09:37:26]: [Client #22] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:37:26]: [Client #22] Start to process inbound data.
[INFO][09:37:26]: [93m[1m[Client #22] Started training in communication round #25.[0m
[INFO][09:37:26]: [93m[1m[Client #41] Started training in communication round #25.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:14,  4.13s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:38,  2.15s/it]  2%|▏         | 1/48 [00:05<03:57,  5.04s/it]  6%|▋         | 3/48 [00:05<01:07,  1.50s/it]  4%|▍         | 2/48 [00:05<01:55,  2.51s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  6%|▋         | 3/48 [00:06<01:16,  1.70s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it]  8%|▊         | 4/48 [00:07<00:57,  1.32s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.11it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 21%|██        | 10/48 [00:10<00:30,  1.27it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 35%|███▌      | 17/48 [00:15<00:23,  1.34it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.34it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.35it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.32it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.30it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
 98%|█████████▊| 47/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.56it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.56it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][09:38:12]: [Client #22] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_22_3536584.pth.
{'train_runtime': 39.014, 'train_samples_per_second': 155.175, 'train_steps_per_second': 1.23, 'train_loss': 3.4314711888631186, 'epoch': 3.0}
[INFO][09:38:13]: [Client #41] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536585.pth.
{'train_runtime': 39.6139, 'train_samples_per_second': 152.825, 'train_steps_per_second': 1.212, 'train_loss': 3.2767461140950522, 'epoch': 3.0}
[INFO][09:38:13]: [Client #22] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_22_3536584.pth.
[INFO][09:38:13]: [Client #22] Model trained.
[INFO][09:38:13]: [Client #22] Inbound data has been processed.
[INFO][09:38:13]: [Client #22] Outbound data is ready to be sent after being processed.
[INFO][09:38:14]: [Client #41] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536585.pth.
[INFO][09:38:14]: [Client #41] Model trained.
[INFO][09:38:14]: [Client #41] Inbound data has been processed.
[INFO][09:38:14]: [Client #41] Outbound data is ready to be sent after being processed.
[INFO][09:38:20]: [Client #22] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:38:21]: [Client #41] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:38:21]: [Server #3536466] Received 507.38 MB of payload data from client #22 (simulated).
[INFO][09:38:22]: [Server #3536466] Received 507.38 MB of payload data from client #41 (simulated).
[INFO][09:38:22]: [Server #3536466] Selecting client #62 for training.
[INFO][09:38:22]: [Server #3536466] Sending the current model to client #62 (simulated).
[INFO][09:38:25]: [Server #3536466] Sending 507.38 MB of payload data to client #62 (simulated).
[INFO][09:38:25]: [Server #3536466] Selecting client #13 for training.
[INFO][09:38:25]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:38:29]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:38:29]: [Client #62] Selected by the server.
[INFO][09:38:29]: [Client #62] Loading its data source...
[INFO][09:38:29]: [Client #62] Dataset size: 2018
[INFO][09:38:29]: [Client #62] Sampler: iid
[INFO][09:38:29]: [Client #13] Selected by the server.
[INFO][09:38:29]: [Client #13] Loading its data source...
[INFO][09:38:29]: [Client #13] Dataset size: 2018
[INFO][09:38:29]: [Client #13] Sampler: iid
[INFO][09:38:30]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:38:30]: [Client #13] Start to process inbound data.
[INFO][09:38:31]: [Client #62] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:38:31]: [Client #62] Start to process inbound data.
[INFO][09:38:31]: [93m[1m[Client #13] Started training in communication round #25.[0m
[INFO][09:38:31]: [93m[1m[Client #62] Started training in communication round #25.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:21,  4.29s/it]  2%|▏         | 1/48 [00:04<03:51,  4.92s/it]  4%|▍         | 2/48 [00:04<01:40,  2.18s/it]  4%|▍         | 2/48 [00:05<01:53,  2.46s/it]  6%|▋         | 3/48 [00:05<01:09,  1.54s/it]  6%|▋         | 3/48 [00:06<01:15,  1.67s/it]  8%|▊         | 4/48 [00:06<00:53,  1.23s/it]  8%|▊         | 4/48 [00:07<00:57,  1.30s/it] 10%|█         | 5/48 [00:07<00:45,  1.05s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.06it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.02it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.32it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.32it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:18,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.32it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.30it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.31it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.30it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.30it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.30it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.30it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.30it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.31it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.31it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][09:39:17]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536585.pth.
{'train_runtime': 39.3126, 'train_samples_per_second': 153.996, 'train_steps_per_second': 1.221, 'train_loss': 2.9308999379475913, 'epoch': 3.0}
[INFO][09:39:17]: [Client #62] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_62_3536584.pth.
{'train_runtime': 39.671, 'train_samples_per_second': 152.605, 'train_steps_per_second': 1.21, 'train_loss': 3.4285669326782227, 'epoch': 3.0}
[INFO][09:39:18]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536585.pth.
[INFO][09:39:18]: [Client #62] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_62_3536584.pth.
[INFO][09:39:18]: [Client #13] Model trained.
[INFO][09:39:18]: [Client #13] Inbound data has been processed.
[INFO][09:39:18]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:39:19]: [Client #62] Model trained.
[INFO][09:39:19]: [Client #62] Inbound data has been processed.
[INFO][09:39:19]: [Client #62] Outbound data is ready to be sent after being processed.
[INFO][09:39:25]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:39:26]: [Client #62] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:39:26]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:39:27]: [Server #3536466] Received 507.38 MB of payload data from client #62 (simulated).
[INFO][09:39:27]: [Server #3536466] Selecting client #9 for training.
[INFO][09:39:27]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:39:31]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:39:31]: [Client #9] Selected by the server.
[INFO][09:39:31]: [Client #9] Loading its data source...
[INFO][09:39:31]: [Client #9] Dataset size: 2018
[INFO][09:39:31]: [Client #9] Sampler: iid
[INFO][09:39:33]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:39:33]: [Client #9] Start to process inbound data.
[INFO][09:39:33]: [93m[1m[Client #9] Started training in communication round #25.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:23,  4.32s/it]  4%|▍         | 2/48 [00:04<01:34,  2.06s/it]  6%|▋         | 3/48 [00:05<01:00,  1.34s/it]  8%|▊         | 4/48 [00:05<00:44,  1.01s/it] 10%|█         | 5/48 [00:06<00:35,  1.22it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.42it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.06it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.06it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.06it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][09:40:06]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
{'train_runtime': 26.8082, 'train_samples_per_second': 225.826, 'train_steps_per_second': 1.79, 'train_loss': 2.9291772842407227, 'epoch': 3.0}
[INFO][09:40:07]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
[INFO][09:40:08]: [Client #9] Model trained.
[INFO][09:40:08]: [Client #9] Inbound data has been processed.
[INFO][09:40:08]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:40:12]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:40:13]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:40:13]: [Server #3536466] Adding client #34 to the list of clients for aggregation.
[INFO][09:40:13]: [Server #3536466] Adding client #28 to the list of clients for aggregation.
[INFO][09:40:13]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:40:13]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:40:13]: [Server #3536466] Adding client #41 to the list of clients for aggregation.
[INFO][09:40:13]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:40:13]: [Server #3536466] Updated weights have been received.
[INFO][09:40:14]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:40:14]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:40:14]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.1543e+00  1e+02  1e+00  1e+00
 1:  1.9777e+00  1.1745e+00  7e+00  7e-02  7e-02
 2:  2.1566e+00  1.3023e+00  9e-01  6e-04  5e-04
 3:  2.1581e+00  2.1102e+00  5e-02  4e-06  4e-06
 4:  2.1570e+00  2.1527e+00  4e-03  4e-07  4e-07
 5:  2.1549e+00  2.1529e+00  2e-03  6e-07  2e-07
 6:  2.1545e+00  2.1532e+00  1e-03  6e-07  2e-07
 7:  2.1537e+00  2.1533e+00  5e-04  3e-06  2e-06
 8:  2.1535e+00  2.1533e+00  2e-04  1e-06  8e-07
 9:  2.1533e+00  2.1533e+00  2e-05  3e-07  2e-07
10:  2.1533e+00  2.1533e+00  5e-07  9e-09  6e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  1.1  0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  0.01 0.01 0.01 0.01 6.1  1.1  1.1
 4.1  0.01 6.1  2.1  0.01 2.1  0.01 0.01 1.1  1.1  0.01 0.01 0.1  1.1
 0.01 0.01 0.01 1.1  4.1  1.1  0.01 6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 1.1  1.1  0.01 3.1  5.1  3.1  0.01 3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 0.01 6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.01 0.2  0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.2
 0.01 0.01 0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.2  0.2  0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.47it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.31it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.87it/s]100%|██████████| 8/8 [00:00<00:00, 11.66it/s]
[INFO][09:40:25]: [93m[1m[Server #3536466] Global model perplexity: 29.10
[0m
[INFO][09:40:25]: [Server #3536466] All client reports have been processed.
[INFO][09:40:25]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_25.pth.
[INFO][09:40:28]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_25.pth.
[INFO][09:40:28]: [93m[1m
[Server #3536466] Starting round 26/100.[0m
[INFO][09:40:28]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([8.37305618e-06, 1.76497922e-06, 1.76497922e-06, 1.76497922e-06,
       8.37305618e-06, 1.76497922e-06, 8.37305618e-06, 1.76497922e-06,
       3.33203399e-01, 8.37305618e-06, 8.37305618e-06, 8.37305618e-06,
       3.33203399e-01, 1.76497922e-06, 3.43821694e-07, 1.76497922e-06,
       1.76497922e-06, 1.76497922e-06, 3.43821694e-07, 1.47554096e-07,
       1.76497922e-06, 8.37305618e-06, 8.37305618e-06, 8.37305618e-06,
       3.65649527e-08, 1.76497922e-06, 1.76497922e-06, 8.23516427e-08,
       8.37305618e-06, 3.65649527e-08, 3.43821694e-07, 8.37305618e-06,
       3.43821694e-07, 8.37305618e-06, 8.37305618e-06, 1.76497922e-06,
       1.76497922e-06, 8.37305618e-06, 3.33203399e-01, 1.76497922e-06,
       8.37305618e-06, 8.37305618e-06, 1.76497922e-06, 8.23516427e-08,
       1.76497922e-06, 3.65649527e-08, 8.37305618e-06, 8.37305618e-06,
       8.37305618e-06, 8.37305618e-06, 1.76497922e-06, 8.37305618e-06,
       1.76497922e-06, 8.37305618e-06, 8.37305618e-06, 1.76497922e-06,
       1.76497922e-06, 1.47554096e-07, 5.26297963e-08, 1.47554096e-07,
       8.37305618e-06, 1.47554096e-07, 8.37305618e-06, 1.76497922e-06,
       8.37305618e-06, 8.37305618e-06, 1.47554096e-07, 3.65649527e-08,
       1.76497922e-06, 1.47554096e-07, 1.76497922e-06, 8.37305618e-06,
       1.76497922e-06, 3.43821694e-07, 8.37305618e-06, 8.37305618e-06,
       3.43821694e-07, 8.37305618e-06, 1.76497922e-06, 8.37305618e-06,
       8.37305618e-06, 3.65649527e-08, 1.76497922e-06, 8.37305618e-06,
       8.37305618e-06, 1.76497922e-06, 1.47554096e-07, 1.47554096e-07,
       8.37305618e-06, 8.37305618e-06, 8.37305618e-06, 8.37305618e-06,
       8.37305618e-06, 5.26297963e-08, 1.76497922e-06]),)
[INFO][09:40:28]: [Server #3536466] Selected clients: [13 41  9 59 39]
[INFO][09:40:28]: [Server #3536466] Selecting client #39 for training.
[INFO][09:40:28]: [Server #3536466] Sending the current model to client #39 (simulated).
[INFO][09:40:32]: [Server #3536466] Sending 507.38 MB of payload data to client #39 (simulated).
[INFO][09:40:32]: [Server #3536466] Selecting client #41 for training.
[INFO][09:40:32]: [Server #3536466] Sending the current model to client #41 (simulated).
[INFO][09:40:37]: [Server #3536466] Sending 507.38 MB of payload data to client #41 (simulated).
[INFO][09:40:37]: [Client #39] Selected by the server.
[INFO][09:40:37]: [Client #39] Loading its data source...
[INFO][09:40:37]: [Client #39] Dataset size: 2018
[INFO][09:40:37]: [Client #39] Sampler: iid
[INFO][09:40:37]: [Client #41] Selected by the server.
[INFO][09:40:37]: [Client #41] Loading its data source...
[INFO][09:40:37]: [Client #41] Dataset size: 2018
[INFO][09:40:37]: [Client #41] Sampler: iid
[INFO][09:40:38]: [Client #39] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:40:38]: [Client #39] Start to process inbound data.
[INFO][09:40:38]: [Client #41] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:40:38]: [Client #41] Start to process inbound data.
[INFO][09:40:39]: [93m[1m[Client #41] Started training in communication round #26.[0m
[INFO][09:40:39]: [93m[1m[Client #39] Started training in communication round #26.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:51,  4.92s/it]  2%|▏         | 1/48 [00:04<03:52,  4.95s/it]  4%|▍         | 2/48 [00:05<01:55,  2.51s/it]  4%|▍         | 2/48 [00:05<01:56,  2.54s/it]  6%|▋         | 3/48 [00:06<01:19,  1.76s/it]  6%|▋         | 3/48 [00:06<01:19,  1.77s/it]  8%|▊         | 4/48 [00:07<01:00,  1.37s/it]  8%|▊         | 4/48 [00:07<01:00,  1.38s/it] 10%|█         | 5/48 [00:08<00:49,  1.14s/it] 10%|█         | 5/48 [00:08<00:49,  1.16s/it] 12%|█▎        | 6/48 [00:08<00:42,  1.01s/it] 12%|█▎        | 6/48 [00:08<00:43,  1.03s/it] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 15%|█▍        | 7/48 [00:09<00:38,  1.07it/s] 17%|█▋        | 8/48 [00:10<00:35,  1.14it/s] 17%|█▋        | 8/48 [00:10<00:35,  1.14it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.19it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.19it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 21%|██        | 10/48 [00:11<00:30,  1.23it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.26it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.28it/s] 27%|██▋       | 13/48 [00:14<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:14<00:27,  1.29it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:15<00:26,  1.30it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.39it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:20<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:29<00:11,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.33it/s] 71%|███████   | 34/48 [00:29<00:10,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.32it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:31<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:31<00:09,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.30it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.31it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.31it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:40<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.37it/s]100%|██████████| 48/48 [00:40<00:00,  1.19it/s]
100%|██████████| 48/48 [00:40<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.39it/s]100%|██████████| 48/48 [00:40<00:00,  1.19it/s]
[INFO][09:41:26]: [Client #41] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536585.pth.
{'train_runtime': 40.2527, 'train_samples_per_second': 150.4, 'train_steps_per_second': 1.192, 'train_loss': 3.2054011027018228, 'epoch': 3.0}
[INFO][09:41:26]: [Client #39] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_39_3536584.pth.
{'train_runtime': 40.1773, 'train_samples_per_second': 150.682, 'train_steps_per_second': 1.195, 'train_loss': 3.3335558573404946, 'epoch': 3.0}
[INFO][09:41:27]: [Client #41] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536585.pth.
[INFO][09:41:27]: [Client #39] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_39_3536584.pth.
[INFO][09:41:27]: [Client #41] Model trained.
[INFO][09:41:27]: [Client #41] Inbound data has been processed.
[INFO][09:41:27]: [Client #41] Outbound data is ready to be sent after being processed.
[INFO][09:41:28]: [Client #39] Model trained.
[INFO][09:41:28]: [Client #39] Inbound data has been processed.
[INFO][09:41:28]: [Client #39] Outbound data is ready to be sent after being processed.
[INFO][09:41:35]: [Client #41] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:41:35]: [Client #39] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:41:36]: [Server #3536466] Received 507.38 MB of payload data from client #41 (simulated).
[INFO][09:41:37]: [Server #3536466] Received 507.38 MB of payload data from client #39 (simulated).
[INFO][09:41:37]: [Server #3536466] Selecting client #59 for training.
[INFO][09:41:37]: [Server #3536466] Sending the current model to client #59 (simulated).
[INFO][09:41:41]: [Server #3536466] Sending 507.38 MB of payload data to client #59 (simulated).
[INFO][09:41:41]: [Server #3536466] Selecting client #13 for training.
[INFO][09:41:41]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:41:45]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:41:45]: [Client #59] Selected by the server.
[INFO][09:41:45]: [Client #59] Loading its data source...
[INFO][09:41:45]: [Client #59] Dataset size: 2018
[INFO][09:41:45]: [Client #13] Selected by the server.
[INFO][09:41:45]: [Client #59] Sampler: iid
[INFO][09:41:45]: [Client #13] Loading its data source...
[INFO][09:41:45]: [Client #13] Dataset size: 2018
[INFO][09:41:45]: [Client #13] Sampler: iid
[INFO][09:41:46]: [Client #59] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:41:46]: [Client #59] Start to process inbound data.
[INFO][09:41:46]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:41:46]: [Client #13] Start to process inbound data.
[INFO][09:41:47]: [93m[1m[Client #59] Started training in communication round #26.[0m
[INFO][09:41:47]: [93m[1m[Client #13] Started training in communication round #26.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:42,  4.73s/it]  2%|▏         | 1/48 [00:04<03:46,  4.82s/it]  4%|▍         | 2/48 [00:05<01:49,  2.38s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:56,  1.27s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][09:42:33]: [Client #59] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_59_3536584.pth.
{'train_runtime': 39.5322, 'train_samples_per_second': 153.141, 'train_steps_per_second': 1.214, 'train_loss': 3.3185831705729165, 'epoch': 3.0}
[INFO][09:42:33]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536585.pth.
{'train_runtime': 39.4475, 'train_samples_per_second': 153.47, 'train_steps_per_second': 1.217, 'train_loss': 2.862370808919271, 'epoch': 3.0}
[INFO][09:42:34]: [Client #59] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_59_3536584.pth.
[INFO][09:42:34]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536585.pth.
[INFO][09:42:35]: [Client #13] Model trained.
[INFO][09:42:35]: [Client #13] Inbound data has been processed.
[INFO][09:42:35]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:42:35]: [Client #59] Model trained.
[INFO][09:42:35]: [Client #59] Inbound data has been processed.
[INFO][09:42:35]: [Client #59] Outbound data is ready to be sent after being processed.
[INFO][09:42:43]: [Client #59] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:42:43]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:42:44]: [Server #3536466] Received 507.38 MB of payload data from client #59 (simulated).
[INFO][09:42:45]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:42:45]: [Server #3536466] Selecting client #9 for training.
[INFO][09:42:45]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:42:49]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:42:49]: [Client #9] Selected by the server.
[INFO][09:42:49]: [Client #9] Loading its data source...
[INFO][09:42:49]: [Client #9] Dataset size: 2018
[INFO][09:42:49]: [Client #9] Sampler: iid
[INFO][09:42:51]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:42:51]: [Client #9] Start to process inbound data.
[INFO][09:42:51]: [93m[1m[Client #9] Started training in communication round #26.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:21,  4.29s/it]  4%|▍         | 2/48 [00:04<01:34,  2.05s/it]  6%|▋         | 3/48 [00:05<01:00,  1.34s/it]  8%|▊         | 4/48 [00:05<00:44,  1.01s/it] 10%|█         | 5/48 [00:06<00:35,  1.22it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.41it/s] 15%|█▍        | 7/48 [00:07<00:26,  1.57it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.70it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.80it/s] 21%|██        | 10/48 [00:08<00:20,  1.88it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.93it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.97it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.06it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.06it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.06it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:24<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][09:43:24]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
{'train_runtime': 26.8286, 'train_samples_per_second': 225.655, 'train_steps_per_second': 1.789, 'train_loss': 2.8605101903279624, 'epoch': 3.0}
[INFO][09:43:25]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
[INFO][09:43:26]: [Client #9] Model trained.
[INFO][09:43:26]: [Client #9] Inbound data has been processed.
[INFO][09:43:26]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:43:30]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:43:32]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:43:32]: [Server #3536466] Adding client #62 to the list of clients for aggregation.
[INFO][09:43:32]: [Server #3536466] Adding client #40 to the list of clients for aggregation.
[INFO][09:43:32]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:43:32]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:43:32]: [Server #3536466] Adding client #41 to the list of clients for aggregation.
[INFO][09:43:32]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:43:32]: [Server #3536466] Updated weights have been received.
[INFO][09:43:32]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:43:32]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:43:32]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.1695e+00  1e+02  1e+00  1e+00
 1:  1.9954e+00  1.1897e+00  7e+00  7e-02  7e-02
 2:  2.1720e+00  1.3193e+00  9e-01  5e-04  5e-04
 3:  2.1734e+00  2.1265e+00  5e-02  4e-06  4e-06
 4:  2.1723e+00  2.1680e+00  4e-03  4e-07  4e-07
 5:  2.1702e+00  2.1682e+00  2e-03  6e-07  2e-07
 6:  2.1698e+00  2.1685e+00  1e-03  6e-07  2e-07
 7:  2.1690e+00  2.1685e+00  5e-04  3e-06  2e-06
 8:  2.1687e+00  2.1686e+00  2e-04  1e-06  8e-07
 9:  2.1686e+00  2.1686e+00  2e-05  3e-07  2e-07
10:  2.1686e+00  2.1686e+00  5e-07  9e-09  6e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  1.1  0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  0.01 0.01 0.01 0.01 6.1  1.1  1.1
 4.1  0.01 6.1  2.1  0.01 2.1  0.01 0.01 1.1  1.1  0.01 5.1  0.1  1.1
 0.01 0.01 0.01 1.1  4.1  1.1  0.01 6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 0.01 1.1  1.1  1.1  3.1  5.1  3.1  0.01 3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 0.01 6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.01 0.2  0.01 0.01 0.2  0.2  0.01 0.2  0.2  0.2
 0.01 0.01 0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.00it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.30it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.73it/s]100%|██████████| 8/8 [00:00<00:00, 11.60it/s]
[INFO][09:43:44]: [93m[1m[Server #3536466] Global model perplexity: 28.99
[0m
[INFO][09:43:44]: [Server #3536466] All client reports have been processed.
[INFO][09:43:44]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_26.pth.
[INFO][09:43:47]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_26.pth.
[INFO][09:43:47]: [93m[1m
[Server #3536466] Starting round 27/100.[0m
[INFO][09:43:47]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([8.36743689e-06, 1.75890642e-06, 1.75890642e-06, 1.75890642e-06,
       8.36743689e-06, 1.75890642e-06, 8.36743689e-06, 1.75890642e-06,
       3.33208512e-01, 8.36743689e-06, 8.36743689e-06, 8.36743689e-06,
       3.33208512e-01, 1.75890642e-06, 3.42381509e-07, 1.75890642e-06,
       1.75890642e-06, 1.75890642e-06, 3.42381509e-07, 1.46972565e-07,
       1.75890642e-06, 8.36743689e-06, 8.36743689e-06, 8.36743689e-06,
       3.64249046e-08, 1.75890642e-06, 1.75890642e-06, 8.20345793e-08,
       8.36743689e-06, 3.64249046e-08, 3.42381509e-07, 8.36743689e-06,
       3.42381509e-07, 8.36743689e-06, 8.36743689e-06, 1.75890642e-06,
       1.75890642e-06, 5.24282943e-08, 3.33208512e-01, 1.75890642e-06,
       8.36743689e-06, 8.36743689e-06, 1.75890642e-06, 8.20345793e-08,
       1.75890642e-06, 3.64249046e-08, 8.36743689e-06, 8.36743689e-06,
       8.36743689e-06, 8.36743689e-06, 1.75890642e-06, 8.36743689e-06,
       1.75890642e-06, 8.36743689e-06, 1.75890642e-06, 1.75890642e-06,
       1.75890642e-06, 1.46972565e-07, 5.24282943e-08, 1.46972565e-07,
       8.36743689e-06, 1.46972565e-07, 8.36743689e-06, 1.75890642e-06,
       8.36743689e-06, 8.36743689e-06, 1.46972565e-07, 3.64249046e-08,
       1.75890642e-06, 1.46972565e-07, 1.75890642e-06, 8.36743689e-06,
       1.75890642e-06, 3.42381509e-07, 8.36743689e-06, 8.36743689e-06,
       3.42381509e-07, 8.36743689e-06, 1.75890642e-06, 8.36743689e-06,
       8.36743689e-06, 3.64249046e-08, 1.75890642e-06, 8.36743689e-06,
       8.36743689e-06, 1.75890642e-06, 1.46972565e-07, 1.46972565e-07,
       8.36743689e-06, 8.36743689e-06, 8.36743689e-06, 8.36743689e-06,
       8.36743689e-06, 5.24282943e-08, 1.75890642e-06]),)
[INFO][09:43:47]: [Server #3536466] Selected clients: [ 9 13 41 86 66]
[INFO][09:43:47]: [Server #3536466] Selecting client #66 for training.
[INFO][09:43:47]: [Server #3536466] Sending the current model to client #66 (simulated).
[INFO][09:43:51]: [Server #3536466] Sending 507.38 MB of payload data to client #66 (simulated).
[INFO][09:43:51]: [Server #3536466] Selecting client #9 for training.
[INFO][09:43:51]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:43:55]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:43:55]: [Client #66] Selected by the server.
[INFO][09:43:55]: [Client #66] Loading its data source...
[INFO][09:43:55]: [Client #66] Dataset size: 2018
[INFO][09:43:55]: [Client #66] Sampler: iid
[INFO][09:43:55]: [Client #9] Selected by the server.
[INFO][09:43:55]: [Client #9] Loading its data source...
[INFO][09:43:55]: [Client #9] Dataset size: 2018
[INFO][09:43:55]: [Client #9] Sampler: iid
[INFO][09:43:57]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:43:57]: [Client #9] Start to process inbound data.
[INFO][09:43:57]: [Client #66] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:43:57]: [Client #66] Start to process inbound data.
[INFO][09:43:58]: [93m[1m[Client #66] Started training in communication round #27.[0m
[INFO][09:43:58]: [93m[1m[Client #9] Started training in communication round #27.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:53,  4.97s/it]  2%|▏         | 1/48 [00:05<03:56,  5.03s/it]  4%|▍         | 2/48 [00:05<01:57,  2.55s/it]  4%|▍         | 2/48 [00:05<01:58,  2.58s/it]  6%|▋         | 3/48 [00:06<01:18,  1.74s/it]  6%|▋         | 3/48 [00:06<01:19,  1.77s/it]  8%|▊         | 4/48 [00:07<00:58,  1.33s/it]  8%|▊         | 4/48 [00:07<01:00,  1.37s/it] 10%|█         | 5/48 [00:08<00:47,  1.12s/it] 10%|█         | 5/48 [00:08<00:49,  1.15s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 12%|█▎        | 6/48 [00:08<00:42,  1.01s/it] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.16it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.33it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:21,  1.33it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.31it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.34it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.31it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.30it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.30it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.31it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.31it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:40<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.38it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
100%|██████████| 48/48 [00:40<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.39it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
[INFO][09:44:44]: [Client #66] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
{'train_runtime': 40.1468, 'train_samples_per_second': 150.797, 'train_steps_per_second': 1.196, 'train_loss': 3.4012203216552734, 'epoch': 3.0}
[INFO][09:44:44]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 40.0198, 'train_samples_per_second': 151.275, 'train_steps_per_second': 1.199, 'train_loss': 2.8310715357462564, 'epoch': 3.0}
[INFO][09:44:45]: [Client #66] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
[INFO][09:44:46]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][09:44:46]: [Client #66] Model trained.
[INFO][09:44:46]: [Client #66] Inbound data has been processed.
[INFO][09:44:46]: [Client #66] Outbound data is ready to be sent after being processed.
[INFO][09:44:46]: [Client #9] Model trained.
[INFO][09:44:46]: [Client #9] Inbound data has been processed.
[INFO][09:44:46]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:44:54]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:44:54]: [Client #66] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:44:55]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:44:56]: [Server #3536466] Received 507.38 MB of payload data from client #66 (simulated).
[INFO][09:44:56]: [Server #3536466] Selecting client #86 for training.
[INFO][09:44:56]: [Server #3536466] Sending the current model to client #86 (simulated).
[INFO][09:45:00]: [Server #3536466] Sending 507.38 MB of payload data to client #86 (simulated).
[INFO][09:45:00]: [Server #3536466] Selecting client #13 for training.
[INFO][09:45:00]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:45:04]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:45:04]: [Client #86] Selected by the server.
[INFO][09:45:04]: [Client #86] Loading its data source...
[INFO][09:45:04]: [Client #86] Dataset size: 2018
[INFO][09:45:04]: [Client #86] Sampler: iid
[INFO][09:45:04]: [Client #13] Selected by the server.
[INFO][09:45:04]: [Client #13] Loading its data source...
[INFO][09:45:04]: [Client #13] Dataset size: 2018
[INFO][09:45:04]: [Client #13] Sampler: iid
[INFO][09:45:05]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:45:05]: [Client #13] Start to process inbound data.
[INFO][09:45:05]: [Client #86] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:45:05]: [Client #86] Start to process inbound data.
[INFO][09:45:06]: [93m[1m[Client #86] Started training in communication round #27.[0m
[INFO][09:45:06]: [93m[1m[Client #13] Started training in communication round #27.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:45,  4.80s/it]  2%|▏         | 1/48 [00:04<03:48,  4.87s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  4%|▍         | 2/48 [00:05<01:53,  2.47s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  6%|▋         | 3/48 [00:06<01:15,  1.69s/it]  8%|▊         | 4/48 [00:07<00:56,  1.28s/it]  8%|▊         | 4/48 [00:07<00:57,  1.31s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.35it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][09:45:52]: [Client #86] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_86_3536584.pth.
{'train_runtime': 39.6715, 'train_samples_per_second': 152.603, 'train_steps_per_second': 1.21, 'train_loss': 3.3725789388020835, 'epoch': 3.0}
[INFO][09:45:52]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536585.pth.
{'train_runtime': 39.5431, 'train_samples_per_second': 153.099, 'train_steps_per_second': 1.214, 'train_loss': 2.8262599309285483, 'epoch': 3.0}
[INFO][09:45:53]: [Client #86] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_86_3536584.pth.
[INFO][09:45:53]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536585.pth.
[INFO][09:45:53]: [Client #86] Model trained.
[INFO][09:45:53]: [Client #86] Inbound data has been processed.
[INFO][09:45:53]: [Client #86] Outbound data is ready to be sent after being processed.
[INFO][09:45:54]: [Client #13] Model trained.
[INFO][09:45:54]: [Client #13] Inbound data has been processed.
[INFO][09:45:54]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:46:01]: [Client #86] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:46:01]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:46:02]: [Server #3536466] Received 507.38 MB of payload data from client #86 (simulated).
[INFO][09:46:03]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:46:03]: [Server #3536466] Selecting client #41 for training.
[INFO][09:46:03]: [Server #3536466] Sending the current model to client #41 (simulated).
[INFO][09:46:07]: [Server #3536466] Sending 507.38 MB of payload data to client #41 (simulated).
[INFO][09:46:07]: [Client #41] Selected by the server.
[INFO][09:46:07]: [Client #41] Loading its data source...
[INFO][09:46:07]: [Client #41] Dataset size: 2018
[INFO][09:46:07]: [Client #41] Sampler: iid
[INFO][09:46:09]: [Client #41] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:46:09]: [Client #41] Start to process inbound data.
[INFO][09:46:09]: [93m[1m[Client #41] Started training in communication round #27.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:21,  4.30s/it]  4%|▍         | 2/48 [00:04<01:34,  2.06s/it]  6%|▋         | 3/48 [00:05<01:00,  1.34s/it]  8%|▊         | 4/48 [00:05<00:43,  1.00it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.88it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.08it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.07it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.06it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.07it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.07it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.08it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][09:46:42]: [Client #41] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536584.pth.
{'train_runtime': 26.781, 'train_samples_per_second': 226.056, 'train_steps_per_second': 1.792, 'train_loss': 3.1463696161905923, 'epoch': 3.0}
[INFO][09:46:43]: [Client #41] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536584.pth.
[INFO][09:46:43]: [Client #41] Model trained.
[INFO][09:46:43]: [Client #41] Inbound data has been processed.
[INFO][09:46:43]: [Client #41] Outbound data is ready to be sent after being processed.
[INFO][09:46:48]: [Client #41] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:46:49]: [Server #3536466] Received 507.38 MB of payload data from client #41 (simulated).
[INFO][09:46:49]: [Server #3536466] Adding client #59 to the list of clients for aggregation.
[INFO][09:46:49]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:46:49]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:46:49]: [Server #3536466] Adding client #41 to the list of clients for aggregation.
[INFO][09:46:49]: [Server #3536466] Adding client #66 to the list of clients for aggregation.
[INFO][09:46:49]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:46:49]: [Server #3536466] Updated weights have been received.
[INFO][09:46:50]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:46:50]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:46:50]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.2320e+00  1e+02  1e+00  1e+00
 1:  2.0654e+00  1.2521e+00  7e+00  6e-02  6e-02
 2:  2.2347e+00  1.3894e+00  9e-01  5e-04  5e-04
 3:  2.2360e+00  2.1930e+00  4e-02  4e-06  4e-06
 4:  2.2348e+00  2.2306e+00  4e-03  4e-07  4e-07
 5:  2.2326e+00  2.2306e+00  2e-03  6e-07  2e-07
 6:  2.2323e+00  2.2310e+00  1e-03  5e-07  2e-07
 7:  2.2315e+00  2.2310e+00  5e-04  3e-06  2e-06
 8:  2.2312e+00  2.2311e+00  2e-04  1e-06  8e-07
 9:  2.2311e+00  2.2311e+00  2e-05  3e-07  2e-07
10:  2.2311e+00  2.2311e+00  4e-07  8e-09  5e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  1.1  0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  0.01 0.01 0.01 0.01 6.1  1.1  1.1
 4.1  0.01 6.1  2.1  0.01 2.1  0.01 0.01 1.1  1.1  0.01 5.1  0.1  1.1
 0.01 0.01 0.01 1.1  4.1  1.1  0.01 6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  0.1  3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 0.01 6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.01 0.2  0.01 0.01 0.2  0.2  0.01 0.2  0.2  0.2
 0.01 0.01 0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.24it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.39it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.98it/s]100%|██████████| 8/8 [00:00<00:00, 11.77it/s]
[INFO][09:47:02]: [93m[1m[Server #3536466] Global model perplexity: 28.67
[0m
[INFO][09:47:02]: [Server #3536466] All client reports have been processed.
[INFO][09:47:02]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_27.pth.
[INFO][09:47:05]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_27.pth.
[INFO][09:47:05]: [93m[1m
[Server #3536466] Starting round 28/100.[0m
[INFO][09:47:05]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([1.31778784e-06, 3.19072236e-07, 3.19072236e-07, 3.19072236e-07,
       1.31778784e-06, 3.19072236e-07, 1.31778784e-06, 3.19072236e-07,
       2.49985488e-01, 1.31778784e-06, 1.31778784e-06, 1.31778784e-06,
       2.49985488e-01, 3.19072236e-07, 6.52146352e-08, 3.19072236e-07,
       3.19072236e-07, 3.19072236e-07, 6.52146352e-08, 2.82437459e-08,
       3.19072236e-07, 1.31778784e-06, 1.31778784e-06, 1.31778784e-06,
       7.03817357e-09, 3.19072236e-07, 3.19072236e-07, 1.58144316e-08,
       1.31778784e-06, 7.03817357e-09, 6.52146352e-08, 1.31778784e-06,
       6.52146352e-08, 1.31778784e-06, 1.31778784e-06, 3.19072236e-07,
       3.19072236e-07, 1.01220865e-08, 2.49985488e-01, 3.19072236e-07,
       1.31778784e-06, 1.31778784e-06, 3.19072236e-07, 1.58144316e-08,
       3.19072236e-07, 7.03817357e-09, 1.31778784e-06, 1.31778784e-06,
       1.31778784e-06, 1.31778784e-06, 3.19072236e-07, 1.31778784e-06,
       3.19072236e-07, 1.31778784e-06, 3.19072236e-07, 3.19072236e-07,
       3.19072236e-07, 3.19072236e-07, 2.82437459e-08, 1.01220865e-08,
       2.82437459e-08, 2.49985488e-01, 2.82437459e-08, 1.31778784e-06,
       3.19072236e-07, 1.31778784e-06, 1.31778784e-06, 2.82437459e-08,
       7.03817357e-09, 3.19072236e-07, 2.82437459e-08, 3.19072236e-07,
       1.31778784e-06, 3.19072236e-07, 6.52146352e-08, 1.31778784e-06,
       1.31778784e-06, 6.52146352e-08, 1.31778784e-06, 3.19072236e-07,
       1.31778784e-06, 7.03817357e-09, 3.19072236e-07, 1.31778784e-06,
       1.31778784e-06, 3.19072236e-07, 2.82437459e-08, 2.82437459e-08,
       1.31778784e-06, 1.31778784e-06, 1.31778784e-06, 1.31778784e-06,
       1.31778784e-06, 1.01220865e-08, 3.19072236e-07]),)
[INFO][09:47:05]: [Server #3536466] Selected clients: [66 41  9 13 38]
[INFO][09:47:05]: [Server #3536466] Selecting client #66 for training.
[INFO][09:47:05]: [Server #3536466] Sending the current model to client #66 (simulated).
[INFO][09:47:09]: [Server #3536466] Sending 507.38 MB of payload data to client #66 (simulated).
[INFO][09:47:09]: [Server #3536466] Selecting client #41 for training.
[INFO][09:47:09]: [Server #3536466] Sending the current model to client #41 (simulated).
[INFO][09:47:13]: [Server #3536466] Sending 507.38 MB of payload data to client #41 (simulated).
[INFO][09:47:13]: [Client #66] Selected by the server.
[INFO][09:47:13]: [Client #66] Loading its data source...
[INFO][09:47:13]: [Client #66] Dataset size: 2018
[INFO][09:47:13]: [Client #66] Sampler: iid
[INFO][09:47:13]: [Client #41] Selected by the server.
[INFO][09:47:13]: [Client #41] Loading its data source...
[INFO][09:47:13]: [Client #41] Dataset size: 2018
[INFO][09:47:13]: [Client #41] Sampler: iid
[INFO][09:47:15]: [Client #66] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:47:15]: [Client #66] Start to process inbound data.
[INFO][09:47:15]: [Client #41] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:47:15]: [Client #41] Start to process inbound data.
[INFO][09:47:16]: [93m[1m[Client #41] Started training in communication round #28.[0m
[INFO][09:47:16]: [93m[1m[Client #66] Started training in communication round #28.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:38,  4.64s/it]  2%|▏         | 1/48 [00:04<03:42,  4.74s/it]  4%|▍         | 2/48 [00:05<01:47,  2.34s/it]  4%|▍         | 2/48 [00:05<01:50,  2.39s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  8%|▊         | 4/48 [00:06<00:56,  1.29s/it]  8%|▊         | 4/48 [00:06<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 71%|███████   | 34/48 [00:29<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.31it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][09:48:01]: [Client #66] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
{'train_runtime': 39.4957, 'train_samples_per_second': 153.283, 'train_steps_per_second': 1.215, 'train_loss': 3.2978992462158203, 'epoch': 3.0}
[INFO][09:48:02]: [Client #41] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536585.pth.
{'train_runtime': 39.5528, 'train_samples_per_second': 153.061, 'train_steps_per_second': 1.214, 'train_loss': 3.0367053349812827, 'epoch': 3.0}
[INFO][09:48:02]: [Client #66] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
[INFO][09:48:03]: [Client #66] Model trained.
[INFO][09:48:03]: [Client #66] Inbound data has been processed.
[INFO][09:48:03]: [Client #66] Outbound data is ready to be sent after being processed.
[INFO][09:48:03]: [Client #41] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536585.pth.
[INFO][09:48:04]: [Client #41] Model trained.
[INFO][09:48:04]: [Client #41] Inbound data has been processed.
[INFO][09:48:04]: [Client #41] Outbound data is ready to be sent after being processed.
[INFO][09:48:10]: [Client #66] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:48:11]: [Client #41] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:48:11]: [Server #3536466] Received 507.38 MB of payload data from client #66 (simulated).
[INFO][09:48:12]: [Server #3536466] Received 507.38 MB of payload data from client #41 (simulated).
[INFO][09:48:12]: [Server #3536466] Selecting client #38 for training.
[INFO][09:48:12]: [Server #3536466] Sending the current model to client #38 (simulated).
[INFO][09:48:16]: [Server #3536466] Sending 507.38 MB of payload data to client #38 (simulated).
[INFO][09:48:16]: [Server #3536466] Selecting client #13 for training.
[INFO][09:48:16]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:48:20]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:48:20]: [Client #38] Selected by the server.
[INFO][09:48:20]: [Client #13] Selected by the server.
[INFO][09:48:20]: [Client #38] Loading its data source...
[INFO][09:48:20]: [Client #13] Loading its data source...
[INFO][09:48:20]: [Client #38] Dataset size: 2018
[INFO][09:48:20]: [Client #38] Sampler: iid
[INFO][09:48:20]: [Client #13] Dataset size: 2018
[INFO][09:48:20]: [Client #13] Sampler: iid
[INFO][09:48:21]: [Client #38] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:48:21]: [Client #38] Start to process inbound data.
[INFO][09:48:21]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:48:21]: [Client #13] Start to process inbound data.
[INFO][09:48:22]: [93m[1m[Client #38] Started training in communication round #28.[0m
[INFO][09:48:22]: [93m[1m[Client #13] Started training in communication round #28.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  2%|▏         | 1/48 [00:04<03:47,  4.85s/it]  4%|▍         | 2/48 [00:04<01:39,  2.17s/it]  4%|▍         | 2/48 [00:05<01:52,  2.44s/it]  6%|▋         | 3/48 [00:05<01:07,  1.51s/it]  6%|▋         | 3/48 [00:06<01:15,  1.67s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it]  8%|▊         | 4/48 [00:07<00:57,  1.30s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.30it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.36it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.33it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.34it/s] 40%|███▉      | 19/48 [00:18<00:22,  1.32it/s] 42%|████▏     | 20/48 [00:18<00:21,  1.33it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.32it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.31it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][09:49:08]: [Client #38] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_38_3536584.pth.
{'train_runtime': 39.2144, 'train_samples_per_second': 154.382, 'train_steps_per_second': 1.224, 'train_loss': 3.3949832916259766, 'epoch': 3.0}
[INFO][09:49:08]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536585.pth.
{'train_runtime': 39.6339, 'train_samples_per_second': 152.748, 'train_steps_per_second': 1.211, 'train_loss': 2.722040812174479, 'epoch': 3.0}
[INFO][09:49:09]: [Client #38] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_38_3536584.pth.
[INFO][09:49:09]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536585.pth.
[INFO][09:49:09]: [Client #38] Model trained.
[INFO][09:49:09]: [Client #38] Inbound data has been processed.
[INFO][09:49:09]: [Client #38] Outbound data is ready to be sent after being processed.
[INFO][09:49:10]: [Client #13] Model trained.
[INFO][09:49:10]: [Client #13] Inbound data has been processed.
[INFO][09:49:10]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:49:17]: [Client #38] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:49:17]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:49:18]: [Server #3536466] Received 507.38 MB of payload data from client #38 (simulated).
[INFO][09:49:19]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:49:19]: [Server #3536466] Selecting client #9 for training.
[INFO][09:49:19]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:49:24]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:49:24]: [Client #9] Selected by the server.
[INFO][09:49:24]: [Client #9] Loading its data source...
[INFO][09:49:24]: [Client #9] Dataset size: 2018
[INFO][09:49:24]: [Client #9] Sampler: iid
[INFO][09:49:25]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:49:25]: [Client #9] Start to process inbound data.
[INFO][09:49:25]: [93m[1m[Client #9] Started training in communication round #28.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:22,  4.30s/it]  4%|▍         | 2/48 [00:04<01:34,  2.05s/it]  6%|▋         | 3/48 [00:05<01:00,  1.34s/it]  8%|▊         | 4/48 [00:05<00:43,  1.00it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.41it/s] 15%|█▍        | 7/48 [00:07<00:26,  1.58it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.70it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.88it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][09:49:58]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
{'train_runtime': 26.7625, 'train_samples_per_second': 226.212, 'train_steps_per_second': 1.794, 'train_loss': 2.740995724995931, 'epoch': 3.0}
[INFO][09:49:59]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
[INFO][09:50:00]: [Client #9] Model trained.
[INFO][09:50:00]: [Client #9] Inbound data has been processed.
[INFO][09:50:00]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:50:04]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:50:05]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:50:05]: [Server #3536466] Adding client #49 to the list of clients for aggregation.
[INFO][09:50:05]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:50:05]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:50:05]: [Server #3536466] Adding client #41 to the list of clients for aggregation.
[INFO][09:50:05]: [Server #3536466] Adding client #66 to the list of clients for aggregation.
[INFO][09:50:05]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:50:05]: [Server #3536466] Updated weights have been received.
[INFO][09:50:06]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:50:06]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:50:06]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.2367e+00  1e+02  1e+00  1e+00
 1:  2.0708e+00  1.2568e+00  7e+00  6e-02  6e-02
 2:  2.2395e+00  1.3946e+00  9e-01  5e-04  5e-04
 3:  2.2407e+00  2.1981e+00  4e-02  4e-06  4e-06
 4:  2.2395e+00  2.2353e+00  4e-03  4e-07  4e-07
 5:  2.2373e+00  2.2354e+00  2e-03  7e-07  2e-07
 6:  2.2369e+00  2.2358e+00  1e-03  6e-07  2e-07
 7:  2.2361e+00  2.2358e+00  4e-04  2e-06  1e-06
 8:  2.2359e+00  2.2358e+00  8e-05  7e-07  4e-07
 9:  2.2358e+00  2.2358e+00  5e-06  7e-08  4e-08
10:  2.2358e+00  2.2358e+00  8e-08  1e-09  6e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.01 1.1  1.1  1.1  0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  0.01 0.01 0.01 0.01 6.1  1.1  1.1
 4.1  0.01 6.1  2.1  0.01 2.1  0.01 0.01 1.1  1.1  0.01 5.1  0.1  1.1
 0.01 0.01 0.01 1.1  4.1  1.1  5.1  6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  0.1  3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 0.01 6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.01 0.2  0.01 0.01 0.2  0.2  0.01 0.2  0.2  0.2
 0.01 0.01 0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.80it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.34it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.77it/s]100%|██████████| 8/8 [00:00<00:00, 11.59it/s]
[INFO][09:50:17]: [93m[1m[Server #3536466] Global model perplexity: 29.39
[0m
[INFO][09:50:17]: [Server #3536466] All client reports have been processed.
[INFO][09:50:17]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_28.pth.
[INFO][09:50:20]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_28.pth.
[INFO][09:50:20]: [93m[1m
[Server #3536466] Starting round 29/100.[0m
[INFO][09:50:20]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([1.29811397e-06, 3.13038170e-07, 3.13038170e-07, 3.13038170e-07,
       1.29811397e-06, 3.13038170e-07, 1.29811397e-06, 3.13038170e-07,
       2.49985792e-01, 1.29811397e-06, 1.29811397e-06, 1.29811397e-06,
       2.49985792e-01, 3.13038170e-07, 6.39378313e-08, 3.13038170e-07,
       3.13038170e-07, 3.13038170e-07, 6.39378313e-08, 2.76984996e-08,
       3.13038170e-07, 1.29811397e-06, 1.29811397e-06, 1.29811397e-06,
       6.90321365e-09, 3.13038170e-07, 3.13038170e-07, 1.55107400e-08,
       1.29811397e-06, 6.90321365e-09, 6.39378313e-08, 1.29811397e-06,
       6.39378313e-08, 1.29811397e-06, 1.29811397e-06, 3.13038170e-07,
       9.92797486e-09, 2.49985792e-01, 3.13038170e-07, 1.29811397e-06,
       1.29811397e-06, 3.13038170e-07, 1.55107400e-08, 3.13038170e-07,
       9.92797486e-09, 6.90321365e-09, 1.29811397e-06, 1.29811397e-06,
       1.29811397e-06, 1.29811397e-06, 3.13038170e-07, 1.29811397e-06,
       3.13038170e-07, 1.29811397e-06, 3.13038170e-07, 3.13038170e-07,
       3.13038170e-07, 3.13038170e-07, 2.76984996e-08, 9.92797486e-09,
       2.76984996e-08, 2.49985792e-01, 2.76984996e-08, 1.29811397e-06,
       3.13038170e-07, 1.29811397e-06, 1.29811397e-06, 2.76984996e-08,
       6.90321365e-09, 3.13038170e-07, 2.76984996e-08, 3.13038170e-07,
       1.29811397e-06, 3.13038170e-07, 6.39378313e-08, 1.29811397e-06,
       1.29811397e-06, 6.39378313e-08, 1.29811397e-06, 3.13038170e-07,
       1.29811397e-06, 6.90321365e-09, 3.13038170e-07, 1.29811397e-06,
       1.29811397e-06, 3.13038170e-07, 2.76984996e-08, 2.76984996e-08,
       1.29811397e-06, 1.29811397e-06, 1.29811397e-06, 1.29811397e-06,
       1.29811397e-06, 9.92797486e-09, 3.13038170e-07]),)
[INFO][09:50:20]: [Server #3536466] Selected clients: [66  9 41 13  1]
[INFO][09:50:20]: [Server #3536466] Selecting client #66 for training.
[INFO][09:50:20]: [Server #3536466] Sending the current model to client #66 (simulated).
[INFO][09:50:25]: [Server #3536466] Sending 507.38 MB of payload data to client #66 (simulated).
[INFO][09:50:25]: [Server #3536466] Selecting client #1 for training.
[INFO][09:50:25]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][09:50:29]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][09:50:29]: [Client #66] Selected by the server.
[INFO][09:50:29]: [Client #66] Loading its data source...
[INFO][09:50:29]: [Client #66] Dataset size: 2018
[INFO][09:50:29]: [Client #66] Sampler: iid
[INFO][09:50:29]: [Client #1] Selected by the server.
[INFO][09:50:29]: [Client #1] Loading its data source...
[INFO][09:50:29]: [Client #1] Dataset size: 2018
[INFO][09:50:29]: [Client #1] Sampler: iid
[INFO][09:50:30]: [Client #66] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:50:30]: [Client #66] Start to process inbound data.
[INFO][09:50:31]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:50:31]: [Client #1] Start to process inbound data.
[INFO][09:50:31]: [93m[1m[Client #66] Started training in communication round #29.[0m
[INFO][09:50:31]: [93m[1m[Client #1] Started training in communication round #29.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:39,  4.68s/it]  2%|▏         | 1/48 [00:04<03:47,  4.85s/it]  4%|▍         | 2/48 [00:05<01:48,  2.36s/it]  4%|▍         | 2/48 [00:05<01:51,  2.43s/it]  6%|▋         | 3/48 [00:06<01:12,  1.62s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it]  8%|▊         | 4/48 [00:06<00:55,  1.27s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.31it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.34it/s]100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][09:51:17]: [Client #66] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
{'train_runtime': 39.6406, 'train_samples_per_second': 152.722, 'train_steps_per_second': 1.211, 'train_loss': 3.2320372263590493, 'epoch': 3.0}
[INFO][09:51:17]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 39.4879, 'train_samples_per_second': 153.313, 'train_steps_per_second': 1.216, 'train_loss': 3.296783765157064, 'epoch': 3.0}
[INFO][09:51:18]: [Client #66] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
[INFO][09:51:18]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][09:51:18]: [Client #66] Model trained.
[INFO][09:51:18]: [Client #66] Inbound data has been processed.
[INFO][09:51:18]: [Client #66] Outbound data is ready to be sent after being processed.
[INFO][09:51:19]: [Client #1] Model trained.
[INFO][09:51:19]: [Client #1] Inbound data has been processed.
[INFO][09:51:19]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][09:51:26]: [Client #66] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:51:26]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:51:27]: [Server #3536466] Received 507.38 MB of payload data from client #66 (simulated).
[INFO][09:51:28]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][09:51:28]: [Server #3536466] Selecting client #9 for training.
[INFO][09:51:28]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:51:32]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:51:32]: [Server #3536466] Selecting client #13 for training.
[INFO][09:51:32]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:51:36]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:51:36]: [Client #13] Selected by the server.
[INFO][09:51:36]: [Client #9] Selected by the server.
[INFO][09:51:36]: [Client #13] Loading its data source...
[INFO][09:51:36]: [Client #9] Loading its data source...
[INFO][09:51:36]: [Client #13] Dataset size: 2018
[INFO][09:51:36]: [Client #9] Dataset size: 2018
[INFO][09:51:36]: [Client #13] Sampler: iid
[INFO][09:51:36]: [Client #9] Sampler: iid
[INFO][09:51:38]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:51:38]: [Client #13] Start to process inbound data.
[INFO][09:51:38]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:51:38]: [Client #9] Start to process inbound data.
[INFO][09:51:38]: [93m[1m[Client #13] Started training in communication round #29.[0m
[INFO][09:51:38]: [93m[1m[Client #9] Started training in communication round #29.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.23s/it]  2%|▏         | 1/48 [00:04<03:42,  4.74s/it]  4%|▍         | 2/48 [00:04<01:38,  2.15s/it]  4%|▍         | 2/48 [00:05<01:50,  2.40s/it]  6%|▋         | 3/48 [00:05<01:07,  1.50s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.25it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.29it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.36it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:21,  1.33it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.31it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.32it/s] 50%|█████     | 24/48 [00:21<00:18,  1.32it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.30it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.31it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.31it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.35it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.35it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][09:52:24]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536585.pth.
{'train_runtime': 39.2524, 'train_samples_per_second': 154.233, 'train_steps_per_second': 1.223, 'train_loss': 2.681891441345215, 'epoch': 3.0}
[INFO][09:52:24]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
{'train_runtime': 39.6094, 'train_samples_per_second': 152.842, 'train_steps_per_second': 1.212, 'train_loss': 2.7127815882364907, 'epoch': 3.0}
[INFO][09:52:25]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536585.pth.
[INFO][09:52:25]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
[INFO][09:52:25]: [Client #13] Model trained.
[INFO][09:52:25]: [Client #13] Inbound data has been processed.
[INFO][09:52:25]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:52:26]: [Client #9] Model trained.
[INFO][09:52:26]: [Client #9] Inbound data has been processed.
[INFO][09:52:26]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:52:32]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:52:33]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:52:33]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:52:34]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:52:34]: [Server #3536466] Selecting client #41 for training.
[INFO][09:52:34]: [Server #3536466] Sending the current model to client #41 (simulated).
[INFO][09:52:39]: [Server #3536466] Sending 507.38 MB of payload data to client #41 (simulated).
[INFO][09:52:39]: [Client #41] Selected by the server.
[INFO][09:52:39]: [Client #41] Loading its data source...
[INFO][09:52:39]: [Client #41] Dataset size: 2018
[INFO][09:52:39]: [Client #41] Sampler: iid
[INFO][09:52:40]: [Client #41] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:52:40]: [Client #41] Start to process inbound data.
[INFO][09:52:40]: [93m[1m[Client #41] Started training in communication round #29.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.25s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.58it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.70it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.80it/s] 21%|██        | 10/48 [00:08<00:20,  1.88it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.93it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.12it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.11it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.10it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.08it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.08it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][09:53:13]: [Client #41] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536584.pth.
{'train_runtime': 26.6941, 'train_samples_per_second': 226.792, 'train_steps_per_second': 1.798, 'train_loss': 2.994069735209147, 'epoch': 3.0}
[INFO][09:53:14]: [Client #41] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536584.pth.
[INFO][09:53:15]: [Client #41] Model trained.
[INFO][09:53:15]: [Client #41] Inbound data has been processed.
[INFO][09:53:15]: [Client #41] Outbound data is ready to be sent after being processed.
[INFO][09:53:19]: [Client #41] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:53:21]: [Server #3536466] Received 507.38 MB of payload data from client #41 (simulated).
[INFO][09:53:21]: [Server #3536466] Adding client #38 to the list of clients for aggregation.
[INFO][09:53:21]: [Server #3536466] Adding client #44 to the list of clients for aggregation.
[INFO][09:53:21]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][09:53:21]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:53:21]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:53:21]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:53:21]: [Server #3536466] Updated weights have been received.
[INFO][09:53:21]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:53:22]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:53:22]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.2884e+00  1e+02  1e+00  1e+00
 1:  2.1284e+00  1.3084e+00  7e+00  6e-02  6e-02
 2:  2.2913e+00  1.4529e+00  9e-01  4e-04  4e-04
 3:  2.2924e+00  2.2530e+00  4e-02  4e-06  4e-06
 4:  2.2911e+00  2.2870e+00  4e-03  4e-07  4e-07
 5:  2.2889e+00  2.2870e+00  2e-03  7e-07  2e-07
 6:  2.2885e+00  2.2874e+00  1e-03  5e-07  2e-07
 7:  2.2878e+00  2.2874e+00  3e-04  2e-06  1e-06
 8:  2.2875e+00  2.2875e+00  7e-05  7e-07  4e-07
 9:  2.2875e+00  2.2875e+00  5e-06  7e-08  4e-08
10:  2.2875e+00  2.2875e+00  7e-08  1e-09  6e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1  1.1  1.1  1.1  0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  0.01 0.01 0.01 0.01 6.1  1.1  1.1
 4.1  0.01 6.1  2.1  0.01 2.1  0.01 0.01 1.1  1.1  0.01 5.1  0.1  1.1
 0.01 5.1  0.01 1.1  4.1  1.1  5.1  6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  0.1  3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 0.01 6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.01 0.2  0.01 0.01 0.2  0.2  0.01 0.2  0.2  0.2
 0.01 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.22it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.38it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.99it/s]100%|██████████| 8/8 [00:00<00:00, 11.80it/s]
[INFO][09:53:33]: [93m[1m[Server #3536466] Global model perplexity: 28.77
[0m
[INFO][09:53:33]: [Server #3536466] All client reports have been processed.
[INFO][09:53:33]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_29.pth.
[INFO][09:53:36]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_29.pth.
[INFO][09:53:36]: [93m[1m
[Server #3536466] Starting round 30/100.[0m
[INFO][09:53:36]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([3.33233597e-01, 1.48982324e-06, 1.48982324e-06, 1.48982324e-06,
       7.13662088e-06, 1.48982324e-06, 7.13662088e-06, 1.48982324e-06,
       3.33233597e-01, 7.13662088e-06, 7.13662088e-06, 7.13662088e-06,
       3.33233597e-01, 1.48982324e-06, 2.89193979e-07, 1.48982324e-06,
       1.48982324e-06, 1.48982324e-06, 2.89193979e-07, 1.24176381e-07,
       1.48982324e-06, 7.13662088e-06, 7.13662088e-06, 7.13662088e-06,
       3.07791489e-08, 1.48982324e-06, 1.48982324e-06, 6.93189693e-08,
       7.13662088e-06, 3.07791489e-08, 2.89193979e-07, 7.13662088e-06,
       2.89193979e-07, 7.13662088e-06, 7.13662088e-06, 1.48982324e-06,
       1.48982324e-06, 4.43026335e-08, 1.48982324e-06, 7.13662088e-06,
       4.43026335e-08, 7.13662088e-06, 1.48982324e-06, 6.93189693e-08,
       1.48982324e-06, 4.43026335e-08, 3.07791489e-08, 7.13662088e-06,
       7.13662088e-06, 7.13662088e-06, 7.13662088e-06, 1.48982324e-06,
       7.13662088e-06, 1.48982324e-06, 7.13662088e-06, 1.48982324e-06,
       1.48982324e-06, 1.48982324e-06, 1.48982324e-06, 1.24176381e-07,
       4.43026335e-08, 1.24176381e-07, 1.24176381e-07, 7.13662088e-06,
       1.48982324e-06, 7.13662088e-06, 7.13662088e-06, 1.24176381e-07,
       3.07791489e-08, 1.48982324e-06, 1.24176381e-07, 1.48982324e-06,
       7.13662088e-06, 1.48982324e-06, 2.89193979e-07, 7.13662088e-06,
       7.13662088e-06, 2.89193979e-07, 7.13662088e-06, 1.48982324e-06,
       7.13662088e-06, 3.07791489e-08, 1.48982324e-06, 7.13662088e-06,
       7.13662088e-06, 1.48982324e-06, 1.24176381e-07, 1.24176381e-07,
       7.13662088e-06, 7.13662088e-06, 7.13662088e-06, 7.13662088e-06,
       7.13662088e-06, 4.43026335e-08, 1.48982324e-06]),)
[INFO][09:53:36]: [Server #3536466] Selected clients: [ 9 13  1 35 98]
[INFO][09:53:36]: [Server #3536466] Selecting client #98 for training.
[INFO][09:53:36]: [Server #3536466] Sending the current model to client #98 (simulated).
[INFO][09:53:40]: [Server #3536466] Sending 507.38 MB of payload data to client #98 (simulated).
[INFO][09:53:40]: [Server #3536466] Selecting client #1 for training.
[INFO][09:53:40]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][09:53:45]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][09:53:45]: [Client #98] Selected by the server.
[INFO][09:53:45]: [Client #98] Loading its data source...
[INFO][09:53:45]: [Client #98] Dataset size: 2018
[INFO][09:53:45]: [Client #98] Sampler: iid
[INFO][09:53:45]: [Client #1] Selected by the server.
[INFO][09:53:45]: [Client #1] Loading its data source...
[INFO][09:53:45]: [Client #1] Dataset size: 2018
[INFO][09:53:45]: [Client #1] Sampler: iid
[INFO][09:53:46]: [Client #98] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:53:46]: [Client #98] Start to process inbound data.
[INFO][09:53:46]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:53:46]: [Client #1] Start to process inbound data.
[INFO][09:53:47]: [93m[1m[Client #98] Started training in communication round #30.[0m
[INFO][09:53:47]: [93m[1m[Client #1] Started training in communication round #30.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:42,  4.73s/it]  2%|▏         | 1/48 [00:04<03:45,  4.81s/it]  4%|▍         | 2/48 [00:05<01:48,  2.37s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it]  8%|▊         | 4/48 [00:06<00:55,  1.27s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.31it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][09:54:33]: [Client #98] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_98_3536584.pth.
{'train_runtime': 39.5482, 'train_samples_per_second': 153.079, 'train_steps_per_second': 1.214, 'train_loss': 3.354034105936686, 'epoch': 3.0}
[INFO][09:54:33]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 39.4503, 'train_samples_per_second': 153.459, 'train_steps_per_second': 1.217, 'train_loss': 3.192356745402018, 'epoch': 3.0}
[INFO][09:54:34]: [Client #98] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_98_3536584.pth.
[INFO][09:54:34]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][09:54:35]: [Client #98] Model trained.
[INFO][09:54:35]: [Client #98] Inbound data has been processed.
[INFO][09:54:35]: [Client #98] Outbound data is ready to be sent after being processed.
[INFO][09:54:35]: [Client #1] Model trained.
[INFO][09:54:35]: [Client #1] Inbound data has been processed.
[INFO][09:54:35]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][09:54:43]: [Client #98] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:54:43]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:54:44]: [Server #3536466] Received 507.38 MB of payload data from client #98 (simulated).
[INFO][09:54:45]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][09:54:45]: [Server #3536466] Selecting client #35 for training.
[INFO][09:54:45]: [Server #3536466] Sending the current model to client #35 (simulated).
[INFO][09:54:49]: [Server #3536466] Sending 507.38 MB of payload data to client #35 (simulated).
[INFO][09:54:49]: [Server #3536466] Selecting client #9 for training.
[INFO][09:54:49]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:54:53]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:54:53]: [Client #35] Selected by the server.
[INFO][09:54:53]: [Client #35] Loading its data source...
[INFO][09:54:53]: [Client #35] Dataset size: 2018
[INFO][09:54:53]: [Client #35] Sampler: iid
[INFO][09:54:53]: [Client #9] Selected by the server.
[INFO][09:54:53]: [Client #9] Loading its data source...
[INFO][09:54:53]: [Client #9] Dataset size: 2018
[INFO][09:54:53]: [Client #9] Sampler: iid
[INFO][09:54:55]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:54:55]: [Client #9] Start to process inbound data.
[INFO][09:54:55]: [Client #35] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:54:55]: [Client #35] Start to process inbound data.
[INFO][09:54:56]: [93m[1m[Client #9] Started training in communication round #30.[0m
[INFO][09:54:56]: [93m[1m[Client #35] Started training in communication round #30.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:45,  4.79s/it]  2%|▏         | 1/48 [00:04<03:46,  4.83s/it]  4%|▍         | 2/48 [00:05<01:50,  2.40s/it]  4%|▍         | 2/48 [00:05<01:52,  2.44s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it]  8%|▊         | 4/48 [00:07<00:57,  1.30s/it] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.16it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.34it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.32it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.32it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.32it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.32it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.32it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:22<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
[INFO][09:55:42]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.8556, 'train_samples_per_second': 151.898, 'train_steps_per_second': 1.204, 'train_loss': 2.6883872350056968, 'epoch': 3.0}
[INFO][09:55:42]: [Client #35] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_35_3536584.pth.
{'train_runtime': 39.7995, 'train_samples_per_second': 152.112, 'train_steps_per_second': 1.206, 'train_loss': 3.24869696299235, 'epoch': 3.0}
[INFO][09:55:43]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][09:55:43]: [Client #35] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_35_3536584.pth.
[INFO][09:55:43]: [Client #9] Model trained.
[INFO][09:55:43]: [Client #9] Inbound data has been processed.
[INFO][09:55:43]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:55:44]: [Client #35] Model trained.
[INFO][09:55:44]: [Client #35] Inbound data has been processed.
[INFO][09:55:44]: [Client #35] Outbound data is ready to be sent after being processed.
[INFO][09:55:51]: [Client #35] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:55:52]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:55:53]: [Server #3536466] Received 507.38 MB of payload data from client #35 (simulated).
[INFO][09:55:54]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:55:54]: [Server #3536466] Selecting client #13 for training.
[INFO][09:55:54]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:55:58]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:55:58]: [Client #13] Selected by the server.
[INFO][09:55:58]: [Client #13] Loading its data source...
[INFO][09:55:58]: [Client #13] Dataset size: 2018
[INFO][09:55:58]: [Client #13] Sampler: iid
[INFO][09:55:59]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:55:59]: [Client #13] Start to process inbound data.
[INFO][09:56:00]: [93m[1m[Client #13] Started training in communication round #30.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.22s/it]  4%|▍         | 2/48 [00:04<01:32,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:09<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.08it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.08it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.08it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.07it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.07it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.06it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.13it/s] 71%|███████   | 34/48 [00:19<00:06,  2.11it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.07it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][09:56:32]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
{'train_runtime': 26.6897, 'train_samples_per_second': 226.829, 'train_steps_per_second': 1.798, 'train_loss': 2.650099754333496, 'epoch': 3.0}
[INFO][09:56:34]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
[INFO][09:56:34]: [Client #13] Model trained.
[INFO][09:56:34]: [Client #13] Inbound data has been processed.
[INFO][09:56:34]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:56:38]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:56:40]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:56:40]: [Server #3536466] Adding client #41 to the list of clients for aggregation.
[INFO][09:56:40]: [Server #3536466] Adding client #66 to the list of clients for aggregation.
[INFO][09:56:40]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][09:56:40]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:56:40]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:56:40]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:56:40]: [Server #3536466] Updated weights have been received.
[INFO][09:56:40]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:56:41]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:56:41]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.3430e+00  1e+02  1e+00  1e+00
 1:  2.1897e+00  1.3631e+00  6e+00  6e-02  6e-02
 2:  2.3463e+00  1.5151e+00  9e-01  4e-04  4e-04
 3:  2.3472e+00  2.3112e+00  4e-02  3e-06  3e-06
 4:  2.3458e+00  2.3418e+00  4e-03  4e-07  4e-07
 5:  2.3437e+00  2.3417e+00  2e-03  6e-07  2e-07
 6:  2.3433e+00  2.3422e+00  1e-03  5e-07  2e-07
 7:  2.3426e+00  2.3422e+00  4e-04  3e-06  2e-06
 8:  2.3424e+00  2.3422e+00  1e-04  1e-06  7e-07
 9:  2.3423e+00  2.3422e+00  1e-05  2e-07  1e-07
10:  2.3422e+00  2.3422e+00  3e-07  6e-09  4e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1  1.1  1.1  1.1  0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  0.01 0.01 0.01 0.01 6.1  1.1  1.1
 4.1  0.01 6.1  2.1  0.01 2.1  0.01 0.01 1.1  1.1  0.01 5.1  1.1  1.1
 0.01 5.1  0.01 1.1  4.1  1.1  5.1  6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 0.01 6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.01 0.2  0.01 0.01 0.2  0.2  0.01 0.2  0.2  0.2
 0.01 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.89it/s] 62%|██████▎   | 5/8 [00:00<00:00, 12.72it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.95it/s]100%|██████████| 8/8 [00:00<00:00, 11.66it/s]
[INFO][09:56:52]: [93m[1m[Server #3536466] Global model perplexity: 29.37
[0m
[INFO][09:56:52]: [Server #3536466] All client reports have been processed.
[INFO][09:56:52]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_30.pth.
[INFO][09:56:55]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_30.pth.
[INFO][09:56:55]: [93m[1m
[Server #3536466] Starting round 31/100.[0m
[INFO][09:56:55]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([3.33243953e-01, 1.38819061e-06, 1.38819061e-06, 1.38819061e-06,
       6.64581634e-06, 1.38819061e-06, 6.64581634e-06, 1.38819061e-06,
       3.33243953e-01, 6.64581634e-06, 6.64581634e-06, 6.64581634e-06,
       3.33243953e-01, 1.38819061e-06, 2.69205454e-07, 1.38819061e-06,
       1.38819061e-06, 1.38819061e-06, 2.69205454e-07, 1.15582321e-07,
       1.38819061e-06, 6.64581634e-06, 6.64581634e-06, 6.64581634e-06,
       2.86472784e-08, 1.38819061e-06, 1.38819061e-06, 6.45195539e-08,
       6.64581634e-06, 2.86472784e-08, 2.69205454e-07, 6.64581634e-06,
       2.69205454e-07, 6.64581634e-06, 1.38819061e-06, 1.38819061e-06,
       4.12345602e-08, 1.38819061e-06, 1.38819061e-06, 6.64581634e-06,
       4.12345602e-08, 6.64581634e-06, 1.38819061e-06, 6.45195539e-08,
       1.38819061e-06, 4.12345602e-08, 2.86472784e-08, 6.64581634e-06,
       6.64581634e-06, 6.64581634e-06, 6.64581634e-06, 1.38819061e-06,
       6.64581634e-06, 1.38819061e-06, 6.64581634e-06, 1.38819061e-06,
       1.38819061e-06, 1.38819061e-06, 1.38819061e-06, 1.15582321e-07,
       4.12345602e-08, 1.15582321e-07, 1.38819061e-06, 1.15582321e-07,
       6.64581634e-06, 1.38819061e-06, 6.64581634e-06, 6.64581634e-06,
       1.15582321e-07, 2.86472784e-08, 1.38819061e-06, 1.15582321e-07,
       1.38819061e-06, 6.64581634e-06, 1.38819061e-06, 2.69205454e-07,
       6.64581634e-06, 6.64581634e-06, 2.69205454e-07, 6.64581634e-06,
       1.38819061e-06, 6.64581634e-06, 2.86472784e-08, 1.38819061e-06,
       6.64581634e-06, 6.64581634e-06, 1.38819061e-06, 1.15582321e-07,
       1.15582321e-07, 6.64581634e-06, 6.64581634e-06, 6.64581634e-06,
       6.64581634e-06, 4.12345602e-08, 1.38819061e-06]),)
[INFO][09:56:55]: [Server #3536466] Selected clients: [ 1  9 13 11 33]
[INFO][09:56:55]: [Server #3536466] Selecting client #1 for training.
[INFO][09:56:55]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][09:56:59]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][09:56:59]: [Server #3536466] Selecting client #33 for training.
[INFO][09:56:59]: [Server #3536466] Sending the current model to client #33 (simulated).
[INFO][09:57:03]: [Server #3536466] Sending 507.38 MB of payload data to client #33 (simulated).
[INFO][09:57:03]: [Client #1] Selected by the server.
[INFO][09:57:03]: [Client #1] Loading its data source...
[INFO][09:57:03]: [Client #1] Dataset size: 2018
[INFO][09:57:03]: [Client #1] Sampler: iid
[INFO][09:57:03]: [Client #33] Selected by the server.
[INFO][09:57:03]: [Client #33] Loading its data source...
[INFO][09:57:03]: [Client #33] Dataset size: 2018
[INFO][09:57:03]: [Client #33] Sampler: iid
[INFO][09:57:05]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:57:05]: [Client #1] Start to process inbound data.
[INFO][09:57:05]: [Client #33] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:57:05]: [Client #33] Start to process inbound data.
[INFO][09:57:06]: [93m[1m[Client #1] Started training in communication round #31.[0m
[INFO][09:57:06]: [93m[1m[Client #33] Started training in communication round #31.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:05<03:57,  5.05s/it]  2%|▏         | 1/48 [00:05<03:55,  5.00s/it]  4%|▍         | 2/48 [00:05<02:00,  2.62s/it]  4%|▍         | 2/48 [00:05<02:00,  2.62s/it]  6%|▋         | 3/48 [00:06<01:21,  1.81s/it]  6%|▋         | 3/48 [00:06<01:21,  1.81s/it]  8%|▊         | 4/48 [00:07<01:02,  1.43s/it]  8%|▊         | 4/48 [00:07<01:03,  1.43s/it] 10%|█         | 5/48 [00:08<00:50,  1.19s/it] 10%|█         | 5/48 [00:08<00:51,  1.20s/it] 12%|█▎        | 6/48 [00:09<00:43,  1.03s/it] 12%|█▎        | 6/48 [00:09<00:44,  1.05s/it] 15%|█▍        | 7/48 [00:09<00:38,  1.07it/s] 15%|█▍        | 7/48 [00:09<00:38,  1.05it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.14it/s] 17%|█▋        | 8/48 [00:10<00:35,  1.13it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.21it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.19it/s] 21%|██        | 10/48 [00:12<00:30,  1.25it/s] 21%|██        | 10/48 [00:12<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:14<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:15<00:25,  1.31it/s] 29%|██▉       | 14/48 [00:15<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:21,  1.32it/s] 42%|████▏     | 20/48 [00:19<00:21,  1.33it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.33it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:21<00:19,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:24<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:26<00:14,  1.32it/s] 60%|██████    | 29/48 [00:26<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:27<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:27<00:13,  1.32it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:29<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:29<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.37it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:40<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.39it/s]100%|██████████| 48/48 [00:40<00:00,  1.19it/s]
100%|██████████| 48/48 [00:40<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.41it/s]100%|██████████| 48/48 [00:40<00:00,  1.19it/s]
[INFO][09:57:52]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536584.pth.
{'train_runtime': 40.2929, 'train_samples_per_second': 150.25, 'train_steps_per_second': 1.191, 'train_loss': 3.115283966064453, 'epoch': 3.0}
[INFO][09:57:53]: [Client #33] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
{'train_runtime': 40.2516, 'train_samples_per_second': 150.404, 'train_steps_per_second': 1.193, 'train_loss': 3.2390193939208984, 'epoch': 3.0}
[INFO][09:57:53]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536584.pth.
[INFO][09:57:54]: [Client #33] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
[INFO][09:57:54]: [Client #1] Model trained.
[INFO][09:57:54]: [Client #1] Inbound data has been processed.
[INFO][09:57:54]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][09:57:54]: [Client #33] Model trained.
[INFO][09:57:54]: [Client #33] Inbound data has been processed.
[INFO][09:57:54]: [Client #33] Outbound data is ready to be sent after being processed.
[INFO][09:58:02]: [Client #33] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:58:02]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:58:03]: [Server #3536466] Received 507.38 MB of payload data from client #33 (simulated).
[INFO][09:58:04]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][09:58:04]: [Server #3536466] Selecting client #9 for training.
[INFO][09:58:04]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][09:58:08]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][09:58:08]: [Server #3536466] Selecting client #11 for training.
[INFO][09:58:08]: [Server #3536466] Sending the current model to client #11 (simulated).
[INFO][09:58:12]: [Server #3536466] Sending 507.38 MB of payload data to client #11 (simulated).
[INFO][09:58:12]: [Client #11] Selected by the server.
[INFO][09:58:12]: [Client #9] Selected by the server.
[INFO][09:58:12]: [Client #11] Loading its data source...
[INFO][09:58:12]: [Client #9] Loading its data source...
[INFO][09:58:12]: [Client #11] Dataset size: 2018
[INFO][09:58:12]: [Client #11] Sampler: iid
[INFO][09:58:12]: [Client #9] Dataset size: 2018
[INFO][09:58:12]: [Client #9] Sampler: iid
[INFO][09:58:13]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:58:13]: [Client #9] Start to process inbound data.
[INFO][09:58:13]: [Client #11] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:58:13]: [Client #11] Start to process inbound data.
[INFO][09:58:14]: [93m[1m[Client #9] Started training in communication round #31.[0m
[INFO][09:58:14]: [93m[1m[Client #11] Started training in communication round #31.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:11,  4.08s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:38,  2.15s/it]  2%|▏         | 1/48 [00:04<03:43,  4.75s/it]  6%|▋         | 3/48 [00:05<01:07,  1.51s/it]  4%|▍         | 2/48 [00:05<01:50,  2.39s/it]  8%|▊         | 4/48 [00:06<00:53,  1.23s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it] 10%|█         | 5/48 [00:07<00:45,  1.06s/it]  8%|▊         | 4/48 [00:07<00:57,  1.30s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.05it/s] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 21%|██        | 10/48 [00:10<00:30,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:25,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.31it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 71%|███████   | 34/48 [00:28<00:10,  1.32it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.34it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 71%|███████   | 34/48 [00:29<00:10,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.32it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.33it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
 98%|█████████▊| 47/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.58it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.58it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][09:58:59]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
{'train_runtime': 39.1074, 'train_samples_per_second': 154.805, 'train_steps_per_second': 1.227, 'train_loss': 2.6283628145853677, 'epoch': 3.0}
[INFO][09:58:59]: [Client #11] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_11_3536585.pth.
{'train_runtime': 39.4329, 'train_samples_per_second': 153.527, 'train_steps_per_second': 1.217, 'train_loss': 3.2500282923380532, 'epoch': 3.0}
[INFO][09:59:00]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
[INFO][09:59:01]: [Client #11] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_11_3536585.pth.
[INFO][09:59:01]: [Client #9] Model trained.
[INFO][09:59:01]: [Client #9] Inbound data has been processed.
[INFO][09:59:01]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][09:59:01]: [Client #11] Model trained.
[INFO][09:59:01]: [Client #11] Inbound data has been processed.
[INFO][09:59:01]: [Client #11] Outbound data is ready to be sent after being processed.
[INFO][09:59:09]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:59:09]: [Client #11] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:59:10]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][09:59:11]: [Server #3536466] Received 507.38 MB of payload data from client #11 (simulated).
[INFO][09:59:11]: [Server #3536466] Selecting client #13 for training.
[INFO][09:59:11]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][09:59:15]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][09:59:15]: [Client #13] Selected by the server.
[INFO][09:59:15]: [Client #13] Loading its data source...
[INFO][09:59:15]: [Client #13] Dataset size: 2018
[INFO][09:59:15]: [Client #13] Sampler: iid
[INFO][09:59:17]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][09:59:17]: [Client #13] Start to process inbound data.
[INFO][09:59:17]: [93m[1m[Client #13] Started training in communication round #31.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.25s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:09<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.02it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.12it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.10it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.13it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.08it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.08it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.08it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.08it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][09:59:50]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
{'train_runtime': 26.6565, 'train_samples_per_second': 227.112, 'train_steps_per_second': 1.801, 'train_loss': 2.58457883199056, 'epoch': 3.0}
[INFO][09:59:51]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
[INFO][09:59:51]: [Client #13] Model trained.
[INFO][09:59:51]: [Client #13] Inbound data has been processed.
[INFO][09:59:51]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][09:59:56]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][09:59:57]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][09:59:57]: [Server #3536466] Adding client #22 to the list of clients for aggregation.
[INFO][09:59:57]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][09:59:57]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][09:59:57]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][09:59:57]: [Server #3536466] Adding client #33 to the list of clients for aggregation.
[INFO][09:59:57]: [Server #3536466] Aggregating 5 clients in total.
[INFO][09:59:57]: [Server #3536466] Updated weights have been received.
[INFO][09:59:57]: [Server #3536466] Aggregating model weight deltas.
[INFO][09:59:58]: [Server #3536466] Finished aggregating updated weights.
[INFO][09:59:58]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.3496e+00  1e+02  1e+00  1e+00
 1:  2.1972e+00  1.3696e+00  6e+00  6e-02  6e-02
 2:  2.3528e+00  1.5225e+00  9e-01  4e-04  4e-04
 3:  2.3538e+00  2.3181e+00  4e-02  3e-06  3e-06
 4:  2.3524e+00  2.3483e+00  4e-03  4e-07  4e-07
 5:  2.3503e+00  2.3482e+00  2e-03  6e-07  2e-07
 6:  2.3499e+00  2.3487e+00  1e-03  5e-07  2e-07
 7:  2.3492e+00  2.3488e+00  4e-04  3e-06  2e-06
 8:  2.3489e+00  2.3488e+00  1e-04  1e-06  7e-07
 9:  2.3488e+00  2.3488e+00  1e-05  2e-07  1e-07
10:  2.3488e+00  2.3488e+00  3e-07  5e-09  3e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1  1.1  1.1  1.1  0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  0.01 0.01 0.01 6.1  1.1  1.1
 4.1  0.01 6.1  2.1  0.1  2.1  0.01 0.01 1.1  1.1  0.01 5.1  1.1  1.1
 0.01 5.1  0.01 1.1  4.1  1.1  5.1  6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 0.01 6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.01 0.2  0.2  0.2
 0.01 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.84it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.26it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.90it/s]100%|██████████| 8/8 [00:00<00:00, 11.69it/s]
[INFO][10:00:09]: [93m[1m[Server #3536466] Global model perplexity: 29.68
[0m
[INFO][10:00:09]: [Server #3536466] All client reports have been processed.
[INFO][10:00:09]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_31.pth.
[INFO][10:00:12]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_31.pth.
[INFO][10:00:12]: [93m[1m
[Server #3536466] Starting round 32/100.[0m
[INFO][10:00:12]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.49991750e-01, 1.98790198e-07, 1.98790198e-07, 1.98790198e-07,
       8.38144133e-07, 1.98790198e-07, 8.38144133e-07, 1.98790198e-07,
       2.49991750e-01, 8.38144133e-07, 8.38144133e-07, 2.49991750e-01,
       1.98790198e-07, 4.01420475e-08, 1.98790198e-07, 1.98790198e-07,
       1.98790198e-07, 4.01420475e-08, 1.73705107e-08, 1.98790198e-07,
       4.32589624e-09, 8.38144133e-07, 8.38144133e-07, 8.38144133e-07,
       4.32589624e-09, 1.98790198e-07, 1.98790198e-07, 9.72356677e-09,
       8.38144133e-07, 4.32589624e-09, 4.01420475e-08, 2.49991750e-01,
       4.01420475e-08, 8.38144133e-07, 1.98790198e-07, 1.98790198e-07,
       6.22234944e-09, 1.98790198e-07, 1.98790198e-07, 8.38144133e-07,
       6.22234944e-09, 8.38144133e-07, 1.98790198e-07, 9.72356677e-09,
       1.98790198e-07, 6.22234944e-09, 4.32589624e-09, 8.38144133e-07,
       8.38144133e-07, 8.38144133e-07, 8.38144133e-07, 1.98790198e-07,
       8.38144133e-07, 1.98790198e-07, 8.38144133e-07, 1.98790198e-07,
       1.98790198e-07, 1.98790198e-07, 1.98790198e-07, 1.73705107e-08,
       6.22234944e-09, 1.73705107e-08, 1.98790198e-07, 1.73705107e-08,
       8.38144133e-07, 1.98790198e-07, 8.38144133e-07, 8.38144133e-07,
       1.73705107e-08, 4.32589624e-09, 1.98790198e-07, 1.73705107e-08,
       1.98790198e-07, 8.38144133e-07, 1.98790198e-07, 4.01420475e-08,
       8.38144133e-07, 8.38144133e-07, 4.01420475e-08, 8.38144133e-07,
       1.98790198e-07, 8.38144133e-07, 4.32589624e-09, 1.98790198e-07,
       8.38144133e-07, 8.38144133e-07, 1.98790198e-07, 1.73705107e-08,
       1.73705107e-08, 8.38144133e-07, 8.38144133e-07, 8.38144133e-07,
       8.38144133e-07, 6.22234944e-09, 1.98790198e-07]),)
[INFO][10:00:12]: [Server #3536466] Selected clients: [13 33  1  9  4]
[INFO][10:00:12]: [Server #3536466] Selecting client #4 for training.
[INFO][10:00:12]: [Server #3536466] Sending the current model to client #4 (simulated).
[INFO][10:00:16]: [Server #3536466] Sending 507.38 MB of payload data to client #4 (simulated).
[INFO][10:00:16]: [Server #3536466] Selecting client #33 for training.
[INFO][10:00:16]: [Server #3536466] Sending the current model to client #33 (simulated).
[INFO][10:00:21]: [Server #3536466] Sending 507.38 MB of payload data to client #33 (simulated).
[INFO][10:00:21]: [Client #4] Selected by the server.
[INFO][10:00:21]: [Client #4] Loading its data source...
[INFO][10:00:21]: [Client #4] Dataset size: 2018
[INFO][10:00:21]: [Client #4] Sampler: iid
[INFO][10:00:21]: [Client #33] Selected by the server.
[INFO][10:00:21]: [Client #33] Loading its data source...
[INFO][10:00:21]: [Client #33] Dataset size: 2018
[INFO][10:00:21]: [Client #33] Sampler: iid
[INFO][10:00:22]: [Client #4] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:00:22]: [Client #4] Start to process inbound data.
[INFO][10:00:22]: [93m[1m[Client #4] Started training in communication round #32.[0m
[INFO][10:00:22]: [Client #33] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:00:22]: [Client #33] Start to process inbound data.
[INFO][10:00:23]: [93m[1m[Client #33] Started training in communication round #32.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:31,  4.50s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:05<01:43,  2.25s/it]  2%|▏         | 1/48 [00:04<03:39,  4.67s/it]  6%|▋         | 3/48 [00:05<01:09,  1.55s/it]  4%|▍         | 2/48 [00:05<01:48,  2.36s/it]  8%|▊         | 4/48 [00:06<00:54,  1.23s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it] 10%|█         | 5/48 [00:07<00:46,  1.07s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it] 12%|█▎        | 6/48 [00:08<00:39,  1.05it/s] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 21%|██        | 10/48 [00:11<00:29,  1.28it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.34it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.31it/s] 50%|█████     | 24/48 [00:21<00:18,  1.32it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.31it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.31it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.31it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
 98%|█████████▊| 47/48 [00:38<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.58it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.58it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][10:01:08]: [Client #4] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_4_3536584.pth.
{'train_runtime': 39.2687, 'train_samples_per_second': 154.169, 'train_steps_per_second': 1.222, 'train_loss': 3.3213526407877603, 'epoch': 3.0}
[INFO][10:01:08]: [Client #33] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
{'train_runtime': 39.2796, 'train_samples_per_second': 154.126, 'train_steps_per_second': 1.222, 'train_loss': 3.12697696685791, 'epoch': 3.0}
[INFO][10:01:09]: [Client #4] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_4_3536584.pth.
[INFO][10:01:09]: [Client #33] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
[INFO][10:01:09]: [Client #4] Model trained.
[INFO][10:01:09]: [Client #4] Inbound data has been processed.
[INFO][10:01:09]: [Client #4] Outbound data is ready to be sent after being processed.
[INFO][10:01:10]: [Client #33] Model trained.
[INFO][10:01:10]: [Client #33] Inbound data has been processed.
[INFO][10:01:10]: [Client #33] Outbound data is ready to be sent after being processed.
[INFO][10:01:16]: [Client #4] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:01:17]: [Client #33] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:01:17]: [Server #3536466] Received 507.38 MB of payload data from client #4 (simulated).
[INFO][10:01:18]: [Server #3536466] Received 507.38 MB of payload data from client #33 (simulated).
[INFO][10:01:18]: [Server #3536466] Selecting client #1 for training.
[INFO][10:01:18]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][10:01:22]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][10:01:22]: [Server #3536466] Selecting client #9 for training.
[INFO][10:01:22]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][10:01:26]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][10:01:26]: [Client #1] Selected by the server.
[INFO][10:01:26]: [Client #1] Loading its data source...
[INFO][10:01:26]: [Client #1] Dataset size: 2018
[INFO][10:01:26]: [Client #1] Sampler: iid
[INFO][10:01:26]: [Client #9] Selected by the server.
[INFO][10:01:26]: [Client #9] Loading its data source...
[INFO][10:01:26]: [Client #9] Dataset size: 2018
[INFO][10:01:26]: [Client #9] Sampler: iid
[INFO][10:01:28]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:01:28]: [Client #9] Start to process inbound data.
[INFO][10:01:28]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:01:28]: [Client #1] Start to process inbound data.
[INFO][10:01:28]: [93m[1m[Client #1] Started training in communication round #32.[0m
[INFO][10:01:28]: [93m[1m[Client #9] Started training in communication round #32.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:43,  4.77s/it]  2%|▏         | 1/48 [00:04<03:43,  4.76s/it]  4%|▍         | 2/48 [00:05<01:49,  2.39s/it]  4%|▍         | 2/48 [00:05<01:51,  2.41s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.18it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.30it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.32it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.32it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.31it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][10:02:14]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536584.pth.
{'train_runtime': 39.6992, 'train_samples_per_second': 152.497, 'train_steps_per_second': 1.209, 'train_loss': 3.041929562886556, 'epoch': 3.0}
[INFO][10:02:15]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.6806, 'train_samples_per_second': 152.568, 'train_steps_per_second': 1.21, 'train_loss': 2.6177441279093423, 'epoch': 3.0}
[INFO][10:02:15]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536584.pth.
[INFO][10:02:16]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][10:02:16]: [Client #1] Model trained.
[INFO][10:02:16]: [Client #1] Inbound data has been processed.
[INFO][10:02:16]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][10:02:16]: [Client #9] Model trained.
[INFO][10:02:16]: [Client #9] Inbound data has been processed.
[INFO][10:02:16]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][10:02:24]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:02:24]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:02:25]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][10:02:26]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][10:02:26]: [Server #3536466] Selecting client #13 for training.
[INFO][10:02:26]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][10:02:30]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][10:02:30]: [Client #13] Selected by the server.
[INFO][10:02:30]: [Client #13] Loading its data source...
[INFO][10:02:30]: [Client #13] Dataset size: 2018
[INFO][10:02:30]: [Client #13] Sampler: iid
[INFO][10:02:31]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:02:31]: [Client #13] Start to process inbound data.
[INFO][10:02:32]: [93m[1m[Client #13] Started training in communication round #32.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.23s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.33s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.12it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.10it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.09it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.07it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.06it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.06it/s] 50%|█████     | 24/48 [00:15<00:11,  2.05it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.05it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.05it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.05it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.04it/s] 60%|██████    | 29/48 [00:17<00:09,  2.04it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.04it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.04it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.14it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.10it/s] 71%|███████   | 34/48 [00:20<00:06,  2.08it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.07it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.06it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.05it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.05it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.05it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.04it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.04it/s] 88%|████████▊ | 42/48 [00:24<00:02,  2.04it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.04it/s] 92%|█████████▏| 44/48 [00:25<00:01,  2.03it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.03it/s] 96%|█████████▌| 46/48 [00:26<00:00,  2.03it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.03it/s]100%|██████████| 48/48 [00:26<00:00,  2.14it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.14it/s]100%|██████████| 48/48 [00:26<00:00,  1.78it/s]
[INFO][10:03:05]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
{'train_runtime': 26.9454, 'train_samples_per_second': 224.677, 'train_steps_per_second': 1.781, 'train_loss': 2.551205635070801, 'epoch': 3.0}
[INFO][10:03:06]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
[INFO][10:03:06]: [Client #13] Model trained.
[INFO][10:03:06]: [Client #13] Inbound data has been processed.
[INFO][10:03:06]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][10:03:11]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:03:12]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][10:03:12]: [Server #3536466] Adding client #35 to the list of clients for aggregation.
[INFO][10:03:12]: [Server #3536466] Adding client #39 to the list of clients for aggregation.
[INFO][10:03:12]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][10:03:12]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][10:03:12]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][10:03:12]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:03:12]: [Server #3536466] Updated weights have been received.
[INFO][10:03:13]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:03:13]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:03:13]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.4200e+00  1e+02  1e+00  1e+00
 1:  2.2744e+00  1.4399e+00  6e+00  5e-02  5e-02
 2:  2.4233e+00  1.6028e+00  8e-01  3e-04  3e-04
 3:  2.4241e+00  2.3926e+00  3e-02  3e-06  3e-06
 4:  2.4227e+00  2.4188e+00  4e-03  4e-07  4e-07
 5:  2.4206e+00  2.4186e+00  2e-03  7e-07  2e-07
 6:  2.4202e+00  2.4192e+00  1e-03  5e-07  2e-07
 7:  2.4194e+00  2.4192e+00  3e-04  2e-06  1e-06
 8:  2.4193e+00  2.4192e+00  5e-05  5e-07  3e-07
 9:  2.4192e+00  2.4192e+00  3e-06  4e-08  2e-08
10:  2.4192e+00  2.4192e+00  4e-08  6e-10  3e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1  1.1  1.1  1.1  0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  0.01 0.01 0.01 6.1  1.1  1.1
 4.1  0.01 6.1  2.1  0.1  2.1  2.1  0.01 1.1  1.1  6.1  5.1  1.1  1.1
 0.01 5.1  0.01 1.1  4.1  1.1  5.1  6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 0.01 6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2
 0.01 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.01 0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.89it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.41it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.02it/s]100%|██████████| 8/8 [00:00<00:00, 11.76it/s]
[INFO][10:03:24]: [93m[1m[Server #3536466] Global model perplexity: 29.97
[0m
[INFO][10:03:24]: [Server #3536466] All client reports have been processed.
[INFO][10:03:24]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_32.pth.
[INFO][10:03:27]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_32.pth.
[INFO][10:03:27]: [93m[1m
[Server #3536466] Starting round 33/100.[0m
[INFO][10:03:27]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([3.33280304e-01, 8.61695584e-07, 8.61695584e-07, 4.17589810e-06,
       8.61695584e-07, 4.17589810e-06, 8.61695584e-07, 3.33280304e-01,
       4.17589810e-06, 4.17589810e-06, 3.33280304e-01, 8.61695584e-07,
       1.65869964e-07, 8.61695584e-07, 8.61695584e-07, 8.61695584e-07,
       1.65869964e-07, 7.11855890e-08, 8.61695584e-07, 1.76381906e-08,
       4.17589810e-06, 4.17589810e-06, 4.17589810e-06, 1.76381906e-08,
       8.61695584e-07, 8.61695584e-07, 3.97319814e-08, 4.17589810e-06,
       1.76381906e-08, 1.65869964e-07, 1.65869964e-07, 1.65869964e-07,
       4.17589810e-06, 8.61695584e-07, 8.61695584e-07, 1.76381906e-08,
       2.53902798e-08, 8.61695584e-07, 8.61695584e-07, 4.17589810e-06,
       2.53902798e-08, 4.17589810e-06, 8.61695584e-07, 3.97319814e-08,
       8.61695584e-07, 2.53902798e-08, 1.76381906e-08, 4.17589810e-06,
       4.17589810e-06, 4.17589810e-06, 4.17589810e-06, 8.61695584e-07,
       4.17589810e-06, 8.61695584e-07, 4.17589810e-06, 8.61695584e-07,
       8.61695584e-07, 8.61695584e-07, 8.61695584e-07, 7.11855890e-08,
       2.53902798e-08, 7.11855890e-08, 8.61695584e-07, 7.11855890e-08,
       4.17589810e-06, 8.61695584e-07, 4.17589810e-06, 4.17589810e-06,
       7.11855890e-08, 1.76381906e-08, 8.61695584e-07, 7.11855890e-08,
       8.61695584e-07, 4.17589810e-06, 8.61695584e-07, 1.65869964e-07,
       4.17589810e-06, 4.17589810e-06, 1.65869964e-07, 4.17589810e-06,
       8.61695584e-07, 4.17589810e-06, 1.76381906e-08, 8.61695584e-07,
       4.17589810e-06, 4.17589810e-06, 8.61695584e-07, 7.11855890e-08,
       7.11855890e-08, 4.17589810e-06, 4.17589810e-06, 4.17589810e-06,
       4.17589810e-06, 2.53902798e-08, 8.61695584e-07]),)
[INFO][10:03:28]: [Server #3536466] Selected clients: [13  9  1 88 71]
[INFO][10:03:28]: [Server #3536466] Selecting client #88 for training.
[INFO][10:03:28]: [Server #3536466] Sending the current model to client #88 (simulated).
[INFO][10:03:32]: [Server #3536466] Sending 507.38 MB of payload data to client #88 (simulated).
[INFO][10:03:32]: [Server #3536466] Selecting client #1 for training.
[INFO][10:03:32]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][10:03:36]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][10:03:36]: [Client #88] Selected by the server.
[INFO][10:03:36]: [Client #88] Loading its data source...
[INFO][10:03:36]: [Client #88] Dataset size: 2018
[INFO][10:03:36]: [Client #88] Sampler: iid
[INFO][10:03:36]: [Client #1] Selected by the server.
[INFO][10:03:36]: [Client #1] Loading its data source...
[INFO][10:03:36]: [Client #1] Dataset size: 2018
[INFO][10:03:36]: [Client #1] Sampler: iid
[INFO][10:03:38]: [Client #88] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:03:38]: [Client #88] Start to process inbound data.
[INFO][10:03:38]: [93m[1m[Client #88] Started training in communication round #33.[0m
[INFO][10:03:38]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:03:38]: [Client #1] Start to process inbound data.
[INFO][10:03:39]: [93m[1m[Client #1] Started training in communication round #33.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.21s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  6%|▋         | 3/48 [00:05<01:03,  1.41s/it]  2%|▏         | 1/48 [00:04<03:41,  4.71s/it]  8%|▊         | 4/48 [00:06<00:52,  1.19s/it]  4%|▍         | 2/48 [00:05<01:52,  2.46s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it]  6%|▋         | 3/48 [00:06<01:16,  1.70s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s]  8%|▊         | 4/48 [00:07<00:58,  1.33s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.16it/s] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 17%|█▋        | 8/48 [00:09<00:32,  1.22it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 19%|█▉        | 9/48 [00:09<00:31,  1.25it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 21%|██        | 10/48 [00:10<00:29,  1.29it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.33it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.37it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.35it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 50%|█████     | 24/48 [00:21<00:18,  1.32it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 58%|█████▊    | 28/48 [00:23<00:14,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.40it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.35it/s] 71%|███████   | 34/48 [00:28<00:10,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.32it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.34it/s] 75%|███████▌  | 36/48 [00:29<00:09,  1.32it/s] 71%|███████   | 34/48 [00:29<00:10,  1.33it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 83%|████████▎ | 40/48 [00:32<00:05,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 92%|█████████▏| 44/48 [00:35<00:02,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.31it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.30it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s]100%|██████████| 48/48 [00:38<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.39it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
 96%|█████████▌| 46/48 [00:38<00:01,  1.35it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.50it/s]100%|██████████| 48/48 [00:39<00:00,  1.70it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.70it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][10:04:23]: [Client #88] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_88_3536584.pth.
{'train_runtime': 38.8898, 'train_samples_per_second': 155.671, 'train_steps_per_second': 1.234, 'train_loss': 3.3172267278035483, 'epoch': 3.0}
[INFO][10:04:24]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 39.2434, 'train_samples_per_second': 154.268, 'train_steps_per_second': 1.223, 'train_loss': 3.001559575398763, 'epoch': 3.0}
[INFO][10:04:24]: [Client #88] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_88_3536584.pth.
[INFO][10:04:25]: [Client #88] Model trained.
[INFO][10:04:25]: [Client #88] Inbound data has been processed.
[INFO][10:04:25]: [Client #88] Outbound data is ready to be sent after being processed.
[INFO][10:04:26]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][10:04:26]: [Client #1] Model trained.
[INFO][10:04:26]: [Client #1] Inbound data has been processed.
[INFO][10:04:26]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][10:04:32]: [Client #88] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:04:33]: [Server #3536466] Received 507.38 MB of payload data from client #88 (simulated).
[INFO][10:04:33]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:04:34]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][10:04:34]: [Server #3536466] Selecting client #71 for training.
[INFO][10:04:34]: [Server #3536466] Sending the current model to client #71 (simulated).
[INFO][10:04:38]: [Server #3536466] Sending 507.38 MB of payload data to client #71 (simulated).
[INFO][10:04:38]: [Server #3536466] Selecting client #9 for training.
[INFO][10:04:38]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][10:04:43]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][10:04:43]: [Client #71] Selected by the server.
[INFO][10:04:43]: [Client #71] Loading its data source...
[INFO][10:04:43]: [Client #71] Dataset size: 2018
[INFO][10:04:43]: [Client #9] Selected by the server.
[INFO][10:04:43]: [Client #71] Sampler: iid
[INFO][10:04:43]: [Client #9] Loading its data source...
[INFO][10:04:43]: [Client #9] Dataset size: 2018
[INFO][10:04:43]: [Client #9] Sampler: iid
[INFO][10:04:44]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:04:44]: [Client #9] Start to process inbound data.
[INFO][10:04:44]: [93m[1m[Client #9] Started training in communication round #33.[0m
[INFO][10:04:44]: [Client #71] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:04:44]: [Client #71] Start to process inbound data.
[INFO][10:04:45]: [93m[1m[Client #71] Started training in communication round #33.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:35,  4.59s/it]  2%|▏         | 1/48 [00:04<03:43,  4.75s/it]  4%|▍         | 2/48 [00:05<01:45,  2.30s/it]  6%|▋         | 3/48 [00:06<01:15,  1.69s/it]  4%|▍         | 2/48 [00:05<01:56,  2.54s/it]  8%|▊         | 4/48 [00:07<01:01,  1.39s/it]  6%|▋         | 3/48 [00:06<01:21,  1.81s/it] 10%|█         | 5/48 [00:07<00:50,  1.18s/it]  8%|▊         | 4/48 [00:07<01:02,  1.43s/it] 12%|█▎        | 6/48 [00:08<00:43,  1.03s/it] 10%|█         | 5/48 [00:08<00:51,  1.19s/it] 15%|█▍        | 7/48 [00:09<00:38,  1.08it/s] 12%|█▎        | 6/48 [00:09<00:43,  1.04s/it] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 15%|█▍        | 7/48 [00:09<00:38,  1.06it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 17%|█▋        | 8/48 [00:10<00:35,  1.14it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.20it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 21%|██        | 10/48 [00:12<00:30,  1.24it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.33it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 50%|█████     | 24/48 [00:22<00:18,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.31it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.32it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 60%|██████    | 29/48 [00:26<00:14,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.32it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.30it/s] 69%|██████▉   | 33/48 [00:29<00:11,  1.33it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.32it/s] 71%|███████   | 34/48 [00:29<00:10,  1.32it/s] 75%|███████▌  | 36/48 [00:31<00:09,  1.33it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:31<00:09,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
 98%|█████████▊| 47/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:40<00:00,  1.57it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.57it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
[INFO][10:05:31]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.9747, 'train_samples_per_second': 151.446, 'train_steps_per_second': 1.201, 'train_loss': 2.5885367393493652, 'epoch': 3.0}
[INFO][10:05:31]: [Client #71] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_71_3536584.pth.
{'train_runtime': 40.0249, 'train_samples_per_second': 151.256, 'train_steps_per_second': 1.199, 'train_loss': 3.2228593826293945, 'epoch': 3.0}
[INFO][10:05:32]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][10:05:32]: [Client #71] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_71_3536584.pth.
[INFO][10:05:32]: [Client #9] Model trained.
[INFO][10:05:32]: [Client #9] Inbound data has been processed.
[INFO][10:05:32]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][10:05:33]: [Client #71] Model trained.
[INFO][10:05:33]: [Client #71] Inbound data has been processed.
[INFO][10:05:33]: [Client #71] Outbound data is ready to be sent after being processed.
[INFO][10:05:40]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:05:40]: [Client #71] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:05:42]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][10:05:43]: [Server #3536466] Received 507.38 MB of payload data from client #71 (simulated).
[INFO][10:05:43]: [Server #3536466] Selecting client #13 for training.
[INFO][10:05:43]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][10:05:47]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][10:05:47]: [Client #13] Selected by the server.
[INFO][10:05:47]: [Client #13] Loading its data source...
[INFO][10:05:47]: [Client #13] Dataset size: 2018
[INFO][10:05:47]: [Client #13] Sampler: iid
[INFO][10:05:48]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:05:48]: [Client #13] Start to process inbound data.
[INFO][10:05:49]: [93m[1m[Client #13] Started training in communication round #33.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.21s/it]  4%|▍         | 2/48 [00:04<01:32,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.70it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.80it/s] 21%|██        | 10/48 [00:08<00:20,  1.86it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.91it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.95it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.97it/s] 29%|██▉       | 14/48 [00:10<00:17,  1.99it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.01it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.12it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.09it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.08it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.08it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.07it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.07it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.07it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.19it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:20<00:06,  2.13it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][10:06:21]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
{'train_runtime': 26.7706, 'train_samples_per_second': 226.143, 'train_steps_per_second': 1.793, 'train_loss': 2.5251876513163247, 'epoch': 3.0}
[INFO][10:06:22]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
[INFO][10:06:23]: [Client #13] Model trained.
[INFO][10:06:23]: [Client #13] Inbound data has been processed.
[INFO][10:06:23]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][10:06:27]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:06:29]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][10:06:29]: [Server #3536466] Adding client #33 to the list of clients for aggregation.
[INFO][10:06:29]: [Server #3536466] Adding client #86 to the list of clients for aggregation.
[INFO][10:06:29]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][10:06:29]: [Server #3536466] Adding client #4 to the list of clients for aggregation.
[INFO][10:06:29]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][10:06:29]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:06:29]: [Server #3536466] Updated weights have been received.
[INFO][10:06:29]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:06:30]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:06:30]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.4894e+00  1e+02  1e+00  1e+00
 1:  2.3511e+00  1.5093e+00  5e+00  5e-02  5e-02
 2:  2.4929e+00  1.6829e+00  8e-01  3e-04  3e-04
 3:  2.4935e+00  2.4660e+00  3e-02  3e-06  3e-06
 4:  2.4920e+00  2.4883e+00  4e-03  4e-07  3e-07
 5:  2.4900e+00  2.4880e+00  2e-03  7e-07  2e-07
 6:  2.4896e+00  2.4886e+00  1e-03  4e-07  2e-07
 7:  2.4890e+00  2.4886e+00  3e-04  2e-06  1e-06
 8:  2.4888e+00  2.4887e+00  9e-05  9e-07  5e-07
 9:  2.4887e+00  2.4887e+00  8e-06  1e-07  8e-08
10:  2.4887e+00  2.4887e+00  2e-07  3e-09  2e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1  1.1  1.1  1.1  0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 0.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  0.01 0.01 0.01 6.1  1.1  1.1
 4.1  0.01 6.1  2.1  1.1  2.1  2.1  0.01 1.1  1.1  6.1  5.1  1.1  1.1
 0.01 5.1  0.01 1.1  4.1  1.1  5.1  6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  0.01 1.1  0.01
 0.01 3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 6.1  6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2
 0.01 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.25it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.47it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.84it/s]100%|██████████| 8/8 [00:00<00:00, 11.60it/s]
[INFO][10:06:41]: [93m[1m[Server #3536466] Global model perplexity: 28.24
[0m
[INFO][10:06:41]: [Server #3536466] All client reports have been processed.
[INFO][10:06:41]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_33.pth.
[INFO][10:06:44]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_33.pth.
[INFO][10:06:44]: [93m[1m
[Server #3536466] Starting round 34/100.[0m
[INFO][10:06:44]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([4.99630143e-01, 2.93443919e-06, 2.93443919e-06, 2.93443919e-06,
       2.12316528e-05, 2.93443919e-06, 2.12316528e-05, 2.93443919e-06,
       4.99630143e-01, 2.12316528e-05, 2.12316528e-05, 2.93443919e-06,
       4.80618445e-07, 2.93443919e-06, 2.93443919e-06, 2.93443919e-06,
       4.80618445e-07, 2.00169944e-07, 2.93443919e-06, 4.86918556e-08,
       2.12316528e-05, 2.12316528e-05, 2.12316528e-05, 4.86918556e-08,
       2.93443919e-06, 2.93443919e-06, 1.10537867e-07, 2.12316528e-05,
       4.86918556e-08, 4.80618445e-07, 2.93443919e-06, 4.80618445e-07,
       4.80618445e-07, 2.12316528e-05, 2.93443919e-06, 2.93443919e-06,
       4.86918556e-08, 7.02850971e-08, 2.93443919e-06, 2.93443919e-06,
       2.12316528e-05, 7.02850971e-08, 2.12316528e-05, 2.93443919e-06,
       1.10537867e-07, 2.93443919e-06, 7.02850971e-08, 4.86918556e-08,
       2.12316528e-05, 2.12316528e-05, 2.12316528e-05, 2.12316528e-05,
       2.93443919e-06, 2.12316528e-05, 2.93443919e-06, 2.12316528e-05,
       2.93443919e-06, 2.93443919e-06, 2.93443919e-06, 2.93443919e-06,
       2.00169944e-07, 7.02850971e-08, 2.00169944e-07, 2.93443919e-06,
       2.00169944e-07, 2.12316528e-05, 2.93443919e-06, 2.12316528e-05,
       2.00169944e-07, 4.86918556e-08, 2.93443919e-06, 2.00169944e-07,
       2.93443919e-06, 2.12316528e-05, 2.93443919e-06, 4.80618445e-07,
       2.12316528e-05, 2.12316528e-05, 4.80618445e-07, 2.12316528e-05,
       2.93443919e-06, 2.12316528e-05, 4.86918556e-08, 4.86918556e-08,
       2.12316528e-05, 2.12316528e-05, 2.93443919e-06, 2.00169944e-07,
       2.00169944e-07, 2.12316528e-05, 2.12316528e-05, 2.12316528e-05,
       2.12316528e-05, 7.02850971e-08, 2.93443919e-06]),)
[INFO][10:06:44]: [Server #3536466] Selected clients: [ 9  1 43 90 24]
[INFO][10:06:44]: [Server #3536466] Selecting client #24 for training.
[INFO][10:06:44]: [Server #3536466] Sending the current model to client #24 (simulated).
[INFO][10:06:49]: [Server #3536466] Sending 507.38 MB of payload data to client #24 (simulated).
[INFO][10:06:49]: [Server #3536466] Selecting client #1 for training.
[INFO][10:06:49]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][10:06:53]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][10:06:53]: [Client #24] Selected by the server.
[INFO][10:06:53]: [Client #24] Loading its data source...
[INFO][10:06:53]: [Client #1] Selected by the server.
[INFO][10:06:53]: [Client #24] Dataset size: 2018
[INFO][10:06:53]: [Client #1] Loading its data source...
[INFO][10:06:53]: [Client #24] Sampler: iid
[INFO][10:06:53]: [Client #1] Dataset size: 2018
[INFO][10:06:53]: [Client #1] Sampler: iid
[INFO][10:06:55]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:06:55]: [Client #1] Start to process inbound data.
[INFO][10:06:55]: [Client #24] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:06:55]: [Client #24] Start to process inbound data.
[INFO][10:06:55]: [93m[1m[Client #1] Started training in communication round #34.[0m
[INFO][10:06:55]: [93m[1m[Client #24] Started training in communication round #34.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:51,  4.93s/it]  2%|▏         | 1/48 [00:05<03:56,  5.03s/it]  4%|▍         | 2/48 [00:05<01:55,  2.50s/it]  4%|▍         | 2/48 [00:05<01:57,  2.55s/it]  6%|▋         | 3/48 [00:06<01:18,  1.75s/it]  6%|▋         | 3/48 [00:06<01:19,  1.77s/it]  8%|▊         | 4/48 [00:07<00:59,  1.36s/it]  8%|▊         | 4/48 [00:07<01:00,  1.39s/it] 10%|█         | 5/48 [00:08<00:49,  1.15s/it] 10%|█         | 5/48 [00:08<00:50,  1.17s/it] 12%|█▎        | 6/48 [00:08<00:42,  1.00s/it] 12%|█▎        | 6/48 [00:09<00:43,  1.03s/it] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 15%|█▍        | 7/48 [00:09<00:38,  1.07it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 19%|█▉        | 9/48 [00:11<00:31,  1.22it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.21it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:14<00:27,  1.28it/s] 27%|██▋       | 13/48 [00:14<00:27,  1.29it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.30it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.39it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.33it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:26<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.31it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:40<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.39it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
100%|██████████| 48/48 [00:40<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.40it/s]100%|██████████| 48/48 [00:40<00:00,  1.19it/s]
[INFO][10:07:42]: [Client #24] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_24_3536584.pth.
{'train_runtime': 40.1939, 'train_samples_per_second': 150.62, 'train_steps_per_second': 1.194, 'train_loss': 3.3363024393717446, 'epoch': 3.0}
[INFO][10:07:42]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 40.0402, 'train_samples_per_second': 151.198, 'train_steps_per_second': 1.199, 'train_loss': 2.9713026682535806, 'epoch': 3.0}
[INFO][10:07:43]: [Client #24] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_24_3536584.pth.
[INFO][10:07:43]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][10:07:43]: [Client #24] Model trained.
[INFO][10:07:43]: [Client #24] Inbound data has been processed.
[INFO][10:07:43]: [Client #24] Outbound data is ready to be sent after being processed.
[INFO][10:07:44]: [Client #1] Model trained.
[INFO][10:07:44]: [Client #1] Inbound data has been processed.
[INFO][10:07:44]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][10:07:52]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:07:52]: [Client #24] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:07:53]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][10:07:54]: [Server #3536466] Received 507.38 MB of payload data from client #24 (simulated).
[INFO][10:07:54]: [Server #3536466] Selecting client #90 for training.
[INFO][10:07:54]: [Server #3536466] Sending the current model to client #90 (simulated).
[INFO][10:07:58]: [Server #3536466] Sending 507.38 MB of payload data to client #90 (simulated).
[INFO][10:07:58]: [Server #3536466] Selecting client #9 for training.
[INFO][10:07:58]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][10:08:02]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][10:08:02]: [Client #9] Selected by the server.
[INFO][10:08:02]: [Client #90] Selected by the server.
[INFO][10:08:02]: [Client #9] Loading its data source...
[INFO][10:08:02]: [Client #90] Loading its data source...
[INFO][10:08:02]: [Client #9] Dataset size: 2018
[INFO][10:08:02]: [Client #90] Dataset size: 2018
[INFO][10:08:02]: [Client #9] Sampler: iid
[INFO][10:08:02]: [Client #90] Sampler: iid
[INFO][10:08:04]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:08:04]: [Client #9] Start to process inbound data.
[INFO][10:08:04]: [Client #90] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:08:04]: [Client #90] Start to process inbound data.
[INFO][10:08:05]: [93m[1m[Client #9] Started training in communication round #34.[0m
[INFO][10:08:05]: [93m[1m[Client #90] Started training in communication round #34.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:05<03:56,  5.03s/it]  2%|▏         | 1/48 [00:05<03:58,  5.07s/it]  4%|▍         | 2/48 [00:05<01:58,  2.58s/it]  4%|▍         | 2/48 [00:05<01:59,  2.61s/it]  6%|▋         | 3/48 [00:06<01:19,  1.76s/it]  6%|▋         | 3/48 [00:06<01:20,  1.80s/it]  8%|▊         | 4/48 [00:07<00:59,  1.36s/it]  8%|▊         | 4/48 [00:07<01:00,  1.39s/it] 10%|█         | 5/48 [00:08<00:48,  1.13s/it] 10%|█         | 5/48 [00:08<00:49,  1.16s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.00it/s] 12%|█▎        | 6/48 [00:09<00:42,  1.01s/it] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.08it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.16it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.16it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.19it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.20it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 21%|██        | 10/48 [00:12<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.28it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.30it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:15<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.36it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.38it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.37it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.32it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.32it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:19,  1.32it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.32it/s] 50%|█████     | 24/48 [00:22<00:18,  1.33it/s] 50%|█████     | 24/48 [00:22<00:18,  1.32it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:29<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.33it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:40<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.39it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
100%|██████████| 48/48 [00:40<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.40it/s]100%|██████████| 48/48 [00:40<00:00,  1.19it/s]
[INFO][10:08:51]: [Client #90] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_90_3536584.pth.
{'train_runtime': 40.2586, 'train_samples_per_second': 150.378, 'train_steps_per_second': 1.192, 'train_loss': 3.334183692932129, 'epoch': 3.0}
[INFO][10:08:52]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 40.1509, 'train_samples_per_second': 150.781, 'train_steps_per_second': 1.195, 'train_loss': 2.5858615239461265, 'epoch': 3.0}
[INFO][10:08:52]: [Client #90] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_90_3536584.pth.
[INFO][10:08:53]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][10:08:53]: [Client #90] Model trained.
[INFO][10:08:53]: [Client #90] Inbound data has been processed.
[INFO][10:08:53]: [Client #90] Outbound data is ready to be sent after being processed.
[INFO][10:08:53]: [Client #9] Model trained.
[INFO][10:08:53]: [Client #9] Inbound data has been processed.
[INFO][10:08:53]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][10:09:01]: [Client #90] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:09:01]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:09:02]: [Server #3536466] Received 507.38 MB of payload data from client #90 (simulated).
[INFO][10:09:03]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][10:09:03]: [Server #3536466] Selecting client #43 for training.
[INFO][10:09:03]: [Server #3536466] Sending the current model to client #43 (simulated).
[INFO][10:09:07]: [Server #3536466] Sending 507.38 MB of payload data to client #43 (simulated).
[INFO][10:09:07]: [Client #43] Selected by the server.
[INFO][10:09:07]: [Client #43] Loading its data source...
[INFO][10:09:07]: [Client #43] Dataset size: 2018
[INFO][10:09:07]: [Client #43] Sampler: iid
[INFO][10:09:09]: [Client #43] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:09:09]: [Client #43] Start to process inbound data.
[INFO][10:09:09]: [93m[1m[Client #43] Started training in communication round #34.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.22s/it]  4%|▍         | 2/48 [00:04<01:32,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:09<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.02it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][10:09:42]: [Client #43] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536584.pth.
{'train_runtime': 26.6396, 'train_samples_per_second': 227.256, 'train_steps_per_second': 1.802, 'train_loss': 3.1936120986938477, 'epoch': 3.0}
[INFO][10:09:43]: [Client #43] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536584.pth.
[INFO][10:09:43]: [Client #43] Model trained.
[INFO][10:09:43]: [Client #43] Inbound data has been processed.
[INFO][10:09:43]: [Client #43] Outbound data is ready to be sent after being processed.
[INFO][10:09:48]: [Client #43] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:09:49]: [Server #3536466] Received 507.38 MB of payload data from client #43 (simulated).
[INFO][10:09:49]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][10:09:49]: [Server #3536466] Adding client #71 to the list of clients for aggregation.
[INFO][10:09:49]: [Server #3536466] Adding client #88 to the list of clients for aggregation.
[INFO][10:09:49]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][10:09:49]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][10:09:49]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:09:49]: [Server #3536466] Updated weights have been received.
[INFO][10:09:50]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:09:50]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:09:50]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.5519e+00  1e+02  1e+00  1e+00
 1:  2.4202e+00  1.5719e+00  5e+00  4e-02  4e-02
 2:  2.5556e+00  1.7557e+00  8e-01  2e-04  2e-04
 3:  2.5560e+00  2.5321e+00  2e-02  2e-06  2e-06
 4:  2.5545e+00  2.5510e+00  4e-03  3e-07  3e-07
 5:  2.5527e+00  2.5506e+00  2e-03  6e-07  3e-07
 6:  2.5523e+00  2.5512e+00  1e-03  4e-07  2e-07
 7:  2.5517e+00  2.5513e+00  4e-04  2e-06  2e-06
 8:  2.5515e+00  2.5513e+00  2e-04  1e-06  1e-06
 9:  2.5513e+00  2.5513e+00  2e-05  4e-07  3e-07
10:  2.5513e+00  2.5513e+00  5e-07  2e-08  1e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1  1.1  1.1  1.1  0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 1.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  0.01 0.01 0.01 6.1  1.1  1.1
 4.1  0.01 6.1  2.1  1.1  2.1  2.1  0.01 1.1  1.1  6.1  5.1  1.1  1.1
 0.01 5.1  0.01 1.1  4.1  1.1  5.1  6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  0.01 1.1  0.01
 1.1  3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 6.1  6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 0.01 0.01
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2
 0.01 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.01
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.19it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.27it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.80it/s]100%|██████████| 8/8 [00:00<00:00, 11.61it/s]
[INFO][10:10:01]: [93m[1m[Server #3536466] Global model perplexity: 29.68
[0m
[INFO][10:10:01]: [Server #3536466] All client reports have been processed.
[INFO][10:10:01]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_34.pth.
[INFO][10:10:04]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_34.pth.
[INFO][10:10:04]: [93m[1m
[Server #3536466] Starting round 35/100.[0m
[INFO][10:10:04]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([4.99672527e-01, 2.86439679e-06, 2.86439679e-06, 2.86439679e-06,
       2.02206323e-05, 2.86439679e-06, 2.02206323e-05, 2.86439679e-06,
       4.99672527e-01, 2.02206323e-05, 2.02206323e-05, 2.86439679e-06,
       2.86439679e-06, 4.75219683e-07, 2.86439679e-06, 2.86439679e-06,
       2.86439679e-06, 4.75219683e-07, 1.98506507e-07, 2.86439679e-06,
       4.83784829e-08, 2.02206323e-05, 2.02206323e-05, 4.83784829e-08,
       2.86439679e-06, 2.86439679e-06, 1.09739347e-07, 2.02206323e-05,
       4.83784829e-08, 4.75219683e-07, 2.86439679e-06, 4.75219683e-07,
       4.75219683e-07, 2.02206323e-05, 2.86439679e-06, 2.86439679e-06,
       4.83784829e-08, 6.98132365e-08, 2.86439679e-06, 2.86439679e-06,
       6.98132365e-08, 2.02206323e-05, 2.86439679e-06, 1.09739347e-07,
       2.86439679e-06, 6.98132365e-08, 4.83784829e-08, 2.02206323e-05,
       2.02206323e-05, 2.02206323e-05, 2.02206323e-05, 2.86439679e-06,
       2.02206323e-05, 2.86439679e-06, 2.02206323e-05, 2.86439679e-06,
       2.86439679e-06, 2.86439679e-06, 2.86439679e-06, 1.98506507e-07,
       6.98132365e-08, 1.98506507e-07, 2.86439679e-06, 1.98506507e-07,
       2.02206323e-05, 2.86439679e-06, 2.02206323e-05, 2.86439679e-06,
       1.98506507e-07, 4.83784829e-08, 2.86439679e-06, 1.98506507e-07,
       2.86439679e-06, 2.02206323e-05, 2.86439679e-06, 4.75219683e-07,
       2.02206323e-05, 2.02206323e-05, 4.75219683e-07, 2.02206323e-05,
       2.86439679e-06, 2.02206323e-05, 4.83784829e-08, 4.83784829e-08,
       2.86439679e-06, 2.02206323e-05, 2.86439679e-06, 1.98506507e-07,
       1.98506507e-07, 2.02206323e-05, 2.02206323e-05, 2.02206323e-05,
       2.02206323e-05, 6.98132365e-08, 2.86439679e-06]),)
[INFO][10:10:04]: [Server #3536466] Selected clients: [ 9  1 45 25 83]
[INFO][10:10:04]: [Server #3536466] Selecting client #1 for training.
[INFO][10:10:04]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][10:10:09]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][10:10:09]: [Server #3536466] Selecting client #83 for training.
[INFO][10:10:09]: [Server #3536466] Sending the current model to client #83 (simulated).
[INFO][10:10:13]: [Server #3536466] Sending 507.38 MB of payload data to client #83 (simulated).
[INFO][10:10:13]: [Client #1] Selected by the server.
[INFO][10:10:13]: [Client #83] Selected by the server.
[INFO][10:10:13]: [Client #1] Loading its data source...
[INFO][10:10:13]: [Client #83] Loading its data source...
[INFO][10:10:13]: [Client #1] Dataset size: 2018
[INFO][10:10:13]: [Client #83] Dataset size: 2018
[INFO][10:10:13]: [Client #1] Sampler: iid
[INFO][10:10:13]: [Client #83] Sampler: iid
[INFO][10:10:15]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:10:15]: [Client #1] Start to process inbound data.
[INFO][10:10:15]: [Client #83] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:10:15]: [Client #83] Start to process inbound data.
[INFO][10:10:16]: [93m[1m[Client #1] Started training in communication round #35.[0m
[INFO][10:10:16]: [93m[1m[Client #83] Started training in communication round #35.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:46,  4.81s/it]  2%|▏         | 1/48 [00:04<03:46,  4.83s/it]  4%|▍         | 2/48 [00:05<01:50,  2.40s/it]  4%|▍         | 2/48 [00:05<01:52,  2.44s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it]  8%|▊         | 4/48 [00:07<00:57,  1.30s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.22it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.36it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.30it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][10:11:01]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536584.pth.
{'train_runtime': 39.6038, 'train_samples_per_second': 152.864, 'train_steps_per_second': 1.212, 'train_loss': 2.876088778177897, 'epoch': 3.0}
[INFO][10:11:02]: [Client #83] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_83_3536585.pth.
{'train_runtime': 39.5667, 'train_samples_per_second': 153.008, 'train_steps_per_second': 1.213, 'train_loss': 3.1931727727254233, 'epoch': 3.0}
[INFO][10:11:02]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536584.pth.
[INFO][10:11:03]: [Client #83] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_83_3536585.pth.
[INFO][10:11:03]: [Client #1] Model trained.
[INFO][10:11:03]: [Client #1] Inbound data has been processed.
[INFO][10:11:03]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][10:11:03]: [Client #83] Model trained.
[INFO][10:11:03]: [Client #83] Inbound data has been processed.
[INFO][10:11:03]: [Client #83] Outbound data is ready to be sent after being processed.
[INFO][10:11:11]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:11:11]: [Client #83] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:11:12]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][10:11:13]: [Server #3536466] Received 507.38 MB of payload data from client #83 (simulated).
[INFO][10:11:13]: [Server #3536466] Selecting client #9 for training.
[INFO][10:11:13]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][10:11:17]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][10:11:17]: [Server #3536466] Selecting client #45 for training.
[INFO][10:11:17]: [Server #3536466] Sending the current model to client #45 (simulated).
[INFO][10:11:22]: [Server #3536466] Sending 507.38 MB of payload data to client #45 (simulated).
[INFO][10:11:22]: [Client #45] Selected by the server.
[INFO][10:11:22]: [Client #9] Selected by the server.
[INFO][10:11:22]: [Client #45] Loading its data source...
[INFO][10:11:22]: [Client #9] Loading its data source...
[INFO][10:11:22]: [Client #45] Dataset size: 2018
[INFO][10:11:22]: [Client #45] Sampler: iid
[INFO][10:11:22]: [Client #9] Dataset size: 2018
[INFO][10:11:22]: [Client #9] Sampler: iid
[INFO][10:11:23]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:11:23]: [Client #9] Start to process inbound data.
[INFO][10:11:23]: [Client #45] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:11:23]: [Client #45] Start to process inbound data.
[INFO][10:11:24]: [93m[1m[Client #45] Started training in communication round #35.[0m
[INFO][10:11:24]: [93m[1m[Client #9] Started training in communication round #35.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:42,  4.73s/it]  2%|▏         | 1/48 [00:04<03:45,  4.80s/it]  4%|▍         | 2/48 [00:05<01:50,  2.40s/it]  4%|▍         | 2/48 [00:05<01:50,  2.41s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][10:12:10]: [Client #45] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_45_3536585.pth.
{'train_runtime': 39.5622, 'train_samples_per_second': 153.025, 'train_steps_per_second': 1.213, 'train_loss': 3.185694694519043, 'epoch': 3.0}
[INFO][10:12:10]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
{'train_runtime': 39.5358, 'train_samples_per_second': 153.127, 'train_steps_per_second': 1.214, 'train_loss': 2.5070482889811196, 'epoch': 3.0}
[INFO][10:12:11]: [Client #45] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_45_3536585.pth.
[INFO][10:12:11]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
[INFO][10:12:12]: [Client #45] Model trained.
[INFO][10:12:12]: [Client #45] Inbound data has been processed.
[INFO][10:12:12]: [Client #45] Outbound data is ready to be sent after being processed.
[INFO][10:12:12]: [Client #9] Model trained.
[INFO][10:12:12]: [Client #9] Inbound data has been processed.
[INFO][10:12:12]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][10:12:19]: [Client #45] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:12:20]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:12:20]: [Server #3536466] Received 507.38 MB of payload data from client #45 (simulated).
[INFO][10:12:21]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][10:12:21]: [Server #3536466] Selecting client #25 for training.
[INFO][10:12:22]: [Server #3536466] Sending the current model to client #25 (simulated).
[INFO][10:12:26]: [Server #3536466] Sending 507.38 MB of payload data to client #25 (simulated).
[INFO][10:12:26]: [Client #25] Selected by the server.
[INFO][10:12:26]: [Client #25] Loading its data source...
[INFO][10:12:26]: [Client #25] Dataset size: 2018
[INFO][10:12:26]: [Client #25] Sampler: iid
[INFO][10:12:27]: [Client #25] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:12:27]: [Client #25] Start to process inbound data.
[INFO][10:12:27]: [93m[1m[Client #25] Started training in communication round #35.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.21s/it]  4%|▍         | 2/48 [00:04<01:32,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.12it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.11it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.10it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.09it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.08it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][10:13:00]: [Client #25] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_25_3536584.pth.
{'train_runtime': 26.6376, 'train_samples_per_second': 227.273, 'train_steps_per_second': 1.802, 'train_loss': 3.184260686238607, 'epoch': 3.0}
[INFO][10:13:01]: [Client #25] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_25_3536584.pth.
[INFO][10:13:02]: [Client #25] Model trained.
[INFO][10:13:02]: [Client #25] Inbound data has been processed.
[INFO][10:13:02]: [Client #25] Outbound data is ready to be sent after being processed.
[INFO][10:13:06]: [Client #25] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:13:08]: [Server #3536466] Received 507.38 MB of payload data from client #25 (simulated).
[INFO][10:13:08]: [Server #3536466] Adding client #43 to the list of clients for aggregation.
[INFO][10:13:08]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][10:13:08]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][10:13:08]: [Server #3536466] Adding client #45 to the list of clients for aggregation.
[INFO][10:13:08]: [Server #3536466] Adding client #98 to the list of clients for aggregation.
[INFO][10:13:08]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:13:08]: [Server #3536466] Updated weights have been received.
[INFO][10:13:08]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:13:09]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:13:09]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.5599e+00  1e+02  1e+00  1e+00
 1:  2.4292e+00  1.5798e+00  5e+00  4e-02  4e-02
 2:  2.5636e+00  1.7649e+00  8e-01  2e-04  2e-04
 3:  2.5640e+00  2.5405e+00  2e-02  2e-06  2e-06
 4:  2.5625e+00  2.5589e+00  4e-03  3e-07  3e-07
 5:  2.5607e+00  2.5585e+00  2e-03  6e-07  3e-07
 6:  2.5603e+00  2.5592e+00  1e-03  4e-07  2e-07
 7:  2.5597e+00  2.5593e+00  4e-04  2e-06  2e-06
 8:  2.5594e+00  2.5593e+00  2e-04  1e-06  1e-06
 9:  2.5593e+00  2.5593e+00  2e-05  3e-07  2e-07
10:  2.5593e+00  2.5593e+00  5e-07  1e-08  9e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1  1.1  1.1  1.1  0.01 1.1  0.01 1.1  0.1  0.01 0.01 0.01 1.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  0.01 0.01 0.01 6.1  1.1  1.1
 4.1  0.01 6.1  2.1  1.1  2.1  2.1  0.01 1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  0.1  1.1  4.1  1.1  5.1  6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  0.01 1.1  0.01
 1.1  3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 6.1  6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 0.01 5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.29it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.36it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.87it/s]100%|██████████| 8/8 [00:00<00:00, 11.70it/s]
[INFO][10:13:19]: [93m[1m[Server #3536466] Global model perplexity: 28.20
[0m
[INFO][10:13:19]: [Server #3536466] All client reports have been processed.
[INFO][10:13:20]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_35.pth.
[INFO][10:13:23]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_35.pth.
[INFO][10:13:23]: [93m[1m
[Server #3536466] Starting round 36/100.[0m
[INFO][10:13:23]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([3.33315665e-01, 3.36733023e-07, 3.36733023e-07, 3.36733023e-07,
       1.65588803e-06, 3.36733023e-07, 1.65588803e-06, 3.36733023e-07,
       3.33315665e-01, 1.65588803e-06, 1.65588803e-06, 3.36733023e-07,
       3.36733023e-07, 6.34600889e-08, 3.36733023e-07, 3.36733023e-07,
       3.36733023e-07, 6.34600889e-08, 2.71516602e-08, 3.36733023e-07,
       6.71448775e-09, 1.65588803e-06, 6.71448775e-09, 3.36733023e-07,
       3.36733023e-07, 1.51386764e-08, 1.65588803e-06, 6.71448775e-09,
       6.34600889e-08, 3.36733023e-07, 6.34600889e-08, 6.34600889e-08,
       1.65588803e-06, 3.36733023e-07, 3.36733023e-07, 6.71448775e-09,
       9.66885908e-09, 3.36733023e-07, 3.36733023e-07, 3.36733023e-07,
       9.66885908e-09, 3.33315665e-01, 3.36733023e-07, 1.51386764e-08,
       3.36733023e-07, 9.66885908e-09, 6.71448775e-09, 1.65588803e-06,
       1.65588803e-06, 1.65588803e-06, 1.65588803e-06, 3.36733023e-07,
       1.65588803e-06, 3.36733023e-07, 1.65588803e-06, 3.36733023e-07,
       3.36733023e-07, 3.36733023e-07, 3.36733023e-07, 2.71516602e-08,
       9.66885908e-09, 2.71516602e-08, 3.36733023e-07, 2.71516602e-08,
       1.65588803e-06, 3.36733023e-07, 1.65588803e-06, 3.36733023e-07,
       2.71516602e-08, 6.71448775e-09, 3.36733023e-07, 2.71516602e-08,
       3.36733023e-07, 1.65588803e-06, 3.36733023e-07, 6.34600889e-08,
       1.65588803e-06, 1.65588803e-06, 6.34600889e-08, 3.36733023e-07,
       1.65588803e-06, 6.71448775e-09, 6.71448775e-09, 3.36733023e-07,
       1.65588803e-06, 3.36733023e-07, 2.71516602e-08, 2.71516602e-08,
       1.65588803e-06, 1.65588803e-06, 1.65588803e-06, 1.65588803e-06,
       9.66885908e-09, 9.66885908e-09, 3.36733023e-07]),)
[INFO][10:13:23]: [Server #3536466] Selected clients: [ 1 45  9  5 10]
[INFO][10:13:23]: [Server #3536466] Selecting client #10 for training.
[INFO][10:13:23]: [Server #3536466] Sending the current model to client #10 (simulated).
[INFO][10:13:27]: [Server #3536466] Sending 507.38 MB of payload data to client #10 (simulated).
[INFO][10:13:27]: [Server #3536466] Selecting client #1 for training.
[INFO][10:13:27]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][10:13:32]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][10:13:32]: [Client #10] Selected by the server.
[INFO][10:13:32]: [Client #10] Loading its data source...
[INFO][10:13:32]: [Client #10] Dataset size: 2018
[INFO][10:13:32]: [Client #10] Sampler: iid
[INFO][10:13:32]: [Client #1] Selected by the server.
[INFO][10:13:32]: [Client #1] Loading its data source...
[INFO][10:13:32]: [Client #1] Dataset size: 2018
[INFO][10:13:32]: [Client #1] Sampler: iid
[INFO][10:13:33]: [Client #10] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:13:33]: [Client #10] Start to process inbound data.
[INFO][10:13:33]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:13:33]: [Client #1] Start to process inbound data.
[INFO][10:13:34]: [93m[1m[Client #1] Started training in communication round #36.[0m
[INFO][10:13:34]: [93m[1m[Client #10] Started training in communication round #36.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:31,  4.50s/it]  2%|▏         | 1/48 [00:05<04:02,  5.17s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  4%|▍         | 2/48 [00:06<02:06,  2.76s/it]  6%|▋         | 3/48 [00:06<01:20,  1.80s/it]  6%|▋         | 3/48 [00:07<01:28,  1.97s/it]  8%|▊         | 4/48 [00:07<01:04,  1.47s/it]  8%|▊         | 4/48 [00:08<01:08,  1.56s/it] 10%|█         | 5/48 [00:08<00:52,  1.21s/it] 10%|█         | 5/48 [00:08<00:53,  1.25s/it] 12%|█▎        | 6/48 [00:08<00:44,  1.05s/it] 12%|█▎        | 6/48 [00:09<00:45,  1.07s/it] 15%|█▍        | 7/48 [00:09<00:38,  1.05it/s] 15%|█▍        | 7/48 [00:10<00:39,  1.04it/s] 17%|█▋        | 8/48 [00:10<00:35,  1.13it/s] 17%|█▋        | 8/48 [00:11<00:36,  1.11it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.19it/s] 19%|█▉        | 9/48 [00:11<00:33,  1.18it/s] 21%|██        | 10/48 [00:11<00:30,  1.23it/s] 21%|██        | 10/48 [00:12<00:30,  1.23it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:13<00:29,  1.25it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:14<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.30it/s] 27%|██▋       | 13/48 [00:14<00:27,  1.29it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 29%|██▉       | 14/48 [00:15<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:16<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:18<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:19<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:20<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.32it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:21<00:19,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:22<00:18,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.33it/s] 50%|█████     | 24/48 [00:23<00:18,  1.32it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.32it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 54%|█████▍    | 26/48 [00:24<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:25<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:27<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:28<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:29<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:30<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:31<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:33<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:34<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:36<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:37<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:39<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:40<00:00,  1.33it/s]100%|██████████| 48/48 [00:40<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.37it/s]100%|██████████| 48/48 [00:40<00:00,  1.19it/s]
100%|██████████| 48/48 [00:40<00:00,  1.54it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.54it/s]100%|██████████| 48/48 [00:40<00:00,  1.18it/s]
[INFO][10:14:21]: [Client #10] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
{'train_runtime': 40.1902, 'train_samples_per_second': 150.634, 'train_steps_per_second': 1.194, 'train_loss': 3.3229293823242188, 'epoch': 3.0}
[INFO][10:14:21]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 40.5898, 'train_samples_per_second': 149.151, 'train_steps_per_second': 1.183, 'train_loss': 2.844630241394043, 'epoch': 3.0}
[INFO][10:14:22]: [Client #10] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
[INFO][10:14:22]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][10:14:22]: [Client #10] Model trained.
[INFO][10:14:22]: [Client #10] Inbound data has been processed.
[INFO][10:14:22]: [Client #10] Outbound data is ready to be sent after being processed.
[INFO][10:14:23]: [Client #1] Model trained.
[INFO][10:14:23]: [Client #1] Inbound data has been processed.
[INFO][10:14:23]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][10:14:30]: [Client #10] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:14:31]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:14:31]: [Server #3536466] Received 507.38 MB of payload data from client #10 (simulated).
[INFO][10:14:32]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][10:14:32]: [Server #3536466] Selecting client #5 for training.
[INFO][10:14:32]: [Server #3536466] Sending the current model to client #5 (simulated).
[INFO][10:14:36]: [Server #3536466] Sending 507.38 MB of payload data to client #5 (simulated).
[INFO][10:14:36]: [Server #3536466] Selecting client #9 for training.
[INFO][10:14:36]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][10:14:41]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][10:14:41]: [Client #5] Selected by the server.
[INFO][10:14:41]: [Client #9] Selected by the server.
[INFO][10:14:41]: [Client #5] Loading its data source...
[INFO][10:14:41]: [Client #9] Loading its data source...
[INFO][10:14:41]: [Client #5] Dataset size: 2018
[INFO][10:14:41]: [Client #9] Dataset size: 2018
[INFO][10:14:41]: [Client #5] Sampler: iid
[INFO][10:14:41]: [Client #9] Sampler: iid
[INFO][10:14:42]: [Client #5] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:14:42]: [Client #5] Start to process inbound data.
[INFO][10:14:42]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:14:42]: [Client #9] Start to process inbound data.
[INFO][10:14:43]: [93m[1m[Client #5] Started training in communication round #36.[0m
[INFO][10:14:43]: [93m[1m[Client #9] Started training in communication round #36.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:42,  4.73s/it]  2%|▏         | 1/48 [00:04<03:47,  4.83s/it]  4%|▍         | 2/48 [00:05<01:49,  2.38s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][10:15:29]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.6212, 'train_samples_per_second': 152.797, 'train_steps_per_second': 1.211, 'train_loss': 2.4553845723470054, 'epoch': 3.0}
[INFO][10:15:29]: [Client #5] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536584.pth.
{'train_runtime': 39.5722, 'train_samples_per_second': 152.986, 'train_steps_per_second': 1.213, 'train_loss': 3.154072125752767, 'epoch': 3.0}
[INFO][10:15:30]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][10:15:30]: [Client #5] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536584.pth.
[INFO][10:15:30]: [Client #9] Model trained.
[INFO][10:15:30]: [Client #9] Inbound data has been processed.
[INFO][10:15:30]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][10:15:31]: [Client #5] Model trained.
[INFO][10:15:31]: [Client #5] Inbound data has been processed.
[INFO][10:15:31]: [Client #5] Outbound data is ready to be sent after being processed.
[INFO][10:15:38]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:15:39]: [Client #5] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:15:39]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][10:15:40]: [Server #3536466] Received 507.38 MB of payload data from client #5 (simulated).
[INFO][10:15:40]: [Server #3536466] Selecting client #45 for training.
[INFO][10:15:40]: [Server #3536466] Sending the current model to client #45 (simulated).
[INFO][10:15:45]: [Server #3536466] Sending 507.38 MB of payload data to client #45 (simulated).
[INFO][10:15:45]: [Client #45] Selected by the server.
[INFO][10:15:45]: [Client #45] Loading its data source...
[INFO][10:15:45]: [Client #45] Dataset size: 2018
[INFO][10:15:45]: [Client #45] Sampler: iid
[INFO][10:15:46]: [Client #45] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:15:46]: [Client #45] Start to process inbound data.
[INFO][10:15:46]: [93m[1m[Client #45] Started training in communication round #36.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.18s/it]  4%|▍         | 2/48 [00:04<01:32,  2.00s/it]  6%|▋         | 3/48 [00:05<00:58,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.25it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.88it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.93it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.97it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.09it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][10:16:19]: [Client #45] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_45_3536584.pth.
{'train_runtime': 26.6724, 'train_samples_per_second': 226.976, 'train_steps_per_second': 1.8, 'train_loss': 3.0644960403442383, 'epoch': 3.0}
[INFO][10:16:20]: [Client #45] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_45_3536584.pth.
[INFO][10:16:20]: [Client #45] Model trained.
[INFO][10:16:20]: [Client #45] Inbound data has been processed.
[INFO][10:16:20]: [Client #45] Outbound data is ready to be sent after being processed.
[INFO][10:16:25]: [Client #45] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:16:26]: [Server #3536466] Received 507.38 MB of payload data from client #45 (simulated).
[INFO][10:16:26]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][10:16:26]: [Server #3536466] Adding client #5 to the list of clients for aggregation.
[INFO][10:16:26]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][10:16:26]: [Server #3536466] Adding client #10 to the list of clients for aggregation.
[INFO][10:16:26]: [Server #3536466] Adding client #11 to the list of clients for aggregation.
[INFO][10:16:26]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:16:26]: [Server #3536466] Updated weights have been received.
[INFO][10:16:27]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:16:27]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:16:27]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.6033e+00  1e+02  1e+00  1e+00
 1:  2.4778e+00  1.6232e+00  5e+00  4e-02  4e-02
 2:  2.6072e+00  1.8160e+00  8e-01  2e-04  2e-04
 3:  2.6076e+00  2.5865e+00  2e-02  2e-06  2e-06
 4:  2.6059e+00  2.6025e+00  3e-03  3e-07  3e-07
 5:  2.6041e+00  2.6019e+00  2e-03  8e-07  3e-07
 6:  2.6036e+00  2.6027e+00  9e-04  4e-07  2e-07
 7:  2.6030e+00  2.6027e+00  3e-04  2e-06  1e-06
 8:  2.6028e+00  2.6027e+00  6e-05  6e-07  4e-07
 9:  2.6027e+00  2.6027e+00  4e-06  6e-08  3e-08
10:  2.6027e+00  2.6027e+00  5e-08  9e-10  5e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1  1.1  1.1  1.1  0.1  1.1  0.01 1.1  0.1  0.1  5.1  0.01 1.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  0.01 0.01 0.01 6.1  1.1  1.1
 4.1  0.01 6.1  2.1  1.1  2.1  2.1  0.01 1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  0.1  1.1  4.1  1.1  5.1  6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  0.01 1.1  0.01
 1.1  3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 6.1  6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 0.01 5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.36it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.30it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.98it/s]100%|██████████| 8/8 [00:00<00:00, 11.78it/s]
[INFO][10:16:38]: [93m[1m[Server #3536466] Global model perplexity: 28.25
[0m
[INFO][10:16:38]: [Server #3536466] All client reports have been processed.
[INFO][10:16:38]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_36.pth.
[INFO][10:16:42]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_36.pth.
[INFO][10:16:42]: [93m[1m
[Server #3536466] Starting round 37/100.[0m
[INFO][10:16:42]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.49868043e-01, 3.86008462e-06, 3.86008462e-06, 3.86008462e-06,
       2.49868043e-01, 3.86008462e-06, 1.70698516e-05, 3.86008462e-06,
       2.49868043e-01, 2.49868043e-01, 1.12872313e-07, 1.70698516e-05,
       3.86008462e-06, 3.86008462e-06, 7.38008423e-07, 3.86008462e-06,
       3.86008462e-06, 3.86008462e-06, 7.38008423e-07, 3.16572889e-07,
       3.86008462e-06, 7.83951726e-08, 1.70698516e-05, 7.83951726e-08,
       3.86008462e-06, 3.86008462e-06, 1.76664436e-07, 1.70698516e-05,
       7.83951726e-08, 7.38008423e-07, 3.86008462e-06, 7.38008423e-07,
       7.38008423e-07, 1.70698516e-05, 3.86008462e-06, 3.86008462e-06,
       7.83951726e-08, 1.12872313e-07, 3.86008462e-06, 3.86008462e-06,
       3.86008462e-06, 1.12872313e-07, 3.86008462e-06, 1.76664436e-07,
       3.86008462e-06, 1.12872313e-07, 7.83951726e-08, 1.70698516e-05,
       1.70698516e-05, 1.70698516e-05, 1.70698516e-05, 3.86008462e-06,
       1.70698516e-05, 3.86008462e-06, 1.70698516e-05, 3.86008462e-06,
       3.86008462e-06, 3.86008462e-06, 3.86008462e-06, 3.16572889e-07,
       1.12872313e-07, 3.16572889e-07, 3.86008462e-06, 3.16572889e-07,
       1.70698516e-05, 3.86008462e-06, 1.70698516e-05, 3.86008462e-06,
       3.16572889e-07, 7.83951726e-08, 3.86008462e-06, 3.16572889e-07,
       3.86008462e-06, 1.70698516e-05, 3.86008462e-06, 7.38008423e-07,
       1.70698516e-05, 1.70698516e-05, 7.38008423e-07, 3.86008462e-06,
       1.70698516e-05, 7.83951726e-08, 7.83951726e-08, 3.86008462e-06,
       1.70698516e-05, 3.86008462e-06, 3.16572889e-07, 3.16572889e-07,
       1.70698516e-05, 1.70698516e-05, 1.70698516e-05, 1.70698516e-05,
       1.12872313e-07, 1.12872313e-07, 3.86008462e-06]),)
[INFO][10:16:42]: [Server #3536466] Selected clients: [ 9 10  1  5 61]
[INFO][10:16:42]: [Server #3536466] Selecting client #10 for training.
[INFO][10:16:42]: [Server #3536466] Sending the current model to client #10 (simulated).
[INFO][10:16:46]: [Server #3536466] Sending 507.38 MB of payload data to client #10 (simulated).
[INFO][10:16:46]: [Server #3536466] Selecting client #1 for training.
[INFO][10:16:46]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][10:16:51]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][10:16:51]: [Client #10] Selected by the server.
[INFO][10:16:51]: [Client #10] Loading its data source...
[INFO][10:16:51]: [Client #10] Dataset size: 2018
[INFO][10:16:51]: [Client #10] Sampler: iid
[INFO][10:16:51]: [Client #1] Selected by the server.
[INFO][10:16:51]: [Client #1] Loading its data source...
[INFO][10:16:51]: [Client #1] Dataset size: 2018
[INFO][10:16:51]: [Client #1] Sampler: iid
[INFO][10:16:52]: [Client #10] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:16:52]: [Client #10] Start to process inbound data.
[INFO][10:16:52]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:16:52]: [Client #1] Start to process inbound data.
[INFO][10:16:53]: [93m[1m[Client #1] Started training in communication round #37.[0m
[INFO][10:16:53]: [93m[1m[Client #10] Started training in communication round #37.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:12,  4.11s/it]  2%|▏         | 1/48 [00:04<03:47,  4.85s/it]  4%|▍         | 2/48 [00:04<01:36,  2.10s/it]  4%|▍         | 2/48 [00:05<01:52,  2.44s/it]  6%|▋         | 3/48 [00:05<01:07,  1.49s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.08it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:32,  1.21it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.18it/s] 19%|█▉        | 9/48 [00:09<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.34it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.34it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:38<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.37it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][10:17:39]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 38.9731, 'train_samples_per_second': 155.338, 'train_steps_per_second': 1.232, 'train_loss': 2.7794179916381836, 'epoch': 3.0}
[INFO][10:17:39]: [Client #10] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
{'train_runtime': 39.4736, 'train_samples_per_second': 153.368, 'train_steps_per_second': 1.216, 'train_loss': 3.221522649129232, 'epoch': 3.0}
[INFO][10:17:40]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][10:17:40]: [Client #10] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
[INFO][10:17:40]: [Client #1] Model trained.
[INFO][10:17:40]: [Client #1] Inbound data has been processed.
[INFO][10:17:40]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][10:17:41]: [Client #10] Model trained.
[INFO][10:17:41]: [Client #10] Inbound data has been processed.
[INFO][10:17:41]: [Client #10] Outbound data is ready to be sent after being processed.
[INFO][10:17:48]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:17:49]: [Client #10] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:17:50]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][10:17:51]: [Server #3536466] Received 507.38 MB of payload data from client #10 (simulated).
[INFO][10:17:51]: [Server #3536466] Selecting client #5 for training.
[INFO][10:17:51]: [Server #3536466] Sending the current model to client #5 (simulated).
[INFO][10:17:55]: [Server #3536466] Sending 507.38 MB of payload data to client #5 (simulated).
[INFO][10:17:55]: [Server #3536466] Selecting client #9 for training.
[INFO][10:17:55]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][10:17:59]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][10:17:59]: [Client #5] Selected by the server.
[INFO][10:17:59]: [Client #5] Loading its data source...
[INFO][10:17:59]: [Client #9] Selected by the server.
[INFO][10:17:59]: [Client #5] Dataset size: 2018
[INFO][10:17:59]: [Client #9] Loading its data source...
[INFO][10:17:59]: [Client #5] Sampler: iid
[INFO][10:17:59]: [Client #9] Dataset size: 2018
[INFO][10:17:59]: [Client #9] Sampler: iid
[INFO][10:18:01]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:18:01]: [Client #9] Start to process inbound data.
[INFO][10:18:01]: [Client #5] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:18:01]: [Client #5] Start to process inbound data.
[INFO][10:18:02]: [93m[1m[Client #9] Started training in communication round #37.[0m
[INFO][10:18:02]: [93m[1m[Client #5] Started training in communication round #37.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:51,  4.92s/it]  2%|▏         | 1/48 [00:04<03:52,  4.94s/it]  4%|▍         | 2/48 [00:05<01:54,  2.48s/it]  4%|▍         | 2/48 [00:05<01:55,  2.50s/it]  6%|▋         | 3/48 [00:06<01:16,  1.70s/it]  6%|▋         | 3/48 [00:06<01:17,  1.72s/it]  8%|▊         | 4/48 [00:07<00:58,  1.32s/it]  8%|▊         | 4/48 [00:07<00:59,  1.34s/it] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 10%|█         | 5/48 [00:08<00:48,  1.12s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.00it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.39it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][10:18:48]: [Client #5] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536584.pth.
{'train_runtime': 39.823, 'train_samples_per_second': 152.023, 'train_steps_per_second': 1.205, 'train_loss': 3.0378170013427734, 'epoch': 3.0}
[INFO][10:18:48]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.7505, 'train_samples_per_second': 152.3, 'train_steps_per_second': 1.208, 'train_loss': 2.394474665323893, 'epoch': 3.0}
[INFO][10:18:49]: [Client #5] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536584.pth.
[INFO][10:18:49]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][10:18:50]: [Client #5] Model trained.
[INFO][10:18:50]: [Client #5] Inbound data has been processed.
[INFO][10:18:50]: [Client #5] Outbound data is ready to be sent after being processed.
[INFO][10:18:50]: [Client #9] Model trained.
[INFO][10:18:50]: [Client #9] Inbound data has been processed.
[INFO][10:18:50]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][10:18:58]: [Client #5] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:18:58]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:18:59]: [Server #3536466] Received 507.38 MB of payload data from client #5 (simulated).
[INFO][10:19:00]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][10:19:00]: [Server #3536466] Selecting client #61 for training.
[INFO][10:19:00]: [Server #3536466] Sending the current model to client #61 (simulated).
[INFO][10:19:04]: [Server #3536466] Sending 507.38 MB of payload data to client #61 (simulated).
[INFO][10:19:04]: [Client #61] Selected by the server.
[INFO][10:19:04]: [Client #61] Loading its data source...
[INFO][10:19:04]: [Client #61] Dataset size: 2018
[INFO][10:19:04]: [Client #61] Sampler: iid
[INFO][10:19:05]: [Client #61] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:19:05]: [Client #61] Start to process inbound data.
[INFO][10:19:05]: [93m[1m[Client #61] Started training in communication round #37.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.18s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.58it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.71it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.80it/s] 21%|██        | 10/48 [00:08<00:20,  1.87it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.92it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.96it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.98it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.00it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.13it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.10it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.09it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.08it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.08it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.07it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.13it/s] 71%|███████   | 34/48 [00:20<00:06,  2.11it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.06it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.06it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.06it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][10:19:38]: [Client #61] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536584.pth.
{'train_runtime': 26.7612, 'train_samples_per_second': 226.223, 'train_steps_per_second': 1.794, 'train_loss': 3.053130785624186, 'epoch': 3.0}
[INFO][10:19:39]: [Client #61] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536584.pth.
[INFO][10:19:40]: [Client #61] Model trained.
[INFO][10:19:40]: [Client #61] Inbound data has been processed.
[INFO][10:19:40]: [Client #61] Outbound data is ready to be sent after being processed.
[INFO][10:19:45]: [Client #61] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:19:46]: [Server #3536466] Received 507.38 MB of payload data from client #61 (simulated).
[INFO][10:19:46]: [Server #3536466] Adding client #45 to the list of clients for aggregation.
[INFO][10:19:46]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][10:19:46]: [Server #3536466] Adding client #5 to the list of clients for aggregation.
[INFO][10:19:46]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][10:19:46]: [Server #3536466] Adding client #10 to the list of clients for aggregation.
[INFO][10:19:46]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:19:46]: [Server #3536466] Updated weights have been received.
[INFO][10:19:46]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:19:47]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:19:47]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.6426e+00  1e+02  1e+00  1e+00
 1:  2.5216e+00  1.6625e+00  5e+00  4e-02  4e-02
 2:  2.6466e+00  1.8623e+00  8e-01  2e-04  2e-04
 3:  2.6469e+00  2.6279e+00  2e-02  2e-06  2e-06
 4:  2.6451e+00  2.6417e+00  3e-03  3e-07  3e-07
 5:  2.6432e+00  2.6411e+00  2e-03  9e-07  4e-07
 6:  2.6427e+00  2.6419e+00  8e-04  5e-07  2e-07
 7:  2.6421e+00  2.6419e+00  1e-04  1e-06  7e-07
 8:  2.6420e+00  2.6419e+00  2e-05  2e-07  1e-07
 9:  2.6419e+00  2.6419e+00  6e-07  9e-09  5e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1  1.1  1.1  1.1  0.1  1.1  0.01 1.1  0.1  0.1  5.1  0.01 1.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  0.01 0.01 0.01 6.1  1.1  1.1
 4.1  0.01 6.1  2.1  1.1  2.1  2.1  0.01 1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  1.1  1.1  4.1  1.1  5.1  6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  0.01 1.1  0.01
 1.1  3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 6.1  6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 0.01 5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.36it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.48it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.06it/s]100%|██████████| 8/8 [00:00<00:00, 11.80it/s]
[INFO][10:19:58]: [93m[1m[Server #3536466] Global model perplexity: 28.62
[0m
[INFO][10:19:58]: [Server #3536466] All client reports have been processed.
[INFO][10:19:58]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_37.pth.
[INFO][10:20:01]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_37.pth.
[INFO][10:20:01]: [93m[1m
[Server #3536466] Starting round 38/100.[0m
[INFO][10:20:01]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.49868043e-01, 3.86008462e-06, 3.86008462e-06, 3.86008462e-06,
       2.49868043e-01, 3.86008462e-06, 1.70698516e-05, 3.86008462e-06,
       2.49868043e-01, 2.49868043e-01, 1.12872313e-07, 1.70698516e-05,
       3.86008462e-06, 3.86008462e-06, 7.38008423e-07, 3.86008462e-06,
       3.86008462e-06, 3.86008462e-06, 7.38008423e-07, 3.16572889e-07,
       3.86008462e-06, 7.83951726e-08, 1.70698516e-05, 7.83951726e-08,
       3.86008462e-06, 3.86008462e-06, 1.76664436e-07, 1.70698516e-05,
       7.83951726e-08, 7.38008423e-07, 3.86008462e-06, 7.38008423e-07,
       7.38008423e-07, 1.70698516e-05, 3.86008462e-06, 3.86008462e-06,
       7.83951726e-08, 1.12872313e-07, 3.86008462e-06, 3.86008462e-06,
       3.86008462e-06, 1.12872313e-07, 3.86008462e-06, 3.86008462e-06,
       1.76664436e-07, 3.86008462e-06, 1.12872313e-07, 7.83951726e-08,
       1.70698516e-05, 1.70698516e-05, 1.70698516e-05, 1.70698516e-05,
       3.86008462e-06, 1.70698516e-05, 3.86008462e-06, 1.70698516e-05,
       3.86008462e-06, 3.86008462e-06, 3.86008462e-06, 3.16572889e-07,
       1.12872313e-07, 3.16572889e-07, 3.86008462e-06, 3.16572889e-07,
       1.70698516e-05, 3.86008462e-06, 1.70698516e-05, 3.86008462e-06,
       3.16572889e-07, 7.83951726e-08, 3.86008462e-06, 3.16572889e-07,
       3.86008462e-06, 1.70698516e-05, 3.86008462e-06, 7.38008423e-07,
       1.70698516e-05, 1.70698516e-05, 7.38008423e-07, 3.86008462e-06,
       1.70698516e-05, 7.83951726e-08, 7.83951726e-08, 3.86008462e-06,
       1.70698516e-05, 3.86008462e-06, 3.16572889e-07, 3.16572889e-07,
       1.70698516e-05, 1.70698516e-05, 1.70698516e-05, 1.70698516e-05,
       1.12872313e-07, 1.12872313e-07, 3.86008462e-06]),)
[INFO][10:20:01]: [Server #3536466] Selected clients: [ 5 10  9  1 97]
[INFO][10:20:01]: [Server #3536466] Selecting client #10 for training.
[INFO][10:20:01]: [Server #3536466] Sending the current model to client #10 (simulated).
[INFO][10:20:06]: [Server #3536466] Sending 507.38 MB of payload data to client #10 (simulated).
[INFO][10:20:06]: [Server #3536466] Selecting client #1 for training.
[INFO][10:20:06]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][10:20:10]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][10:20:10]: [Client #10] Selected by the server.
[INFO][10:20:10]: [Client #10] Loading its data source...
[INFO][10:20:10]: [Client #10] Dataset size: 2018
[INFO][10:20:10]: [Client #10] Sampler: iid
[INFO][10:20:10]: [Client #1] Selected by the server.
[INFO][10:20:10]: [Client #1] Loading its data source...
[INFO][10:20:10]: [Client #1] Dataset size: 2018
[INFO][10:20:10]: [Client #1] Sampler: iid
[INFO][10:20:12]: [Client #10] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:20:12]: [Client #10] Start to process inbound data.
[INFO][10:20:12]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:20:12]: [Client #1] Start to process inbound data.
[INFO][10:20:13]: [93m[1m[Client #10] Started training in communication round #38.[0m
[INFO][10:20:13]: [93m[1m[Client #1] Started training in communication round #38.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:53,  4.98s/it]  2%|▏         | 1/48 [00:04<03:54,  4.99s/it]  4%|▍         | 2/48 [00:05<01:57,  2.55s/it]  4%|▍         | 2/48 [00:05<01:58,  2.57s/it]  6%|▋         | 3/48 [00:06<01:17,  1.73s/it]  6%|▋         | 3/48 [00:06<01:19,  1.76s/it]  8%|▊         | 4/48 [00:07<00:58,  1.33s/it]  8%|▊         | 4/48 [00:07<00:59,  1.36s/it] 10%|█         | 5/48 [00:08<00:47,  1.11s/it] 10%|█         | 5/48 [00:08<00:48,  1.13s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.00it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:11<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.37it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.33it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:31<00:09,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.30it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
[INFO][10:20:59]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 39.9124, 'train_samples_per_second': 151.682, 'train_steps_per_second': 1.203, 'train_loss': 2.678188959757487, 'epoch': 3.0}
[INFO][10:20:59]: [Client #10] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
{'train_runtime': 39.8334, 'train_samples_per_second': 151.983, 'train_steps_per_second': 1.205, 'train_loss': 3.1440258026123047, 'epoch': 3.0}
[INFO][10:21:00]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][10:21:00]: [Client #10] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
[INFO][10:21:00]: [Client #1] Model trained.
[INFO][10:21:00]: [Client #1] Inbound data has been processed.
[INFO][10:21:00]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][10:21:01]: [Client #10] Model trained.
[INFO][10:21:01]: [Client #10] Inbound data has been processed.
[INFO][10:21:01]: [Client #10] Outbound data is ready to be sent after being processed.
[INFO][10:21:09]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:21:09]: [Client #10] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:21:10]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][10:21:11]: [Server #3536466] Received 507.38 MB of payload data from client #10 (simulated).
[INFO][10:21:11]: [Server #3536466] Selecting client #97 for training.
[INFO][10:21:11]: [Server #3536466] Sending the current model to client #97 (simulated).
[INFO][10:21:16]: [Server #3536466] Sending 507.38 MB of payload data to client #97 (simulated).
[INFO][10:21:16]: [Server #3536466] Selecting client #5 for training.
[INFO][10:21:16]: [Server #3536466] Sending the current model to client #5 (simulated).
[INFO][10:21:20]: [Server #3536466] Sending 507.38 MB of payload data to client #5 (simulated).
[INFO][10:21:20]: [Client #97] Selected by the server.
[INFO][10:21:20]: [Client #97] Loading its data source...
[INFO][10:21:20]: [Client #5] Selected by the server.
[INFO][10:21:20]: [Client #97] Dataset size: 2018
[INFO][10:21:20]: [Client #5] Loading its data source...
[INFO][10:21:20]: [Client #97] Sampler: iid
[INFO][10:21:20]: [Client #5] Dataset size: 2018
[INFO][10:21:20]: [Client #5] Sampler: iid
[INFO][10:21:22]: [Client #5] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:21:22]: [Client #5] Start to process inbound data.
[INFO][10:21:22]: [Client #97] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:21:22]: [Client #97] Start to process inbound data.
[INFO][10:21:23]: [93m[1m[Client #5] Started training in communication round #38.[0m
[INFO][10:21:23]: [93m[1m[Client #97] Started training in communication round #38.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:40,  4.70s/it]  2%|▏         | 1/48 [00:04<03:44,  4.78s/it]  4%|▍         | 2/48 [00:05<01:49,  2.39s/it]  4%|▍         | 2/48 [00:05<01:50,  2.41s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:56,  1.27s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:18,  1.32it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.30it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.31it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][10:22:08]: [Client #97] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_97_3536584.pth.
{'train_runtime': 39.5752, 'train_samples_per_second': 152.975, 'train_steps_per_second': 1.213, 'train_loss': 3.127701759338379, 'epoch': 3.0}
[INFO][10:22:09]: [Client #5] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536585.pth.
{'train_runtime': 39.6295, 'train_samples_per_second': 152.765, 'train_steps_per_second': 1.211, 'train_loss': 2.9387381871541343, 'epoch': 3.0}
[INFO][10:22:09]: [Client #97] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_97_3536584.pth.
[INFO][10:22:10]: [Client #5] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536585.pth.
[INFO][10:22:10]: [Client #97] Model trained.
[INFO][10:22:10]: [Client #97] Inbound data has been processed.
[INFO][10:22:10]: [Client #97] Outbound data is ready to be sent after being processed.
[INFO][10:22:10]: [Client #5] Model trained.
[INFO][10:22:10]: [Client #5] Inbound data has been processed.
[INFO][10:22:10]: [Client #5] Outbound data is ready to be sent after being processed.
[INFO][10:22:19]: [Client #5] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:22:19]: [Client #97] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:22:20]: [Server #3536466] Received 507.38 MB of payload data from client #5 (simulated).
[INFO][10:22:21]: [Server #3536466] Received 507.38 MB of payload data from client #97 (simulated).
[INFO][10:22:21]: [Server #3536466] Selecting client #9 for training.
[INFO][10:22:21]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][10:22:25]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][10:22:25]: [Client #9] Selected by the server.
[INFO][10:22:25]: [Client #9] Loading its data source...
[INFO][10:22:25]: [Client #9] Dataset size: 2018
[INFO][10:22:25]: [Client #9] Sampler: iid
[INFO][10:22:27]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:22:27]: [Client #9] Start to process inbound data.
[INFO][10:22:27]: [93m[1m[Client #9] Started training in communication round #38.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.21s/it]  4%|▍         | 2/48 [00:04<01:32,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][10:23:00]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
{'train_runtime': 26.6544, 'train_samples_per_second': 227.129, 'train_steps_per_second': 1.801, 'train_loss': 2.3169026374816895, 'epoch': 3.0}
[INFO][10:23:01]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
[INFO][10:23:01]: [Client #9] Model trained.
[INFO][10:23:01]: [Client #9] Inbound data has been processed.
[INFO][10:23:01]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][10:23:06]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:23:07]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][10:23:07]: [Server #3536466] Adding client #61 to the list of clients for aggregation.
[INFO][10:23:07]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][10:23:07]: [Server #3536466] Adding client #5 to the list of clients for aggregation.
[INFO][10:23:07]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][10:23:07]: [Server #3536466] Adding client #10 to the list of clients for aggregation.
[INFO][10:23:07]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:23:07]: [Server #3536466] Updated weights have been received.
[INFO][10:23:08]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:23:08]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:23:08]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.6426e+00  1e+02  1e+00  1e+00
 1:  2.5216e+00  1.6625e+00  5e+00  4e-02  4e-02
 2:  2.6466e+00  1.8623e+00  8e-01  2e-04  2e-04
 3:  2.6469e+00  2.6279e+00  2e-02  2e-06  2e-06
 4:  2.6451e+00  2.6417e+00  3e-03  3e-07  3e-07
 5:  2.6432e+00  2.6411e+00  2e-03  9e-07  4e-07
 6:  2.6427e+00  2.6419e+00  8e-04  5e-07  2e-07
 7:  2.6421e+00  2.6419e+00  1e-04  1e-06  7e-07
 8:  2.6420e+00  2.6419e+00  2e-05  2e-07  1e-07
 9:  2.6419e+00  2.6419e+00  6e-07  9e-09  5e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1  1.1  1.1  1.1  0.1  1.1  0.01 1.1  0.1  0.1  5.1  0.01 1.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  0.01 0.01 0.01 6.1  1.1  1.1
 4.1  0.01 6.1  2.1  1.1  2.1  2.1  0.01 1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  1.1  1.1  4.1  1.1  5.1  6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  0.01 1.1  0.01
 1.1  3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 6.1  6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 0.01 5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.04it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.35it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.92it/s]100%|██████████| 8/8 [00:00<00:00, 11.74it/s]
[INFO][10:23:19]: [93m[1m[Server #3536466] Global model perplexity: 29.05
[0m
[INFO][10:23:19]: [Server #3536466] All client reports have been processed.
[INFO][10:23:19]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_38.pth.
[INFO][10:23:23]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_38.pth.
[INFO][10:23:23]: [93m[1m
[Server #3536466] Starting round 39/100.[0m
[INFO][10:23:23]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.49880030e-01, 3.59398781e-06, 3.59398781e-06, 3.59398781e-06,
       2.49880030e-01, 3.59398781e-06, 1.59301888e-05, 3.59398781e-06,
       2.49880030e-01, 2.49880030e-01, 1.04497748e-07, 1.59301888e-05,
       3.59398781e-06, 3.59398781e-06, 6.84147846e-07, 3.59398781e-06,
       3.59398781e-06, 3.59398781e-06, 6.84147846e-07, 2.93217729e-07,
       3.59398781e-06, 7.25724799e-08, 1.59301888e-05, 7.25724799e-08,
       3.59398781e-06, 3.59398781e-06, 1.63581057e-07, 1.59301888e-05,
       7.25724799e-08, 6.84147846e-07, 3.59398781e-06, 6.84147846e-07,
       6.84147846e-07, 1.59301888e-05, 3.59398781e-06, 3.59398781e-06,
       7.25724799e-08, 1.04497748e-07, 3.59398781e-06, 3.59398781e-06,
       3.59398781e-06, 1.04497748e-07, 3.59398781e-06, 3.59398781e-06,
       1.63581057e-07, 3.59398781e-06, 1.04497748e-07, 7.25724799e-08,
       1.59301888e-05, 1.59301888e-05, 1.59301888e-05, 1.59301888e-05,
       3.59398781e-06, 1.59301888e-05, 3.59398781e-06, 1.59301888e-05,
       3.59398781e-06, 3.59398781e-06, 3.59398781e-06, 3.59398781e-06,
       2.93217729e-07, 1.04497748e-07, 2.93217729e-07, 3.59398781e-06,
       2.93217729e-07, 1.59301888e-05, 3.59398781e-06, 1.59301888e-05,
       3.59398781e-06, 2.93217729e-07, 7.25724799e-08, 3.59398781e-06,
       2.93217729e-07, 3.59398781e-06, 1.59301888e-05, 3.59398781e-06,
       6.84147846e-07, 1.59301888e-05, 1.59301888e-05, 6.84147846e-07,
       3.59398781e-06, 1.59301888e-05, 7.25724799e-08, 7.25724799e-08,
       3.59398781e-06, 1.59301888e-05, 3.59398781e-06, 2.93217729e-07,
       2.93217729e-07, 1.59301888e-05, 1.59301888e-05, 1.59301888e-05,
       1.04497748e-07, 1.04497748e-07, 3.59398781e-06]),)
[INFO][10:23:23]: [Server #3536466] Selected clients: [ 1  5 10  9 80]
[INFO][10:23:23]: [Server #3536466] Selecting client #80 for training.
[INFO][10:23:23]: [Server #3536466] Sending the current model to client #80 (simulated).
[INFO][10:23:27]: [Server #3536466] Sending 507.38 MB of payload data to client #80 (simulated).
[INFO][10:23:27]: [Server #3536466] Selecting client #1 for training.
[INFO][10:23:27]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][10:23:32]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][10:23:32]: [Client #80] Selected by the server.
[INFO][10:23:32]: [Client #80] Loading its data source...
[INFO][10:23:32]: [Client #80] Dataset size: 2018
[INFO][10:23:32]: [Client #80] Sampler: iid
[INFO][10:23:32]: [Client #1] Selected by the server.
[INFO][10:23:32]: [Client #1] Loading its data source...
[INFO][10:23:32]: [Client #1] Dataset size: 2018
[INFO][10:23:32]: [Client #1] Sampler: iid
[INFO][10:23:34]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:23:34]: [Client #1] Start to process inbound data.
[INFO][10:23:34]: [Client #80] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:23:34]: [Client #80] Start to process inbound data.
[INFO][10:23:35]: [93m[1m[Client #80] Started training in communication round #39.[0m
[INFO][10:23:35]: [93m[1m[Client #1] Started training in communication round #39.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:35,  4.59s/it]  2%|▏         | 1/48 [00:05<03:56,  5.04s/it]  4%|▍         | 2/48 [00:05<01:49,  2.38s/it]  4%|▍         | 2/48 [00:05<01:59,  2.60s/it]  6%|▋         | 3/48 [00:06<01:17,  1.72s/it]  6%|▋         | 3/48 [00:06<01:20,  1.79s/it]  8%|▊         | 4/48 [00:07<01:00,  1.38s/it]  8%|▊         | 4/48 [00:07<01:03,  1.44s/it] 10%|█         | 5/48 [00:08<00:51,  1.20s/it] 10%|█         | 5/48 [00:08<00:53,  1.25s/it] 12%|█▎        | 6/48 [00:09<00:46,  1.10s/it] 12%|█▎        | 6/48 [00:09<00:47,  1.14s/it] 15%|█▍        | 7/48 [00:09<00:42,  1.04s/it] 15%|█▍        | 7/48 [00:10<00:43,  1.06s/it] 17%|█▋        | 8/48 [00:10<00:40,  1.01s/it] 17%|█▋        | 8/48 [00:11<00:40,  1.01s/it] 19%|█▉        | 9/48 [00:11<00:38,  1.01it/s] 19%|█▉        | 9/48 [00:12<00:38,  1.03it/s] 21%|██        | 10/48 [00:12<00:37,  1.02it/s] 21%|██        | 10/48 [00:13<00:36,  1.04it/s] 23%|██▎       | 11/48 [00:13<00:35,  1.03it/s] 23%|██▎       | 11/48 [00:14<00:36,  1.02it/s] 25%|██▌       | 12/48 [00:14<00:34,  1.03it/s] 25%|██▌       | 12/48 [00:15<00:34,  1.04it/s] 27%|██▋       | 13/48 [00:15<00:32,  1.08it/s] 27%|██▋       | 13/48 [00:15<00:32,  1.07it/s] 29%|██▉       | 14/48 [00:16<00:32,  1.06it/s] 29%|██▉       | 14/48 [00:16<00:32,  1.05it/s] 31%|███▏      | 15/48 [00:17<00:30,  1.08it/s] 31%|███▏      | 15/48 [00:17<00:32,  1.01it/s] 33%|███▎      | 16/48 [00:18<00:29,  1.08it/s] 33%|███▎      | 16/48 [00:18<00:28,  1.13it/s] 35%|███▌      | 17/48 [00:19<00:28,  1.08it/s] 35%|███▌      | 17/48 [00:19<00:28,  1.10it/s] 38%|███▊      | 18/48 [00:20<00:27,  1.09it/s] 38%|███▊      | 18/48 [00:20<00:27,  1.10it/s] 40%|███▉      | 19/48 [00:21<00:27,  1.07it/s] 40%|███▉      | 19/48 [00:21<00:27,  1.07it/s] 42%|████▏     | 20/48 [00:22<00:26,  1.06it/s] 42%|████▏     | 20/48 [00:22<00:26,  1.06it/s] 44%|████▍     | 21/48 [00:22<00:24,  1.08it/s] 44%|████▍     | 21/48 [00:23<00:25,  1.07it/s] 46%|████▌     | 22/48 [00:23<00:23,  1.09it/s] 46%|████▌     | 22/48 [00:24<00:24,  1.08it/s] 48%|████▊     | 23/48 [00:24<00:22,  1.10it/s] 48%|████▊     | 23/48 [00:25<00:22,  1.09it/s] 50%|█████     | 24/48 [00:25<00:21,  1.10it/s] 50%|█████     | 24/48 [00:26<00:21,  1.10it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.07it/s] 52%|█████▏    | 25/48 [00:27<00:21,  1.08it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.08it/s] 54%|█████▍    | 26/48 [00:28<00:20,  1.06it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.09it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.09it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.10it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.08it/s] 60%|██████    | 29/48 [00:30<00:17,  1.09it/s] 60%|██████    | 29/48 [00:30<00:17,  1.10it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.06it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.10it/s] 65%|██████▍   | 31/48 [00:32<00:15,  1.08it/s] 65%|██████▍   | 31/48 [00:32<00:16,  1.03it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.08it/s] 67%|██████▋   | 32/48 [00:33<00:13,  1.15it/s] 69%|██████▉   | 33/48 [00:34<00:14,  1.02it/s] 69%|██████▉   | 33/48 [00:34<00:14,  1.06it/s] 71%|███████   | 34/48 [00:35<00:14,  1.01s/it] 71%|███████   | 34/48 [00:35<00:13,  1.01it/s] 73%|███████▎  | 35/48 [00:36<00:13,  1.04s/it] 73%|███████▎  | 35/48 [00:36<00:13,  1.02s/it] 75%|███████▌  | 36/48 [00:37<00:12,  1.05s/it] 75%|███████▌  | 36/48 [00:37<00:12,  1.04s/it] 77%|███████▋  | 37/48 [00:38<00:11,  1.06s/it] 77%|███████▋  | 37/48 [00:38<00:11,  1.05s/it] 79%|███████▉  | 38/48 [00:39<00:10,  1.06s/it] 79%|███████▉  | 38/48 [00:39<00:10,  1.05s/it] 81%|████████▏ | 39/48 [00:40<00:09,  1.07s/it] 81%|████████▏ | 39/48 [00:40<00:09,  1.06s/it] 83%|████████▎ | 40/48 [00:41<00:08,  1.07s/it] 83%|████████▎ | 40/48 [00:42<00:08,  1.07s/it] 85%|████████▌ | 41/48 [00:42<00:07,  1.07s/it] 85%|████████▌ | 41/48 [00:43<00:07,  1.08s/it] 88%|████████▊ | 42/48 [00:43<00:06,  1.03s/it] 88%|████████▊ | 42/48 [00:44<00:06,  1.04s/it] 90%|████████▉ | 43/48 [00:44<00:05,  1.01s/it] 90%|████████▉ | 43/48 [00:45<00:05,  1.02s/it] 92%|█████████▏| 44/48 [00:45<00:03,  1.03it/s] 92%|█████████▏| 44/48 [00:46<00:03,  1.01it/s] 94%|█████████▍| 45/48 [00:46<00:02,  1.05it/s] 94%|█████████▍| 45/48 [00:46<00:02,  1.02it/s] 96%|█████████▌| 46/48 [00:47<00:01,  1.07it/s] 96%|█████████▌| 46/48 [00:47<00:01,  1.05it/s] 98%|█████████▊| 47/48 [00:48<00:00,  1.07it/s] 98%|█████████▊| 47/48 [00:49<00:01,  1.01s/it]100%|██████████| 48/48 [00:49<00:00,  1.06it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:49<00:00,  1.06it/s]100%|██████████| 48/48 [00:49<00:00,  1.03s/it]
100%|██████████| 48/48 [00:49<00:00,  1.15it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:49<00:00,  1.15it/s]100%|██████████| 48/48 [00:49<00:00,  1.03s/it]
[INFO][10:24:31]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 49.3176, 'train_samples_per_second': 122.755, 'train_steps_per_second': 0.973, 'train_loss': 2.5996479988098145, 'epoch': 3.0}
[INFO][10:24:31]: [Client #80] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_80_3536584.pth.
{'train_runtime': 49.5438, 'train_samples_per_second': 122.195, 'train_steps_per_second': 0.969, 'train_loss': 3.2722768783569336, 'epoch': 3.0}
[INFO][10:24:32]: [Client #80] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_80_3536584.pth.
[INFO][10:24:32]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][10:24:32]: [Client #80] Model trained.
[INFO][10:24:32]: [Client #80] Inbound data has been processed.
[INFO][10:24:32]: [Client #80] Outbound data is ready to be sent after being processed.
[INFO][10:24:32]: [Client #1] Model trained.
[INFO][10:24:32]: [Client #1] Inbound data has been processed.
[INFO][10:24:32]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][10:24:41]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:24:41]: [Client #80] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:24:42]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][10:24:43]: [Server #3536466] Received 507.38 MB of payload data from client #80 (simulated).
[INFO][10:24:43]: [Server #3536466] Selecting client #10 for training.
[INFO][10:24:43]: [Server #3536466] Sending the current model to client #10 (simulated).
[INFO][10:24:47]: [Server #3536466] Sending 507.38 MB of payload data to client #10 (simulated).
[INFO][10:24:47]: [Server #3536466] Selecting client #5 for training.
[INFO][10:24:47]: [Server #3536466] Sending the current model to client #5 (simulated).
[INFO][10:24:52]: [Server #3536466] Sending 507.38 MB of payload data to client #5 (simulated).
[INFO][10:24:52]: [Client #10] Selected by the server.
[INFO][10:24:52]: [Client #5] Selected by the server.
[INFO][10:24:52]: [Client #10] Loading its data source...
[INFO][10:24:52]: [Client #5] Loading its data source...
[INFO][10:24:52]: [Client #5] Dataset size: 2018
[INFO][10:24:52]: [Client #10] Dataset size: 2018
[INFO][10:24:52]: [Client #5] Sampler: iid
[INFO][10:24:52]: [Client #10] Sampler: iid
[INFO][10:24:53]: [Client #10] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:24:53]: [Client #10] Start to process inbound data.
[INFO][10:24:53]: [Client #5] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:24:53]: [Client #5] Start to process inbound data.
[INFO][10:24:54]: [93m[1m[Client #10] Started training in communication round #39.[0m
[INFO][10:24:54]: [93m[1m[Client #5] Started training in communication round #39.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:52,  4.95s/it]  2%|▏         | 1/48 [00:04<03:50,  4.91s/it]  4%|▍         | 2/48 [00:05<01:54,  2.50s/it]  4%|▍         | 2/48 [00:05<01:55,  2.51s/it]  6%|▋         | 3/48 [00:06<01:17,  1.72s/it]  6%|▋         | 3/48 [00:06<01:17,  1.73s/it]  8%|▊         | 4/48 [00:07<00:58,  1.32s/it]  8%|▊         | 4/48 [00:07<00:59,  1.34s/it] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 10%|█         | 5/48 [00:08<00:48,  1.12s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.39it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
[INFO][10:25:40]: [Client #5] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536585.pth.
{'train_runtime': 39.8762, 'train_samples_per_second': 151.82, 'train_steps_per_second': 1.204, 'train_loss': 2.841196378072103, 'epoch': 3.0}
[INFO][10:25:40]: [Client #10] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
{'train_runtime': 39.8371, 'train_samples_per_second': 151.969, 'train_steps_per_second': 1.205, 'train_loss': 3.0644540786743164, 'epoch': 3.0}
[INFO][10:25:41]: [Client #5] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536585.pth.
[INFO][10:25:41]: [Client #10] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
[INFO][10:25:42]: [Client #5] Model trained.
[INFO][10:25:42]: [Client #5] Inbound data has been processed.
[INFO][10:25:42]: [Client #5] Outbound data is ready to be sent after being processed.
[INFO][10:25:42]: [Client #10] Model trained.
[INFO][10:25:42]: [Client #10] Inbound data has been processed.
[INFO][10:25:42]: [Client #10] Outbound data is ready to be sent after being processed.
[INFO][10:25:50]: [Client #5] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:25:51]: [Client #10] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:25:51]: [Server #3536466] Received 507.38 MB of payload data from client #5 (simulated).
[INFO][10:25:53]: [Server #3536466] Received 507.38 MB of payload data from client #10 (simulated).
[INFO][10:25:53]: [Server #3536466] Selecting client #9 for training.
[INFO][10:25:53]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][10:25:57]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][10:25:57]: [Client #9] Selected by the server.
[INFO][10:25:57]: [Client #9] Loading its data source...
[INFO][10:25:57]: [Client #9] Dataset size: 2018
[INFO][10:25:57]: [Client #9] Sampler: iid
[INFO][10:25:58]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:25:58]: [Client #9] Start to process inbound data.
[INFO][10:25:59]: [93m[1m[Client #9] Started training in communication round #39.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:20,  4.27s/it]  4%|▍         | 2/48 [00:04<01:34,  2.05s/it]  6%|▋         | 3/48 [00:05<01:00,  1.33s/it]  8%|▊         | 4/48 [00:05<00:43,  1.00it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:20<00:06,  2.11it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.07it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.06it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.06it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.05it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.05it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.05it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.05it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.05it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.05it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.05it/s]100%|██████████| 48/48 [00:26<00:00,  2.16it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.16it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][10:26:32]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
{'train_runtime': 26.7624, 'train_samples_per_second': 226.213, 'train_steps_per_second': 1.794, 'train_loss': 2.2506346702575684, 'epoch': 3.0}
[INFO][10:26:33]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
[INFO][10:26:33]: [Client #9] Model trained.
[INFO][10:26:33]: [Client #9] Inbound data has been processed.
[INFO][10:26:33]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][10:26:38]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:26:39]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][10:26:39]: [Server #3536466] Adding client #97 to the list of clients for aggregation.
[INFO][10:26:39]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][10:26:39]: [Server #3536466] Adding client #5 to the list of clients for aggregation.
[INFO][10:26:39]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][10:26:39]: [Server #3536466] Adding client #10 to the list of clients for aggregation.
[INFO][10:26:39]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:26:39]: [Server #3536466] Updated weights have been received.
[INFO][10:26:40]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:26:41]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:26:41]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.6450e+00  1e+02  1e+00  1e+00
 1:  2.5243e+00  1.6649e+00  5e+00  4e-02  4e-02
 2:  2.6491e+00  1.8652e+00  8e-01  2e-04  2e-04
 3:  2.6493e+00  2.6305e+00  2e-02  2e-06  2e-06
 4:  2.6476e+00  2.6442e+00  3e-03  3e-07  3e-07
 5:  2.6456e+00  2.6435e+00  2e-03  1e-06  4e-07
 6:  2.6451e+00  2.6443e+00  8e-04  5e-07  2e-07
 7:  2.6445e+00  2.6444e+00  1e-04  1e-06  7e-07
 8:  2.6444e+00  2.6444e+00  2e-05  2e-07  1e-07
 9:  2.6444e+00  2.6444e+00  5e-07  8e-09  4e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1  1.1  1.1  1.1  0.1  1.1  0.01 1.1  0.1  0.1  5.1  0.01 1.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  0.01 0.01 0.01 6.1  1.1  1.1
 4.1  0.01 6.1  2.1  1.1  2.1  2.1  0.01 1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  1.1  1.1  4.1  1.1  5.1  6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  0.01 1.1  0.01
 1.1  3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  0.01 0.01 2.1  0.01 1.1
 0.01 6.1  6.1  1.1  0.01 0.01 1.1  3.1  3.1  0.01 0.01 0.01 1.1  5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.01 0.01 0.2  0.01 0.2
 0.01 0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.01it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.38it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.85it/s]100%|██████████| 8/8 [00:00<00:00, 11.68it/s]
[INFO][10:26:52]: [93m[1m[Server #3536466] Global model perplexity: 29.54
[0m
[INFO][10:26:52]: [Server #3536466] All client reports have been processed.
[INFO][10:26:52]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_39.pth.
[INFO][10:26:55]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_39.pth.
[INFO][10:26:55]: [93m[1m
[Server #3536466] Starting round 40/100.[0m
[INFO][10:26:55]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.49891223e-01, 3.33981435e-06, 3.33981435e-06, 3.33981435e-06,
       2.49891223e-01, 3.33981435e-06, 1.48371020e-05, 3.33981435e-06,
       2.49891223e-01, 2.49891223e-01, 9.65394588e-08, 1.48371020e-05,
       3.33981435e-06, 3.33981435e-06, 6.32910470e-07, 3.33981435e-06,
       3.33981435e-06, 3.33981435e-06, 6.32910470e-07, 2.71015519e-07,
       3.33981435e-06, 6.70395886e-08, 1.48371020e-05, 6.70395886e-08,
       3.33981435e-06, 3.33981435e-06, 1.51146557e-07, 1.48371020e-05,
       6.70395886e-08, 6.32910470e-07, 3.33981435e-06, 6.32910470e-07,
       6.32910470e-07, 1.48371020e-05, 3.33981435e-06, 3.33981435e-06,
       6.70395886e-08, 9.65394588e-08, 3.33981435e-06, 3.33981435e-06,
       3.33981435e-06, 9.65394588e-08, 3.33981435e-06, 3.33981435e-06,
       1.51146557e-07, 3.33981435e-06, 9.65394588e-08, 6.70395886e-08,
       1.48371020e-05, 1.48371020e-05, 1.48371020e-05, 1.48371020e-05,
       3.33981435e-06, 1.48371020e-05, 3.33981435e-06, 1.48371020e-05,
       3.33981435e-06, 3.33981435e-06, 3.33981435e-06, 3.33981435e-06,
       2.71015519e-07, 9.65394588e-08, 2.71015519e-07, 3.33981435e-06,
       2.71015519e-07, 1.48371020e-05, 3.33981435e-06, 1.48371020e-05,
       3.33981435e-06, 2.71015519e-07, 6.70395886e-08, 3.33981435e-06,
       2.71015519e-07, 3.33981435e-06, 1.48371020e-05, 3.33981435e-06,
       6.32910470e-07, 1.48371020e-05, 6.32910470e-07, 3.33981435e-06,
       1.48371020e-05, 6.70395886e-08, 6.70395886e-08, 3.33981435e-06,
       1.48371020e-05, 3.33981435e-06, 2.71015519e-07, 2.71015519e-07,
       1.48371020e-05, 1.48371020e-05, 1.48371020e-05, 3.33981435e-06,
       9.65394588e-08, 9.65394588e-08, 3.33981435e-06]),)
[INFO][10:26:55]: [Server #3536466] Selected clients: [ 1  9  5 10 53]
[INFO][10:26:55]: [Server #3536466] Selecting client #10 for training.
[INFO][10:26:55]: [Server #3536466] Sending the current model to client #10 (simulated).
[INFO][10:27:00]: [Server #3536466] Sending 507.38 MB of payload data to client #10 (simulated).
[INFO][10:27:00]: [Server #3536466] Selecting client #1 for training.
[INFO][10:27:00]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][10:27:04]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][10:27:04]: [Client #10] Selected by the server.
[INFO][10:27:04]: [Client #10] Loading its data source...
[INFO][10:27:04]: [Client #10] Dataset size: 2018
[INFO][10:27:04]: [Client #10] Sampler: iid
[INFO][10:27:04]: [Client #1] Selected by the server.
[INFO][10:27:04]: [Client #1] Loading its data source...
[INFO][10:27:04]: [Client #1] Dataset size: 2018
[INFO][10:27:04]: [Client #1] Sampler: iid
[INFO][10:27:06]: [Client #10] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:27:06]: [Client #10] Start to process inbound data.
[INFO][10:27:06]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:27:06]: [Client #1] Start to process inbound data.
[INFO][10:27:07]: [93m[1m[Client #10] Started training in communication round #40.[0m
[INFO][10:27:07]: [93m[1m[Client #1] Started training in communication round #40.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:38,  4.64s/it]  2%|▏         | 1/48 [00:04<03:44,  4.78s/it]  4%|▍         | 2/48 [00:05<01:54,  2.50s/it]  4%|▍         | 2/48 [00:05<02:00,  2.61s/it]  6%|▋         | 3/48 [00:06<01:23,  1.85s/it]  6%|▋         | 3/48 [00:06<01:26,  1.91s/it]  8%|▊         | 4/48 [00:07<01:06,  1.50s/it]  8%|▊         | 4/48 [00:07<01:08,  1.55s/it] 10%|█         | 5/48 [00:08<00:54,  1.28s/it] 10%|█         | 5/48 [00:08<00:56,  1.31s/it] 12%|█▎        | 6/48 [00:09<00:47,  1.14s/it] 12%|█▎        | 6/48 [00:09<00:49,  1.18s/it] 15%|█▍        | 7/48 [00:10<00:44,  1.07s/it] 15%|█▍        | 7/48 [00:10<00:45,  1.10s/it] 17%|█▋        | 8/48 [00:11<00:40,  1.01s/it] 17%|█▋        | 8/48 [00:11<00:41,  1.03s/it] 19%|█▉        | 9/48 [00:12<00:37,  1.03it/s] 19%|█▉        | 9/48 [00:12<00:38,  1.01it/s] 21%|██        | 10/48 [00:12<00:35,  1.07it/s] 21%|██        | 10/48 [00:13<00:36,  1.04it/s] 23%|██▎       | 11/48 [00:13<00:34,  1.08it/s] 23%|██▎       | 11/48 [00:14<00:34,  1.06it/s] 25%|██▌       | 12/48 [00:14<00:32,  1.09it/s] 25%|██▌       | 12/48 [00:15<00:33,  1.08it/s] 27%|██▋       | 13/48 [00:15<00:32,  1.06it/s] 27%|██▋       | 13/48 [00:16<00:32,  1.09it/s] 29%|██▉       | 14/48 [00:16<00:31,  1.08it/s] 29%|██▉       | 14/48 [00:16<00:31,  1.09it/s] 31%|███▏      | 15/48 [00:17<00:30,  1.08it/s] 31%|███▏      | 15/48 [00:18<00:31,  1.03it/s] 33%|███▎      | 16/48 [00:18<00:29,  1.09it/s] 33%|███▎      | 16/48 [00:18<00:28,  1.14it/s] 35%|███▌      | 17/48 [00:19<00:27,  1.12it/s] 35%|███▌      | 17/48 [00:19<00:27,  1.13it/s] 38%|███▊      | 18/48 [00:20<00:26,  1.13it/s] 38%|███▊      | 18/48 [00:20<00:26,  1.11it/s] 40%|███▉      | 19/48 [00:21<00:26,  1.09it/s] 40%|███▉      | 19/48 [00:21<00:26,  1.11it/s] 42%|████▏     | 20/48 [00:22<00:25,  1.11it/s] 42%|████▏     | 20/48 [00:22<00:25,  1.09it/s] 44%|████▍     | 21/48 [00:22<00:24,  1.12it/s] 44%|████▍     | 21/48 [00:23<00:24,  1.09it/s] 46%|████▌     | 22/48 [00:23<00:23,  1.10it/s] 46%|████▌     | 22/48 [00:24<00:23,  1.08it/s] 48%|████▊     | 23/48 [00:24<00:23,  1.07it/s] 48%|████▊     | 23/48 [00:25<00:22,  1.09it/s] 50%|█████     | 24/48 [00:25<00:22,  1.06it/s] 50%|█████     | 24/48 [00:26<00:22,  1.09it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.09it/s] 52%|█████▏    | 25/48 [00:27<00:21,  1.09it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.09it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.10it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.09it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.09it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.08it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.08it/s] 60%|██████    | 29/48 [00:30<00:17,  1.10it/s] 60%|██████    | 29/48 [00:30<00:17,  1.09it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.09it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.09it/s] 65%|██████▍   | 31/48 [00:32<00:15,  1.11it/s] 65%|██████▍   | 31/48 [00:32<00:16,  1.04it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.09it/s] 67%|██████▋   | 32/48 [00:33<00:13,  1.16it/s] 69%|██████▉   | 33/48 [00:34<00:14,  1.03it/s] 69%|██████▉   | 33/48 [00:34<00:14,  1.07it/s] 71%|███████   | 34/48 [00:35<00:14,  1.01s/it] 71%|███████   | 34/48 [00:35<00:13,  1.02it/s] 73%|███████▎  | 35/48 [00:36<00:13,  1.04s/it] 73%|███████▎  | 35/48 [00:36<00:13,  1.02s/it] 75%|███████▌  | 36/48 [00:37<00:12,  1.05s/it] 75%|███████▌  | 36/48 [00:37<00:12,  1.04s/it] 77%|███████▋  | 37/48 [00:38<00:11,  1.07s/it] 77%|███████▋  | 37/48 [00:38<00:11,  1.06s/it] 79%|███████▉  | 38/48 [00:39<00:10,  1.08s/it] 79%|███████▉  | 38/48 [00:39<00:10,  1.07s/it] 81%|████████▏ | 39/48 [00:40<00:09,  1.08s/it] 81%|████████▏ | 39/48 [00:40<00:09,  1.08s/it] 83%|████████▎ | 40/48 [00:41<00:08,  1.07s/it] 83%|████████▎ | 40/48 [00:42<00:08,  1.08s/it] 85%|████████▌ | 41/48 [00:42<00:07,  1.04s/it] 85%|████████▌ | 41/48 [00:43<00:07,  1.04s/it] 88%|████████▊ | 42/48 [00:43<00:06,  1.01s/it] 88%|████████▊ | 42/48 [00:44<00:06,  1.02s/it] 90%|████████▉ | 43/48 [00:44<00:04,  1.01it/s] 90%|████████▉ | 43/48 [00:45<00:05,  1.03s/it] 92%|█████████▏| 44/48 [00:45<00:03,  1.03it/s] 92%|█████████▏| 44/48 [00:46<00:04,  1.01s/it] 94%|█████████▍| 45/48 [00:46<00:02,  1.04it/s] 94%|█████████▍| 45/48 [00:47<00:03,  1.00s/it] 96%|█████████▌| 46/48 [00:47<00:01,  1.04it/s] 96%|█████████▌| 46/48 [00:47<00:01,  1.03it/s] 98%|█████████▊| 47/48 [00:48<00:00,  1.05it/s] 98%|█████████▊| 47/48 [00:48<00:01,  1.01s/it]100%|██████████| 48/48 [00:49<00:00,  1.04it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:49<00:00,  1.04it/s]100%|██████████| 48/48 [00:49<00:00,  1.03s/it]
100%|██████████| 48/48 [00:49<00:00,  1.15it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:49<00:00,  1.15it/s]100%|██████████| 48/48 [00:49<00:00,  1.03s/it]
[INFO][10:28:02]: [Client #10] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
{'train_runtime': 49.4077, 'train_samples_per_second': 122.532, 'train_steps_per_second': 0.972, 'train_loss': 2.9899187088012695, 'epoch': 3.0}
[INFO][10:28:02]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 49.5396, 'train_samples_per_second': 122.205, 'train_steps_per_second': 0.969, 'train_loss': 2.5144294102986655, 'epoch': 3.0}
[INFO][10:28:04]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][10:28:04]: [Client #10] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
[INFO][10:28:04]: [Client #1] Model trained.
[INFO][10:28:04]: [Client #1] Inbound data has been processed.
[INFO][10:28:04]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][10:28:04]: [Client #10] Model trained.
[INFO][10:28:04]: [Client #10] Inbound data has been processed.
[INFO][10:28:04]: [Client #10] Outbound data is ready to be sent after being processed.
[INFO][10:28:13]: [Client #10] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:28:13]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:28:14]: [Server #3536466] Received 507.38 MB of payload data from client #10 (simulated).
[INFO][10:28:15]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][10:28:15]: [Server #3536466] Selecting client #5 for training.
[INFO][10:28:15]: [Server #3536466] Sending the current model to client #5 (simulated).
[INFO][10:28:19]: [Server #3536466] Sending 507.38 MB of payload data to client #5 (simulated).
[INFO][10:28:19]: [Server #3536466] Selecting client #53 for training.
[INFO][10:28:19]: [Server #3536466] Sending the current model to client #53 (simulated).
[INFO][10:28:24]: [Server #3536466] Sending 507.38 MB of payload data to client #53 (simulated).
[INFO][10:28:24]: [Client #53] Selected by the server.
[INFO][10:28:24]: [Client #53] Loading its data source...
[INFO][10:28:24]: [Client #5] Selected by the server.
[INFO][10:28:24]: [Client #53] Dataset size: 2018
[INFO][10:28:24]: [Client #5] Loading its data source...
[INFO][10:28:24]: [Client #53] Sampler: iid
[INFO][10:28:24]: [Client #5] Dataset size: 2018
[INFO][10:28:24]: [Client #5] Sampler: iid
[INFO][10:28:25]: [Client #53] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:28:25]: [Client #53] Start to process inbound data.
[INFO][10:28:25]: [Client #5] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:28:25]: [Client #5] Start to process inbound data.
[INFO][10:28:26]: [93m[1m[Client #5] Started training in communication round #40.[0m
[INFO][10:28:26]: [93m[1m[Client #53] Started training in communication round #40.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:40,  4.69s/it]  2%|▏         | 1/48 [00:04<03:44,  4.79s/it]  4%|▍         | 2/48 [00:05<01:48,  2.36s/it]  4%|▍         | 2/48 [00:05<01:50,  2.41s/it]  6%|▋         | 3/48 [00:06<01:13,  1.62s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:55,  1.27s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 10%|█         | 5/48 [00:07<00:47,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.02it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:12<00:28,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.28it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:27,  1.29it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.35it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 71%|███████   | 34/48 [00:29<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.30it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.30it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][10:29:12]: [Client #5] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536584.pth.
{'train_runtime': 39.6642, 'train_samples_per_second': 152.631, 'train_steps_per_second': 1.21, 'train_loss': 2.750070571899414, 'epoch': 3.0}
[INFO][10:29:12]: [Client #53] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_53_3536585.pth.
{'train_runtime': 39.5816, 'train_samples_per_second': 152.95, 'train_steps_per_second': 1.213, 'train_loss': 3.077094395955404, 'epoch': 3.0}
[INFO][10:29:13]: [Client #5] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536584.pth.
[INFO][10:29:14]: [Client #53] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_53_3536585.pth.
[INFO][10:29:14]: [Client #5] Model trained.
[INFO][10:29:14]: [Client #5] Inbound data has been processed.
[INFO][10:29:14]: [Client #5] Outbound data is ready to be sent after being processed.
[INFO][10:29:14]: [Client #53] Model trained.
[INFO][10:29:14]: [Client #53] Inbound data has been processed.
[INFO][10:29:14]: [Client #53] Outbound data is ready to be sent after being processed.
[INFO][10:29:21]: [Client #5] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:29:22]: [Client #53] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:29:23]: [Server #3536466] Received 507.38 MB of payload data from client #5 (simulated).
[INFO][10:29:24]: [Server #3536466] Received 507.38 MB of payload data from client #53 (simulated).
[INFO][10:29:24]: [Server #3536466] Selecting client #9 for training.
[INFO][10:29:24]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][10:29:28]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][10:29:28]: [Client #9] Selected by the server.
[INFO][10:29:28]: [Client #9] Loading its data source...
[INFO][10:29:28]: [Client #9] Dataset size: 2018
[INFO][10:29:28]: [Client #9] Sampler: iid
[INFO][10:29:30]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:29:30]: [Client #9] Start to process inbound data.
[INFO][10:29:30]: [93m[1m[Client #9] Started training in communication round #40.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:21,  4.29s/it]  4%|▍         | 2/48 [00:04<01:34,  2.05s/it]  6%|▋         | 3/48 [00:05<00:59,  1.33s/it]  8%|▊         | 4/48 [00:05<00:43,  1.00it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.01it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.12it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.10it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.09it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.08it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.08it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.07it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.06it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.06it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.05it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.04it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.04it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.04it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.04it/s]100%|██████████| 48/48 [00:26<00:00,  2.14it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.14it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][10:30:03]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
{'train_runtime': 26.8536, 'train_samples_per_second': 225.445, 'train_steps_per_second': 1.787, 'train_loss': 2.2053248087565103, 'epoch': 3.0}
[INFO][10:30:04]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
[INFO][10:30:05]: [Client #9] Model trained.
[INFO][10:30:05]: [Client #9] Inbound data has been processed.
[INFO][10:30:05]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][10:30:09]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:30:11]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][10:30:11]: [Server #3536466] Adding client #24 to the list of clients for aggregation.
[INFO][10:30:11]: [Server #3536466] Adding client #90 to the list of clients for aggregation.
[INFO][10:30:11]: [Server #3536466] Adding client #80 to the list of clients for aggregation.
[INFO][10:30:11]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][10:30:11]: [Server #3536466] Adding client #5 to the list of clients for aggregation.
[INFO][10:30:11]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:30:11]: [Server #3536466] Updated weights have been received.
[INFO][10:30:11]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:30:12]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:30:12]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.6474e+00  1e+02  1e+00  1e+00
 1:  2.5270e+00  1.6673e+00  5e+00  4e-02  4e-02
 2:  2.6515e+00  1.8680e+00  8e-01  2e-04  2e-04
 3:  2.6517e+00  2.6330e+00  2e-02  2e-06  1e-06
 4:  2.6500e+00  2.6466e+00  3e-03  3e-07  3e-07
 5:  2.6481e+00  2.6460e+00  2e-03  1e-06  4e-07
 6:  2.6476e+00  2.6468e+00  8e-04  5e-07  2e-07
 7:  2.6469e+00  2.6468e+00  1e-04  1e-06  7e-07
 8:  2.6468e+00  2.6468e+00  2e-05  2e-07  1e-07
 9:  2.6468e+00  2.6468e+00  5e-07  7e-09  4e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1  1.1  1.1  1.1  0.1  1.1  0.01 1.1  0.1  0.1  5.1  0.01 1.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  0.01 6.1  0.01 6.1  1.1  1.1
 4.1  0.01 6.1  2.1  1.1  2.1  2.1  0.01 1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  1.1  1.1  4.1  1.1  5.1  6.1  0.01 0.01 0.01 0.01 1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  0.01 1.1  0.01
 1.1  3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  1.1  0.01 2.1  0.01 1.1
 0.01 6.1  6.1  1.1  0.01 6.1  1.1  3.1  3.1  0.01 0.01 0.01 1.1  5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01 0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.01 0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.01 0.2  0.01 0.2
 0.01 0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.04it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.34it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.88it/s]100%|██████████| 8/8 [00:00<00:00, 11.71it/s]
[INFO][10:30:23]: [93m[1m[Server #3536466] Global model perplexity: 26.32
[0m
[INFO][10:30:23]: [Server #3536466] All client reports have been processed.
[INFO][10:30:23]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_40.pth.
[INFO][10:30:26]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_40.pth.
[INFO][10:30:26]: [93m[1m
[Server #3536466] Starting round 41/100.[0m
[INFO][10:30:26]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([4.98443584e-01, 1.76344494e-05, 1.76344494e-05, 1.76344494e-05,
       4.98443584e-01, 1.76344494e-05, 1.24839443e-04, 1.76344494e-05,
       4.01755670e-07, 1.24839443e-04, 1.76344494e-05, 1.76344494e-05,
       2.77946250e-06, 1.76344494e-05, 1.76344494e-05, 1.76344494e-05,
       2.77946250e-06, 1.14879651e-06, 1.76344494e-05, 2.78112485e-07,
       1.24839443e-04, 2.78112485e-07, 2.78112485e-07, 1.76344494e-05,
       1.76344494e-05, 6.32681945e-07, 1.24839443e-04, 2.78112485e-07,
       2.77946250e-06, 1.76344494e-05, 2.77946250e-06, 2.77946250e-06,
       1.24839443e-04, 1.76344494e-05, 1.76344494e-05, 2.78112485e-07,
       4.01755670e-07, 1.76344494e-05, 1.76344494e-05, 1.76344494e-05,
       4.01755670e-07, 1.76344494e-05, 1.76344494e-05, 6.32681945e-07,
       1.76344494e-05, 4.01755670e-07, 2.78112485e-07, 1.24839443e-04,
       1.24839443e-04, 1.24839443e-04, 1.76344494e-05, 1.24839443e-04,
       1.76344494e-05, 1.24839443e-04, 1.76344494e-05, 1.76344494e-05,
       1.76344494e-05, 1.76344494e-05, 1.14879651e-06, 4.01755670e-07,
       1.14879651e-06, 1.76344494e-05, 1.14879651e-06, 1.24839443e-04,
       1.76344494e-05, 1.24839443e-04, 1.76344494e-05, 1.14879651e-06,
       2.78112485e-07, 1.76344494e-05, 1.14879651e-06, 1.76344494e-05,
       1.24839443e-04, 1.76344494e-05, 2.77946250e-06, 1.76344494e-05,
       1.24839443e-04, 2.77946250e-06, 1.76344494e-05, 1.24839443e-04,
       2.78112485e-07, 2.78112485e-07, 1.76344494e-05, 1.24839443e-04,
       2.78112485e-07, 1.76344494e-05, 1.14879651e-06, 1.14879651e-06,
       1.24839443e-04, 1.24839443e-04, 1.24839443e-04, 1.76344494e-05,
       4.01755670e-07, 4.01755670e-07, 1.76344494e-05]),)
[INFO][10:30:26]: [Server #3536466] Selected clients: [ 5  1 41 12 94]
[INFO][10:30:26]: [Server #3536466] Selecting client #12 for training.
[INFO][10:30:26]: [Server #3536466] Sending the current model to client #12 (simulated).
[INFO][10:30:31]: [Server #3536466] Sending 507.38 MB of payload data to client #12 (simulated).
[INFO][10:30:31]: [Server #3536466] Selecting client #1 for training.
[INFO][10:30:31]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][10:30:35]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][10:30:35]: [Client #12] Selected by the server.
[INFO][10:30:35]: [Client #12] Loading its data source...
[INFO][10:30:35]: [Client #12] Dataset size: 2018
[INFO][10:30:35]: [Client #12] Sampler: iid
[INFO][10:30:35]: [Client #1] Selected by the server.
[INFO][10:30:35]: [Client #1] Loading its data source...
[INFO][10:30:35]: [Client #1] Dataset size: 2018
[INFO][10:30:35]: [Client #1] Sampler: iid
[INFO][10:30:36]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:30:36]: [Client #1] Start to process inbound data.
[INFO][10:30:36]: [Client #12] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:30:36]: [Client #12] Start to process inbound data.
[INFO][10:30:37]: [93m[1m[Client #12] Started training in communication round #41.[0m
[INFO][10:30:38]: [93m[1m[Client #1] Started training in communication round #41.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:37,  4.63s/it]  2%|▏         | 1/48 [00:04<03:39,  4.68s/it]  4%|▍         | 2/48 [00:05<01:47,  2.35s/it]  4%|▍         | 2/48 [00:05<01:47,  2.34s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it]  6%|▋         | 3/48 [00:06<01:12,  1.61s/it]  8%|▊         | 4/48 [00:06<00:55,  1.27s/it]  8%|▊         | 4/48 [00:06<00:55,  1.27s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:18,  1.31it/s] 50%|█████     | 24/48 [00:21<00:18,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.32it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.34it/s] 71%|███████   | 34/48 [00:29<00:10,  1.34it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.32it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s]100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][10:31:23]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 39.5392, 'train_samples_per_second': 153.114, 'train_steps_per_second': 1.214, 'train_loss': 2.643523852030436, 'epoch': 3.0}
[INFO][10:31:23]: [Client #12] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_12_3536584.pth.
{'train_runtime': 39.5513, 'train_samples_per_second': 153.067, 'train_steps_per_second': 1.214, 'train_loss': 3.2533702850341797, 'epoch': 3.0}
[INFO][10:31:24]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][10:31:25]: [Client #12] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_12_3536584.pth.
[INFO][10:31:25]: [Client #1] Model trained.
[INFO][10:31:25]: [Client #1] Inbound data has been processed.
[INFO][10:31:25]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][10:31:25]: [Client #12] Model trained.
[INFO][10:31:25]: [Client #12] Inbound data has been processed.
[INFO][10:31:25]: [Client #12] Outbound data is ready to be sent after being processed.
[INFO][10:31:33]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:31:33]: [Client #12] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:31:34]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][10:31:36]: [Server #3536466] Received 507.38 MB of payload data from client #12 (simulated).
[INFO][10:31:36]: [Server #3536466] Selecting client #94 for training.
[INFO][10:31:36]: [Server #3536466] Sending the current model to client #94 (simulated).
[INFO][10:31:40]: [Server #3536466] Sending 507.38 MB of payload data to client #94 (simulated).
[INFO][10:31:40]: [Server #3536466] Selecting client #5 for training.
[INFO][10:31:40]: [Server #3536466] Sending the current model to client #5 (simulated).
[INFO][10:31:45]: [Server #3536466] Sending 507.38 MB of payload data to client #5 (simulated).
[INFO][10:31:45]: [Client #94] Selected by the server.
[INFO][10:31:45]: [Client #94] Loading its data source...
[INFO][10:31:45]: [Client #5] Selected by the server.
[INFO][10:31:45]: [Client #5] Loading its data source...
[INFO][10:31:45]: [Client #94] Dataset size: 2018
[INFO][10:31:45]: [Client #94] Sampler: iid
[INFO][10:31:45]: [Client #5] Dataset size: 2018
[INFO][10:31:45]: [Client #5] Sampler: iid
[INFO][10:31:46]: [Client #5] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:31:46]: [Client #5] Start to process inbound data.
[INFO][10:31:46]: [Client #94] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:31:46]: [Client #94] Start to process inbound data.
[INFO][10:31:46]: [93m[1m[Client #5] Started training in communication round #41.[0m
[INFO][10:31:46]: [93m[1m[Client #94] Started training in communication round #41.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:10,  4.06s/it]  2%|▏         | 1/48 [00:04<03:37,  4.62s/it]  4%|▍         | 2/48 [00:04<01:37,  2.11s/it]  4%|▍         | 2/48 [00:05<01:47,  2.33s/it]  6%|▋         | 3/48 [00:05<01:07,  1.50s/it]  6%|▋         | 3/48 [00:06<01:12,  1.60s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:06<00:55,  1.26s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:46,  1.07s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.13it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:23<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:32<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.30it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:35<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.30it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.29it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.30it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.31it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.30it/s]100%|██████████| 48/48 [00:38<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.37it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][10:32:32]: [Client #5] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536585.pth.
{'train_runtime': 39.4006, 'train_samples_per_second': 153.652, 'train_steps_per_second': 1.218, 'train_loss': 2.8466310501098633, 'epoch': 3.0}
[INFO][10:32:32]: [Client #94] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_94_3536584.pth.
{'train_runtime': 38.9247, 'train_samples_per_second': 155.531, 'train_steps_per_second': 1.233, 'train_loss': 3.271773020426432, 'epoch': 3.0}
[INFO][10:32:33]: [Client #5] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536585.pth.
[INFO][10:32:33]: [Client #94] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_94_3536584.pth.
[INFO][10:32:34]: [Client #5] Model trained.
[INFO][10:32:34]: [Client #5] Inbound data has been processed.
[INFO][10:32:34]: [Client #5] Outbound data is ready to be sent after being processed.
[INFO][10:32:34]: [Client #94] Model trained.
[INFO][10:32:34]: [Client #94] Inbound data has been processed.
[INFO][10:32:34]: [Client #94] Outbound data is ready to be sent after being processed.
[INFO][10:32:42]: [Client #94] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:32:42]: [Client #5] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:32:43]: [Server #3536466] Received 507.38 MB of payload data from client #94 (simulated).
[INFO][10:32:44]: [Server #3536466] Received 507.38 MB of payload data from client #5 (simulated).
[INFO][10:32:44]: [Server #3536466] Selecting client #41 for training.
[INFO][10:32:44]: [Server #3536466] Sending the current model to client #41 (simulated).
[INFO][10:32:49]: [Server #3536466] Sending 507.38 MB of payload data to client #41 (simulated).
[INFO][10:32:49]: [Client #41] Selected by the server.
[INFO][10:32:49]: [Client #41] Loading its data source...
[INFO][10:32:49]: [Client #41] Dataset size: 2018
[INFO][10:32:49]: [Client #41] Sampler: iid
[INFO][10:32:50]: [Client #41] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:32:50]: [Client #41] Start to process inbound data.
[INFO][10:32:51]: [93m[1m[Client #41] Started training in communication round #41.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.19s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:58,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.25it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.12it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.10it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.19it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][10:33:23]: [Client #41] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536584.pth.
{'train_runtime': 26.5997, 'train_samples_per_second': 227.597, 'train_steps_per_second': 1.805, 'train_loss': 2.896939277648926, 'epoch': 3.0}
[INFO][10:33:25]: [Client #41] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536584.pth.
[INFO][10:33:25]: [Client #41] Model trained.
[INFO][10:33:25]: [Client #41] Inbound data has been processed.
[INFO][10:33:25]: [Client #41] Outbound data is ready to be sent after being processed.
[INFO][10:33:30]: [Client #41] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:33:31]: [Server #3536466] Received 507.38 MB of payload data from client #41 (simulated).
[INFO][10:33:31]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][10:33:31]: [Server #3536466] Adding client #10 to the list of clients for aggregation.
[INFO][10:33:31]: [Server #3536466] Adding client #25 to the list of clients for aggregation.
[INFO][10:33:31]: [Server #3536466] Adding client #53 to the list of clients for aggregation.
[INFO][10:33:31]: [Server #3536466] Adding client #83 to the list of clients for aggregation.
[INFO][10:33:31]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:33:31]: [Server #3536466] Updated weights have been received.
[INFO][10:33:32]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:33:32]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:33:32]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.7498e+00  1e+02  1e+00  1e+00
 1:  2.6398e+00  1.7697e+00  4e+00  4e-02  4e-02
 2:  2.7542e+00  1.9905e+00  8e-01  8e-05  8e-05
 3:  2.7541e+00  2.7408e+00  1e-02  8e-07  8e-07
 4:  2.7523e+00  2.7491e+00  3e-03  2e-07  2e-07
 5:  2.7507e+00  2.7483e+00  2e-03  1e-06  6e-07
 6:  2.7502e+00  2.7493e+00  9e-04  5e-07  3e-07
 7:  2.7495e+00  2.7493e+00  2e-04  2e-06  2e-06
 8:  2.7494e+00  2.7493e+00  5e-05  7e-07  5e-07
 9:  2.7493e+00  2.7493e+00  2e-06  6e-08  4e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1  1.1  1.1  1.1  0.1  1.1  0.01 1.1  1.1  1.1  5.1  0.01 1.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  0.01 6.1  6.1  6.1  1.1  1.1
 4.1  0.01 6.1  2.1  1.1  2.1  2.1  0.01 1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  1.1  1.1  4.1  1.1  5.1  6.1  0.01 0.01 1.1  0.01 1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  0.01 1.1  0.01
 1.1  3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  1.1  0.01 2.1  6.1  1.1
 0.01 6.1  6.1  1.1  0.01 6.1  1.1  3.1  3.1  0.01 0.01 0.01 1.1  5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.2  0.01 0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.01 0.2  0.2  0.2
 0.01 0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.01 0.01 0.01 0.2  0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.44it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.33it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.85it/s]100%|██████████| 8/8 [00:00<00:00, 11.69it/s]
[INFO][10:33:43]: [93m[1m[Server #3536466] Global model perplexity: 28.14
[0m
[INFO][10:33:43]: [Server #3536466] All client reports have been processed.
[INFO][10:33:43]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_41.pth.
[INFO][10:33:46]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_41.pth.
[INFO][10:33:46]: [93m[1m
[Server #3536466] Starting round 42/100.[0m
[INFO][10:33:46]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([4.52842345e-06, 4.52842345e-06, 4.52842345e-06, 4.52842345e-06,
       5.88119207e-02, 4.52842345e-06, 4.52842345e-06, 4.52842345e-06,
       8.16420455e-08, 4.52842345e-06, 4.52842345e-06, 5.47504823e-07,
       4.52842345e-06, 4.52842345e-06, 4.52842345e-06, 5.47504823e-07,
       2.25189174e-07, 4.52842345e-06, 5.80125084e-08, 5.88119207e-02,
       5.80125084e-08, 5.80125084e-08, 5.80125084e-08, 4.52842345e-06,
       4.52842345e-06, 1.26019191e-07, 5.88119207e-02, 5.80125084e-08,
       5.47504823e-07, 4.52842345e-06, 5.47504823e-07, 5.47504823e-07,
       5.88119207e-02, 4.52842345e-06, 4.52842345e-06, 5.80125084e-08,
       8.16420455e-08, 4.52842345e-06, 4.52842345e-06, 8.16420455e-08,
       4.52842345e-06, 4.52842345e-06, 1.26019191e-07, 4.52842345e-06,
       8.16420455e-08, 5.80125084e-08, 5.88119207e-02, 5.88119207e-02,
       4.52842345e-06, 5.88119207e-02, 4.52842345e-06, 5.88119207e-02,
       4.52842345e-06, 5.88119207e-02, 4.52842345e-06, 4.52842345e-06,
       4.52842345e-06, 4.52842345e-06, 2.25189174e-07, 8.16420455e-08,
       2.25189174e-07, 4.52842345e-06, 2.25189174e-07, 5.88119207e-02,
       4.52842345e-06, 5.88119207e-02, 4.52842345e-06, 2.25189174e-07,
       5.80125084e-08, 4.52842345e-06, 2.25189174e-07, 4.52842345e-06,
       5.88119207e-02, 4.52842345e-06, 5.47504823e-07, 4.52842345e-06,
       5.88119207e-02, 5.47504823e-07, 5.80125084e-08, 4.52842345e-06,
       5.88119207e-02, 5.80125084e-08, 5.80125084e-08, 4.52842345e-06,
       5.88119207e-02, 5.80125084e-08, 4.52842345e-06, 2.25189174e-07,
       2.25189174e-07, 5.88119207e-02, 5.88119207e-02, 4.52842345e-06,
       8.16420455e-08, 8.16420455e-08, 4.52842345e-06]),)
[INFO][10:33:46]: [Server #3536466] Selected clients: [54 68 58 30 36]
[INFO][10:33:46]: [Server #3536466] Selecting client #68 for training.
[INFO][10:33:46]: [Server #3536466] Sending the current model to client #68 (simulated).
[INFO][10:33:51]: [Server #3536466] Sending 507.38 MB of payload data to client #68 (simulated).
[INFO][10:33:51]: [Client #68] Selected by the server.
[INFO][10:33:51]: [Client #68] Loading its data source...
[INFO][10:33:51]: [Client #68] Dataset size: 2018
[INFO][10:33:51]: [Client #68] Sampler: iid
[INFO][10:33:52]: [Client #68] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:33:52]: [Client #68] Start to process inbound data.
[INFO][10:33:52]: [93m[1m[Client #68] Started training in communication round #42.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.22s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.71it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.80it/s] 21%|██        | 10/48 [00:08<00:20,  1.87it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.93it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.96it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.99it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.01it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.13it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.11it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.09it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.08it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.07it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.07it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.06it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.06it/s] 50%|█████     | 24/48 [00:15<00:11,  2.06it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:20<00:06,  2.13it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.10it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.09it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][10:34:25]: [Client #68] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_68_3536584.pth.
{'train_runtime': 26.7429, 'train_samples_per_second': 226.378, 'train_steps_per_second': 1.795, 'train_loss': 3.3058077494303384, 'epoch': 3.0}
[INFO][10:34:26]: [Client #68] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_68_3536584.pth.
[INFO][10:34:27]: [Client #68] Model trained.
[INFO][10:34:27]: [Client #68] Inbound data has been processed.
[INFO][10:34:27]: [Client #68] Outbound data is ready to be sent after being processed.
[INFO][10:34:31]: [Client #68] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:34:32]: [Server #3536466] Received 507.38 MB of payload data from client #68 (simulated).
[INFO][10:34:32]: [Server #3536466] Selecting client #36 for training.
[INFO][10:34:32]: [Server #3536466] Sending the current model to client #36 (simulated).
[INFO][10:34:37]: [Server #3536466] Sending 507.38 MB of payload data to client #36 (simulated).
[INFO][10:34:37]: [Client #36] Selected by the server.
[INFO][10:34:37]: [Client #36] Loading its data source...
[INFO][10:34:37]: [Client #36] Dataset size: 2018
[INFO][10:34:37]: [Client #36] Sampler: iid
[INFO][10:34:38]: [Client #36] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:34:38]: [Client #36] Start to process inbound data.
[INFO][10:34:38]: [93m[1m[Client #36] Started training in communication round #42.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.17s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.10it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.19it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.13it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][10:35:11]: [Client #36] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_36_3536584.pth.
{'train_runtime': 26.6118, 'train_samples_per_second': 227.493, 'train_steps_per_second': 1.804, 'train_loss': 3.2925917307535806, 'epoch': 3.0}
[INFO][10:35:12]: [Client #36] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_36_3536584.pth.
[INFO][10:35:13]: [Client #36] Model trained.
[INFO][10:35:13]: [Client #36] Inbound data has been processed.
[INFO][10:35:13]: [Client #36] Outbound data is ready to be sent after being processed.
[INFO][10:35:17]: [Client #36] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:35:18]: [Server #3536466] Received 507.38 MB of payload data from client #36 (simulated).
[INFO][10:35:18]: [Server #3536466] Selecting client #54 for training.
[INFO][10:35:18]: [Server #3536466] Sending the current model to client #54 (simulated).
[INFO][10:35:23]: [Server #3536466] Sending 507.38 MB of payload data to client #54 (simulated).
[INFO][10:35:23]: [Client #54] Selected by the server.
[INFO][10:35:23]: [Client #54] Loading its data source...
[INFO][10:35:23]: [Client #54] Dataset size: 2018
[INFO][10:35:23]: [Client #54] Sampler: iid
[INFO][10:35:24]: [Client #54] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:35:24]: [Client #54] Start to process inbound data.
[INFO][10:35:24]: [93m[1m[Client #54] Started training in communication round #42.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.18s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.09it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.07it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.06it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.06it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.05it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.05it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.05it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.04it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.04it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.05it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.05it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.06it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.06it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][10:35:57]: [Client #54] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_54_3536584.pth.
{'train_runtime': 26.7187, 'train_samples_per_second': 226.583, 'train_steps_per_second': 1.796, 'train_loss': 3.28604793548584, 'epoch': 3.0}
[INFO][10:35:58]: [Client #54] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_54_3536584.pth.
[INFO][10:35:59]: [Client #54] Model trained.
[INFO][10:35:59]: [Client #54] Inbound data has been processed.
[INFO][10:35:59]: [Client #54] Outbound data is ready to be sent after being processed.
[INFO][10:36:04]: [Client #54] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:36:05]: [Server #3536466] Received 507.38 MB of payload data from client #54 (simulated).
[INFO][10:36:05]: [Server #3536466] Selecting client #58 for training.
[INFO][10:36:05]: [Server #3536466] Sending the current model to client #58 (simulated).
[INFO][10:36:09]: [Server #3536466] Sending 507.38 MB of payload data to client #58 (simulated).
[INFO][10:36:09]: [Client #58] Selected by the server.
[INFO][10:36:09]: [Client #58] Loading its data source...
[INFO][10:36:09]: [Client #58] Dataset size: 2018
[INFO][10:36:09]: [Client #58] Sampler: iid
[INFO][10:36:11]: [Client #58] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:36:11]: [Client #58] Start to process inbound data.
[INFO][10:36:11]: [93m[1m[Client #58] Started training in communication round #42.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.19s/it]  4%|▍         | 2/48 [00:04<01:33,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:35,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.42it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.58it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.70it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.80it/s] 21%|██        | 10/48 [00:08<00:20,  1.87it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.92it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.96it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.99it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.01it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.12it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.11it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.10it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.10it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.10it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:15<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.09it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.09it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:20<00:06,  2.13it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.12it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.11it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.11it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.09it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.09it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.09it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.09it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.09it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.09it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.09it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.09it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.09it/s]100%|██████████| 48/48 [00:26<00:00,  2.19it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.19it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][10:36:44]: [Client #58] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_58_3536584.pth.
{'train_runtime': 26.6327, 'train_samples_per_second': 227.315, 'train_steps_per_second': 1.802, 'train_loss': 3.3216451009114585, 'epoch': 3.0}
[INFO][10:36:45]: [Client #58] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_58_3536584.pth.
[INFO][10:36:45]: [Client #58] Model trained.
[INFO][10:36:45]: [Client #58] Inbound data has been processed.
[INFO][10:36:45]: [Client #58] Outbound data is ready to be sent after being processed.
[INFO][10:36:50]: [Client #58] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:36:51]: [Server #3536466] Received 507.38 MB of payload data from client #58 (simulated).
[INFO][10:36:51]: [Server #3536466] Selecting client #30 for training.
[INFO][10:36:51]: [Server #3536466] Sending the current model to client #30 (simulated).
[INFO][10:36:56]: [Server #3536466] Sending 507.38 MB of payload data to client #30 (simulated).
[INFO][10:36:56]: [Client #30] Selected by the server.
[INFO][10:36:56]: [Client #30] Loading its data source...
[INFO][10:36:56]: [Client #30] Dataset size: 2018
[INFO][10:36:56]: [Client #30] Sampler: iid
[INFO][10:36:57]: [Client #30] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:36:57]: [Client #30] Start to process inbound data.
[INFO][10:36:57]: [93m[1m[Client #30] Started training in communication round #42.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.20s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.01it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.03it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][10:37:30]: [Client #30] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_30_3536584.pth.
{'train_runtime': 26.648, 'train_samples_per_second': 227.184, 'train_steps_per_second': 1.801, 'train_loss': 3.2850993474324546, 'epoch': 3.0}
[INFO][10:37:31]: [Client #30] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_30_3536584.pth.
[INFO][10:37:32]: [Client #30] Model trained.
[INFO][10:37:32]: [Client #30] Inbound data has been processed.
[INFO][10:37:32]: [Client #30] Outbound data is ready to be sent after being processed.
[INFO][10:37:36]: [Client #30] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:37:37]: [Server #3536466] Received 507.38 MB of payload data from client #30 (simulated).
[INFO][10:37:37]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][10:37:37]: [Server #3536466] Adding client #5 to the list of clients for aggregation.
[INFO][10:37:37]: [Server #3536466] Adding client #41 to the list of clients for aggregation.
[INFO][10:37:37]: [Server #3536466] Adding client #54 to the list of clients for aggregation.
[INFO][10:37:37]: [Server #3536466] Adding client #94 to the list of clients for aggregation.
[INFO][10:37:37]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:37:37]: [Server #3536466] Updated weights have been received.
[INFO][10:37:38]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:37:39]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:37:39]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.8447e+00  1e+02  1e+00  1e+00
 1:  2.7444e+00  1.8646e+00  4e+00  3e-02  3e-02
 2:  2.8494e+00  2.1060e+00  7e-01  2e-05  2e-05
 3:  2.8491e+00  2.8373e+00  1e-02  3e-07  3e-07
 4:  2.8471e+00  2.8446e+00  2e-03  1e-07  6e-08
 5:  2.8451e+00  2.8443e+00  8e-04  5e-07  9e-08
 6:  2.8448e+00  2.8447e+00  1e-04  1e-07  2e-08
 7:  2.8447e+00  2.8447e+00  1e-05  2e-08  4e-09
 8:  2.8447e+00  2.8447e+00  2e-07  7e-10  1e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1  1.1  1.1  1.1  1.1  1.1  0.01 1.1  1.1  1.1  5.1  0.01 1.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  0.01 6.1  6.1  6.1  1.1  1.1
 4.1  0.01 6.1  2.1  1.1  2.1  2.1  0.01 1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  1.1  1.1  4.1  1.1  5.1  6.1  0.01 0.01 1.1  0.1  1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  0.01 1.1  0.01
 1.1  3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  1.1  0.01 2.1  6.1  1.1
 0.01 6.1  6.1  1.1  0.01 6.1  1.1  3.1  3.1  1.1  0.01 0.01 1.1  5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.01 0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.01 0.2  0.2  0.2
 0.01 0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.2  0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.92it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.38it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.71it/s]100%|██████████| 8/8 [00:00<00:00, 11.47it/s]
[INFO][10:37:49]: [93m[1m[Server #3536466] Global model perplexity: 26.18
[0m
[INFO][10:37:49]: [Server #3536466] All client reports have been processed.
[INFO][10:37:49]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_42.pth.
[INFO][10:37:52]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_42.pth.
[INFO][10:37:53]: [93m[1m
[Server #3536466] Starting round 43/100.[0m
[INFO][10:37:53]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.82644238e-06, 2.82644238e-06, 2.82644238e-06, 2.82644238e-06,
       2.82644238e-06, 2.82644238e-06, 8.24445865e-05, 2.82644238e-06,
       2.82644238e-06, 2.82644238e-06, 2.05226642e-08, 2.82644238e-06,
       2.82644238e-06, 1.98828970e-07, 2.82644238e-06, 2.82644238e-06,
       2.82644238e-06, 1.98828970e-07, 6.65257318e-08, 2.82644238e-06,
       1.38816626e-08, 8.24445865e-05, 1.38816626e-08, 1.38816626e-08,
       1.38816626e-08, 2.82644238e-06, 2.82644238e-06, 3.36813883e-08,
       1.38816626e-08, 1.98828970e-07, 2.82644238e-06, 1.98828970e-07,
       1.98828970e-07, 2.82644238e-06, 2.82644238e-06, 1.38816626e-08,
       2.05226642e-08, 2.82644238e-06, 2.82644238e-06, 2.82644238e-06,
       2.05226642e-08, 2.82644238e-06, 2.82644238e-06, 3.36813883e-08,
       2.82644238e-06, 2.05226642e-08, 1.38816626e-08, 8.24445865e-05,
       8.24445865e-05, 2.82644238e-06, 9.98878347e-01, 2.82644238e-06,
       8.24445865e-05, 2.82644238e-06, 2.82644238e-06, 2.82644238e-06,
       2.82644238e-06, 2.82644238e-06, 6.65257318e-08, 2.05226642e-08,
       6.65257318e-08, 2.82644238e-06, 6.65257318e-08, 2.82644238e-06,
       8.24445865e-05, 2.82644238e-06, 6.65257318e-08, 1.38816626e-08,
       2.82644238e-06, 6.65257318e-08, 2.82644238e-06, 8.24445865e-05,
       2.82644238e-06, 1.98828970e-07, 2.82644238e-06, 8.24445865e-05,
       1.98828970e-07, 1.38816626e-08, 2.82644238e-06, 8.24445865e-05,
       1.38816626e-08, 1.38816626e-08, 2.82644238e-06, 8.24445865e-05,
       1.38816626e-08, 2.82644238e-06, 6.65257318e-08, 6.65257318e-08,
       2.82644238e-06, 8.24445865e-05, 8.24445865e-05, 2.82644238e-06,
       2.05226642e-08, 2.05226642e-08, 2.82644238e-06]),)
[INFO][10:37:53]: [Server #3536466] Selected clients: [54 89 18 96 23]
[INFO][10:37:53]: [Server #3536466] Selecting client #96 for training.
[INFO][10:37:53]: [Server #3536466] Sending the current model to client #96 (simulated).
[INFO][10:37:57]: [Server #3536466] Sending 507.38 MB of payload data to client #96 (simulated).
[INFO][10:37:57]: [Server #3536466] Selecting client #23 for training.
[INFO][10:37:57]: [Server #3536466] Sending the current model to client #23 (simulated).
[INFO][10:38:02]: [Server #3536466] Sending 507.38 MB of payload data to client #23 (simulated).
[INFO][10:38:02]: [Client #96] Selected by the server.
[INFO][10:38:02]: [Client #96] Loading its data source...
[INFO][10:38:02]: [Client #96] Dataset size: 2018
[INFO][10:38:02]: [Client #96] Sampler: iid
[INFO][10:38:02]: [Client #23] Selected by the server.
[INFO][10:38:02]: [Client #23] Loading its data source...
[INFO][10:38:02]: [Client #23] Dataset size: 2018
[INFO][10:38:02]: [Client #23] Sampler: iid
[INFO][10:38:03]: [Client #96] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:38:03]: [Client #96] Start to process inbound data.
[INFO][10:38:03]: [Client #23] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:38:03]: [Client #23] Start to process inbound data.
[INFO][10:38:04]: [93m[1m[Client #96] Started training in communication round #43.[0m
[INFO][10:38:04]: [93m[1m[Client #23] Started training in communication round #43.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.18s/it]  2%|▏         | 1/48 [00:04<03:45,  4.79s/it]  4%|▍         | 2/48 [00:04<01:38,  2.14s/it]  4%|▍         | 2/48 [00:05<01:50,  2.41s/it]  6%|▋         | 3/48 [00:05<01:07,  1.50s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.31it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][10:38:50]: [Client #96] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_96_3536584.pth.
{'train_runtime': 39.0242, 'train_samples_per_second': 155.135, 'train_steps_per_second': 1.23, 'train_loss': 3.254711151123047, 'epoch': 3.0}
[INFO][10:38:50]: [Client #23] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_23_3536585.pth.
{'train_runtime': 39.437, 'train_samples_per_second': 153.511, 'train_steps_per_second': 1.217, 'train_loss': 3.0584290822347007, 'epoch': 3.0}
[INFO][10:38:51]: [Client #96] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_96_3536584.pth.
[INFO][10:38:51]: [Client #23] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_23_3536585.pth.
[INFO][10:38:51]: [Client #96] Model trained.
[INFO][10:38:51]: [Client #96] Inbound data has been processed.
[INFO][10:38:51]: [Client #96] Outbound data is ready to be sent after being processed.
[INFO][10:38:51]: [Client #23] Model trained.
[INFO][10:38:51]: [Client #23] Inbound data has been processed.
[INFO][10:38:51]: [Client #23] Outbound data is ready to be sent after being processed.
[INFO][10:39:00]: [Client #96] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:39:00]: [Client #23] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:39:01]: [Server #3536466] Received 507.38 MB of payload data from client #96 (simulated).
[INFO][10:39:02]: [Server #3536466] Received 507.38 MB of payload data from client #23 (simulated).
[INFO][10:39:02]: [Server #3536466] Selecting client #18 for training.
[INFO][10:39:02]: [Server #3536466] Sending the current model to client #18 (simulated).
[INFO][10:39:06]: [Server #3536466] Sending 507.38 MB of payload data to client #18 (simulated).
[INFO][10:39:06]: [Server #3536466] Selecting client #89 for training.
[INFO][10:39:06]: [Server #3536466] Sending the current model to client #89 (simulated).
[INFO][10:39:10]: [Server #3536466] Sending 507.38 MB of payload data to client #89 (simulated).
[INFO][10:39:10]: [Client #18] Selected by the server.
[INFO][10:39:10]: [Client #18] Loading its data source...
[INFO][10:39:10]: [Client #18] Dataset size: 2018
[INFO][10:39:10]: [Client #89] Selected by the server.
[INFO][10:39:10]: [Client #18] Sampler: iid
[INFO][10:39:10]: [Client #89] Loading its data source...
[INFO][10:39:10]: [Client #89] Dataset size: 2018
[INFO][10:39:10]: [Client #89] Sampler: iid
[INFO][10:39:11]: [Client #18] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:39:11]: [Client #18] Start to process inbound data.
[INFO][10:39:11]: [Client #89] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:39:11]: [Client #89] Start to process inbound data.
[INFO][10:39:12]: [93m[1m[Client #89] Started training in communication round #43.[0m
[INFO][10:39:12]: [93m[1m[Client #18] Started training in communication round #43.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:37,  4.63s/it]  2%|▏         | 1/48 [00:04<03:45,  4.79s/it]  4%|▍         | 2/48 [00:05<01:47,  2.34s/it]  4%|▍         | 2/48 [00:05<01:50,  2.41s/it]  6%|▋         | 3/48 [00:06<01:12,  1.61s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  8%|▊         | 4/48 [00:06<00:55,  1.26s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.32it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.31it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.30it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.31it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.31it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.31it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][10:39:58]: [Client #18] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
{'train_runtime': 39.6812, 'train_samples_per_second': 152.566, 'train_steps_per_second': 1.21, 'train_loss': 3.194169044494629, 'epoch': 3.0}
[INFO][10:39:58]: [Client #89] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_89_3536585.pth.
{'train_runtime': 39.5453, 'train_samples_per_second': 153.09, 'train_steps_per_second': 1.214, 'train_loss': 3.0621840159098306, 'epoch': 3.0}
[INFO][10:39:59]: [Client #18] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
[INFO][10:39:59]: [Client #89] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_89_3536585.pth.
[INFO][10:40:00]: [Client #18] Model trained.
[INFO][10:40:00]: [Client #18] Inbound data has been processed.
[INFO][10:40:00]: [Client #18] Outbound data is ready to be sent after being processed.
[INFO][10:40:00]: [Client #89] Model trained.
[INFO][10:40:00]: [Client #89] Inbound data has been processed.
[INFO][10:40:00]: [Client #89] Outbound data is ready to be sent after being processed.
[INFO][10:40:08]: [Client #18] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:40:08]: [Client #89] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:40:09]: [Server #3536466] Received 507.38 MB of payload data from client #18 (simulated).
[INFO][10:40:10]: [Server #3536466] Received 507.38 MB of payload data from client #89 (simulated).
[INFO][10:40:10]: [Server #3536466] Selecting client #54 for training.
[INFO][10:40:10]: [Server #3536466] Sending the current model to client #54 (simulated).
[INFO][10:40:15]: [Server #3536466] Sending 507.38 MB of payload data to client #54 (simulated).
[INFO][10:40:15]: [Client #54] Selected by the server.
[INFO][10:40:15]: [Client #54] Loading its data source...
[INFO][10:40:15]: [Client #54] Dataset size: 2018
[INFO][10:40:15]: [Client #54] Sampler: iid
[INFO][10:40:16]: [Client #54] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:40:16]: [Client #54] Start to process inbound data.
[INFO][10:40:17]: [93m[1m[Client #54] Started training in communication round #43.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][10:40:49]: [Client #54] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_54_3536584.pth.
{'train_runtime': 26.6862, 'train_samples_per_second': 226.858, 'train_steps_per_second': 1.799, 'train_loss': 3.1460914611816406, 'epoch': 3.0}
[INFO][10:40:51]: [Client #54] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_54_3536584.pth.
[INFO][10:40:51]: [Client #54] Model trained.
[INFO][10:40:51]: [Client #54] Inbound data has been processed.
[INFO][10:40:51]: [Client #54] Outbound data is ready to be sent after being processed.
[INFO][10:40:56]: [Client #54] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:40:57]: [Server #3536466] Received 507.38 MB of payload data from client #54 (simulated).
[INFO][10:40:57]: [Server #3536466] Adding client #23 to the list of clients for aggregation.
[INFO][10:40:57]: [Server #3536466] Adding client #54 to the list of clients for aggregation.
[INFO][10:40:57]: [Server #3536466] Adding client #89 to the list of clients for aggregation.
[INFO][10:40:57]: [Server #3536466] Adding client #18 to the list of clients for aggregation.
[INFO][10:40:57]: [Server #3536466] Adding client #12 to the list of clients for aggregation.
[INFO][10:40:57]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:40:57]: [Server #3536466] Updated weights have been received.
[INFO][10:40:58]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:40:58]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:40:58]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.8532e+00  1e+02  1e+00  1e+00
 1:  2.7538e+00  1.8731e+00  4e+00  3e-02  3e-02
 2:  2.8579e+00  2.1162e+00  7e-01  2e-05  1e-05
 3:  2.8576e+00  2.8453e+00  1e-02  2e-07  2e-07
 4:  2.8558e+00  2.8525e+00  3e-03  1e-07  6e-08
 5:  2.8543e+00  2.8518e+00  3e-03  8e-07  6e-07
 6:  2.8538e+00  2.8527e+00  1e-03  4e-07  3e-07
 7:  2.8532e+00  2.8528e+00  4e-04  2e-06  2e-06
 8:  2.8530e+00  2.8528e+00  2e-04  2e-06  1e-06
 9:  2.8528e+00  2.8528e+00  8e-06  4e-07  4e-07
10:  2.8528e+00  2.8528e+00  3e-07  2e-08  2e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1  1.1  1.1  1.1  1.1  1.1  0.01 1.1  1.1  1.1  5.1  2.1  1.1  1.1
 2.1  1.1  1.1  0.1  2.1  3.1  1.1  6.1  0.1  6.1  6.1  6.1  1.1  1.1
 4.1  0.01 6.1  2.1  1.1  2.1  2.1  0.01 1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  1.1  1.1  4.1  1.1  5.1  6.1  0.01 0.01 1.1  0.1  1.1  0.01
 1.1  0.01 1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  0.01 1.1  0.01
 1.1  3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  1.1  0.01 2.1  6.1  1.1
 0.01 6.1  6.1  1.1  0.1  6.1  1.1  3.1  3.1  1.1  0.01 0.01 1.1  5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01
 0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.01 0.2  0.2  0.2
 0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.2  0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.32it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.29it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.91it/s]100%|██████████| 8/8 [00:00<00:00, 11.74it/s]
[INFO][10:41:09]: [93m[1m[Server #3536466] Global model perplexity: 24.39
[0m
[INFO][10:41:09]: [Server #3536466] All client reports have been processed.
[INFO][10:41:09]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_43.pth.
[INFO][10:41:12]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_43.pth.
[INFO][10:41:12]: [93m[1m
[Server #3536466] Starting round 44/100.[0m
[INFO][10:41:12]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([5.67976102e-07, 5.67976102e-07, 5.67976102e-07, 5.67976102e-07,
       5.67976102e-07, 5.67976102e-07, 3.27157653e-06, 5.67976102e-07,
       5.67976102e-07, 5.67976102e-07, 9.07334091e-09, 6.98051040e-08,
       5.67976102e-07, 5.67976102e-07, 6.98051040e-08, 5.67976102e-07,
       5.67976102e-07, 2.49986014e-01, 6.98051040e-08, 2.66866499e-08,
       5.67976102e-07, 6.30647053e-09, 2.49986014e-01, 6.30647053e-09,
       6.30647053e-09, 6.30647053e-09, 5.67976102e-07, 5.67976102e-07,
       1.43571506e-08, 6.30647053e-09, 6.98051040e-08, 5.67976102e-07,
       6.98051040e-08, 6.98051040e-08, 5.67976102e-07, 5.67976102e-07,
       6.30647053e-09, 9.07334091e-09, 5.67976102e-07, 5.67976102e-07,
       5.67976102e-07, 9.07334091e-09, 5.67976102e-07, 5.67976102e-07,
       1.43571506e-08, 5.67976102e-07, 9.07334091e-09, 6.30647053e-09,
       3.27157653e-06, 3.27157653e-06, 5.67976102e-07, 2.49986014e-01,
       5.67976102e-07, 3.27157653e-06, 5.67976102e-07, 5.67976102e-07,
       5.67976102e-07, 5.67976102e-07, 5.67976102e-07, 2.66866499e-08,
       9.07334091e-09, 2.66866499e-08, 5.67976102e-07, 2.66866499e-08,
       5.67976102e-07, 3.27157653e-06, 5.67976102e-07, 2.66866499e-08,
       6.30647053e-09, 5.67976102e-07, 2.66866499e-08, 5.67976102e-07,
       3.27157653e-06, 5.67976102e-07, 6.98051040e-08, 5.67976102e-07,
       3.27157653e-06, 6.98051040e-08, 6.30647053e-09, 5.67976102e-07,
       3.27157653e-06, 6.30647053e-09, 6.30647053e-09, 5.67976102e-07,
       2.49986014e-01, 6.30647053e-09, 5.67976102e-07, 2.66866499e-08,
       2.66866499e-08, 5.67976102e-07, 3.27157653e-06, 5.67976102e-07,
       9.07334091e-09, 9.07334091e-09, 5.67976102e-07]),)
[INFO][10:41:12]: [Server #3536466] Selected clients: [54 18 89 23 61]
[INFO][10:41:12]: [Server #3536466] Selecting client #18 for training.
[INFO][10:41:12]: [Server #3536466] Sending the current model to client #18 (simulated).
[INFO][10:41:17]: [Server #3536466] Sending 507.38 MB of payload data to client #18 (simulated).
[INFO][10:41:17]: [Server #3536466] Selecting client #23 for training.
[INFO][10:41:17]: [Server #3536466] Sending the current model to client #23 (simulated).
[INFO][10:41:21]: [Server #3536466] Sending 507.38 MB of payload data to client #23 (simulated).
[INFO][10:41:21]: [Client #18] Selected by the server.
[INFO][10:41:21]: [Client #18] Loading its data source...
[INFO][10:41:21]: [Client #18] Dataset size: 2018
[INFO][10:41:21]: [Client #18] Sampler: iid
[INFO][10:41:21]: [Client #23] Selected by the server.
[INFO][10:41:21]: [Client #23] Loading its data source...
[INFO][10:41:21]: [Client #23] Dataset size: 2018
[INFO][10:41:21]: [Client #23] Sampler: iid
[INFO][10:41:23]: [Client #23] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:41:23]: [Client #23] Start to process inbound data.
[INFO][10:41:23]: [Client #18] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:41:23]: [Client #18] Start to process inbound data.
[INFO][10:41:23]: [93m[1m[Client #23] Started training in communication round #44.[0m
[INFO][10:41:23]: [93m[1m[Client #18] Started training in communication round #44.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:51,  4.92s/it]  2%|▏         | 1/48 [00:05<03:55,  5.01s/it]  4%|▍         | 2/48 [00:05<01:53,  2.48s/it]  4%|▍         | 2/48 [00:05<01:56,  2.53s/it]  6%|▋         | 3/48 [00:06<01:15,  1.67s/it]  6%|▋         | 3/48 [00:06<01:17,  1.72s/it]  8%|▊         | 4/48 [00:07<00:57,  1.30s/it]  8%|▊         | 4/48 [00:07<00:58,  1.33s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 10%|█         | 5/48 [00:08<00:48,  1.12s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.00it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:11<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.34it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
[INFO][10:42:10]: [Client #23] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_23_3536585.pth.
{'train_runtime': 39.9341, 'train_samples_per_second': 151.6, 'train_steps_per_second': 1.202, 'train_loss': 2.938180605570475, 'epoch': 3.0}
[INFO][10:42:10]: [Client #18] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
{'train_runtime': 39.7783, 'train_samples_per_second': 152.194, 'train_steps_per_second': 1.207, 'train_loss': 3.066184679667155, 'epoch': 3.0}
[INFO][10:42:11]: [Client #23] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_23_3536585.pth.
[INFO][10:42:11]: [Client #18] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
[INFO][10:42:11]: [Client #23] Model trained.
[INFO][10:42:11]: [Client #23] Inbound data has been processed.
[INFO][10:42:11]: [Client #23] Outbound data is ready to be sent after being processed.
[INFO][10:42:11]: [Client #18] Model trained.
[INFO][10:42:11]: [Client #18] Inbound data has been processed.
[INFO][10:42:11]: [Client #18] Outbound data is ready to be sent after being processed.
[INFO][10:42:19]: [Client #23] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:42:20]: [Client #18] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:42:20]: [Server #3536466] Received 507.38 MB of payload data from client #23 (simulated).
[INFO][10:42:21]: [Server #3536466] Received 507.38 MB of payload data from client #18 (simulated).
[INFO][10:42:21]: [Server #3536466] Selecting client #54 for training.
[INFO][10:42:21]: [Server #3536466] Sending the current model to client #54 (simulated).
[INFO][10:42:26]: [Server #3536466] Sending 507.38 MB of payload data to client #54 (simulated).
[INFO][10:42:26]: [Server #3536466] Selecting client #89 for training.
[INFO][10:42:26]: [Server #3536466] Sending the current model to client #89 (simulated).
[INFO][10:42:30]: [Server #3536466] Sending 507.38 MB of payload data to client #89 (simulated).
[INFO][10:42:30]: [Client #54] Selected by the server.
[INFO][10:42:30]: [Client #54] Loading its data source...
[INFO][10:42:30]: [Client #54] Dataset size: 2018
[INFO][10:42:30]: [Client #54] Sampler: iid
[INFO][10:42:30]: [Client #89] Selected by the server.
[INFO][10:42:30]: [Client #89] Loading its data source...
[INFO][10:42:30]: [Client #89] Dataset size: 2018
[INFO][10:42:30]: [Client #89] Sampler: iid
[INFO][10:42:32]: [Client #54] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:42:32]: [Client #54] Start to process inbound data.
[INFO][10:42:32]: [Client #89] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:42:32]: [Client #89] Start to process inbound data.
[INFO][10:42:32]: [93m[1m[Client #54] Started training in communication round #44.[0m
[INFO][10:42:32]: [93m[1m[Client #89] Started training in communication round #44.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:46,  4.82s/it]  2%|▏         | 1/48 [00:04<03:50,  4.91s/it]  4%|▍         | 2/48 [00:05<01:52,  2.44s/it]  4%|▍         | 2/48 [00:05<01:54,  2.49s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it]  6%|▋         | 3/48 [00:06<01:16,  1.71s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it]  8%|▊         | 4/48 [00:07<00:58,  1.32s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.16it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.31it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
[INFO][10:43:18]: [Client #54] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_54_3536584.pth.
{'train_runtime': 39.8544, 'train_samples_per_second': 151.903, 'train_steps_per_second': 1.204, 'train_loss': 3.0406761169433594, 'epoch': 3.0}
[INFO][10:43:18]: [Client #89] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_89_3536585.pth.
{'train_runtime': 39.7192, 'train_samples_per_second': 152.42, 'train_steps_per_second': 1.208, 'train_loss': 2.942363421122233, 'epoch': 3.0}
[INFO][10:43:19]: [Client #54] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_54_3536584.pth.
[INFO][10:43:19]: [Client #89] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_89_3536585.pth.
[INFO][10:43:20]: [Client #54] Model trained.
[INFO][10:43:20]: [Client #54] Inbound data has been processed.
[INFO][10:43:20]: [Client #54] Outbound data is ready to be sent after being processed.
[INFO][10:43:20]: [Client #89] Model trained.
[INFO][10:43:20]: [Client #89] Inbound data has been processed.
[INFO][10:43:20]: [Client #89] Outbound data is ready to be sent after being processed.
[INFO][10:43:28]: [Client #89] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:43:28]: [Client #54] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:43:29]: [Server #3536466] Received 507.38 MB of payload data from client #89 (simulated).
[INFO][10:43:30]: [Server #3536466] Received 507.38 MB of payload data from client #54 (simulated).
[INFO][10:43:30]: [Server #3536466] Selecting client #61 for training.
[INFO][10:43:30]: [Server #3536466] Sending the current model to client #61 (simulated).
[INFO][10:43:34]: [Server #3536466] Sending 507.38 MB of payload data to client #61 (simulated).
[INFO][10:43:34]: [Client #61] Selected by the server.
[INFO][10:43:34]: [Client #61] Loading its data source...
[INFO][10:43:34]: [Client #61] Dataset size: 2018
[INFO][10:43:34]: [Client #61] Sampler: iid
[INFO][10:43:36]: [Client #61] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:43:36]: [Client #61] Start to process inbound data.
[INFO][10:43:36]: [93m[1m[Client #61] Started training in communication round #44.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:15,  4.16s/it]  4%|▍         | 2/48 [00:04<01:31,  2.00s/it]  6%|▋         | 3/48 [00:05<00:58,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.71it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.80it/s] 21%|██        | 10/48 [00:08<00:20,  1.87it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.92it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.96it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.98it/s] 29%|██▉       | 14/48 [00:10<00:17,  2.00it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.01it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.12it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.10it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.09it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.08it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.07it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.07it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.07it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.06it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.06it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.06it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.13it/s] 71%|███████   | 34/48 [00:20<00:06,  2.11it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.09it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.06it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.06it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.06it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][10:44:09]: [Client #61] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536584.pth.
{'train_runtime': 26.7707, 'train_samples_per_second': 226.143, 'train_steps_per_second': 1.793, 'train_loss': 2.9292421340942383, 'epoch': 3.0}
[INFO][10:44:10]: [Client #61] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536584.pth.
[INFO][10:44:10]: [Client #61] Model trained.
[INFO][10:44:10]: [Client #61] Inbound data has been processed.
[INFO][10:44:10]: [Client #61] Outbound data is ready to be sent after being processed.
[INFO][10:44:15]: [Client #61] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:44:16]: [Server #3536466] Received 507.38 MB of payload data from client #61 (simulated).
[INFO][10:44:16]: [Server #3536466] Adding client #30 to the list of clients for aggregation.
[INFO][10:44:16]: [Server #3536466] Adding client #36 to the list of clients for aggregation.
[INFO][10:44:16]: [Server #3536466] Adding client #58 to the list of clients for aggregation.
[INFO][10:44:16]: [Server #3536466] Adding client #68 to the list of clients for aggregation.
[INFO][10:44:16]: [Server #3536466] Adding client #23 to the list of clients for aggregation.
[INFO][10:44:16]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:44:16]: [Server #3536466] Updated weights have been received.
[INFO][10:44:17]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:44:17]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:44:17]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.8586e+00  1e+02  1e+00  1e+00
 1:  2.7598e+00  1.8785e+00  4e+00  3e-02  3e-02
 2:  2.8633e+00  2.1227e+00  7e-01  1e-05  1e-05
 3:  2.8630e+00  2.8507e+00  1e-02  2e-07  2e-07
 4:  2.8612e+00  2.8580e+00  3e-03  1e-07  5e-08
 5:  2.8594e+00  2.8572e+00  2e-03  1e-06  5e-07
 6:  2.8588e+00  2.8581e+00  7e-04  5e-07  2e-07
 7:  2.8583e+00  2.8581e+00  2e-04  6e-07  3e-07
 8:  2.8581e+00  2.8581e+00  4e-06  1e-07  5e-08
 9:  2.8581e+00  2.8581e+00  6e-08  2e-09  8e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1  1.1  1.1  1.1  1.1  1.1  0.01 1.1  1.1  1.1  5.1  2.1  1.1  1.1
 2.1  1.1  1.1  0.1  2.1  3.1  1.1  6.1  0.1  6.1  6.1  6.1  1.1  1.1
 4.1  2.1  6.1  2.1  1.1  2.1  2.1  2.1  1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  1.1  1.1  4.1  1.1  5.1  6.1  0.01 0.01 1.1  0.1  1.1  0.01
 1.1  2.1  1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  2.1  1.1  0.01
 1.1  3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  1.1  0.01 2.1  6.1  1.1
 0.01 6.1  6.1  1.1  0.1  6.1  1.1  3.1  3.1  1.1  0.01 0.01 1.1  5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.01 0.2  0.2  0.2
 0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.2  0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.25it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.39it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.83it/s]100%|██████████| 8/8 [00:00<00:00, 11.57it/s]
[INFO][10:44:28]: [93m[1m[Server #3536466] Global model perplexity: 24.17
[0m
[INFO][10:44:28]: [Server #3536466] All client reports have been processed.
[INFO][10:44:28]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_44.pth.
[INFO][10:44:31]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_44.pth.
[INFO][10:44:31]: [93m[1m
[Server #3536466] Starting round 45/100.[0m
[INFO][10:44:31]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([1.42798094e-06, 1.42798094e-06, 1.42798094e-06, 1.42798094e-06,
       1.42798094e-06, 1.42798094e-06, 4.32537342e-05, 1.42798094e-06,
       1.42798094e-06, 1.42798094e-06, 9.95190877e-09, 9.68582690e-08,
       1.42798094e-06, 1.42798094e-06, 9.68582690e-08, 1.42798094e-06,
       1.42798094e-06, 9.68582690e-08, 3.22898193e-08, 1.42798094e-06,
       6.73091000e-09, 9.99546282e-01, 6.73091000e-09, 6.73091000e-09,
       6.73091000e-09, 1.42798094e-06, 1.42798094e-06, 1.63364427e-08,
       9.68582690e-08, 6.73091000e-09, 9.68582690e-08, 1.42798094e-06,
       9.68582690e-08, 9.68582690e-08, 9.68582690e-08, 1.42798094e-06,
       1.42798094e-06, 6.73091000e-09, 9.95190877e-09, 1.42798094e-06,
       1.42798094e-06, 1.42798094e-06, 9.95190877e-09, 1.42798094e-06,
       1.42798094e-06, 1.63364427e-08, 1.42798094e-06, 9.95190877e-09,
       6.73091000e-09, 4.32537342e-05, 4.32537342e-05, 1.42798094e-06,
       1.42798094e-06, 4.32537342e-05, 1.42798094e-06, 9.68582690e-08,
       1.42798094e-06, 1.42798094e-06, 1.42798094e-06, 3.22898193e-08,
       9.95190877e-09, 3.22898193e-08, 1.42798094e-06, 3.22898193e-08,
       9.68582690e-08, 1.42798094e-06, 4.32537342e-05, 1.42798094e-06,
       3.22898193e-08, 6.73091000e-09, 1.42798094e-06, 3.22898193e-08,
       1.42798094e-06, 4.32537342e-05, 1.42798094e-06, 9.68582690e-08,
       1.42798094e-06, 4.32537342e-05, 9.68582690e-08, 6.73091000e-09,
       1.42798094e-06, 4.32537342e-05, 6.73091000e-09, 6.73091000e-09,
       1.42798094e-06, 6.73091000e-09, 1.42798094e-06, 3.22898193e-08,
       3.22898193e-08, 1.42798094e-06, 4.32537342e-05, 1.42798094e-06,
       9.95190877e-09, 9.95190877e-09, 1.42798094e-06]),)
[INFO][10:44:31]: [Server #3536466] Selected clients: [23  7 85 70 56]
[INFO][10:44:31]: [Server #3536466] Selecting client #70 for training.
[INFO][10:44:31]: [Server #3536466] Sending the current model to client #70 (simulated).
[INFO][10:44:36]: [Server #3536466] Sending 507.38 MB of payload data to client #70 (simulated).
[INFO][10:44:36]: [Server #3536466] Selecting client #23 for training.
[INFO][10:44:36]: [Server #3536466] Sending the current model to client #23 (simulated).
[INFO][10:44:40]: [Server #3536466] Sending 507.38 MB of payload data to client #23 (simulated).
[INFO][10:44:40]: [Client #70] Selected by the server.
[INFO][10:44:40]: [Client #70] Loading its data source...
[INFO][10:44:40]: [Client #70] Dataset size: 2018
[INFO][10:44:40]: [Client #70] Sampler: iid
[INFO][10:44:40]: [Client #23] Selected by the server.
[INFO][10:44:40]: [Client #23] Loading its data source...
[INFO][10:44:40]: [Client #23] Dataset size: 2018
[INFO][10:44:40]: [Client #23] Sampler: iid
[INFO][10:44:42]: [Client #70] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:44:42]: [Client #70] Start to process inbound data.
[INFO][10:44:42]: [Client #23] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:44:42]: [Client #23] Start to process inbound data.
[INFO][10:44:43]: [93m[1m[Client #70] Started training in communication round #45.[0m
[INFO][10:44:43]: [93m[1m[Client #23] Started training in communication round #45.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.18s/it]  2%|▏         | 1/48 [00:04<03:48,  4.85s/it]  4%|▍         | 2/48 [00:04<01:37,  2.12s/it]  4%|▍         | 2/48 [00:05<01:53,  2.47s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  6%|▋         | 3/48 [00:06<01:16,  1.69s/it]  8%|▊         | 4/48 [00:06<00:54,  1.23s/it]  8%|▊         | 4/48 [00:07<00:57,  1.31s/it] 10%|█         | 5/48 [00:07<00:45,  1.06s/it] 10%|█         | 5/48 [00:07<00:48,  1.12s/it] 12%|█▎        | 6/48 [00:07<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.22it/s] 21%|██        | 10/48 [00:10<00:30,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.36it/s] 50%|█████     | 24/48 [00:21<00:17,  1.36it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:16,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.32it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.32it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][10:45:28]: [Client #23] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_23_3536585.pth.
{'train_runtime': 39.1568, 'train_samples_per_second': 154.609, 'train_steps_per_second': 1.226, 'train_loss': 2.914677619934082, 'epoch': 3.0}
[INFO][10:45:28]: [Client #70] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_70_3536584.pth.
{'train_runtime': 39.5709, 'train_samples_per_second': 152.991, 'train_steps_per_second': 1.213, 'train_loss': 3.194673220316569, 'epoch': 3.0}
[INFO][10:45:29]: [Client #23] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_23_3536585.pth.
[INFO][10:45:30]: [Client #70] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_70_3536584.pth.
[INFO][10:45:30]: [Client #23] Model trained.
[INFO][10:45:30]: [Client #23] Inbound data has been processed.
[INFO][10:45:30]: [Client #23] Outbound data is ready to be sent after being processed.
[INFO][10:45:30]: [Client #70] Model trained.
[INFO][10:45:30]: [Client #70] Inbound data has been processed.
[INFO][10:45:30]: [Client #70] Outbound data is ready to be sent after being processed.
[INFO][10:45:38]: [Client #23] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:45:39]: [Client #70] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:45:39]: [Server #3536466] Received 507.38 MB of payload data from client #23 (simulated).
[INFO][10:45:40]: [Server #3536466] Received 507.38 MB of payload data from client #70 (simulated).
[INFO][10:45:40]: [Server #3536466] Selecting client #56 for training.
[INFO][10:45:40]: [Server #3536466] Sending the current model to client #56 (simulated).
[INFO][10:45:44]: [Server #3536466] Sending 507.38 MB of payload data to client #56 (simulated).
[INFO][10:45:44]: [Server #3536466] Selecting client #85 for training.
[INFO][10:45:44]: [Server #3536466] Sending the current model to client #85 (simulated).
[INFO][10:45:49]: [Server #3536466] Sending 507.38 MB of payload data to client #85 (simulated).
[INFO][10:45:49]: [Client #56] Selected by the server.
[INFO][10:45:49]: [Client #56] Loading its data source...
[INFO][10:45:49]: [Client #85] Selected by the server.
[INFO][10:45:49]: [Client #56] Dataset size: 2018
[INFO][10:45:49]: [Client #85] Loading its data source...
[INFO][10:45:49]: [Client #56] Sampler: iid
[INFO][10:45:49]: [Client #85] Dataset size: 2018
[INFO][10:45:49]: [Client #85] Sampler: iid
[INFO][10:45:50]: [Client #56] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:45:50]: [Client #56] Start to process inbound data.
[INFO][10:45:50]: [Client #85] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:45:50]: [Client #85] Start to process inbound data.
[INFO][10:45:50]: [93m[1m[Client #56] Started training in communication round #45.[0m
[INFO][10:45:51]: [93m[1m[Client #85] Started training in communication round #45.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:05<03:55,  5.01s/it]  2%|▏         | 1/48 [00:05<03:55,  5.01s/it]  4%|▍         | 2/48 [00:05<02:00,  2.63s/it]  4%|▍         | 2/48 [00:05<02:01,  2.63s/it]  6%|▋         | 3/48 [00:06<01:24,  1.87s/it]  6%|▋         | 3/48 [00:06<01:24,  1.87s/it]  8%|▊         | 4/48 [00:07<01:05,  1.49s/it]  8%|▊         | 4/48 [00:07<01:06,  1.50s/it] 10%|█         | 5/48 [00:08<00:53,  1.25s/it] 10%|█         | 5/48 [00:08<00:54,  1.27s/it] 12%|█▎        | 6/48 [00:09<00:45,  1.08s/it] 12%|█▎        | 6/48 [00:09<00:46,  1.10s/it] 15%|█▍        | 7/48 [00:10<00:39,  1.04it/s] 15%|█▍        | 7/48 [00:10<00:40,  1.01it/s] 17%|█▋        | 8/48 [00:10<00:35,  1.12it/s] 17%|█▋        | 8/48 [00:11<00:36,  1.10it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.19it/s] 19%|█▉        | 9/48 [00:11<00:33,  1.17it/s] 21%|██        | 10/48 [00:12<00:30,  1.23it/s] 21%|██        | 10/48 [00:12<00:31,  1.22it/s] 23%|██▎       | 11/48 [00:13<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:13<00:29,  1.26it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.28it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:15<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:15<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:16<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:16<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.39it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:18<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:19<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.33it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:21<00:19,  1.33it/s] 46%|████▌     | 22/48 [00:21<00:19,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:22<00:18,  1.33it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:24<00:16,  1.31it/s] 54%|█████▍    | 26/48 [00:24<00:16,  1.32it/s] 56%|█████▋    | 27/48 [00:25<00:15,  1.31it/s] 56%|█████▋    | 27/48 [00:25<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.32it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 60%|██████    | 29/48 [00:26<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:27<00:13,  1.30it/s] 62%|██████▎   | 30/48 [00:27<00:13,  1.32it/s] 65%|██████▍   | 31/48 [00:28<00:12,  1.32it/s] 65%|██████▍   | 31/48 [00:28<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:29<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:30<00:10,  1.37it/s] 71%|███████   | 34/48 [00:30<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:31<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:33<00:07,  1.31it/s] 79%|███████▉  | 38/48 [00:33<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:34<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:36<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:36<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:37<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:39<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:39<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:40<00:00,  1.33it/s]100%|██████████| 48/48 [00:40<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.39it/s]100%|██████████| 48/48 [00:40<00:00,  1.18it/s]
100%|██████████| 48/48 [00:40<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.39it/s]100%|██████████| 48/48 [00:40<00:00,  1.18it/s]
[INFO][10:46:38]: [Client #85] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_85_3536585.pth.
{'train_runtime': 40.687, 'train_samples_per_second': 148.794, 'train_steps_per_second': 1.18, 'train_loss': 3.0409603118896484, 'epoch': 3.0}
[INFO][10:46:38]: [Client #56] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_56_3536584.pth.
{'train_runtime': 40.5871, 'train_samples_per_second': 149.161, 'train_steps_per_second': 1.183, 'train_loss': 3.215876897176107, 'epoch': 3.0}
[INFO][10:46:39]: [Client #85] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_85_3536585.pth.
[INFO][10:46:39]: [Client #56] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_56_3536584.pth.
[INFO][10:46:39]: [Client #85] Model trained.
[INFO][10:46:39]: [Client #85] Inbound data has been processed.
[INFO][10:46:39]: [Client #85] Outbound data is ready to be sent after being processed.
[INFO][10:46:39]: [Client #56] Model trained.
[INFO][10:46:39]: [Client #56] Inbound data has been processed.
[INFO][10:46:39]: [Client #56] Outbound data is ready to be sent after being processed.
[INFO][10:46:48]: [Client #56] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:46:48]: [Client #85] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:46:48]: [Server #3536466] Received 507.38 MB of payload data from client #56 (simulated).
[INFO][10:46:49]: [Server #3536466] Received 507.38 MB of payload data from client #85 (simulated).
[INFO][10:46:49]: [Server #3536466] Selecting client #7 for training.
[INFO][10:46:49]: [Server #3536466] Sending the current model to client #7 (simulated).
[INFO][10:46:53]: [Server #3536466] Sending 507.38 MB of payload data to client #7 (simulated).
[INFO][10:46:53]: [Client #7] Selected by the server.
[INFO][10:46:53]: [Client #7] Loading its data source...
[INFO][10:46:53]: [Client #7] Dataset size: 2018
[INFO][10:46:53]: [Client #7] Sampler: iid
[INFO][10:46:55]: [Client #7] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:46:55]: [Client #7] Start to process inbound data.
[INFO][10:46:55]: [93m[1m[Client #7] Started training in communication round #45.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.18s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:58,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.25it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.71it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.80it/s] 21%|██        | 10/48 [00:08<00:20,  1.87it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.92it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.96it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.99it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.00it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.13it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.10it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.08it/s] 40%|███▉      | 19/48 [00:12<00:14,  2.07it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.06it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.06it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.06it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.05it/s] 50%|█████     | 24/48 [00:15<00:11,  2.05it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.05it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.05it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.05it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.05it/s] 60%|██████    | 29/48 [00:17<00:09,  2.05it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.05it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.05it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.15it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.12it/s] 71%|███████   | 34/48 [00:20<00:06,  2.09it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.08it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.07it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.06it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.05it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.05it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.05it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.05it/s] 88%|████████▊ | 42/48 [00:24<00:02,  2.04it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.05it/s] 92%|█████████▏| 44/48 [00:25<00:01,  2.04it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.04it/s] 96%|█████████▌| 46/48 [00:26<00:00,  2.04it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.04it/s]100%|██████████| 48/48 [00:26<00:00,  2.15it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.15it/s]100%|██████████| 48/48 [00:26<00:00,  1.78it/s]
[INFO][10:47:28]: [Client #7] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536584.pth.
{'train_runtime': 26.9119, 'train_samples_per_second': 224.956, 'train_steps_per_second': 1.784, 'train_loss': 3.052654266357422, 'epoch': 3.0}
[INFO][10:47:29]: [Client #7] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536584.pth.
[INFO][10:47:29]: [Client #7] Model trained.
[INFO][10:47:29]: [Client #7] Inbound data has been processed.
[INFO][10:47:29]: [Client #7] Outbound data is ready to be sent after being processed.
[INFO][10:47:34]: [Client #7] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:47:35]: [Server #3536466] Received 507.38 MB of payload data from client #7 (simulated).
[INFO][10:47:35]: [Server #3536466] Adding client #54 to the list of clients for aggregation.
[INFO][10:47:35]: [Server #3536466] Adding client #89 to the list of clients for aggregation.
[INFO][10:47:35]: [Server #3536466] Adding client #61 to the list of clients for aggregation.
[INFO][10:47:35]: [Server #3536466] Adding client #18 to the list of clients for aggregation.
[INFO][10:47:35]: [Server #3536466] Adding client #96 to the list of clients for aggregation.
[INFO][10:47:35]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:47:35]: [Server #3536466] Updated weights have been received.
[INFO][10:47:35]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:47:36]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:47:36]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.8773e+00  1e+02  1e+00  1e+00
 1:  2.7810e+00  1.8972e+00  4e+00  3e-02  3e-02
 2:  2.8822e+00  2.1459e+00  7e-01  5e-06  7e-07
 3:  2.8819e+00  2.8694e+00  1e-02  9e-08  1e-08
 4:  2.8801e+00  2.8766e+00  3e-03  1e-07  2e-08
 5:  2.8785e+00  2.8758e+00  3e-03  8e-07  7e-07
 6:  2.8780e+00  2.8768e+00  1e-03  4e-07  4e-07
 7:  2.8773e+00  2.8769e+00  4e-04  3e-06  2e-06
 8:  2.8770e+00  2.8769e+00  1e-04  1e-06  1e-06
 9:  2.8769e+00  2.8769e+00  5e-06  3e-07  2e-07
10:  2.8769e+00  2.8769e+00  1e-07  9e-09  8e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1  1.1  1.1  1.1  1.1  1.1  0.01 1.1  1.1  1.1  5.1  2.1  1.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  0.1  6.1  6.1  6.1  1.1  1.1
 4.1  2.1  6.1  2.1  1.1  2.1  2.1  2.1  1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  1.1  1.1  4.1  1.1  5.1  6.1  0.01 0.01 1.1  1.1  1.1  0.01
 1.1  2.1  1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  2.1  1.1  0.01
 1.1  3.1  6.1  1.1  3.1  1.1  0.01 1.1  2.1  1.1  0.01 2.1  6.1  1.1
 0.01 6.1  6.1  1.1  1.1  6.1  1.1  3.1  3.1  1.1  0.01 2.1  1.1  5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.01 0.2  0.2  0.2
 0.01 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.05it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.28it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.75it/s]100%|██████████| 8/8 [00:00<00:00, 11.66it/s]
[INFO][10:47:47]: [93m[1m[Server #3536466] Global model perplexity: 24.35
[0m
[INFO][10:47:47]: [Server #3536466] All client reports have been processed.
[INFO][10:47:47]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_45.pth.
[INFO][10:47:50]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_45.pth.
[INFO][10:47:50]: [93m[1m
[Server #3536466] Starting round 46/100.[0m
[INFO][10:47:50]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([3.09749639e-05, 3.09749639e-05, 3.09749639e-05, 3.09749639e-05,
       3.09749639e-05, 3.09749639e-05, 3.09749639e-05, 3.09749639e-05,
       3.09749639e-05, 5.05946131e-07, 3.34812787e-06, 3.09749639e-05,
       3.09749639e-05, 3.34812787e-06, 3.09749639e-05, 3.09749639e-05,
       3.09749639e-05, 3.34812787e-06, 1.39047467e-06, 3.09749639e-05,
       3.57751205e-07, 3.57751205e-07, 3.57751205e-07, 3.57751205e-07,
       3.09749639e-05, 3.09749639e-05, 7.80786555e-07, 3.34812787e-06,
       3.57751205e-07, 3.34812787e-06, 3.09749639e-05, 3.34812787e-06,
       3.34812787e-06, 3.34812787e-06, 3.09749639e-05, 3.09749639e-05,
       3.57751205e-07, 5.05946131e-07, 3.09749639e-05, 3.09749639e-05,
       3.09749639e-05, 5.05946131e-07, 3.09749639e-05, 3.09749639e-05,
       7.80786555e-07, 3.09749639e-05, 5.05946131e-07, 3.57751205e-07,
       1.99689831e-01, 1.99689831e-01, 3.09749639e-05, 3.09749639e-05,
       3.09749639e-05, 3.09749639e-05, 3.34812787e-06, 3.09749639e-05,
       3.09749639e-05, 3.09749639e-05, 3.09749639e-05, 1.39047467e-06,
       5.05946131e-07, 1.39047467e-06, 3.09749639e-05, 1.39047467e-06,
       3.34812787e-06, 3.09749639e-05, 3.09749639e-05, 1.39047467e-06,
       3.57751205e-07, 3.09749639e-05, 1.39047467e-06, 3.09749639e-05,
       1.99689831e-01, 3.09749639e-05, 3.34812787e-06, 3.09749639e-05,
       1.99689831e-01, 3.34812787e-06, 3.57751205e-07, 3.09749639e-05,
       3.57751205e-07, 3.57751205e-07, 3.09749639e-05, 3.09749639e-05,
       3.57751205e-07, 3.09749639e-05, 1.39047467e-06, 1.39047467e-06,
       3.09749639e-05, 1.99689831e-01, 3.34812787e-06, 3.09749639e-05,
       5.05946131e-07, 5.05946131e-07, 3.09749639e-05]),)
[INFO][10:47:50]: [Server #3536466] Selected clients: [81 95 52 51 77]
[INFO][10:47:50]: [Server #3536466] Selecting client #52 for training.
[INFO][10:47:50]: [Server #3536466] Sending the current model to client #52 (simulated).
[INFO][10:47:55]: [Server #3536466] Sending 507.38 MB of payload data to client #52 (simulated).
[INFO][10:47:55]: [Server #3536466] Selecting client #81 for training.
[INFO][10:47:55]: [Server #3536466] Sending the current model to client #81 (simulated).
[INFO][10:47:59]: [Server #3536466] Sending 507.38 MB of payload data to client #81 (simulated).
[INFO][10:47:59]: [Client #52] Selected by the server.
[INFO][10:47:59]: [Client #52] Loading its data source...
[INFO][10:47:59]: [Client #52] Dataset size: 2018
[INFO][10:47:59]: [Client #52] Sampler: iid
[INFO][10:47:59]: [Client #81] Selected by the server.
[INFO][10:47:59]: [Client #81] Loading its data source...
[INFO][10:47:59]: [Client #81] Dataset size: 2018
[INFO][10:47:59]: [Client #81] Sampler: iid
[INFO][10:48:00]: [Client #52] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:48:00]: [Client #52] Start to process inbound data.
[INFO][10:48:00]: [Client #81] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:48:00]: [Client #81] Start to process inbound data.
[INFO][10:48:01]: [93m[1m[Client #52] Started training in communication round #46.[0m
[INFO][10:48:01]: [93m[1m[Client #81] Started training in communication round #46.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:52,  4.95s/it]  2%|▏         | 1/48 [00:04<03:53,  4.98s/it]  4%|▍         | 2/48 [00:05<01:54,  2.50s/it]  4%|▍         | 2/48 [00:05<01:56,  2.52s/it]  6%|▋         | 3/48 [00:06<01:15,  1.69s/it]  6%|▋         | 3/48 [00:06<01:17,  1.72s/it]  8%|▊         | 4/48 [00:07<00:57,  1.31s/it]  8%|▊         | 4/48 [00:07<00:58,  1.34s/it] 10%|█         | 5/48 [00:07<00:48,  1.12s/it] 10%|█         | 5/48 [00:08<00:48,  1.13s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.00it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.39it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.31it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.29it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.31it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
[INFO][10:48:47]: [Client #81] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_81_3536585.pth.
{'train_runtime': 39.942, 'train_samples_per_second': 151.57, 'train_steps_per_second': 1.202, 'train_loss': 3.015186627705892, 'epoch': 3.0}
[INFO][10:48:48]: [Client #52] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_52_3536584.pth.
{'train_runtime': 39.8609, 'train_samples_per_second': 151.878, 'train_steps_per_second': 1.204, 'train_loss': 3.1675144831339517, 'epoch': 3.0}
[INFO][10:48:48]: [Client #81] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_81_3536585.pth.
[INFO][10:48:49]: [Client #52] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_52_3536584.pth.
[INFO][10:48:49]: [Client #81] Model trained.
[INFO][10:48:49]: [Client #81] Inbound data has been processed.
[INFO][10:48:49]: [Client #81] Outbound data is ready to be sent after being processed.
[INFO][10:48:50]: [Client #52] Model trained.
[INFO][10:48:50]: [Client #52] Inbound data has been processed.
[INFO][10:48:50]: [Client #52] Outbound data is ready to be sent after being processed.
[INFO][10:48:57]: [Client #81] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:48:57]: [Server #3536466] Received 507.38 MB of payload data from client #81 (simulated).
[INFO][10:48:57]: [Client #52] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:48:58]: [Server #3536466] Received 507.38 MB of payload data from client #52 (simulated).
[INFO][10:48:58]: [Server #3536466] Selecting client #51 for training.
[INFO][10:48:58]: [Server #3536466] Sending the current model to client #51 (simulated).
[INFO][10:49:02]: [Server #3536466] Sending 507.38 MB of payload data to client #51 (simulated).
[INFO][10:49:02]: [Server #3536466] Selecting client #77 for training.
[INFO][10:49:02]: [Server #3536466] Sending the current model to client #77 (simulated).
[INFO][10:49:07]: [Server #3536466] Sending 507.38 MB of payload data to client #77 (simulated).
[INFO][10:49:07]: [Client #51] Selected by the server.
[INFO][10:49:07]: [Client #51] Loading its data source...
[INFO][10:49:07]: [Client #51] Dataset size: 2018
[INFO][10:49:07]: [Client #77] Selected by the server.
[INFO][10:49:07]: [Client #51] Sampler: iid
[INFO][10:49:07]: [Client #77] Loading its data source...
[INFO][10:49:07]: [Client #77] Dataset size: 2018
[INFO][10:49:07]: [Client #77] Sampler: iid
[INFO][10:49:08]: [Client #51] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:49:08]: [Client #51] Start to process inbound data.
[INFO][10:49:08]: [Client #77] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:49:08]: [Client #77] Start to process inbound data.
[INFO][10:49:09]: [93m[1m[Client #51] Started training in communication round #46.[0m
[INFO][10:49:09]: [93m[1m[Client #77] Started training in communication round #46.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:53,  4.98s/it]  2%|▏         | 1/48 [00:04<03:52,  4.94s/it]  4%|▍         | 2/48 [00:05<01:59,  2.59s/it]  4%|▍         | 2/48 [00:05<01:58,  2.59s/it]  6%|▋         | 3/48 [00:06<01:20,  1.79s/it]  6%|▋         | 3/48 [00:06<01:20,  1.80s/it]  8%|▊         | 4/48 [00:07<01:00,  1.38s/it]  8%|▊         | 4/48 [00:07<01:01,  1.39s/it] 10%|█         | 5/48 [00:08<00:49,  1.14s/it] 10%|█         | 5/48 [00:08<00:49,  1.16s/it] 12%|█▎        | 6/48 [00:08<00:42,  1.00s/it] 12%|█▎        | 6/48 [00:09<00:42,  1.02s/it] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 15%|█▍        | 7/48 [00:09<00:38,  1.08it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.16it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.19it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.20it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.37it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 42%|████▏     | 20/48 [00:19<00:21,  1.33it/s] 42%|████▏     | 20/48 [00:19<00:21,  1.33it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:22<00:18,  1.32it/s] 50%|█████     | 24/48 [00:22<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.32it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.32it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:26<00:14,  1.35it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.35it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.31it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:40<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.36it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
100%|██████████| 48/48 [00:40<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.38it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
[INFO][10:49:56]: [Client #77] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_77_3536585.pth.
{'train_runtime': 40.1624, 'train_samples_per_second': 150.738, 'train_steps_per_second': 1.195, 'train_loss': 3.0097646713256836, 'epoch': 3.0}
[INFO][10:49:56]: [Client #51] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_51_3536584.pth.
{'train_runtime': 40.1488, 'train_samples_per_second': 150.789, 'train_steps_per_second': 1.196, 'train_loss': 3.0081780751546225, 'epoch': 3.0}
[INFO][10:49:57]: [Client #77] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_77_3536585.pth.
[INFO][10:49:57]: [Client #51] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_51_3536584.pth.
[INFO][10:49:57]: [Client #77] Model trained.
[INFO][10:49:57]: [Client #77] Inbound data has been processed.
[INFO][10:49:57]: [Client #77] Outbound data is ready to be sent after being processed.
[INFO][10:49:57]: [Client #51] Model trained.
[INFO][10:49:57]: [Client #51] Inbound data has been processed.
[INFO][10:49:57]: [Client #51] Outbound data is ready to be sent after being processed.
[INFO][10:50:06]: [Client #51] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:50:06]: [Client #77] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:50:06]: [Server #3536466] Received 507.38 MB of payload data from client #51 (simulated).
[INFO][10:50:07]: [Server #3536466] Received 507.38 MB of payload data from client #77 (simulated).
[INFO][10:50:07]: [Server #3536466] Selecting client #95 for training.
[INFO][10:50:07]: [Server #3536466] Sending the current model to client #95 (simulated).
[INFO][10:50:11]: [Server #3536466] Sending 507.38 MB of payload data to client #95 (simulated).
[INFO][10:50:11]: [Client #95] Selected by the server.
[INFO][10:50:11]: [Client #95] Loading its data source...
[INFO][10:50:11]: [Client #95] Dataset size: 2018
[INFO][10:50:11]: [Client #95] Sampler: iid
[INFO][10:50:13]: [Client #95] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:50:13]: [Client #95] Start to process inbound data.
[INFO][10:50:13]: [93m[1m[Client #95] Started training in communication round #46.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:15,  4.17s/it]  4%|▍         | 2/48 [00:04<01:31,  2.00s/it]  6%|▋         | 3/48 [00:05<00:58,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.25it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.45it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.61it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.12it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.10it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.07it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.07it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.06it/s] 50%|█████     | 24/48 [00:15<00:11,  2.06it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.05it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.05it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.05it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.05it/s] 60%|██████    | 29/48 [00:17<00:09,  2.06it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.05it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.05it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.15it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.12it/s] 71%|███████   | 34/48 [00:19<00:06,  2.10it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.08it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.07it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.06it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.06it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.06it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.06it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.06it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][10:50:46]: [Client #95] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_95_3536584.pth.
{'train_runtime': 26.7043, 'train_samples_per_second': 226.705, 'train_steps_per_second': 1.797, 'train_loss': 3.037848154703776, 'epoch': 3.0}
[INFO][10:50:47]: [Client #95] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_95_3536584.pth.
[INFO][10:50:47]: [Client #95] Model trained.
[INFO][10:50:47]: [Client #95] Inbound data has been processed.
[INFO][10:50:47]: [Client #95] Outbound data is ready to be sent after being processed.
[INFO][10:50:52]: [Client #95] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:50:53]: [Server #3536466] Received 507.38 MB of payload data from client #95 (simulated).
[INFO][10:50:53]: [Server #3536466] Adding client #23 to the list of clients for aggregation.
[INFO][10:50:53]: [Server #3536466] Adding client #85 to the list of clients for aggregation.
[INFO][10:50:53]: [Server #3536466] Adding client #7 to the list of clients for aggregation.
[INFO][10:50:53]: [Server #3536466] Adding client #70 to the list of clients for aggregation.
[INFO][10:50:53]: [Server #3536466] Adding client #77 to the list of clients for aggregation.
[INFO][10:50:53]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:50:53]: [Server #3536466] Updated weights have been received.
[INFO][10:50:53]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:50:54]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:50:54]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.8898e+00  1e+02  1e+00  1e+00
 1:  2.7951e+00  1.9097e+00  4e+00  3e-02  3e-02
 2:  2.8948e+00  2.1612e+00  7e-01  5e-06  7e-07
 3:  2.8945e+00  2.8825e+00  1e-02  9e-08  1e-08
 4:  2.8926e+00  2.8897e+00  3e-03  1e-07  2e-08
 5:  2.8908e+00  2.8890e+00  2e-03  3e-07  5e-08
 6:  2.8903e+00  2.8898e+00  5e-04  1e-07  2e-08
 7:  2.8900e+00  2.8898e+00  1e-04  1e-07  3e-08
 8:  2.8898e+00  2.8898e+00  2e-06  2e-08  3e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1  1.1  1.1  1.1  1.1  1.1  1.1  1.1  1.1  1.1  5.1  2.1  1.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  1.1  6.1  6.1  6.1  1.1  1.1
 4.1  2.1  6.1  2.1  1.1  2.1  2.1  2.1  1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  1.1  1.1  4.1  1.1  5.1  6.1  0.01 0.01 1.1  1.1  1.1  0.01
 1.1  2.1  1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  2.1  1.1  1.1
 1.1  3.1  6.1  1.1  3.1  1.1  0.1  1.1  2.1  1.1  0.01 2.1  6.1  1.1
 1.1  6.1  6.1  1.1  1.1  6.1  1.1  3.1  3.1  1.1  0.01 2.1  1.1  5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.40it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.44it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.39it/s]100%|██████████| 8/8 [00:00<00:00, 11.58it/s]
[INFO][10:51:05]: [93m[1m[Server #3536466] Global model perplexity: 23.76
[0m
[INFO][10:51:05]: [Server #3536466] All client reports have been processed.
[INFO][10:51:05]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_46.pth.
[INFO][10:51:08]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_46.pth.
[INFO][10:51:08]: [93m[1m
[Server #3536466] Starting round 47/100.[0m
[INFO][10:51:08]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([3.18040202e-05, 3.18040202e-05, 3.18040202e-05, 3.18040202e-05,
       3.18040202e-05, 3.18040202e-05, 3.18040202e-05, 3.18040202e-05,
       3.18040202e-05, 3.18040202e-05, 3.56108732e-07, 2.88110315e-06,
       3.18040202e-05, 3.18040202e-05, 2.88110315e-06, 3.18040202e-05,
       3.18040202e-05, 3.18040202e-05, 2.88110315e-06, 1.07440034e-06,
       3.18040202e-05, 2.44219323e-07, 3.18040202e-05, 2.44219323e-07,
       2.44219323e-07, 2.44219323e-07, 3.18040202e-05, 3.18040202e-05,
       5.70466293e-07, 2.88110315e-06, 2.44219323e-07, 2.88110315e-06,
       3.18040202e-05, 2.88110315e-06, 2.88110315e-06, 2.88110315e-06,
       3.18040202e-05, 3.18040202e-05, 2.44219323e-07, 3.56108732e-07,
       3.18040202e-05, 3.18040202e-05, 3.18040202e-05, 3.56108732e-07,
       3.18040202e-05, 3.18040202e-05, 5.70466293e-07, 3.18040202e-05,
       3.56108732e-07, 2.44219323e-07, 3.18040202e-05, 3.18040202e-05,
       3.18040202e-05, 3.18040202e-05, 2.88110315e-06, 3.18040202e-05,
       3.18040202e-05, 3.18040202e-05, 3.18040202e-05, 1.07440034e-06,
       3.56108732e-07, 1.07440034e-06, 3.18040202e-05, 1.07440034e-06,
       2.88110315e-06, 3.18040202e-05, 3.18040202e-05, 3.18040202e-05,
       1.07440034e-06, 2.44219323e-07, 3.18040202e-05, 1.07440034e-06,
       3.18040202e-05, 9.98293577e-01, 3.18040202e-05, 2.88110315e-06,
       3.18040202e-05, 2.88110315e-06, 2.44219323e-07, 3.18040202e-05,
       3.18040202e-05, 2.44219323e-07, 2.44219323e-07, 3.18040202e-05,
       3.18040202e-05, 2.44219323e-07, 3.18040202e-05, 1.07440034e-06,
       1.07440034e-06, 3.18040202e-05, 2.88110315e-06, 3.18040202e-05,
       3.56108732e-07, 3.56108732e-07, 3.18040202e-05]),)
[INFO][10:51:08]: [Server #3536466] Selected clients: [77 33 74 71 58]
[INFO][10:51:08]: [Server #3536466] Selecting client #58 for training.
[INFO][10:51:08]: [Server #3536466] Sending the current model to client #58 (simulated).
[INFO][10:51:13]: [Server #3536466] Sending 507.38 MB of payload data to client #58 (simulated).
[INFO][10:51:13]: [Server #3536466] Selecting client #33 for training.
[INFO][10:51:13]: [Server #3536466] Sending the current model to client #33 (simulated).
[INFO][10:51:18]: [Server #3536466] Sending 507.38 MB of payload data to client #33 (simulated).
[INFO][10:51:18]: [Client #33] Selected by the server.
[INFO][10:51:18]: [Client #33] Loading its data source...
[INFO][10:51:18]: [Client #33] Dataset size: 2018
[INFO][10:51:18]: [Client #33] Sampler: iid
[INFO][10:51:18]: [Client #58] Selected by the server.
[INFO][10:51:18]: [Client #58] Loading its data source...
[INFO][10:51:18]: [Client #58] Dataset size: 2018
[INFO][10:51:18]: [Client #58] Sampler: iid
[INFO][10:51:19]: [Client #33] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:51:19]: [Client #33] Start to process inbound data.
[INFO][10:51:19]: [Client #58] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:51:19]: [Client #58] Start to process inbound data.
[INFO][10:51:20]: [93m[1m[Client #33] Started training in communication round #47.[0m
[INFO][10:51:20]: [93m[1m[Client #58] Started training in communication round #47.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:31,  4.50s/it]  2%|▏         | 1/48 [00:04<03:54,  4.99s/it]  4%|▍         | 2/48 [00:05<01:43,  2.26s/it]  4%|▍         | 2/48 [00:05<01:56,  2.52s/it]  6%|▋         | 3/48 [00:05<01:09,  1.55s/it]  6%|▋         | 3/48 [00:06<01:17,  1.73s/it]  8%|▊         | 4/48 [00:06<00:54,  1.23s/it]  8%|▊         | 4/48 [00:07<00:58,  1.33s/it] 10%|█         | 5/48 [00:07<00:45,  1.05s/it] 10%|█         | 5/48 [00:08<00:47,  1.12s/it] 12%|█▎        | 6/48 [00:08<00:39,  1.06it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:11<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:21,  1.33it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.42it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.30it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.54it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.54it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][10:52:06]: [Client #33] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
{'train_runtime': 39.2195, 'train_samples_per_second': 154.362, 'train_steps_per_second': 1.224, 'train_loss': 2.910240809122721, 'epoch': 3.0}
[INFO][10:52:06]: [Client #58] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_58_3536584.pth.
{'train_runtime': 39.6308, 'train_samples_per_second': 152.76, 'train_steps_per_second': 1.211, 'train_loss': 3.1421330769856772, 'epoch': 3.0}
[INFO][10:52:07]: [Client #33] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
[INFO][10:52:07]: [Client #58] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_58_3536584.pth.
[INFO][10:52:07]: [Client #33] Model trained.
[INFO][10:52:07]: [Client #33] Inbound data has been processed.
[INFO][10:52:07]: [Client #33] Outbound data is ready to be sent after being processed.
[INFO][10:52:08]: [Client #58] Model trained.
[INFO][10:52:08]: [Client #58] Inbound data has been processed.
[INFO][10:52:08]: [Client #58] Outbound data is ready to be sent after being processed.
[INFO][10:52:16]: [Client #58] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:52:16]: [Client #33] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:52:17]: [Server #3536466] Received 507.38 MB of payload data from client #58 (simulated).
[INFO][10:52:18]: [Server #3536466] Received 507.38 MB of payload data from client #33 (simulated).
[INFO][10:52:18]: [Server #3536466] Selecting client #74 for training.
[INFO][10:52:18]: [Server #3536466] Sending the current model to client #74 (simulated).
[INFO][10:52:22]: [Server #3536466] Sending 507.38 MB of payload data to client #74 (simulated).
[INFO][10:52:22]: [Server #3536466] Selecting client #71 for training.
[INFO][10:52:22]: [Server #3536466] Sending the current model to client #71 (simulated).
[INFO][10:52:27]: [Server #3536466] Sending 507.38 MB of payload data to client #71 (simulated).
[INFO][10:52:27]: [Client #74] Selected by the server.
[INFO][10:52:27]: [Client #71] Selected by the server.
[INFO][10:52:27]: [Client #74] Loading its data source...
[INFO][10:52:27]: [Client #71] Loading its data source...
[INFO][10:52:27]: [Client #74] Dataset size: 2018
[INFO][10:52:27]: [Client #71] Dataset size: 2018
[INFO][10:52:27]: [Client #74] Sampler: iid
[INFO][10:52:27]: [Client #71] Sampler: iid
[INFO][10:52:29]: [Client #71] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:52:29]: [Client #71] Start to process inbound data.
[INFO][10:52:29]: [Client #74] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:52:29]: [Client #74] Start to process inbound data.
[INFO][10:52:30]: [93m[1m[Client #71] Started training in communication round #47.[0m
[INFO][10:52:30]: [93m[1m[Client #74] Started training in communication round #47.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:49,  4.89s/it]  2%|▏         | 1/48 [00:04<03:50,  4.91s/it]  4%|▍         | 2/48 [00:05<01:54,  2.49s/it]  4%|▍         | 2/48 [00:05<01:55,  2.52s/it]  6%|▋         | 3/48 [00:06<01:16,  1.69s/it]  6%|▋         | 3/48 [00:06<01:17,  1.72s/it]  8%|▊         | 4/48 [00:07<00:58,  1.32s/it]  8%|▊         | 4/48 [00:07<00:58,  1.34s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 10%|█         | 5/48 [00:08<00:48,  1.12s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.31it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.35it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][10:53:16]: [Client #74] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_74_3536584.pth.
{'train_runtime': 39.8183, 'train_samples_per_second': 152.041, 'train_steps_per_second': 1.205, 'train_loss': 3.150679270426432, 'epoch': 3.0}
[INFO][10:53:16]: [Client #71] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_71_3536585.pth.
{'train_runtime': 39.7466, 'train_samples_per_second': 152.315, 'train_steps_per_second': 1.208, 'train_loss': 2.953218142191569, 'epoch': 3.0}
[INFO][10:53:17]: [Client #74] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_74_3536584.pth.
[INFO][10:53:17]: [Client #71] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_71_3536585.pth.
[INFO][10:53:17]: [Client #74] Model trained.
[INFO][10:53:17]: [Client #74] Inbound data has been processed.
[INFO][10:53:17]: [Client #74] Outbound data is ready to be sent after being processed.
[INFO][10:53:18]: [Client #71] Model trained.
[INFO][10:53:18]: [Client #71] Inbound data has been processed.
[INFO][10:53:18]: [Client #71] Outbound data is ready to be sent after being processed.
[INFO][10:53:25]: [Client #74] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:53:26]: [Client #71] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:53:26]: [Server #3536466] Received 507.38 MB of payload data from client #74 (simulated).
[INFO][10:53:27]: [Server #3536466] Received 507.38 MB of payload data from client #71 (simulated).
[INFO][10:53:27]: [Server #3536466] Selecting client #77 for training.
[INFO][10:53:27]: [Server #3536466] Sending the current model to client #77 (simulated).
[INFO][10:53:31]: [Server #3536466] Sending 507.38 MB of payload data to client #77 (simulated).
[INFO][10:53:31]: [Client #77] Selected by the server.
[INFO][10:53:31]: [Client #77] Loading its data source...
[INFO][10:53:31]: [Client #77] Dataset size: 2018
[INFO][10:53:31]: [Client #77] Sampler: iid
[INFO][10:53:33]: [Client #77] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:53:33]: [Client #77] Start to process inbound data.
[INFO][10:53:33]: [93m[1m[Client #77] Started training in communication round #47.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.20s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.14it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.12it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.10it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.09it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.08it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][10:54:06]: [Client #77] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_77_3536584.pth.
{'train_runtime': 26.6847, 'train_samples_per_second': 226.872, 'train_steps_per_second': 1.799, 'train_loss': 2.879347483317057, 'epoch': 3.0}
[INFO][10:54:07]: [Client #77] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_77_3536584.pth.
[INFO][10:54:08]: [Client #77] Model trained.
[INFO][10:54:08]: [Client #77] Inbound data has been processed.
[INFO][10:54:08]: [Client #77] Outbound data is ready to be sent after being processed.
[INFO][10:54:12]: [Client #77] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:54:13]: [Server #3536466] Received 507.38 MB of payload data from client #77 (simulated).
[INFO][10:54:13]: [Server #3536466] Adding client #81 to the list of clients for aggregation.
[INFO][10:54:13]: [Server #3536466] Adding client #33 to the list of clients for aggregation.
[INFO][10:54:13]: [Server #3536466] Adding client #71 to the list of clients for aggregation.
[INFO][10:54:13]: [Server #3536466] Adding client #95 to the list of clients for aggregation.
[INFO][10:54:13]: [Server #3536466] Adding client #77 to the list of clients for aggregation.
[INFO][10:54:13]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:54:13]: [Server #3536466] Updated weights have been received.
[INFO][10:54:14]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:54:15]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:54:15]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.8980e+00  1e+02  1e+00  1e+00
 1:  2.8040e+00  1.9178e+00  4e+00  3e-02  3e-02
 2:  2.9030e+00  2.1710e+00  7e-01  5e-06  6e-07
 3:  2.9026e+00  2.8901e+00  1e-02  9e-08  1e-08
 4:  2.9009e+00  2.8973e+00  4e-03  1e-07  2e-08
 5:  2.8995e+00  2.8965e+00  3e-03  1e-06  9e-07
 6:  2.8989e+00  2.8975e+00  1e-03  6e-07  5e-07
 7:  2.8981e+00  2.8976e+00  5e-04  3e-06  3e-06
 8:  2.8977e+00  2.8976e+00  1e-04  1e-06  1e-06
 9:  2.8976e+00  2.8976e+00  2e-06  1e-07  7e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1  1.1  1.1  1.1  1.1  1.1  1.1  1.1  1.1  1.1  5.1  2.1  1.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  1.1  6.1  6.1  6.1  1.1  1.1
 4.1  2.1  6.1  2.1  0.1  2.1  2.1  2.1  1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  1.1  1.1  4.1  1.1  5.1  6.1  0.01 0.01 1.1  1.1  1.1  0.01
 1.1  2.1  1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  2.1  1.1  1.1
 0.1  3.1  6.1  1.1  3.1  1.1  0.1  1.1  2.1  1.1  1.1  2.1  6.1  1.1
 1.1  6.1  6.1  1.1  1.1  6.1  1.1  3.1  3.1  1.1  1.1  2.1  1.1  5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.22it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.31it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.00it/s]100%|██████████| 8/8 [00:00<00:00, 11.76it/s]
[INFO][10:54:26]: [93m[1m[Server #3536466] Global model perplexity: 23.76
[0m
[INFO][10:54:26]: [Server #3536466] All client reports have been processed.
[INFO][10:54:26]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_47.pth.
[INFO][10:54:29]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_47.pth.
[INFO][10:54:29]: [93m[1m
[Server #3536466] Starting round 48/100.[0m
[INFO][10:54:29]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([1.08730353e-06, 1.08730353e-06, 1.08730353e-06, 1.08730353e-06,
       1.08730353e-06, 1.08730353e-06, 1.08730353e-06, 1.08730353e-06,
       1.08730353e-06, 1.08730353e-06, 1.38689675e-08, 1.15768049e-07,
       1.08730353e-06, 1.08730353e-06, 1.15768049e-07, 1.08730353e-06,
       1.08730353e-06, 1.08730353e-06, 1.15768049e-07, 4.21952050e-08,
       1.08730353e-06, 9.56036230e-09, 1.08730353e-06, 9.56036230e-09,
       9.56036230e-09, 9.56036230e-09, 1.08730353e-06, 1.08730353e-06,
       2.22143905e-08, 1.15768049e-07, 9.56036230e-09, 1.15768049e-07,
       3.33314188e-01, 1.15768049e-07, 1.15768049e-07, 1.15768049e-07,
       1.08730353e-06, 1.08730353e-06, 9.56036230e-09, 1.38689675e-08,
       1.08730353e-06, 1.08730353e-06, 1.08730353e-06, 1.38689675e-08,
       1.08730353e-06, 1.08730353e-06, 2.22143905e-08, 1.08730353e-06,
       1.38689675e-08, 9.56036230e-09, 1.08730353e-06, 1.08730353e-06,
       1.08730353e-06, 1.08730353e-06, 1.08730353e-06, 1.08730353e-06,
       1.08730353e-06, 1.08730353e-06, 4.21952050e-08, 1.38689675e-08,
       4.21952050e-08, 1.08730353e-06, 4.21952050e-08, 1.15768049e-07,
       1.08730353e-06, 1.08730353e-06, 3.33314188e-01, 4.21952050e-08,
       9.56036230e-09, 4.21952050e-08, 1.08730353e-06, 3.33314188e-01,
       1.08730353e-06, 1.15768049e-07, 1.08730353e-06, 1.08730353e-06,
       1.15768049e-07, 9.56036230e-09, 1.08730353e-06, 1.08730353e-06,
       9.56036230e-09, 9.56036230e-09, 1.08730353e-06, 1.08730353e-06,
       9.56036230e-09, 1.08730353e-06, 4.21952050e-08, 4.21952050e-08,
       1.08730353e-06, 1.08730353e-06, 1.15768049e-07, 1.08730353e-06,
       1.38689675e-08, 1.38689675e-08, 1.08730353e-06]),)
[INFO][10:54:29]: [Server #3536466] Selected clients: [71 77 33 16  7]
[INFO][10:54:29]: [Server #3536466] Selecting client #16 for training.
[INFO][10:54:29]: [Server #3536466] Sending the current model to client #16 (simulated).
[INFO][10:54:34]: [Server #3536466] Sending 507.38 MB of payload data to client #16 (simulated).
[INFO][10:54:34]: [Server #3536466] Selecting client #33 for training.
[INFO][10:54:34]: [Server #3536466] Sending the current model to client #33 (simulated).
[INFO][10:54:38]: [Server #3536466] Sending 507.38 MB of payload data to client #33 (simulated).
[INFO][10:54:38]: [Client #16] Selected by the server.
[INFO][10:54:38]: [Client #16] Loading its data source...
[INFO][10:54:38]: [Client #33] Selected by the server.
[INFO][10:54:38]: [Client #16] Dataset size: 2018
[INFO][10:54:38]: [Client #33] Loading its data source...
[INFO][10:54:38]: [Client #16] Sampler: iid
[INFO][10:54:38]: [Client #33] Dataset size: 2018
[INFO][10:54:38]: [Client #33] Sampler: iid
[INFO][10:54:40]: [Client #33] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:54:40]: [Client #33] Start to process inbound data.
[INFO][10:54:40]: [Client #16] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:54:40]: [Client #16] Start to process inbound data.
[INFO][10:54:41]: [93m[1m[Client #33] Started training in communication round #48.[0m
[INFO][10:54:41]: [93m[1m[Client #16] Started training in communication round #48.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
***** Running training *****
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Num examples = 2018
  Total optimization steps = 48
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.25s/it]  2%|▏         | 1/48 [00:04<03:46,  4.82s/it]  4%|▍         | 2/48 [00:04<01:39,  2.16s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:07<00:57,  1.31s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.28it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.31it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 60%|██████    | 29/48 [00:24<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.31it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.32it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.33it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.33it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.31it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.32it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.31it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][10:55:26]: [Client #33] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
{'train_runtime': 39.1623, 'train_samples_per_second': 154.588, 'train_steps_per_second': 1.226, 'train_loss': 2.7703609466552734, 'epoch': 3.0}
[INFO][10:55:26]: [Client #16] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_16_3536584.pth.
{'train_runtime': 39.5439, 'train_samples_per_second': 153.096, 'train_steps_per_second': 1.214, 'train_loss': 3.1413745880126953, 'epoch': 3.0}
[INFO][10:55:27]: [Client #33] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
[INFO][10:55:28]: [Client #16] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_16_3536584.pth.
[INFO][10:55:28]: [Client #33] Model trained.
[INFO][10:55:28]: [Client #33] Inbound data has been processed.
[INFO][10:55:28]: [Client #33] Outbound data is ready to be sent after being processed.
[INFO][10:55:28]: [Client #16] Model trained.
[INFO][10:55:28]: [Client #16] Inbound data has been processed.
[INFO][10:55:28]: [Client #16] Outbound data is ready to be sent after being processed.
[INFO][10:55:36]: [Client #33] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:55:36]: [Client #16] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:55:37]: [Server #3536466] Received 507.38 MB of payload data from client #33 (simulated).
[INFO][10:55:38]: [Server #3536466] Received 507.38 MB of payload data from client #16 (simulated).
[INFO][10:55:38]: [Server #3536466] Selecting client #71 for training.
[INFO][10:55:38]: [Server #3536466] Sending the current model to client #71 (simulated).
[INFO][10:55:42]: [Server #3536466] Sending 507.38 MB of payload data to client #71 (simulated).
[INFO][10:55:42]: [Server #3536466] Selecting client #7 for training.
[INFO][10:55:42]: [Server #3536466] Sending the current model to client #7 (simulated).
[INFO][10:55:47]: [Server #3536466] Sending 507.38 MB of payload data to client #7 (simulated).
[INFO][10:55:47]: [Client #71] Selected by the server.
[INFO][10:55:47]: [Client #7] Selected by the server.
[INFO][10:55:47]: [Client #71] Loading its data source...
[INFO][10:55:47]: [Client #7] Loading its data source...
[INFO][10:55:47]: [Client #71] Dataset size: 2018
[INFO][10:55:47]: [Client #7] Dataset size: 2018
[INFO][10:55:47]: [Client #71] Sampler: iid
[INFO][10:55:47]: [Client #7] Sampler: iid
[INFO][10:55:48]: [Client #7] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:55:48]: [Client #7] Start to process inbound data.
[INFO][10:55:48]: [Client #71] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:55:48]: [Client #71] Start to process inbound data.
[INFO][10:55:49]: [93m[1m[Client #71] Started training in communication round #48.[0m
[INFO][10:55:49]: [93m[1m[Client #7] Started training in communication round #48.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:33,  4.54s/it]  2%|▏         | 1/48 [00:04<03:54,  5.00s/it]  4%|▍         | 2/48 [00:05<01:45,  2.29s/it]  4%|▍         | 2/48 [00:05<01:55,  2.51s/it]  6%|▋         | 3/48 [00:05<01:10,  1.57s/it]  6%|▋         | 3/48 [00:06<01:16,  1.70s/it]  8%|▊         | 4/48 [00:06<00:54,  1.24s/it]  8%|▊         | 4/48 [00:07<00:58,  1.34s/it] 10%|█         | 5/48 [00:07<00:45,  1.06s/it] 10%|█         | 5/48 [00:08<00:47,  1.12s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.05it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.19it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.23it/s] 23%|██▎       | 11/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.29it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:14<00:27,  1.28it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.30it/s] 31%|███▏      | 15/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.30it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.34it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.33it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.34it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.34it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.34it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:19<00:21,  1.33it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:22<00:18,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:26<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.34it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.31it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
[INFO][10:56:35]: [Client #71] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_71_3536584.pth.
{'train_runtime': 39.6176, 'train_samples_per_second': 152.811, 'train_steps_per_second': 1.212, 'train_loss': 2.8230616251627603, 'epoch': 3.0}
[INFO][10:56:36]: [Client #7] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536585.pth.
{'train_runtime': 39.9154, 'train_samples_per_second': 151.671, 'train_steps_per_second': 1.203, 'train_loss': 2.903735796610514, 'epoch': 3.0}
[INFO][10:56:37]: [Client #7] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536585.pth.
[INFO][10:56:37]: [Client #71] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_71_3536584.pth.
[INFO][10:56:38]: [Client #7] Model trained.
[INFO][10:56:38]: [Client #7] Inbound data has been processed.
[INFO][10:56:38]: [Client #7] Outbound data is ready to be sent after being processed.
[INFO][10:56:38]: [Client #71] Model trained.
[INFO][10:56:38]: [Client #71] Inbound data has been processed.
[INFO][10:56:38]: [Client #71] Outbound data is ready to be sent after being processed.
[INFO][10:56:47]: [Client #7] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:56:47]: [Client #71] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:56:48]: [Server #3536466] Received 507.38 MB of payload data from client #7 (simulated).
[INFO][10:56:49]: [Server #3536466] Received 507.38 MB of payload data from client #71 (simulated).
[INFO][10:56:49]: [Server #3536466] Selecting client #77 for training.
[INFO][10:56:49]: [Server #3536466] Sending the current model to client #77 (simulated).
[INFO][10:56:53]: [Server #3536466] Sending 507.38 MB of payload data to client #77 (simulated).
[INFO][10:56:53]: [Client #77] Selected by the server.
[INFO][10:56:53]: [Client #77] Loading its data source...
[INFO][10:56:53]: [Client #77] Dataset size: 2018
[INFO][10:56:53]: [Client #77] Sampler: iid
[INFO][10:56:54]: [Client #77] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:56:54]: [Client #77] Start to process inbound data.
[INFO][10:56:54]: [93m[1m[Client #77] Started training in communication round #48.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.23s/it]  4%|▍         | 2/48 [00:04<01:33,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.42it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.58it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.71it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.79it/s] 21%|██        | 10/48 [00:08<00:20,  1.87it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.92it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.96it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.99it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.01it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.13it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.11it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.10it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.09it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.08it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][10:57:27]: [Client #77] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_77_3536584.pth.
{'train_runtime': 26.7691, 'train_samples_per_second': 226.157, 'train_steps_per_second': 1.793, 'train_loss': 2.780819892883301, 'epoch': 3.0}
[INFO][10:57:28]: [Client #77] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_77_3536584.pth.
[INFO][10:57:29]: [Client #77] Model trained.
[INFO][10:57:29]: [Client #77] Inbound data has been processed.
[INFO][10:57:29]: [Client #77] Outbound data is ready to be sent after being processed.
[INFO][10:57:34]: [Client #77] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:57:35]: [Server #3536466] Received 507.38 MB of payload data from client #77 (simulated).
[INFO][10:57:35]: [Server #3536466] Adding client #74 to the list of clients for aggregation.
[INFO][10:57:35]: [Server #3536466] Adding client #33 to the list of clients for aggregation.
[INFO][10:57:35]: [Server #3536466] Adding client #71 to the list of clients for aggregation.
[INFO][10:57:35]: [Server #3536466] Adding client #7 to the list of clients for aggregation.
[INFO][10:57:35]: [Server #3536466] Adding client #77 to the list of clients for aggregation.
[INFO][10:57:35]: [Server #3536466] Aggregating 5 clients in total.
[INFO][10:57:35]: [Server #3536466] Updated weights have been received.
[INFO][10:57:36]: [Server #3536466] Aggregating model weight deltas.
[INFO][10:57:36]: [Server #3536466] Finished aggregating updated weights.
[INFO][10:57:36]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.8918e+00  1e+02  1e+00  1e+00
 1:  2.7970e+00  1.9116e+00  4e+00  3e-02  3e-02
 2:  2.8967e+00  2.1632e+00  7e-01  5e-06  7e-07
 3:  2.8964e+00  2.8839e+00  1e-02  9e-08  1e-08
 4:  2.8947e+00  2.8911e+00  4e-03  1e-07  2e-08
 5:  2.8928e+00  2.8902e+00  3e-03  1e-06  7e-07
 6:  2.8922e+00  2.8913e+00  9e-04  6e-07  3e-07
 7:  2.8916e+00  2.8913e+00  3e-04  9e-07  5e-07
 8:  2.8913e+00  2.8913e+00  6e-06  2e-07  9e-08
 9:  2.8913e+00  2.8913e+00  8e-08  3e-09  1e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1  1.1  1.1  1.1  1.1  1.1  0.1  1.1  1.1  1.1  5.1  2.1  1.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  1.1  6.1  6.1  6.1  1.1  1.1
 4.1  2.1  6.1  2.1  0.1  2.1  2.1  2.1  1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  1.1  1.1  4.1  1.1  5.1  6.1  0.01 0.01 1.1  1.1  1.1  0.01
 1.1  2.1  1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  2.1  1.1  1.1
 0.1  3.1  6.1  1.1  3.1  1.1  0.1  1.1  2.1  1.1  1.1  2.1  6.1  1.1
 1.1  6.1  6.1  1.1  1.1  6.1  1.1  3.1  3.1  1.1  1.1  2.1  1.1  5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.84it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.35it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.95it/s]100%|██████████| 8/8 [00:00<00:00, 11.76it/s]
[INFO][10:57:47]: [93m[1m[Server #3536466] Global model perplexity: 23.56
[0m
[INFO][10:57:47]: [Server #3536466] All client reports have been processed.
[INFO][10:57:47]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_48.pth.
[INFO][10:57:50]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_48.pth.
[INFO][10:57:50]: [93m[1m
[Server #3536466] Starting round 49/100.[0m
[INFO][10:57:50]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([5.54803097e-07, 5.54803097e-07, 5.54803097e-07, 5.54803097e-07,
       5.54803097e-07, 5.54803097e-07, 2.49992757e-01, 5.54803097e-07,
       5.54803097e-07, 5.54803097e-07, 9.31518135e-09, 7.01227197e-08,
       5.54803097e-07, 5.54803097e-07, 7.01227197e-08, 5.54803097e-07,
       5.54803097e-07, 7.01227197e-08, 2.70627708e-08, 5.54803097e-07,
       6.51315368e-09, 5.54803097e-07, 6.51315368e-09, 6.51315368e-09,
       6.51315368e-09, 5.54803097e-07, 5.54803097e-07, 1.46539317e-08,
       7.01227197e-08, 6.51315368e-09, 7.01227197e-08, 2.49992757e-01,
       7.01227197e-08, 7.01227197e-08, 7.01227197e-08, 5.54803097e-07,
       5.54803097e-07, 6.51315368e-09, 9.31518135e-09, 5.54803097e-07,
       5.54803097e-07, 5.54803097e-07, 9.31518135e-09, 5.54803097e-07,
       5.54803097e-07, 1.46539317e-08, 5.54803097e-07, 9.31518135e-09,
       6.51315368e-09, 5.54803097e-07, 5.54803097e-07, 5.54803097e-07,
       5.54803097e-07, 5.54803097e-07, 5.54803097e-07, 5.54803097e-07,
       5.54803097e-07, 2.70627708e-08, 9.31518135e-09, 2.70627708e-08,
       5.54803097e-07, 2.70627708e-08, 7.01227197e-08, 5.54803097e-07,
       5.54803097e-07, 2.49992757e-01, 2.70627708e-08, 6.51315368e-09,
       5.54803097e-07, 2.70627708e-08, 5.54803097e-07, 2.49992757e-01,
       5.54803097e-07, 7.01227197e-08, 5.54803097e-07, 5.54803097e-07,
       7.01227197e-08, 6.51315368e-09, 5.54803097e-07, 5.54803097e-07,
       6.51315368e-09, 6.51315368e-09, 5.54803097e-07, 5.54803097e-07,
       6.51315368e-09, 5.54803097e-07, 2.70627708e-08, 2.70627708e-08,
       5.54803097e-07, 5.54803097e-07, 7.01227197e-08, 5.54803097e-07,
       9.31518135e-09, 9.31518135e-09, 5.54803097e-07]),)
[INFO][10:57:51]: [Server #3536466] Selected clients: [ 7 33 77 71  9]
[INFO][10:57:51]: [Server #3536466] Selecting client #33 for training.
[INFO][10:57:51]: [Server #3536466] Sending the current model to client #33 (simulated).
[INFO][10:57:55]: [Server #3536466] Sending 507.38 MB of payload data to client #33 (simulated).
[INFO][10:57:55]: [Server #3536466] Selecting client #7 for training.
[INFO][10:57:55]: [Server #3536466] Sending the current model to client #7 (simulated).
[INFO][10:58:00]: [Server #3536466] Sending 507.38 MB of payload data to client #7 (simulated).
[INFO][10:58:00]: [Client #33] Selected by the server.
[INFO][10:58:00]: [Client #33] Loading its data source...
[INFO][10:58:00]: [Client #7] Selected by the server.
[INFO][10:58:00]: [Client #7] Loading its data source...
[INFO][10:58:00]: [Client #33] Dataset size: 2018
[INFO][10:58:00]: [Client #33] Sampler: iid
[INFO][10:58:00]: [Client #7] Dataset size: 2018
[INFO][10:58:00]: [Client #7] Sampler: iid
[INFO][10:58:01]: [Client #33] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:58:01]: [Client #33] Start to process inbound data.
[INFO][10:58:01]: [Client #7] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:58:01]: [Client #7] Start to process inbound data.
[INFO][10:58:02]: [93m[1m[Client #7] Started training in communication round #49.[0m
[INFO][10:58:02]: [93m[1m[Client #33] Started training in communication round #49.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:47,  4.84s/it]  2%|▏         | 1/48 [00:04<03:50,  4.91s/it]  4%|▍         | 2/48 [00:05<01:52,  2.44s/it]  4%|▍         | 2/48 [00:05<01:54,  2.49s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it]  6%|▋         | 3/48 [00:06<01:16,  1.70s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it]  8%|▊         | 4/48 [00:07<00:58,  1.32s/it] 10%|█         | 5/48 [00:07<00:47,  1.09s/it] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.16it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:18,  1.32it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.31it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.31it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.30it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][10:58:48]: [Client #7] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536585.pth.
{'train_runtime': 39.7764, 'train_samples_per_second': 152.201, 'train_steps_per_second': 1.207, 'train_loss': 2.771528879801432, 'epoch': 3.0}
[INFO][10:58:48]: [Client #33] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536584.pth.
{'train_runtime': 39.6795, 'train_samples_per_second': 152.573, 'train_steps_per_second': 1.21, 'train_loss': 2.670400619506836, 'epoch': 3.0}
[INFO][10:58:49]: [Client #7] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536585.pth.
[INFO][10:58:49]: [Client #7] Model trained.
[INFO][10:58:49]: [Client #7] Inbound data has been processed.
[INFO][10:58:49]: [Client #7] Outbound data is ready to be sent after being processed.
[INFO][10:58:50]: [Client #33] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536584.pth.
[INFO][10:58:50]: [Client #33] Model trained.
[INFO][10:58:50]: [Client #33] Inbound data has been processed.
[INFO][10:58:50]: [Client #33] Outbound data is ready to be sent after being processed.
[INFO][10:58:57]: [Client #7] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:58:58]: [Server #3536466] Received 507.38 MB of payload data from client #7 (simulated).
[INFO][10:58:58]: [Client #33] Sent 507.38 MB of payload data to the server (simulated).
[INFO][10:58:59]: [Server #3536466] Received 507.38 MB of payload data from client #33 (simulated).
[INFO][10:58:59]: [Server #3536466] Selecting client #71 for training.
[INFO][10:58:59]: [Server #3536466] Sending the current model to client #71 (simulated).
[INFO][10:59:04]: [Server #3536466] Sending 507.38 MB of payload data to client #71 (simulated).
[INFO][10:59:04]: [Server #3536466] Selecting client #9 for training.
[INFO][10:59:04]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][10:59:08]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][10:59:08]: [Client #71] Selected by the server.
[INFO][10:59:08]: [Client #9] Selected by the server.
[INFO][10:59:08]: [Client #9] Loading its data source...
[INFO][10:59:08]: [Client #71] Loading its data source...
[INFO][10:59:08]: [Client #9] Dataset size: 2018
[INFO][10:59:08]: [Client #71] Dataset size: 2018
[INFO][10:59:08]: [Client #9] Sampler: iid
[INFO][10:59:08]: [Client #71] Sampler: iid
[INFO][10:59:10]: [Client #71] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:59:10]: [Client #71] Start to process inbound data.
[INFO][10:59:10]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][10:59:10]: [Client #9] Start to process inbound data.
[INFO][10:59:10]: [93m[1m[Client #71] Started training in communication round #49.[0m
[INFO][10:59:10]: [93m[1m[Client #9] Started training in communication round #49.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:48,  4.86s/it]  2%|▏         | 1/48 [00:04<03:50,  4.90s/it]  4%|▍         | 2/48 [00:05<01:52,  2.45s/it]  4%|▍         | 2/48 [00:05<01:54,  2.49s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it]  6%|▋         | 3/48 [00:06<01:16,  1.69s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it]  8%|▊         | 4/48 [00:07<00:57,  1.32s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][10:59:56]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.7345, 'train_samples_per_second': 152.361, 'train_steps_per_second': 1.208, 'train_loss': 2.2406460444132485, 'epoch': 3.0}
[INFO][10:59:57]: [Client #71] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_71_3536584.pth.
{'train_runtime': 39.6375, 'train_samples_per_second': 152.734, 'train_steps_per_second': 1.211, 'train_loss': 2.7195510864257812, 'epoch': 3.0}
[INFO][10:59:57]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][10:59:58]: [Client #71] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_71_3536584.pth.
[INFO][10:59:58]: [Client #9] Model trained.
[INFO][10:59:58]: [Client #9] Inbound data has been processed.
[INFO][10:59:58]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][10:59:58]: [Client #71] Model trained.
[INFO][10:59:58]: [Client #71] Inbound data has been processed.
[INFO][10:59:58]: [Client #71] Outbound data is ready to be sent after being processed.
[INFO][11:00:07]: [Client #71] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:00:07]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:00:07]: [Server #3536466] Received 507.38 MB of payload data from client #71 (simulated).
[INFO][11:00:08]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][11:00:08]: [Server #3536466] Selecting client #77 for training.
[INFO][11:00:08]: [Server #3536466] Sending the current model to client #77 (simulated).
[INFO][11:00:13]: [Server #3536466] Sending 507.38 MB of payload data to client #77 (simulated).
[INFO][11:00:13]: [Client #77] Selected by the server.
[INFO][11:00:13]: [Client #77] Loading its data source...
[INFO][11:00:13]: [Client #77] Dataset size: 2018
[INFO][11:00:13]: [Client #77] Sampler: iid
[INFO][11:00:14]: [Client #77] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:00:14]: [Client #77] Start to process inbound data.
[INFO][11:00:15]: [93m[1m[Client #77] Started training in communication round #49.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.19s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:58,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.25it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.61it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.71it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.80it/s] 21%|██        | 10/48 [00:08<00:20,  1.87it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.92it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.96it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.98it/s] 29%|██▉       | 14/48 [00:10<00:17,  2.00it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.13it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.10it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.09it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.08it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.07it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.07it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.06it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.06it/s] 50%|█████     | 24/48 [00:15<00:11,  2.05it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.05it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.05it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.05it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.05it/s] 60%|██████    | 29/48 [00:17<00:09,  2.05it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.05it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.05it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.15it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.12it/s] 71%|███████   | 34/48 [00:20<00:06,  2.10it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.08it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.07it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.06it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.06it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.06it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.05it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.05it/s] 88%|████████▊ | 42/48 [00:24<00:02,  2.05it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.05it/s] 92%|█████████▏| 44/48 [00:25<00:01,  2.05it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.05it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.05it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.05it/s]100%|██████████| 48/48 [00:26<00:00,  2.15it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.15it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][11:00:48]: [Client #77] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_77_3536584.pth.
{'train_runtime': 26.8818, 'train_samples_per_second': 225.208, 'train_steps_per_second': 1.786, 'train_loss': 2.6745389302571616, 'epoch': 3.0}
[INFO][11:00:49]: [Client #77] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_77_3536584.pth.
[INFO][11:00:49]: [Client #77] Model trained.
[INFO][11:00:49]: [Client #77] Inbound data has been processed.
[INFO][11:00:49]: [Client #77] Outbound data is ready to be sent after being processed.
[INFO][11:00:54]: [Client #77] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:00:55]: [Server #3536466] Received 507.38 MB of payload data from client #77 (simulated).
[INFO][11:00:55]: [Server #3536466] Adding client #16 to the list of clients for aggregation.
[INFO][11:00:55]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][11:00:55]: [Server #3536466] Adding client #33 to the list of clients for aggregation.
[INFO][11:00:55]: [Server #3536466] Adding client #71 to the list of clients for aggregation.
[INFO][11:00:55]: [Server #3536466] Adding client #7 to the list of clients for aggregation.
[INFO][11:00:55]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:00:55]: [Server #3536466] Updated weights have been received.
[INFO][11:00:56]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:00:56]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:00:56]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.8904e+00  1e+02  1e+00  1e+00
 1:  2.7955e+00  1.9102e+00  4e+00  3e-02  3e-02
 2:  2.8954e+00  2.1616e+00  7e-01  5e-06  7e-07
 3:  2.8950e+00  2.8826e+00  1e-02  9e-08  1e-08
 4:  2.8933e+00  2.8898e+00  3e-03  1e-07  2e-08
 5:  2.8913e+00  2.8889e+00  2e-03  1e-06  6e-07
 6:  2.8907e+00  2.8899e+00  8e-04  5e-07  2e-07
 7:  2.8902e+00  2.8899e+00  2e-04  6e-07  3e-07
 8:  2.8900e+00  2.8899e+00  4e-06  8e-08  4e-08
 9:  2.8899e+00  2.8899e+00  5e-08  1e-09  5e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1  1.1  1.1  1.1  1.1  1.1  0.1  1.1  0.1  1.1  5.1  2.1  1.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  1.1  6.1  6.1  6.1  1.1  1.1
 4.1  2.1  6.1  2.1  0.1  2.1  2.1  2.1  1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  1.1  1.1  4.1  1.1  5.1  6.1  0.01 0.01 1.1  1.1  1.1  0.01
 1.1  2.1  1.1  1.1  1.1  1.1  3.1  5.1  3.1  1.1  3.1  2.1  1.1  1.1
 0.1  3.1  6.1  1.1  3.1  1.1  0.1  1.1  2.1  1.1  1.1  2.1  6.1  1.1
 1.1  6.1  6.1  1.1  1.1  6.1  1.1  3.1  3.1  1.1  1.1  2.1  1.1  5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.20it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.40it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.79it/s]100%|██████████| 8/8 [00:00<00:00, 11.65it/s]
[INFO][11:01:07]: [93m[1m[Server #3536466] Global model perplexity: 25.95
[0m
[INFO][11:01:07]: [Server #3536466] All client reports have been processed.
[INFO][11:01:07]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_49.pth.
[INFO][11:01:11]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_49.pth.
[INFO][11:01:11]: [93m[1m
[Server #3536466] Starting round 50/100.[0m
[INFO][11:01:11]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([5.54803097e-07, 5.54803097e-07, 5.54803097e-07, 5.54803097e-07,
       5.54803097e-07, 5.54803097e-07, 2.49992757e-01, 5.54803097e-07,
       2.49992757e-01, 5.54803097e-07, 9.31518135e-09, 7.01227197e-08,
       5.54803097e-07, 5.54803097e-07, 7.01227197e-08, 5.54803097e-07,
       5.54803097e-07, 5.54803097e-07, 7.01227197e-08, 2.70627708e-08,
       5.54803097e-07, 6.51315368e-09, 5.54803097e-07, 6.51315368e-09,
       6.51315368e-09, 6.51315368e-09, 5.54803097e-07, 5.54803097e-07,
       1.46539317e-08, 7.01227197e-08, 6.51315368e-09, 7.01227197e-08,
       2.49992757e-01, 7.01227197e-08, 7.01227197e-08, 7.01227197e-08,
       5.54803097e-07, 5.54803097e-07, 6.51315368e-09, 9.31518135e-09,
       5.54803097e-07, 5.54803097e-07, 5.54803097e-07, 9.31518135e-09,
       5.54803097e-07, 5.54803097e-07, 1.46539317e-08, 5.54803097e-07,
       9.31518135e-09, 6.51315368e-09, 5.54803097e-07, 5.54803097e-07,
       5.54803097e-07, 5.54803097e-07, 5.54803097e-07, 5.54803097e-07,
       5.54803097e-07, 5.54803097e-07, 2.70627708e-08, 9.31518135e-09,
       2.70627708e-08, 5.54803097e-07, 2.70627708e-08, 7.01227197e-08,
       5.54803097e-07, 5.54803097e-07, 2.49992757e-01, 2.70627708e-08,
       6.51315368e-09, 5.54803097e-07, 2.70627708e-08, 5.54803097e-07,
       5.54803097e-07, 7.01227197e-08, 5.54803097e-07, 5.54803097e-07,
       7.01227197e-08, 6.51315368e-09, 5.54803097e-07, 5.54803097e-07,
       6.51315368e-09, 6.51315368e-09, 5.54803097e-07, 5.54803097e-07,
       6.51315368e-09, 5.54803097e-07, 2.70627708e-08, 2.70627708e-08,
       5.54803097e-07, 5.54803097e-07, 7.01227197e-08, 5.54803097e-07,
       9.31518135e-09, 9.31518135e-09, 5.54803097e-07]),)
[INFO][11:01:11]: [Server #3536466] Selected clients: [ 9 33 71  7 66]
[INFO][11:01:11]: [Server #3536466] Selecting client #66 for training.
[INFO][11:01:11]: [Server #3536466] Sending the current model to client #66 (simulated).
[INFO][11:01:16]: [Server #3536466] Sending 507.38 MB of payload data to client #66 (simulated).
[INFO][11:01:16]: [Server #3536466] Selecting client #33 for training.
[INFO][11:01:16]: [Server #3536466] Sending the current model to client #33 (simulated).
[INFO][11:01:20]: [Server #3536466] Sending 507.38 MB of payload data to client #33 (simulated).
[INFO][11:01:20]: [Client #66] Selected by the server.
[INFO][11:01:20]: [Client #66] Loading its data source...
[INFO][11:01:20]: [Client #66] Dataset size: 2018
[INFO][11:01:20]: [Client #66] Sampler: iid
[INFO][11:01:20]: [Client #33] Selected by the server.
[INFO][11:01:20]: [Client #33] Loading its data source...
[INFO][11:01:20]: [Client #33] Dataset size: 2018
[INFO][11:01:20]: [Client #33] Sampler: iid
[INFO][11:01:22]: [Client #33] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:01:22]: [Client #33] Start to process inbound data.
[INFO][11:01:22]: [Client #66] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:01:22]: [Client #66] Start to process inbound data.
[INFO][11:01:23]: [93m[1m[Client #33] Started training in communication round #50.[0m
[INFO][11:01:23]: [93m[1m[Client #66] Started training in communication round #50.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:46,  4.82s/it]  2%|▏         | 1/48 [00:04<03:50,  4.90s/it]  4%|▍         | 2/48 [00:05<01:51,  2.43s/it]  4%|▍         | 2/48 [00:05<01:54,  2.49s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  6%|▋         | 3/48 [00:06<01:16,  1.69s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it]  8%|▊         | 4/48 [00:07<00:57,  1.31s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:16,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][11:02:08]: [Client #66] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
{'train_runtime': 39.4781, 'train_samples_per_second': 153.351, 'train_steps_per_second': 1.216, 'train_loss': 3.064016660054525, 'epoch': 3.0}
[INFO][11:02:08]: [Client #33] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
{'train_runtime': 39.6059, 'train_samples_per_second': 152.856, 'train_steps_per_second': 1.212, 'train_loss': 2.570094426472982, 'epoch': 3.0}
[INFO][11:02:09]: [Client #33] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
[INFO][11:02:10]: [Client #66] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
[INFO][11:02:10]: [Client #33] Model trained.
[INFO][11:02:10]: [Client #33] Inbound data has been processed.
[INFO][11:02:10]: [Client #33] Outbound data is ready to be sent after being processed.
[INFO][11:02:10]: [Client #66] Model trained.
[INFO][11:02:10]: [Client #66] Inbound data has been processed.
[INFO][11:02:10]: [Client #66] Outbound data is ready to be sent after being processed.
[INFO][11:02:19]: [Client #66] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:02:19]: [Client #33] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:02:20]: [Server #3536466] Received 507.38 MB of payload data from client #66 (simulated).
[INFO][11:02:21]: [Server #3536466] Received 507.38 MB of payload data from client #33 (simulated).
[INFO][11:02:21]: [Server #3536466] Selecting client #71 for training.
[INFO][11:02:21]: [Server #3536466] Sending the current model to client #71 (simulated).
[INFO][11:02:26]: [Server #3536466] Sending 507.38 MB of payload data to client #71 (simulated).
[INFO][11:02:26]: [Server #3536466] Selecting client #7 for training.
[INFO][11:02:26]: [Server #3536466] Sending the current model to client #7 (simulated).
[INFO][11:02:30]: [Server #3536466] Sending 507.38 MB of payload data to client #7 (simulated).
[INFO][11:02:30]: [Client #71] Selected by the server.
[INFO][11:02:30]: [Client #71] Loading its data source...
[INFO][11:02:30]: [Client #71] Dataset size: 2018
[INFO][11:02:30]: [Client #71] Sampler: iid
[INFO][11:02:30]: [Client #7] Selected by the server.
[INFO][11:02:30]: [Client #7] Loading its data source...
[INFO][11:02:30]: [Client #7] Dataset size: 2018
[INFO][11:02:30]: [Client #7] Sampler: iid
[INFO][11:02:32]: [Client #71] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:02:32]: [Client #71] Start to process inbound data.
[INFO][11:02:32]: [Client #7] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:02:32]: [Client #7] Start to process inbound data.
[INFO][11:02:32]: [93m[1m[Client #71] Started training in communication round #50.[0m
[INFO][11:02:33]: [93m[1m[Client #7] Started training in communication round #50.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:54,  4.99s/it]  2%|▏         | 1/48 [00:05<03:55,  5.00s/it]  4%|▍         | 2/48 [00:05<01:58,  2.57s/it]  4%|▍         | 2/48 [00:05<01:59,  2.60s/it]  6%|▋         | 3/48 [00:06<01:19,  1.76s/it]  6%|▋         | 3/48 [00:06<01:20,  1.78s/it]  8%|▊         | 4/48 [00:07<00:59,  1.35s/it]  8%|▊         | 4/48 [00:07<01:00,  1.38s/it] 10%|█         | 5/48 [00:08<00:48,  1.13s/it] 10%|█         | 5/48 [00:08<00:49,  1.15s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 12%|█▎        | 6/48 [00:08<00:42,  1.01s/it] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.16it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.20it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.20it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:26<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.31it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
100%|██████████| 48/48 [00:40<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.40it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
[INFO][11:03:19]: [Client #71] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_71_3536584.pth.
{'train_runtime': 40.0391, 'train_samples_per_second': 151.202, 'train_steps_per_second': 1.199, 'train_loss': 2.618905544281006, 'epoch': 3.0}
[INFO][11:03:19]: [Client #7] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536585.pth.
{'train_runtime': 39.9448, 'train_samples_per_second': 151.559, 'train_steps_per_second': 1.202, 'train_loss': 2.6751991907755532, 'epoch': 3.0}
[INFO][11:03:20]: [Client #71] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_71_3536584.pth.
[INFO][11:03:20]: [Client #7] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536585.pth.
[INFO][11:03:20]: [Client #71] Model trained.
[INFO][11:03:20]: [Client #71] Inbound data has been processed.
[INFO][11:03:20]: [Client #71] Outbound data is ready to be sent after being processed.
[INFO][11:03:21]: [Client #7] Model trained.
[INFO][11:03:21]: [Client #7] Inbound data has been processed.
[INFO][11:03:21]: [Client #7] Outbound data is ready to be sent after being processed.
[INFO][11:03:29]: [Client #71] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:03:29]: [Client #7] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:03:30]: [Server #3536466] Received 507.38 MB of payload data from client #71 (simulated).
[INFO][11:03:31]: [Server #3536466] Received 507.38 MB of payload data from client #7 (simulated).
[INFO][11:03:31]: [Server #3536466] Selecting client #9 for training.
[INFO][11:03:31]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][11:03:36]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][11:03:36]: [Client #9] Selected by the server.
[INFO][11:03:36]: [Client #9] Loading its data source...
[INFO][11:03:36]: [Client #9] Dataset size: 2018
[INFO][11:03:36]: [Client #9] Sampler: iid
[INFO][11:03:37]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:03:37]: [Client #9] Start to process inbound data.
[INFO][11:03:38]: [93m[1m[Client #9] Started training in communication round #50.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:15,  4.16s/it]  4%|▍         | 2/48 [00:04<01:31,  2.00s/it]  6%|▋         | 3/48 [00:05<00:59,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.02it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.12it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.13it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.06it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.04it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.05it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.06it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][11:04:10]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
{'train_runtime': 26.622, 'train_samples_per_second': 227.406, 'train_steps_per_second': 1.803, 'train_loss': 2.123468557993571, 'epoch': 3.0}
[INFO][11:04:12]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
[INFO][11:04:12]: [Client #9] Model trained.
[INFO][11:04:12]: [Client #9] Inbound data has been processed.
[INFO][11:04:12]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][11:04:17]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:04:18]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][11:04:18]: [Server #3536466] Adding client #77 to the list of clients for aggregation.
[INFO][11:04:18]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][11:04:18]: [Server #3536466] Adding client #33 to the list of clients for aggregation.
[INFO][11:04:18]: [Server #3536466] Adding client #66 to the list of clients for aggregation.
[INFO][11:04:18]: [Server #3536466] Adding client #71 to the list of clients for aggregation.
[INFO][11:04:18]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:04:18]: [Server #3536466] Updated weights have been received.
[INFO][11:04:19]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:04:19]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:04:19]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.8904e+00  1e+02  1e+00  1e+00
 1:  2.7955e+00  1.9102e+00  4e+00  3e-02  3e-02
 2:  2.8954e+00  2.1616e+00  7e-01  5e-06  7e-07
 3:  2.8950e+00  2.8826e+00  1e-02  9e-08  1e-08
 4:  2.8933e+00  2.8898e+00  3e-03  1e-07  2e-08
 5:  2.8913e+00  2.8889e+00  2e-03  1e-06  6e-07
 6:  2.8907e+00  2.8899e+00  8e-04  5e-07  2e-07
 7:  2.8902e+00  2.8899e+00  2e-04  6e-07  3e-07
 8:  2.8900e+00  2.8899e+00  4e-06  8e-08  4e-08
 9:  2.8899e+00  2.8899e+00  5e-08  1e-09  5e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1  1.1  1.1  1.1  1.1  1.1  0.1  1.1  0.1  1.1  5.1  2.1  1.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  1.1  6.1  6.1  6.1  1.1  1.1
 4.1  2.1  6.1  2.1  0.1  2.1  2.1  2.1  1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  1.1  1.1  4.1  1.1  5.1  6.1  0.01 0.01 1.1  1.1  1.1  0.01
 1.1  2.1  1.1  1.1  1.1  1.1  3.1  5.1  3.1  0.1  3.1  2.1  1.1  1.1
 0.1  3.1  6.1  1.1  3.1  1.1  1.1  1.1  2.1  1.1  1.1  2.1  6.1  1.1
 1.1  6.1  6.1  1.1  1.1  6.1  1.1  3.1  3.1  1.1  1.1  2.1  1.1  5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.01 0.2  0.2  0.2  0.01
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.14it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.40it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.75it/s]100%|██████████| 8/8 [00:00<00:00, 11.66it/s]
[INFO][11:04:30]: [93m[1m[Server #3536466] Global model perplexity: 26.53
[0m
[INFO][11:04:30]: [Server #3536466] All client reports have been processed.
[INFO][11:04:30]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_50.pth.
[INFO][11:04:33]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_50.pth.
[INFO][11:04:33]: [93m[1m
[Server #3536466] Starting round 51/100.[0m
[INFO][11:04:33]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([5.54803097e-07, 5.54803097e-07, 5.54803097e-07, 5.54803097e-07,
       5.54803097e-07, 5.54803097e-07, 5.54803097e-07, 2.49992757e-01,
       5.54803097e-07, 9.31518135e-09, 7.01227197e-08, 5.54803097e-07,
       5.54803097e-07, 7.01227197e-08, 5.54803097e-07, 5.54803097e-07,
       5.54803097e-07, 7.01227197e-08, 2.70627708e-08, 5.54803097e-07,
       6.51315368e-09, 5.54803097e-07, 6.51315368e-09, 6.51315368e-09,
       6.51315368e-09, 5.54803097e-07, 5.54803097e-07, 1.46539317e-08,
       7.01227197e-08, 6.51315368e-09, 7.01227197e-08, 2.49992757e-01,
       7.01227197e-08, 7.01227197e-08, 7.01227197e-08, 5.54803097e-07,
       5.54803097e-07, 6.51315368e-09, 9.31518135e-09, 5.54803097e-07,
       5.54803097e-07, 5.54803097e-07, 9.31518135e-09, 5.54803097e-07,
       5.54803097e-07, 1.46539317e-08, 5.54803097e-07, 9.31518135e-09,
       6.51315368e-09, 5.54803097e-07, 5.54803097e-07, 5.54803097e-07,
       5.54803097e-07, 5.54803097e-07, 5.54803097e-07, 5.54803097e-07,
       5.54803097e-07, 2.70627708e-08, 9.31518135e-09, 2.70627708e-08,
       2.49992757e-01, 2.70627708e-08, 7.01227197e-08, 5.54803097e-07,
       5.54803097e-07, 2.49992757e-01, 2.70627708e-08, 6.51315368e-09,
       5.54803097e-07, 2.70627708e-08, 5.54803097e-07, 5.54803097e-07,
       5.54803097e-07, 7.01227197e-08, 5.54803097e-07, 5.54803097e-07,
       7.01227197e-08, 6.51315368e-09, 5.54803097e-07, 5.54803097e-07,
       6.51315368e-09, 6.51315368e-09, 5.54803097e-07, 5.54803097e-07,
       6.51315368e-09, 5.54803097e-07, 2.70627708e-08, 2.70627708e-08,
       5.54803097e-07, 5.54803097e-07, 7.01227197e-08, 5.54803097e-07,
       9.31518135e-09, 9.31518135e-09, 5.54803097e-07]),)
[INFO][11:04:33]: [Server #3536466] Selected clients: [ 9 33 66 71 45]
[INFO][11:04:33]: [Server #3536466] Selecting client #66 for training.
[INFO][11:04:33]: [Server #3536466] Sending the current model to client #66 (simulated).
[INFO][11:04:38]: [Server #3536466] Sending 507.38 MB of payload data to client #66 (simulated).
[INFO][11:04:38]: [Server #3536466] Selecting client #33 for training.
[INFO][11:04:38]: [Server #3536466] Sending the current model to client #33 (simulated).
[INFO][11:04:43]: [Server #3536466] Sending 507.38 MB of payload data to client #33 (simulated).
[INFO][11:04:43]: [Client #66] Selected by the server.
[INFO][11:04:43]: [Client #66] Loading its data source...
[INFO][11:04:43]: [Client #66] Dataset size: 2018
[INFO][11:04:43]: [Client #66] Sampler: iid
[INFO][11:04:43]: [Client #33] Selected by the server.
[INFO][11:04:43]: [Client #33] Loading its data source...
[INFO][11:04:43]: [Client #33] Dataset size: 2018
[INFO][11:04:43]: [Client #33] Sampler: iid
[INFO][11:04:44]: [Client #66] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:04:44]: [Client #66] Start to process inbound data.
[INFO][11:04:44]: [Client #33] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:04:44]: [Client #33] Start to process inbound data.
[INFO][11:04:45]: [93m[1m[Client #66] Started training in communication round #51.[0m
[INFO][11:04:45]: [93m[1m[Client #33] Started training in communication round #51.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:31,  4.50s/it]  2%|▏         | 1/48 [00:05<03:56,  5.03s/it]  4%|▍         | 2/48 [00:05<01:44,  2.28s/it]  4%|▍         | 2/48 [00:05<01:56,  2.52s/it]  6%|▋         | 3/48 [00:05<01:10,  1.57s/it]  6%|▋         | 3/48 [00:06<01:17,  1.73s/it]  8%|▊         | 4/48 [00:06<00:54,  1.24s/it]  8%|▊         | 4/48 [00:07<00:58,  1.33s/it] 10%|█         | 5/48 [00:07<00:45,  1.06s/it] 10%|█         | 5/48 [00:08<00:48,  1.12s/it] 12%|█▎        | 6/48 [00:08<00:39,  1.05it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.14it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.16it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.28it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.36it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.35it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.35it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][11:05:31]: [Client #66] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
{'train_runtime': 39.2465, 'train_samples_per_second': 154.256, 'train_steps_per_second': 1.223, 'train_loss': 2.9686806996663413, 'epoch': 3.0}
[INFO][11:05:31]: [Client #33] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
{'train_runtime': 39.6087, 'train_samples_per_second': 152.845, 'train_steps_per_second': 1.212, 'train_loss': 2.482292334238688, 'epoch': 3.0}
[INFO][11:05:32]: [Client #66] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
[INFO][11:05:32]: [Client #33] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
[INFO][11:05:33]: [Client #33] Model trained.
[INFO][11:05:33]: [Client #33] Inbound data has been processed.
[INFO][11:05:33]: [Client #33] Outbound data is ready to be sent after being processed.
[INFO][11:05:33]: [Client #66] Model trained.
[INFO][11:05:33]: [Client #66] Inbound data has been processed.
[INFO][11:05:33]: [Client #66] Outbound data is ready to be sent after being processed.
[INFO][11:05:42]: [Client #33] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:05:42]: [Client #66] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:05:43]: [Server #3536466] Received 507.38 MB of payload data from client #33 (simulated).
[INFO][11:05:44]: [Server #3536466] Received 507.38 MB of payload data from client #66 (simulated).
[INFO][11:05:44]: [Server #3536466] Selecting client #71 for training.
[INFO][11:05:44]: [Server #3536466] Sending the current model to client #71 (simulated).
[INFO][11:05:49]: [Server #3536466] Sending 507.38 MB of payload data to client #71 (simulated).
[INFO][11:05:49]: [Server #3536466] Selecting client #9 for training.
[INFO][11:05:49]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][11:05:53]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][11:05:53]: [Client #71] Selected by the server.
[INFO][11:05:53]: [Client #71] Loading its data source...
[INFO][11:05:53]: [Client #9] Selected by the server.
[INFO][11:05:53]: [Client #71] Dataset size: 2018
[INFO][11:05:53]: [Client #71] Sampler: iid
[INFO][11:05:53]: [Client #9] Loading its data source...
[INFO][11:05:53]: [Client #9] Dataset size: 2018
[INFO][11:05:53]: [Client #9] Sampler: iid
[INFO][11:05:55]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:05:55]: [Client #9] Start to process inbound data.
[INFO][11:05:55]: [Client #71] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:05:55]: [Client #71] Start to process inbound data.
[INFO][11:05:56]: [93m[1m[Client #9] Started training in communication round #51.[0m
[INFO][11:05:56]: [93m[1m[Client #71] Started training in communication round #51.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:40,  4.68s/it]  2%|▏         | 1/48 [00:04<03:43,  4.76s/it]  4%|▍         | 2/48 [00:05<01:48,  2.36s/it]  4%|▍         | 2/48 [00:05<01:50,  2.39s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.32it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 71%|███████   | 34/48 [00:29<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.38it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.30it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][11:06:41]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.4932, 'train_samples_per_second': 153.292, 'train_steps_per_second': 1.215, 'train_loss': 2.0619104703267417, 'epoch': 3.0}
[INFO][11:06:41]: [Client #71] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_71_3536584.pth.
{'train_runtime': 39.4652, 'train_samples_per_second': 153.401, 'train_steps_per_second': 1.216, 'train_loss': 2.5329524676005044, 'epoch': 3.0}
[INFO][11:06:42]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][11:06:43]: [Client #71] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_71_3536584.pth.
[INFO][11:06:43]: [Client #9] Model trained.
[INFO][11:06:43]: [Client #9] Inbound data has been processed.
[INFO][11:06:43]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][11:06:44]: [Client #71] Model trained.
[INFO][11:06:44]: [Client #71] Inbound data has been processed.
[INFO][11:06:44]: [Client #71] Outbound data is ready to be sent after being processed.
[INFO][11:06:51]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:06:52]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][11:06:52]: [Client #71] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:06:53]: [Server #3536466] Received 507.38 MB of payload data from client #71 (simulated).
[INFO][11:06:53]: [Server #3536466] Selecting client #45 for training.
[INFO][11:06:53]: [Server #3536466] Sending the current model to client #45 (simulated).
[INFO][11:06:58]: [Server #3536466] Sending 507.38 MB of payload data to client #45 (simulated).
[INFO][11:06:58]: [Client #45] Selected by the server.
[INFO][11:06:58]: [Client #45] Loading its data source...
[INFO][11:06:58]: [Client #45] Dataset size: 2018
[INFO][11:06:58]: [Client #45] Sampler: iid
[INFO][11:06:59]: [Client #45] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:06:59]: [Client #45] Start to process inbound data.
[INFO][11:06:59]: [93m[1m[Client #45] Started training in communication round #51.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.18s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:09<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.12it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.08it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][11:07:32]: [Client #45] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_45_3536584.pth.
{'train_runtime': 26.6203, 'train_samples_per_second': 227.421, 'train_steps_per_second': 1.803, 'train_loss': 2.8141581217447915, 'epoch': 3.0}
[INFO][11:07:33]: [Client #45] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_45_3536584.pth.
[INFO][11:07:33]: [Client #45] Model trained.
[INFO][11:07:33]: [Client #45] Inbound data has been processed.
[INFO][11:07:33]: [Client #45] Outbound data is ready to be sent after being processed.
[INFO][11:07:38]: [Client #45] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:07:40]: [Server #3536466] Received 507.38 MB of payload data from client #45 (simulated).
[INFO][11:07:40]: [Server #3536466] Adding client #7 to the list of clients for aggregation.
[INFO][11:07:40]: [Server #3536466] Adding client #56 to the list of clients for aggregation.
[INFO][11:07:40]: [Server #3536466] Adding client #52 to the list of clients for aggregation.
[INFO][11:07:40]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][11:07:40]: [Server #3536466] Adding client #33 to the list of clients for aggregation.
[INFO][11:07:40]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:07:40]: [Server #3536466] Updated weights have been received.
[INFO][11:07:40]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:07:40]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:07:40]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.8904e+00  1e+02  1e+00  1e+00
 1:  2.7955e+00  1.9102e+00  4e+00  3e-02  3e-02
 2:  2.8954e+00  2.1616e+00  7e-01  5e-06  7e-07
 3:  2.8950e+00  2.8826e+00  1e-02  9e-08  1e-08
 4:  2.8933e+00  2.8898e+00  3e-03  1e-07  2e-08
 5:  2.8913e+00  2.8889e+00  2e-03  1e-06  6e-07
 6:  2.8907e+00  2.8899e+00  8e-04  5e-07  2e-07
 7:  2.8902e+00  2.8899e+00  2e-04  6e-07  3e-07
 8:  2.8900e+00  2.8899e+00  4e-06  8e-08  4e-08
 9:  2.8899e+00  2.8899e+00  5e-08  1e-09  5e-10
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1  1.1  1.1  1.1  1.1  1.1  1.1  1.1  0.1  1.1  5.1  2.1  1.1  1.1
 2.1  1.1  1.1  1.1  2.1  3.1  1.1  6.1  1.1  6.1  6.1  6.1  1.1  1.1
 4.1  2.1  6.1  2.1  0.1  2.1  2.1  2.1  1.1  1.1  6.1  5.1  1.1  1.1
 1.1  5.1  1.1  1.1  4.1  1.1  5.1  6.1  0.01 5.1  1.1  1.1  1.1  6.1
 1.1  2.1  1.1  1.1  1.1  1.1  3.1  5.1  3.1  0.1  3.1  2.1  1.1  1.1
 0.1  3.1  6.1  1.1  3.1  1.1  1.1  1.1  2.1  1.1  1.1  2.1  6.1  1.1
 1.1  6.1  6.1  1.1  1.1  6.1  1.1  3.1  3.1  1.1  1.1  2.1  1.1  5.1
 5.1  1.1 ]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.01 0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2  0.2
 0.2  0.2 ]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.94it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.35it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.74it/s]100%|██████████| 8/8 [00:00<00:00, 11.64it/s]
[INFO][11:07:51]: [93m[1m[Server #3536466] Global model perplexity: 26.50
[0m
[INFO][11:07:51]: [Server #3536466] All client reports have been processed.
[INFO][11:07:51]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_51.pth.
[INFO][11:07:55]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_51.pth.
[INFO][11:07:55]: [93m[1m
[Server #3536466] Starting round 52/100.[0m
[INFO][11:07:55]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.97738547e-06, 2.97738547e-06, 2.97738547e-06, 2.97738547e-06,
       2.97738547e-06, 2.97738547e-06, 2.97738547e-06, 2.97738547e-06,
       4.99923326e-01, 2.97738547e-06, 2.83141163e-08, 2.65191381e-07,
       2.97738547e-06, 2.97738547e-06, 2.65191381e-07, 2.97738547e-06,
       2.97738547e-06, 2.97738547e-06, 2.65191381e-07, 9.09764657e-08,
       2.97738547e-06, 1.91659190e-08, 2.97738547e-06, 1.91659190e-08,
       1.91659190e-08, 1.91659190e-08, 2.97738547e-06, 2.97738547e-06,
       4.63664000e-08, 2.65191381e-07, 1.91659190e-08, 2.65191381e-07,
       4.99923326e-01, 2.65191381e-07, 2.65191381e-07, 2.65191381e-07,
       2.97738547e-06, 2.97738547e-06, 1.91659190e-08, 2.83141163e-08,
       2.97738547e-06, 2.97738547e-06, 2.97738547e-06, 2.83141163e-08,
       2.97738547e-06, 4.63664000e-08, 2.97738547e-06, 2.83141163e-08,
       1.91659190e-08, 2.83141163e-08, 2.97738547e-06, 2.97738547e-06,
       2.97738547e-06, 1.91659190e-08, 2.97738547e-06, 2.97738547e-06,
       2.97738547e-06, 2.97738547e-06, 2.97738547e-06, 9.09764657e-08,
       2.83141163e-08, 9.09764657e-08, 9.09764657e-08, 2.65191381e-07,
       2.97738547e-06, 2.97738547e-06, 9.09764657e-08, 1.91659190e-08,
       2.97738547e-06, 9.09764657e-08, 2.97738547e-06, 2.97738547e-06,
       2.97738547e-06, 2.65191381e-07, 2.97738547e-06, 2.97738547e-06,
       2.65191381e-07, 1.91659190e-08, 2.97738547e-06, 2.97738547e-06,
       1.91659190e-08, 1.91659190e-08, 2.97738547e-06, 2.97738547e-06,
       1.91659190e-08, 2.97738547e-06, 9.09764657e-08, 9.09764657e-08,
       2.97738547e-06, 2.97738547e-06, 2.65191381e-07, 2.97738547e-06,
       2.83141163e-08, 2.83141163e-08, 2.97738547e-06]),)
[INFO][11:07:55]: [Server #3536466] Selected clients: [33  9 91 60 78]
[INFO][11:07:55]: [Server #3536466] Selecting client #60 for training.
[INFO][11:07:55]: [Server #3536466] Sending the current model to client #60 (simulated).
[INFO][11:07:59]: [Server #3536466] Sending 507.38 MB of payload data to client #60 (simulated).
[INFO][11:07:59]: [Server #3536466] Selecting client #33 for training.
[INFO][11:07:59]: [Server #3536466] Sending the current model to client #33 (simulated).
[INFO][11:08:04]: [Server #3536466] Sending 507.38 MB of payload data to client #33 (simulated).
[INFO][11:08:04]: [Client #60] Selected by the server.
[INFO][11:08:04]: [Client #60] Loading its data source...
[INFO][11:08:04]: [Client #60] Dataset size: 2018
[INFO][11:08:04]: [Client #60] Sampler: iid
[INFO][11:08:04]: [Client #33] Selected by the server.
[INFO][11:08:04]: [Client #33] Loading its data source...
[INFO][11:08:04]: [Client #33] Dataset size: 2018
[INFO][11:08:04]: [Client #33] Sampler: iid
[INFO][11:08:05]: [Client #60] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:08:05]: [Client #60] Start to process inbound data.
[INFO][11:08:05]: [Client #33] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:08:05]: [Client #33] Start to process inbound data.
[INFO][11:08:06]: [93m[1m[Client #60] Started training in communication round #52.[0m
[INFO][11:08:06]: [93m[1m[Client #33] Started training in communication round #52.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:40,  4.69s/it]  2%|▏         | 1/48 [00:04<03:45,  4.80s/it]  4%|▍         | 2/48 [00:05<01:48,  2.36s/it]  4%|▍         | 2/48 [00:05<01:50,  2.41s/it]  6%|▋         | 3/48 [00:06<01:12,  1.62s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.39it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.37it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 50%|█████     | 24/48 [00:21<00:18,  1.32it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][11:08:52]: [Client #60] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
{'train_runtime': 39.473, 'train_samples_per_second': 153.37, 'train_steps_per_second': 1.216, 'train_loss': 3.094167709350586, 'epoch': 3.0}
[INFO][11:08:52]: [Client #33] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
{'train_runtime': 39.3891, 'train_samples_per_second': 153.697, 'train_steps_per_second': 1.219, 'train_loss': 2.57519801457723, 'epoch': 3.0}
[INFO][11:08:53]: [Client #60] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
[INFO][11:08:54]: [Client #33] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
[INFO][11:08:54]: [Client #60] Model trained.
[INFO][11:08:54]: [Client #60] Inbound data has been processed.
[INFO][11:08:54]: [Client #60] Outbound data is ready to be sent after being processed.
[INFO][11:08:54]: [Client #33] Model trained.
[INFO][11:08:54]: [Client #33] Inbound data has been processed.
[INFO][11:08:54]: [Client #33] Outbound data is ready to be sent after being processed.
[INFO][11:09:02]: [Client #60] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:09:02]: [Client #33] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:09:02]: [Server #3536466] Received 507.38 MB of payload data from client #60 (simulated).
[INFO][11:09:03]: [Server #3536466] Received 507.38 MB of payload data from client #33 (simulated).
[INFO][11:09:03]: [Server #3536466] Selecting client #78 for training.
[INFO][11:09:03]: [Server #3536466] Sending the current model to client #78 (simulated).
[INFO][11:09:08]: [Server #3536466] Sending 507.38 MB of payload data to client #78 (simulated).
[INFO][11:09:08]: [Server #3536466] Selecting client #9 for training.
[INFO][11:09:08]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][11:09:12]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][11:09:12]: [Client #78] Selected by the server.
[INFO][11:09:12]: [Client #78] Loading its data source...
[INFO][11:09:12]: [Client #78] Dataset size: 2018
[INFO][11:09:12]: [Client #78] Sampler: iid
[INFO][11:09:12]: [Client #9] Selected by the server.
[INFO][11:09:12]: [Client #9] Loading its data source...
[INFO][11:09:12]: [Client #9] Dataset size: 2018
[INFO][11:09:12]: [Client #9] Sampler: iid
[INFO][11:09:14]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:09:14]: [Client #9] Start to process inbound data.
[INFO][11:09:14]: [Client #78] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:09:14]: [Client #78] Start to process inbound data.
[INFO][11:09:14]: [93m[1m[Client #9] Started training in communication round #52.[0m
[INFO][11:09:14]: [93m[1m[Client #78] Started training in communication round #52.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:47,  4.83s/it]  2%|▏         | 1/48 [00:04<03:48,  4.85s/it]  4%|▍         | 2/48 [00:05<01:52,  2.44s/it]  4%|▍         | 2/48 [00:05<01:53,  2.46s/it]  6%|▋         | 3/48 [00:06<01:14,  1.67s/it]  6%|▋         | 3/48 [00:06<01:15,  1.69s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it]  8%|▊         | 4/48 [00:07<00:57,  1.32s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.11it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.33it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.34it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][11:10:00]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.7274, 'train_samples_per_second': 152.389, 'train_steps_per_second': 1.208, 'train_loss': 2.0766393343607583, 'epoch': 3.0}
[INFO][11:10:01]: [Client #78] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
{'train_runtime': 39.6652, 'train_samples_per_second': 152.628, 'train_steps_per_second': 1.21, 'train_loss': 3.0199546813964844, 'epoch': 3.0}
[INFO][11:10:01]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][11:10:02]: [Client #78] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
[INFO][11:10:02]: [Client #9] Model trained.
[INFO][11:10:02]: [Client #9] Inbound data has been processed.
[INFO][11:10:02]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][11:10:03]: [Client #78] Model trained.
[INFO][11:10:03]: [Client #78] Inbound data has been processed.
[INFO][11:10:03]: [Client #78] Outbound data is ready to be sent after being processed.
[INFO][11:10:09]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:10:10]: [Client #78] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:10:10]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][11:10:11]: [Server #3536466] Received 507.38 MB of payload data from client #78 (simulated).
[INFO][11:10:11]: [Server #3536466] Selecting client #91 for training.
[INFO][11:10:11]: [Server #3536466] Sending the current model to client #91 (simulated).
[INFO][11:10:16]: [Server #3536466] Sending 507.38 MB of payload data to client #91 (simulated).
[INFO][11:10:16]: [Client #91] Selected by the server.
[INFO][11:10:16]: [Client #91] Loading its data source...
[INFO][11:10:16]: [Client #91] Dataset size: 2018
[INFO][11:10:16]: [Client #91] Sampler: iid
[INFO][11:10:17]: [Client #91] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:10:17]: [Client #91] Start to process inbound data.
[INFO][11:10:17]: [93m[1m[Client #91] Started training in communication round #52.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.00it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.12it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.11it/s] 71%|███████   | 34/48 [00:20<00:06,  2.09it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.07it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.06it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.06it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.05it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.04it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.04it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.03it/s] 88%|████████▊ | 42/48 [00:24<00:02,  2.03it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.03it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.03it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.03it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.04it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.04it/s]100%|██████████| 48/48 [00:26<00:00,  2.15it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.15it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][11:10:50]: [Client #91] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_91_3536584.pth.
{'train_runtime': 26.8761, 'train_samples_per_second': 225.256, 'train_steps_per_second': 1.786, 'train_loss': 2.886693318684896, 'epoch': 3.0}
[INFO][11:10:51]: [Client #91] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_91_3536584.pth.
[INFO][11:10:52]: [Client #91] Model trained.
[INFO][11:10:52]: [Client #91] Inbound data has been processed.
[INFO][11:10:52]: [Client #91] Outbound data is ready to be sent after being processed.
[INFO][11:10:57]: [Client #91] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:10:58]: [Server #3536466] Received 507.38 MB of payload data from client #91 (simulated).
[INFO][11:10:58]: [Server #3536466] Adding client #45 to the list of clients for aggregation.
[INFO][11:10:58]: [Server #3536466] Adding client #51 to the list of clients for aggregation.
[INFO][11:10:58]: [Server #3536466] Adding client #66 to the list of clients for aggregation.
[INFO][11:10:58]: [Server #3536466] Adding client #71 to the list of clients for aggregation.
[INFO][11:10:58]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][11:10:58]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:10:58]: [Server #3536466] Updated weights have been received.
[INFO][11:10:58]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:10:59]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:10:59]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.9583e+00  1e+02  1e+00  1e+00
 1:  2.8702e+00  1.9782e+00  4e+00  3e-02  3e-02
 2:  2.9634e+00  2.2461e+00  7e-01  4e-06  5e-07
 3:  2.9630e+00  2.9507e+00  1e-02  7e-08  9e-09
 4:  2.9613e+00  2.9577e+00  4e-03  1e-07  2e-08
 5:  2.9596e+00  2.9568e+00  3e-03  1e-06  8e-07
 6:  2.9589e+00  2.9579e+00  1e-03  6e-07  4e-07
 7:  2.9582e+00  2.9579e+00  4e-04  1e-06  9e-07
 8:  2.9579e+00  2.9579e+00  1e-05  4e-07  2e-07
 9:  2.9579e+00  2.9579e+00  2e-07  7e-09  5e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 0.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 1.1 4.1 2.1 6.1 2.1 0.1 2.1 2.1 2.1
 1.1 1.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 2.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 1.1 1.1 6.1 6.1 1.1 1.1 6.1
 1.1 3.1 3.1 1.1 1.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.04it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.33it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.97it/s]100%|██████████| 8/8 [00:00<00:00, 11.74it/s]
[INFO][11:11:10]: [93m[1m[Server #3536466] Global model perplexity: 26.55
[0m
[INFO][11:11:10]: [Server #3536466] All client reports have been processed.
[INFO][11:11:10]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_52.pth.
[INFO][11:11:13]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_52.pth.
[INFO][11:11:13]: [93m[1m
[Server #3536466] Starting round 53/100.[0m
[INFO][11:11:13]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([3.66123390e-05, 3.66123390e-05, 3.66123390e-05, 3.66123390e-05,
       3.66123390e-05, 3.66123390e-05, 3.66123390e-05, 3.66123390e-05,
       9.98112783e-01, 3.66123390e-05, 3.95114176e-07, 3.23365465e-06,
       3.66123390e-05, 3.66123390e-05, 3.23365465e-06, 3.66123390e-05,
       3.66123390e-05, 3.66123390e-05, 3.23365465e-06, 1.19708062e-06,
       3.66123390e-05, 2.70764095e-07, 3.66123390e-05, 2.70764095e-07,
       2.70764095e-07, 2.70764095e-07, 3.66123390e-05, 3.66123390e-05,
       6.33813608e-07, 3.23365465e-06, 2.70764095e-07, 3.23365465e-06,
       3.23365465e-06, 3.23365465e-06, 3.23365465e-06, 3.66123390e-05,
       3.66123390e-05, 2.70764095e-07, 3.95114176e-07, 3.66123390e-05,
       3.66123390e-05, 3.66123390e-05, 3.95114176e-07, 3.66123390e-05,
       3.66123390e-05, 6.33813608e-07, 3.66123390e-05, 3.95114176e-07,
       2.70764095e-07, 2.70764095e-07, 3.95114176e-07, 3.66123390e-05,
       3.66123390e-05, 3.66123390e-05, 2.70764095e-07, 3.66123390e-05,
       3.66123390e-05, 3.66123390e-05, 3.66123390e-05, 1.19708062e-06,
       3.95114176e-07, 1.19708062e-06, 3.66123390e-05, 1.19708062e-06,
       3.23365465e-06, 3.66123390e-05, 3.66123390e-05, 3.66123390e-05,
       1.19708062e-06, 2.70764095e-07, 3.66123390e-05, 1.19708062e-06,
       3.66123390e-05, 3.66123390e-05, 3.23365465e-06, 3.66123390e-05,
       3.66123390e-05, 3.23365465e-06, 2.70764095e-07, 3.66123390e-05,
       3.66123390e-05, 2.70764095e-07, 2.70764095e-07, 3.66123390e-05,
       3.66123390e-05, 2.70764095e-07, 1.19708062e-06, 1.19708062e-06,
       3.66123390e-05, 3.66123390e-05, 3.23365465e-06, 3.66123390e-05,
       3.95114176e-07, 3.95114176e-07, 3.66123390e-05]),)
[INFO][11:11:13]: [Server #3536466] Selected clients: [ 9 95 48 13 84]
[INFO][11:11:13]: [Server #3536466] Selecting client #48 for training.
[INFO][11:11:13]: [Server #3536466] Sending the current model to client #48 (simulated).
[INFO][11:11:18]: [Server #3536466] Sending 507.38 MB of payload data to client #48 (simulated).
[INFO][11:11:18]: [Server #3536466] Selecting client #9 for training.
[INFO][11:11:18]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][11:11:22]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][11:11:22]: [Client #48] Selected by the server.
[INFO][11:11:22]: [Client #48] Loading its data source...
[INFO][11:11:22]: [Client #48] Dataset size: 2018
[INFO][11:11:22]: [Client #48] Sampler: iid
[INFO][11:11:22]: [Client #9] Selected by the server.
[INFO][11:11:22]: [Client #9] Loading its data source...
[INFO][11:11:22]: [Client #9] Dataset size: 2018
[INFO][11:11:22]: [Client #9] Sampler: iid
[INFO][11:11:24]: [Client #48] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:11:24]: [Client #48] Start to process inbound data.
[INFO][11:11:24]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:11:24]: [Client #9] Start to process inbound data.
[INFO][11:11:24]: [93m[1m[Client #48] Started training in communication round #53.[0m
[INFO][11:11:25]: [93m[1m[Client #9] Started training in communication round #53.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:29,  4.45s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:05<01:45,  2.29s/it]  2%|▏         | 1/48 [00:04<03:45,  4.80s/it]  6%|▋         | 3/48 [00:06<01:15,  1.68s/it]  4%|▍         | 2/48 [00:05<01:56,  2.54s/it]  8%|▊         | 4/48 [00:06<00:58,  1.34s/it]  6%|▋         | 3/48 [00:06<01:16,  1.71s/it] 10%|█         | 5/48 [00:07<00:48,  1.14s/it]  8%|▊         | 4/48 [00:07<00:58,  1.32s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.00it/s] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 21%|██        | 10/48 [00:11<00:30,  1.27it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
 98%|█████████▊| 47/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.57it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.57it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][11:12:10]: [Client #48] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_48_3536584.pth.
{'train_runtime': 39.5692, 'train_samples_per_second': 152.998, 'train_steps_per_second': 1.213, 'train_loss': 3.1205215454101562, 'epoch': 3.0}
[INFO][11:12:10]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.4823, 'train_samples_per_second': 153.335, 'train_steps_per_second': 1.216, 'train_loss': 2.0291131337483725, 'epoch': 3.0}
[INFO][11:12:11]: [Client #48] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_48_3536584.pth.
[INFO][11:12:11]: [Client #48] Model trained.
[INFO][11:12:11]: [Client #48] Inbound data has been processed.
[INFO][11:12:11]: [Client #48] Outbound data is ready to be sent after being processed.
[INFO][11:12:11]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][11:12:12]: [Client #9] Model trained.
[INFO][11:12:12]: [Client #9] Inbound data has been processed.
[INFO][11:12:12]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][11:12:18]: [Client #48] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:12:19]: [Server #3536466] Received 507.38 MB of payload data from client #48 (simulated).
[INFO][11:12:20]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:12:21]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][11:12:21]: [Server #3536466] Selecting client #84 for training.
[INFO][11:12:21]: [Server #3536466] Sending the current model to client #84 (simulated).
[INFO][11:12:25]: [Server #3536466] Sending 507.38 MB of payload data to client #84 (simulated).
[INFO][11:12:25]: [Server #3536466] Selecting client #13 for training.
[INFO][11:12:25]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][11:12:30]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][11:12:30]: [Client #84] Selected by the server.
[INFO][11:12:30]: [Client #84] Loading its data source...
[INFO][11:12:30]: [Client #84] Dataset size: 2018
[INFO][11:12:30]: [Client #13] Selected by the server.
[INFO][11:12:30]: [Client #84] Sampler: iid
[INFO][11:12:30]: [Client #13] Loading its data source...
[INFO][11:12:30]: [Client #13] Dataset size: 2018
[INFO][11:12:30]: [Client #13] Sampler: iid
[INFO][11:12:31]: [Client #84] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:12:31]: [Client #84] Start to process inbound data.
[INFO][11:12:31]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:12:31]: [Client #13] Start to process inbound data.
[INFO][11:12:32]: [93m[1m[Client #84] Started training in communication round #53.[0m
[INFO][11:12:32]: [93m[1m[Client #13] Started training in communication round #53.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:40,  4.69s/it]  2%|▏         | 1/48 [00:04<03:45,  4.79s/it]  4%|▍         | 2/48 [00:05<01:49,  2.38s/it]  4%|▍         | 2/48 [00:05<01:50,  2.41s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:55,  1.27s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.18it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.32it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.31it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.31it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][11:13:18]: [Client #84] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_84_3536584.pth.
{'train_runtime': 39.6582, 'train_samples_per_second': 152.654, 'train_steps_per_second': 1.21, 'train_loss': 3.1327489217122397, 'epoch': 3.0}
[INFO][11:13:18]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536585.pth.
{'train_runtime': 39.5872, 'train_samples_per_second': 152.928, 'train_steps_per_second': 1.213, 'train_loss': 2.390195369720459, 'epoch': 3.0}
[INFO][11:13:19]: [Client #84] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_84_3536584.pth.
[INFO][11:13:19]: [Client #84] Model trained.
[INFO][11:13:19]: [Client #84] Inbound data has been processed.
[INFO][11:13:19]: [Client #84] Outbound data is ready to be sent after being processed.
[INFO][11:13:19]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536585.pth.
[INFO][11:13:20]: [Client #13] Model trained.
[INFO][11:13:20]: [Client #13] Inbound data has been processed.
[INFO][11:13:20]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][11:13:26]: [Client #84] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:13:27]: [Server #3536466] Received 507.38 MB of payload data from client #84 (simulated).
[INFO][11:13:28]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:13:29]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][11:13:29]: [Server #3536466] Selecting client #95 for training.
[INFO][11:13:29]: [Server #3536466] Sending the current model to client #95 (simulated).
[INFO][11:13:33]: [Server #3536466] Sending 507.38 MB of payload data to client #95 (simulated).
[INFO][11:13:33]: [Client #95] Selected by the server.
[INFO][11:13:33]: [Client #95] Loading its data source...
[INFO][11:13:33]: [Client #95] Dataset size: 2018
[INFO][11:13:33]: [Client #95] Sampler: iid
[INFO][11:13:35]: [Client #95] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:13:35]: [Client #95] Start to process inbound data.
[INFO][11:13:35]: [93m[1m[Client #95] Started training in communication round #53.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.21s/it]  4%|▍         | 2/48 [00:04<01:32,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.58it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.70it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.80it/s] 21%|██        | 10/48 [00:08<00:20,  1.87it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.92it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.95it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.98it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.00it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.01it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.12it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.10it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.08it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.08it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.07it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.07it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.07it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.11it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.06it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.06it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.06it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][11:14:08]: [Client #95] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_95_3536584.pth.
{'train_runtime': 26.7958, 'train_samples_per_second': 225.931, 'train_steps_per_second': 1.791, 'train_loss': 2.8587706883748374, 'epoch': 3.0}
[INFO][11:14:09]: [Client #95] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_95_3536584.pth.
[INFO][11:14:09]: [Client #95] Model trained.
[INFO][11:14:09]: [Client #95] Inbound data has been processed.
[INFO][11:14:09]: [Client #95] Outbound data is ready to be sent after being processed.
[INFO][11:14:14]: [Client #95] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:14:15]: [Server #3536466] Received 507.38 MB of payload data from client #95 (simulated).
[INFO][11:14:15]: [Server #3536466] Adding client #33 to the list of clients for aggregation.
[INFO][11:14:15]: [Server #3536466] Adding client #78 to the list of clients for aggregation.
[INFO][11:14:15]: [Server #3536466] Adding client #58 to the list of clients for aggregation.
[INFO][11:14:15]: [Server #3536466] Adding client #60 to the list of clients for aggregation.
[INFO][11:14:15]: [Server #3536466] Adding client #91 to the list of clients for aggregation.
[INFO][11:14:15]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:14:15]: [Server #3536466] Updated weights have been received.
[INFO][11:14:16]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:14:17]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:14:17]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  2.9962e+00  1e+02  1e+00  1e+00
 1:  2.9118e+00  2.0161e+00  3e+00  3e-02  3e-02
 2:  3.0013e+00  2.2937e+00  7e-01  4e-06  5e-07
 3:  3.0009e+00  2.9887e+00  1e-02  7e-08  9e-09
 4:  2.9992e+00  2.9956e+00  4e-03  1e-07  2e-08
 5:  2.9977e+00  2.9948e+00  3e-03  9e-07  8e-07
 6:  2.9971e+00  2.9958e+00  1e-03  5e-07  5e-07
 7:  2.9963e+00  2.9959e+00  5e-04  3e-06  3e-06
 8:  2.9960e+00  2.9959e+00  1e-04  1e-06  1e-06
 9:  2.9959e+00  2.9959e+00  2e-06  1e-07  7e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 0.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 1.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 1.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 1.1 1.1 6.1 6.1 1.1 1.1 6.1
 1.1 3.1 3.1 1.1 1.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.06it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.40it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.01it/s]100%|██████████| 8/8 [00:00<00:00, 11.77it/s]
[INFO][11:14:27]: [93m[1m[Server #3536466] Global model perplexity: 23.18
[0m
[INFO][11:14:27]: [Server #3536466] All client reports have been processed.
[INFO][11:14:27]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_53.pth.
[INFO][11:14:31]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_53.pth.
[INFO][11:14:31]: [93m[1m
[Server #3536466] Starting round 54/100.[0m
[INFO][11:14:31]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([1.99999044e-02, 1.99999044e-02, 1.99999044e-02, 1.99999044e-02,
       1.99999044e-02, 1.99999044e-02, 1.99999044e-02, 1.99999044e-02,
       1.99999044e-02, 3.44837066e-08, 2.66358030e-07, 1.99999044e-02,
       2.66358030e-07, 1.99999044e-02, 1.99999044e-02, 1.99999044e-02,
       2.66358030e-07, 1.19259738e-07, 1.99999044e-02, 1.50826572e-08,
       1.99999044e-02, 1.50826572e-08, 1.50826572e-08, 1.50826572e-08,
       1.99999044e-02, 1.99999044e-02, 6.43251793e-08, 2.66358030e-07,
       1.50826572e-08, 2.66358030e-07, 1.99999044e-02, 2.66358030e-07,
       2.66358030e-07, 2.66358030e-07, 1.99999044e-02, 1.99999044e-02,
       1.50826572e-08, 3.44837066e-08, 1.99999044e-02, 1.99999044e-02,
       1.99999044e-02, 3.44837066e-08, 1.99999044e-02, 1.99999044e-02,
       6.43251793e-08, 3.44837066e-08, 1.50826572e-08, 1.50826572e-08,
       3.44837066e-08, 1.99999044e-02, 1.99999044e-02, 1.99999044e-02,
       1.50826572e-08, 1.99999044e-02, 1.50826572e-08, 1.99999044e-02,
       1.99999044e-02, 1.99999044e-02, 1.99999044e-02, 1.19259738e-07,
       3.44837066e-08, 1.19259738e-07, 1.99999044e-02, 1.19259738e-07,
       2.66358030e-07, 1.99999044e-02, 1.99999044e-02, 1.99999044e-02,
       1.19259738e-07, 1.50826572e-08, 1.99999044e-02, 1.19259738e-07,
       1.99999044e-02, 1.99999044e-02, 1.99999044e-02, 2.66358030e-07,
       1.99999044e-02, 1.99999044e-02, 2.66358030e-07, 1.50826572e-08,
       1.99999044e-02, 1.50826572e-08, 1.50826572e-08, 1.99999044e-02,
       1.99999044e-02, 1.50826572e-08, 1.99999044e-02, 1.19259738e-07,
       1.19259738e-07, 1.99999044e-02, 2.66358030e-07, 1.99999044e-02,
       3.44837066e-08, 3.44837066e-08, 1.99999044e-02]),)
[INFO][11:14:31]: [Server #3536466] Selected clients: [18 70 55 94 61]
[INFO][11:14:31]: [Server #3536466] Selecting client #18 for training.
[INFO][11:14:31]: [Server #3536466] Sending the current model to client #18 (simulated).
[INFO][11:14:36]: [Server #3536466] Sending 507.38 MB of payload data to client #18 (simulated).
[INFO][11:14:36]: [Server #3536466] Selecting client #55 for training.
[INFO][11:14:36]: [Server #3536466] Sending the current model to client #55 (simulated).
[INFO][11:14:40]: [Server #3536466] Sending 507.38 MB of payload data to client #55 (simulated).
[INFO][11:14:40]: [Client #18] Selected by the server.
[INFO][11:14:40]: [Client #18] Loading its data source...
[INFO][11:14:40]: [Client #18] Dataset size: 2018
[INFO][11:14:40]: [Client #18] Sampler: iid
[INFO][11:14:40]: [Client #55] Selected by the server.
[INFO][11:14:40]: [Client #55] Loading its data source...
[INFO][11:14:40]: [Client #55] Dataset size: 2018
[INFO][11:14:40]: [Client #55] Sampler: iid
[INFO][11:14:42]: [Client #18] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:14:42]: [Client #18] Start to process inbound data.
[INFO][11:14:42]: [Client #55] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:14:42]: [Client #55] Start to process inbound data.
[INFO][11:14:43]: [93m[1m[Client #18] Started training in communication round #54.[0m
[INFO][11:14:43]: [93m[1m[Client #55] Started training in communication round #54.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:44,  4.77s/it]  2%|▏         | 1/48 [00:04<03:43,  4.76s/it]  4%|▍         | 2/48 [00:05<01:50,  2.41s/it]  4%|▍         | 2/48 [00:05<01:51,  2.43s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.31it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.31it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][11:15:28]: [Client #55] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_55_3536585.pth.
{'train_runtime': 39.6037, 'train_samples_per_second': 152.864, 'train_steps_per_second': 1.212, 'train_loss': 2.8985214233398438, 'epoch': 3.0}
[INFO][11:15:29]: [Client #18] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
{'train_runtime': 39.5838, 'train_samples_per_second': 152.941, 'train_steps_per_second': 1.213, 'train_loss': 3.0073674519856772, 'epoch': 3.0}
[INFO][11:15:29]: [Client #55] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_55_3536585.pth.
[INFO][11:15:30]: [Client #18] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
[INFO][11:15:30]: [Client #55] Model trained.
[INFO][11:15:30]: [Client #55] Inbound data has been processed.
[INFO][11:15:30]: [Client #55] Outbound data is ready to be sent after being processed.
[INFO][11:15:31]: [Client #18] Model trained.
[INFO][11:15:31]: [Client #18] Inbound data has been processed.
[INFO][11:15:31]: [Client #18] Outbound data is ready to be sent after being processed.
[INFO][11:15:38]: [Client #55] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:15:38]: [Client #18] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:15:39]: [Server #3536466] Received 507.38 MB of payload data from client #55 (simulated).
[INFO][11:15:40]: [Server #3536466] Received 507.38 MB of payload data from client #18 (simulated).
[INFO][11:15:40]: [Server #3536466] Selecting client #70 for training.
[INFO][11:15:40]: [Server #3536466] Sending the current model to client #70 (simulated).
[INFO][11:15:45]: [Server #3536466] Sending 507.38 MB of payload data to client #70 (simulated).
[INFO][11:15:45]: [Server #3536466] Selecting client #61 for training.
[INFO][11:15:45]: [Server #3536466] Sending the current model to client #61 (simulated).
[INFO][11:15:49]: [Server #3536466] Sending 507.38 MB of payload data to client #61 (simulated).
[INFO][11:15:49]: [Client #70] Selected by the server.
[INFO][11:15:49]: [Client #70] Loading its data source...
[INFO][11:15:49]: [Client #70] Dataset size: 2018
[INFO][11:15:49]: [Client #70] Sampler: iid
[INFO][11:15:49]: [Client #61] Selected by the server.
[INFO][11:15:49]: [Client #61] Loading its data source...
[INFO][11:15:49]: [Client #61] Dataset size: 2018
[INFO][11:15:49]: [Client #61] Sampler: iid
[INFO][11:15:50]: [Client #61] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:15:50]: [Client #61] Start to process inbound data.
[INFO][11:15:51]: [Client #70] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:15:51]: [Client #70] Start to process inbound data.
[INFO][11:15:51]: [93m[1m[Client #61] Started training in communication round #54.[0m
[INFO][11:15:51]: [93m[1m[Client #70] Started training in communication round #54.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:13,  4.11s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:36,  2.09s/it]  2%|▏         | 1/48 [00:04<03:35,  4.58s/it]  6%|▋         | 3/48 [00:05<01:06,  1.48s/it]  4%|▍         | 2/48 [00:05<01:48,  2.36s/it]  8%|▊         | 4/48 [00:06<00:52,  1.18s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it] 10%|█         | 5/48 [00:07<00:43,  1.02s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it] 12%|█▎        | 6/48 [00:07<00:38,  1.08it/s] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 19%|█▉        | 9/48 [00:09<00:31,  1.24it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.33it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.36it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.41it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.34it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 83%|████████▎ | 40/48 [00:32<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 92%|█████████▏| 44/48 [00:35<00:02,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s]100%|██████████| 48/48 [00:38<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.40it/s]100%|██████████| 48/48 [00:38<00:00,  1.24it/s]
 98%|█████████▊| 47/48 [00:38<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.57it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.57it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][11:16:36]: [Client #61] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536585.pth.
{'train_runtime': 38.8431, 'train_samples_per_second': 155.858, 'train_steps_per_second': 1.236, 'train_loss': 2.778273900349935, 'epoch': 3.0}
[INFO][11:16:36]: [Client #70] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_70_3536584.pth.
{'train_runtime': 39.1773, 'train_samples_per_second': 154.528, 'train_steps_per_second': 1.225, 'train_loss': 3.063079516092936, 'epoch': 3.0}
[INFO][11:16:37]: [Client #61] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536585.pth.
[INFO][11:16:37]: [Client #61] Model trained.
[INFO][11:16:37]: [Client #61] Inbound data has been processed.
[INFO][11:16:37]: [Client #61] Outbound data is ready to be sent after being processed.
[INFO][11:16:38]: [Client #70] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_70_3536584.pth.
[INFO][11:16:38]: [Client #70] Model trained.
[INFO][11:16:38]: [Client #70] Inbound data has been processed.
[INFO][11:16:38]: [Client #70] Outbound data is ready to be sent after being processed.
[INFO][11:16:45]: [Client #61] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:16:46]: [Client #70] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:16:46]: [Server #3536466] Received 507.38 MB of payload data from client #61 (simulated).
[INFO][11:16:47]: [Server #3536466] Received 507.38 MB of payload data from client #70 (simulated).
[INFO][11:16:47]: [Server #3536466] Selecting client #94 for training.
[INFO][11:16:47]: [Server #3536466] Sending the current model to client #94 (simulated).
[INFO][11:16:52]: [Server #3536466] Sending 507.38 MB of payload data to client #94 (simulated).
[INFO][11:16:52]: [Client #94] Selected by the server.
[INFO][11:16:52]: [Client #94] Loading its data source...
[INFO][11:16:52]: [Client #94] Dataset size: 2018
[INFO][11:16:52]: [Client #94] Sampler: iid
[INFO][11:16:54]: [Client #94] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:16:54]: [Client #94] Start to process inbound data.
[INFO][11:16:54]: [93m[1m[Client #94] Started training in communication round #54.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.20s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.96it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.99it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.00it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.13it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.10it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.10it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.09it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.08it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][11:17:26]: [Client #94] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_94_3536584.pth.
{'train_runtime': 26.7052, 'train_samples_per_second': 226.697, 'train_steps_per_second': 1.797, 'train_loss': 3.090519587198893, 'epoch': 3.0}
[INFO][11:17:28]: [Client #94] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_94_3536584.pth.
[INFO][11:17:28]: [Client #94] Model trained.
[INFO][11:17:28]: [Client #94] Inbound data has been processed.
[INFO][11:17:28]: [Client #94] Outbound data is ready to be sent after being processed.
[INFO][11:17:33]: [Client #94] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:17:34]: [Server #3536466] Received 507.38 MB of payload data from client #94 (simulated).
[INFO][11:17:34]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][11:17:34]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][11:17:34]: [Server #3536466] Adding client #48 to the list of clients for aggregation.
[INFO][11:17:34]: [Server #3536466] Adding client #61 to the list of clients for aggregation.
[INFO][11:17:34]: [Server #3536466] Adding client #18 to the list of clients for aggregation.
[INFO][11:17:34]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:17:34]: [Server #3536466] Updated weights have been received.
[INFO][11:17:35]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:17:35]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:17:35]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0327e+00  1e+02  1e+00  1e+00
 1:  2.9517e+00  2.0526e+00  3e+00  2e-02  2e-02
 2:  3.0379e+00  2.3400e+00  7e-01  3e-06  4e-07
 3:  3.0375e+00  3.0264e+00  1e-02  5e-08  7e-09
 4:  3.0354e+00  3.0333e+00  2e-03  1e-07  2e-08
 5:  3.0335e+00  3.0334e+00  1e-04  4e-07  7e-08
 6:  3.0334e+00  3.0334e+00  3e-06  1e-08  2e-09
 7:  3.0334e+00  3.0334e+00  3e-08  1e-10  3e-11
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 0.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 1.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 1.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 0.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 1.1 1.1 6.1 6.1 1.1 1.1 6.1
 1.1 3.1 3.1 1.1 1.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.79it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.32it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.98it/s]100%|██████████| 8/8 [00:00<00:00, 11.75it/s]
[INFO][11:17:46]: [93m[1m[Server #3536466] Global model perplexity: 27.02
[0m
[INFO][11:17:46]: [Server #3536466] All client reports have been processed.
[INFO][11:17:46]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_54.pth.
[INFO][11:17:49]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_54.pth.
[INFO][11:17:49]: [93m[1m
[Server #3536466] Starting round 55/100.[0m
[INFO][11:17:49]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([3.25312721e-06, 3.25312721e-06, 3.25312721e-06, 3.25312721e-06,
       3.25312721e-06, 3.25312721e-06, 3.25312721e-06, 3.25312721e-06,
       3.25312721e-06, 3.25312721e-06, 3.10848493e-08, 2.90423037e-07,
       3.25312721e-06, 3.25312721e-06, 2.90423037e-07, 3.25312721e-06,
       3.25312721e-06, 4.99919450e-01, 2.90423037e-07, 9.97598836e-08,
       3.25312721e-06, 2.10472741e-08, 3.25312721e-06, 2.10472741e-08,
       2.10472741e-08, 2.10472741e-08, 3.25312721e-06, 3.25312721e-06,
       5.08811189e-08, 2.90423037e-07, 2.10472741e-08, 2.90423037e-07,
       3.25312721e-06, 2.90423037e-07, 2.90423037e-07, 2.90423037e-07,
       3.25312721e-06, 3.25312721e-06, 2.10472741e-08, 3.10848493e-08,
       3.25312721e-06, 3.25312721e-06, 3.25312721e-06, 3.10848493e-08,
       3.25312721e-06, 3.25312721e-06, 5.08811189e-08, 3.25312721e-06,
       3.10848493e-08, 2.10472741e-08, 2.10472741e-08, 3.10848493e-08,
       3.25312721e-06, 3.25312721e-06, 2.10472741e-08, 3.25312721e-06,
       2.10472741e-08, 3.25312721e-06, 3.25312721e-06, 4.99919450e-01,
       3.25312721e-06, 9.97598836e-08, 3.10848493e-08, 9.97598836e-08,
       3.25312721e-06, 9.97598836e-08, 2.90423037e-07, 3.25312721e-06,
       3.25312721e-06, 9.97598836e-08, 2.10472741e-08, 3.25312721e-06,
       9.97598836e-08, 3.25312721e-06, 3.25312721e-06, 3.25312721e-06,
       2.90423037e-07, 3.25312721e-06, 3.25312721e-06, 2.90423037e-07,
       2.10472741e-08, 3.25312721e-06, 2.10472741e-08, 2.10472741e-08,
       3.25312721e-06, 3.25312721e-06, 2.10472741e-08, 3.25312721e-06,
       9.97598836e-08, 9.97598836e-08, 2.90423037e-07, 3.25312721e-06,
       3.10848493e-08, 3.10848493e-08, 3.25312721e-06]),)
[INFO][11:17:49]: [Server #3536466] Selected clients: [61 18 91  1 78]
[INFO][11:17:49]: [Server #3536466] Selecting client #18 for training.
[INFO][11:17:49]: [Server #3536466] Sending the current model to client #18 (simulated).
[INFO][11:17:54]: [Server #3536466] Sending 507.38 MB of payload data to client #18 (simulated).
[INFO][11:17:54]: [Server #3536466] Selecting client #1 for training.
[INFO][11:17:54]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][11:17:59]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][11:17:59]: [Client #18] Selected by the server.
[INFO][11:17:59]: [Client #18] Loading its data source...
[INFO][11:17:59]: [Client #18] Dataset size: 2018
[INFO][11:17:59]: [Client #18] Sampler: iid
[INFO][11:17:59]: [Client #1] Selected by the server.
[INFO][11:17:59]: [Client #1] Loading its data source...
[INFO][11:17:59]: [Client #1] Dataset size: 2018
[INFO][11:17:59]: [Client #1] Sampler: iid
[INFO][11:18:00]: [Client #18] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:18:00]: [Client #18] Start to process inbound data.
[INFO][11:18:00]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:18:00]: [Client #1] Start to process inbound data.
[INFO][11:18:01]: [93m[1m[Client #1] Started training in communication round #55.[0m
[INFO][11:18:01]: [93m[1m[Client #18] Started training in communication round #55.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:39,  4.68s/it]  2%|▏         | 1/48 [00:04<03:46,  4.82s/it]  4%|▍         | 2/48 [00:05<01:48,  2.36s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  6%|▋         | 3/48 [00:06<01:12,  1.62s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:55,  1.27s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][11:18:47]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 39.4995, 'train_samples_per_second': 153.268, 'train_steps_per_second': 1.215, 'train_loss': 2.466650644938151, 'epoch': 3.0}
[INFO][11:18:47]: [Client #18] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
{'train_runtime': 39.3929, 'train_samples_per_second': 153.682, 'train_steps_per_second': 1.218, 'train_loss': 2.8995574315389, 'epoch': 3.0}
[INFO][11:18:48]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][11:18:48]: [Client #1] Model trained.
[INFO][11:18:48]: [Client #1] Inbound data has been processed.
[INFO][11:18:48]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][11:18:48]: [Client #18] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
[INFO][11:18:49]: [Client #18] Model trained.
[INFO][11:18:49]: [Client #18] Inbound data has been processed.
[INFO][11:18:49]: [Client #18] Outbound data is ready to be sent after being processed.
[INFO][11:18:56]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:18:57]: [Client #18] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:18:57]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][11:18:58]: [Server #3536466] Received 507.38 MB of payload data from client #18 (simulated).
[INFO][11:18:58]: [Server #3536466] Selecting client #78 for training.
[INFO][11:18:58]: [Server #3536466] Sending the current model to client #78 (simulated).
[INFO][11:19:03]: [Server #3536466] Sending 507.38 MB of payload data to client #78 (simulated).
[INFO][11:19:03]: [Server #3536466] Selecting client #91 for training.
[INFO][11:19:03]: [Server #3536466] Sending the current model to client #91 (simulated).
[INFO][11:19:07]: [Server #3536466] Sending 507.38 MB of payload data to client #91 (simulated).
[INFO][11:19:07]: [Client #78] Selected by the server.
[INFO][11:19:07]: [Client #78] Loading its data source...
[INFO][11:19:07]: [Client #91] Selected by the server.
[INFO][11:19:07]: [Client #78] Dataset size: 2018
[INFO][11:19:07]: [Client #91] Loading its data source...
[INFO][11:19:07]: [Client #78] Sampler: iid
[INFO][11:19:07]: [Client #91] Dataset size: 2018
[INFO][11:19:07]: [Client #91] Sampler: iid
[INFO][11:19:08]: [Client #78] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:19:08]: [Client #78] Start to process inbound data.
[INFO][11:19:08]: [Client #91] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:19:08]: [Client #91] Start to process inbound data.
[INFO][11:19:09]: [93m[1m[Client #78] Started training in communication round #55.[0m
[INFO][11:19:09]: [93m[1m[Client #91] Started training in communication round #55.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:42,  4.73s/it]  2%|▏         | 1/48 [00:04<03:45,  4.81s/it]  4%|▍         | 2/48 [00:05<01:49,  2.37s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it]  8%|▊         | 4/48 [00:06<00:56,  1.27s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.02it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][11:19:55]: [Client #91] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_91_3536585.pth.
{'train_runtime': 39.7221, 'train_samples_per_second': 152.409, 'train_steps_per_second': 1.208, 'train_loss': 2.817018508911133, 'epoch': 3.0}
[INFO][11:19:55]: [Client #78] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
{'train_runtime': 39.6178, 'train_samples_per_second': 152.81, 'train_steps_per_second': 1.212, 'train_loss': 2.962547938028971, 'epoch': 3.0}
[INFO][11:19:56]: [Client #91] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_91_3536585.pth.
[INFO][11:19:56]: [Client #78] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
[INFO][11:19:56]: [Client #91] Model trained.
[INFO][11:19:56]: [Client #91] Inbound data has been processed.
[INFO][11:19:56]: [Client #91] Outbound data is ready to be sent after being processed.
[INFO][11:19:57]: [Client #78] Model trained.
[INFO][11:19:57]: [Client #78] Inbound data has been processed.
[INFO][11:19:57]: [Client #78] Outbound data is ready to be sent after being processed.
[INFO][11:20:05]: [Client #78] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:20:05]: [Client #91] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:20:06]: [Server #3536466] Received 507.38 MB of payload data from client #78 (simulated).
[INFO][11:20:07]: [Server #3536466] Received 507.38 MB of payload data from client #91 (simulated).
[INFO][11:20:07]: [Server #3536466] Selecting client #61 for training.
[INFO][11:20:07]: [Server #3536466] Sending the current model to client #61 (simulated).
[INFO][11:20:12]: [Server #3536466] Sending 507.38 MB of payload data to client #61 (simulated).
[INFO][11:20:12]: [Client #61] Selected by the server.
[INFO][11:20:12]: [Client #61] Loading its data source...
[INFO][11:20:12]: [Client #61] Dataset size: 2018
[INFO][11:20:12]: [Client #61] Sampler: iid
[INFO][11:20:13]: [Client #61] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:20:13]: [Client #61] Start to process inbound data.
[INFO][11:20:13]: [93m[1m[Client #61] Started training in communication round #55.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.19s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:09<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.02it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.12it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.10it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.10it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:15<00:11,  2.09it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.09it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.19it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.16it/s] 71%|███████   | 34/48 [00:19<00:06,  2.13it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.09it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.08it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.08it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.08it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.08it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.81it/s]
[INFO][11:20:46]: [Client #61] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536584.pth.
{'train_runtime': 26.5746, 'train_samples_per_second': 227.811, 'train_steps_per_second': 1.806, 'train_loss': 2.6378706296284995, 'epoch': 3.0}
[INFO][11:20:47]: [Client #61] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536584.pth.
[INFO][11:20:47]: [Client #61] Model trained.
[INFO][11:20:47]: [Client #61] Inbound data has been processed.
[INFO][11:20:47]: [Client #61] Outbound data is ready to be sent after being processed.
[INFO][11:20:52]: [Client #61] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:20:53]: [Server #3536466] Received 507.38 MB of payload data from client #61 (simulated).
[INFO][11:20:53]: [Server #3536466] Adding client #55 to the list of clients for aggregation.
[INFO][11:20:53]: [Server #3536466] Adding client #70 to the list of clients for aggregation.
[INFO][11:20:53]: [Server #3536466] Adding client #95 to the list of clients for aggregation.
[INFO][11:20:53]: [Server #3536466] Adding client #94 to the list of clients for aggregation.
[INFO][11:20:53]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][11:20:53]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:20:53]: [Server #3536466] Updated weights have been received.
[INFO][11:20:54]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:20:54]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:20:54]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0304e+00  1e+02  1e+00  1e+00
 1:  2.9491e+00  2.0503e+00  3e+00  2e-02  2e-02
 2:  3.0356e+00  2.3370e+00  7e-01  3e-06  4e-07
 3:  3.0352e+00  3.0230e+00  1e-02  6e-08  8e-09
 4:  3.0333e+00  3.0298e+00  4e-03  9e-08  2e-08
 5:  3.0317e+00  3.0289e+00  3e-03  1e-06  7e-07
 6:  3.0310e+00  3.0300e+00  1e-03  5e-07  3e-07
 7:  3.0303e+00  3.0300e+00  3e-04  1e-06  9e-07
 8:  3.0300e+00  3.0300e+00  1e-05  4e-07  2e-07
 9:  3.0300e+00  3.0300e+00  2e-07  7e-09  4e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 0.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 1.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 1.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 0.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 1.1 1.1 6.1 6.1 1.1 1.1 6.1
 1.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.42it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.37it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.98it/s]100%|██████████| 8/8 [00:00<00:00, 11.79it/s]
[INFO][11:21:05]: [93m[1m[Server #3536466] Global model perplexity: 23.95
[0m
[INFO][11:21:05]: [Server #3536466] All client reports have been processed.
[INFO][11:21:05]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_55.pth.
[INFO][11:21:09]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_55.pth.
[INFO][11:21:09]: [93m[1m
[Server #3536466] Starting round 56/100.[0m
[INFO][11:21:09]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([9.98378335e-01, 3.25665998e-05, 3.25665998e-05, 3.25665998e-05,
       3.25665998e-05, 3.25665998e-05, 3.25665998e-05, 3.25665998e-05,
       3.25665998e-05, 3.25665998e-05, 3.95731215e-07, 3.11572583e-06,
       3.25665998e-05, 3.25665998e-05, 3.11572583e-06, 3.25665998e-05,
       3.25665998e-05, 3.11572583e-06, 1.18194336e-06, 3.25665998e-05,
       2.71895663e-07, 3.25665998e-05, 2.71895663e-07, 2.71895663e-07,
       2.71895663e-07, 3.25665998e-05, 3.25665998e-05, 6.31841296e-07,
       3.11572583e-06, 2.71895663e-07, 3.11572583e-06, 3.25665998e-05,
       3.11572583e-06, 3.11572583e-06, 3.11572583e-06, 3.25665998e-05,
       3.25665998e-05, 2.71895663e-07, 3.95731215e-07, 3.25665998e-05,
       3.25665998e-05, 3.25665998e-05, 3.95731215e-07, 3.25665998e-05,
       3.25665998e-05, 6.31841296e-07, 3.25665998e-05, 3.95731215e-07,
       2.71895663e-07, 2.71895663e-07, 3.95731215e-07, 3.25665998e-05,
       3.25665998e-05, 3.25665998e-05, 2.71895663e-07, 3.25665998e-05,
       2.71895663e-07, 3.25665998e-05, 3.25665998e-05, 3.25665998e-05,
       1.18194336e-06, 3.95731215e-07, 1.18194336e-06, 3.25665998e-05,
       1.18194336e-06, 3.11572583e-06, 3.25665998e-05, 3.25665998e-05,
       3.25665998e-05, 1.18194336e-06, 2.71895663e-07, 3.25665998e-05,
       1.18194336e-06, 3.25665998e-05, 3.25665998e-05, 3.11572583e-06,
       3.25665998e-05, 3.25665998e-05, 3.11572583e-06, 2.71895663e-07,
       3.25665998e-05, 2.71895663e-07, 2.71895663e-07, 3.25665998e-05,
       3.25665998e-05, 2.71895663e-07, 1.18194336e-06, 1.18194336e-06,
       3.25665998e-05, 3.11572583e-06, 3.11572583e-06, 3.25665998e-05,
       3.95731215e-07, 3.95731215e-07, 3.25665998e-05]),)
[INFO][11:21:09]: [Server #3536466] Selected clients: [ 1  8 89 88 45]
[INFO][11:21:09]: [Server #3536466] Selecting client #8 for training.
[INFO][11:21:09]: [Server #3536466] Sending the current model to client #8 (simulated).
[INFO][11:21:13]: [Server #3536466] Sending 507.38 MB of payload data to client #8 (simulated).
[INFO][11:21:13]: [Server #3536466] Selecting client #1 for training.
[INFO][11:21:13]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][11:21:18]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][11:21:18]: [Client #8] Selected by the server.
[INFO][11:21:18]: [Client #8] Loading its data source...
[INFO][11:21:18]: [Client #8] Dataset size: 2018
[INFO][11:21:18]: [Client #8] Sampler: iid
[INFO][11:21:18]: [Client #1] Selected by the server.
[INFO][11:21:18]: [Client #1] Loading its data source...
[INFO][11:21:18]: [Client #1] Dataset size: 2018
[INFO][11:21:18]: [Client #1] Sampler: iid
[INFO][11:21:20]: [Client #8] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:21:20]: [Client #8] Start to process inbound data.
[INFO][11:21:20]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:21:20]: [Client #1] Start to process inbound data.
[INFO][11:21:21]: [93m[1m[Client #8] Started training in communication round #56.[0m
[INFO][11:21:21]: [93m[1m[Client #1] Started training in communication round #56.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:39,  4.67s/it]  2%|▏         | 1/48 [00:04<03:46,  4.83s/it]  4%|▍         | 2/48 [00:05<01:49,  2.39s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.39it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.37it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][11:22:06]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 39.4718, 'train_samples_per_second': 153.375, 'train_steps_per_second': 1.216, 'train_loss': 2.3880081176757812, 'epoch': 3.0}
[INFO][11:22:06]: [Client #8] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_8_3536584.pth.
{'train_runtime': 39.3986, 'train_samples_per_second': 153.66, 'train_steps_per_second': 1.218, 'train_loss': 3.087223688761393, 'epoch': 3.0}
[INFO][11:22:07]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][11:22:08]: [Client #8] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_8_3536584.pth.
[INFO][11:22:08]: [Client #1] Model trained.
[INFO][11:22:08]: [Client #1] Inbound data has been processed.
[INFO][11:22:08]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][11:22:08]: [Client #8] Model trained.
[INFO][11:22:08]: [Client #8] Inbound data has been processed.
[INFO][11:22:08]: [Client #8] Outbound data is ready to be sent after being processed.
[INFO][11:22:17]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:22:17]: [Client #8] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:22:18]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][11:22:19]: [Server #3536466] Received 507.38 MB of payload data from client #8 (simulated).
[INFO][11:22:19]: [Server #3536466] Selecting client #88 for training.
[INFO][11:22:19]: [Server #3536466] Sending the current model to client #88 (simulated).
[INFO][11:22:23]: [Server #3536466] Sending 507.38 MB of payload data to client #88 (simulated).
[INFO][11:22:23]: [Server #3536466] Selecting client #89 for training.
[INFO][11:22:23]: [Server #3536466] Sending the current model to client #89 (simulated).
[INFO][11:22:28]: [Server #3536466] Sending 507.38 MB of payload data to client #89 (simulated).
[INFO][11:22:28]: [Client #88] Selected by the server.
[INFO][11:22:28]: [Client #88] Loading its data source...
[INFO][11:22:28]: [Client #89] Selected by the server.
[INFO][11:22:28]: [Client #88] Dataset size: 2018
[INFO][11:22:28]: [Client #89] Loading its data source...
[INFO][11:22:28]: [Client #88] Sampler: iid
[INFO][11:22:28]: [Client #89] Dataset size: 2018
[INFO][11:22:28]: [Client #89] Sampler: iid
[INFO][11:22:29]: [Client #88] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:22:29]: [Client #88] Start to process inbound data.
[INFO][11:22:30]: [Client #89] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:22:30]: [Client #89] Start to process inbound data.
[INFO][11:22:30]: [93m[1m[Client #88] Started training in communication round #56.[0m
[INFO][11:22:30]: [93m[1m[Client #89] Started training in communication round #56.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:47,  4.84s/it]  2%|▏         | 1/48 [00:04<03:50,  4.91s/it]  4%|▍         | 2/48 [00:05<01:54,  2.49s/it]  4%|▍         | 2/48 [00:05<01:55,  2.52s/it]  6%|▋         | 3/48 [00:06<01:16,  1.71s/it]  6%|▋         | 3/48 [00:06<01:18,  1.74s/it]  8%|▊         | 4/48 [00:07<00:58,  1.32s/it]  8%|▊         | 4/48 [00:07<00:59,  1.35s/it] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 10%|█         | 5/48 [00:08<00:48,  1.13s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:42,  1.00s/it] 15%|█▍        | 7/48 [00:09<00:37,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.16it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.21it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.30it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.39it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:22<00:18,  1.32it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.34it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.34it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
[INFO][11:23:17]: [Client #88] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_88_3536584.pth.
{'train_runtime': 39.9833, 'train_samples_per_second': 151.413, 'train_steps_per_second': 1.201, 'train_loss': 3.019733111063639, 'epoch': 3.0}
[INFO][11:23:17]: [Client #89] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_89_3536585.pth.
{'train_runtime': 39.8526, 'train_samples_per_second': 151.91, 'train_steps_per_second': 1.204, 'train_loss': 2.7959772745768228, 'epoch': 3.0}
[INFO][11:23:18]: [Client #88] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_88_3536584.pth.
[INFO][11:23:18]: [Client #89] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_89_3536585.pth.
[INFO][11:23:18]: [Client #88] Model trained.
[INFO][11:23:18]: [Client #88] Inbound data has been processed.
[INFO][11:23:18]: [Client #88] Outbound data is ready to be sent after being processed.
[INFO][11:23:18]: [Client #89] Model trained.
[INFO][11:23:18]: [Client #89] Inbound data has been processed.
[INFO][11:23:18]: [Client #89] Outbound data is ready to be sent after being processed.
[INFO][11:23:26]: [Client #89] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:23:27]: [Client #88] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:23:27]: [Server #3536466] Received 507.38 MB of payload data from client #89 (simulated).
[INFO][11:23:28]: [Server #3536466] Received 507.38 MB of payload data from client #88 (simulated).
[INFO][11:23:28]: [Server #3536466] Selecting client #45 for training.
[INFO][11:23:28]: [Server #3536466] Sending the current model to client #45 (simulated).
[INFO][11:23:33]: [Server #3536466] Sending 507.38 MB of payload data to client #45 (simulated).
[INFO][11:23:33]: [Client #45] Selected by the server.
[INFO][11:23:33]: [Client #45] Loading its data source...
[INFO][11:23:33]: [Client #45] Dataset size: 2018
[INFO][11:23:33]: [Client #45] Sampler: iid
[INFO][11:23:34]: [Client #45] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:23:34]: [Client #45] Start to process inbound data.
[INFO][11:23:35]: [93m[1m[Client #45] Started training in communication round #56.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.21s/it]  4%|▍         | 2/48 [00:04<01:32,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:09<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.02it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.12it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.11it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.10it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.10it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.06it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.05it/s] 60%|██████    | 29/48 [00:17<00:09,  2.05it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.05it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.05it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.15it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.12it/s] 71%|███████   | 34/48 [00:19<00:06,  2.10it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.08it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.07it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.06it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.06it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.05it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.05it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.05it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.05it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.05it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.04it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.04it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.04it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.05it/s]100%|██████████| 48/48 [00:26<00:00,  2.14it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.14it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][11:24:07]: [Client #45] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_45_3536584.pth.
{'train_runtime': 26.774, 'train_samples_per_second': 226.115, 'train_steps_per_second': 1.793, 'train_loss': 2.7800108591715493, 'epoch': 3.0}
[INFO][11:24:09]: [Client #45] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_45_3536584.pth.
[INFO][11:24:09]: [Client #45] Model trained.
[INFO][11:24:09]: [Client #45] Inbound data has been processed.
[INFO][11:24:09]: [Client #45] Outbound data is ready to be sent after being processed.
[INFO][11:24:14]: [Client #45] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:24:15]: [Server #3536466] Received 507.38 MB of payload data from client #45 (simulated).
[INFO][11:24:15]: [Server #3536466] Adding client #78 to the list of clients for aggregation.
[INFO][11:24:15]: [Server #3536466] Adding client #61 to the list of clients for aggregation.
[INFO][11:24:15]: [Server #3536466] Adding client #18 to the list of clients for aggregation.
[INFO][11:24:15]: [Server #3536466] Adding client #91 to the list of clients for aggregation.
[INFO][11:24:15]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][11:24:15]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:24:15]: [Server #3536466] Updated weights have been received.
[INFO][11:24:16]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:24:16]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:24:16]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0346e+00  1e+02  1e+00  1e+00
 1:  2.9539e+00  2.0546e+00  3e+00  2e-02  2e-02
 2:  3.0398e+00  2.3425e+00  7e-01  3e-06  4e-07
 3:  3.0394e+00  3.0272e+00  1e-02  6e-08  8e-09
 4:  3.0377e+00  3.0341e+00  4e-03  9e-08  2e-08
 5:  3.0362e+00  3.0332e+00  3e-03  9e-07  8e-07
 6:  3.0356e+00  3.0342e+00  1e-03  5e-07  4e-07
 7:  3.0348e+00  3.0343e+00  5e-04  3e-06  3e-06
 8:  3.0344e+00  3.0343e+00  1e-04  1e-06  1e-06
 9:  3.0343e+00  3.0343e+00  2e-06  8e-08  6e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 1.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 1.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 1.1 1.1 6.1 6.1 1.1 1.1 6.1
 1.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.70it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.38it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.84it/s]100%|██████████| 8/8 [00:00<00:00, 11.67it/s]
[INFO][11:24:27]: [93m[1m[Server #3536466] Global model perplexity: 24.59
[0m
[INFO][11:24:27]: [Server #3536466] All client reports have been processed.
[INFO][11:24:27]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_56.pth.
[INFO][11:24:31]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_56.pth.
[INFO][11:24:31]: [93m[1m
[Server #3536466] Starting round 57/100.[0m
[INFO][11:24:31]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([9.98378335e-01, 3.25665998e-05, 3.25665998e-05, 3.25665998e-05,
       3.25665998e-05, 3.25665998e-05, 3.25665998e-05, 3.25665998e-05,
       3.25665998e-05, 3.95731215e-07, 3.11572583e-06, 3.25665998e-05,
       3.25665998e-05, 3.11572583e-06, 3.25665998e-05, 3.25665998e-05,
       3.25665998e-05, 3.11572583e-06, 1.18194336e-06, 3.25665998e-05,
       2.71895663e-07, 3.25665998e-05, 2.71895663e-07, 2.71895663e-07,
       2.71895663e-07, 3.25665998e-05, 3.25665998e-05, 6.31841296e-07,
       3.11572583e-06, 2.71895663e-07, 3.11572583e-06, 3.25665998e-05,
       3.11572583e-06, 3.11572583e-06, 3.11572583e-06, 3.25665998e-05,
       3.25665998e-05, 2.71895663e-07, 3.95731215e-07, 3.25665998e-05,
       3.25665998e-05, 3.25665998e-05, 3.95731215e-07, 3.25665998e-05,
       6.31841296e-07, 3.25665998e-05, 3.95731215e-07, 2.71895663e-07,
       2.71895663e-07, 3.95731215e-07, 3.25665998e-05, 3.25665998e-05,
       3.25665998e-05, 2.71895663e-07, 3.25665998e-05, 2.71895663e-07,
       3.25665998e-05, 3.25665998e-05, 3.25665998e-05, 3.25665998e-05,
       1.18194336e-06, 3.95731215e-07, 1.18194336e-06, 3.25665998e-05,
       1.18194336e-06, 3.11572583e-06, 3.25665998e-05, 3.25665998e-05,
       3.25665998e-05, 1.18194336e-06, 2.71895663e-07, 3.25665998e-05,
       1.18194336e-06, 3.25665998e-05, 3.25665998e-05, 3.25665998e-05,
       3.11572583e-06, 3.25665998e-05, 3.25665998e-05, 3.11572583e-06,
       2.71895663e-07, 3.25665998e-05, 2.71895663e-07, 2.71895663e-07,
       2.71895663e-07, 3.25665998e-05, 1.18194336e-06, 1.18194336e-06,
       3.25665998e-05, 3.11572583e-06, 3.11572583e-06, 3.25665998e-05,
       3.95731215e-07, 3.95731215e-07, 3.25665998e-05]),)
[INFO][11:24:31]: [Server #3536466] Selected clients: [ 1 14 97 23  7]
[INFO][11:24:31]: [Server #3536466] Selecting client #14 for training.
[INFO][11:24:31]: [Server #3536466] Sending the current model to client #14 (simulated).
[INFO][11:24:35]: [Server #3536466] Sending 507.38 MB of payload data to client #14 (simulated).
[INFO][11:24:35]: [Server #3536466] Selecting client #1 for training.
[INFO][11:24:35]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][11:24:40]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][11:24:40]: [Client #14] Selected by the server.
[INFO][11:24:40]: [Client #14] Loading its data source...
[INFO][11:24:40]: [Client #14] Dataset size: 2018
[INFO][11:24:40]: [Client #14] Sampler: iid
[INFO][11:24:40]: [Client #1] Selected by the server.
[INFO][11:24:40]: [Client #1] Loading its data source...
[INFO][11:24:40]: [Client #1] Dataset size: 2018
[INFO][11:24:40]: [Client #1] Sampler: iid
[INFO][11:24:41]: [Client #14] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:24:41]: [Client #14] Start to process inbound data.
[INFO][11:24:41]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:24:41]: [Client #1] Start to process inbound data.
[INFO][11:24:42]: [93m[1m[Client #14] Started training in communication round #57.[0m
[INFO][11:24:42]: [93m[1m[Client #1] Started training in communication round #57.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.21s/it]  2%|▏         | 1/48 [00:04<03:47,  4.83s/it]  4%|▍         | 2/48 [00:04<01:38,  2.14s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  6%|▋         | 3/48 [00:05<01:07,  1.50s/it]  6%|▋         | 3/48 [00:06<01:15,  1.67s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.42it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:38<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.36it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][11:25:28]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 38.9944, 'train_samples_per_second': 155.253, 'train_steps_per_second': 1.231, 'train_loss': 2.3566293716430664, 'epoch': 3.0}
[INFO][11:25:28]: [Client #14] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
{'train_runtime': 39.421, 'train_samples_per_second': 153.573, 'train_steps_per_second': 1.218, 'train_loss': 2.9026501973470054, 'epoch': 3.0}
[INFO][11:25:29]: [Client #14] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
[INFO][11:25:29]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][11:25:29]: [Client #14] Model trained.
[INFO][11:25:29]: [Client #14] Inbound data has been processed.
[INFO][11:25:29]: [Client #14] Outbound data is ready to be sent after being processed.
[INFO][11:25:30]: [Client #1] Model trained.
[INFO][11:25:30]: [Client #1] Inbound data has been processed.
[INFO][11:25:30]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][11:25:38]: [Client #14] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:25:38]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:25:39]: [Server #3536466] Received 507.38 MB of payload data from client #14 (simulated).
[INFO][11:25:39]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][11:25:39]: [Server #3536466] Selecting client #97 for training.
[INFO][11:25:40]: [Server #3536466] Sending the current model to client #97 (simulated).
[INFO][11:25:44]: [Server #3536466] Sending 507.38 MB of payload data to client #97 (simulated).
[INFO][11:25:44]: [Server #3536466] Selecting client #23 for training.
[INFO][11:25:44]: [Server #3536466] Sending the current model to client #23 (simulated).
[INFO][11:25:49]: [Server #3536466] Sending 507.38 MB of payload data to client #23 (simulated).
[INFO][11:25:49]: [Client #97] Selected by the server.
[INFO][11:25:49]: [Client #97] Loading its data source...
[INFO][11:25:49]: [Client #97] Dataset size: 2018
[INFO][11:25:49]: [Client #23] Selected by the server.
[INFO][11:25:49]: [Client #97] Sampler: iid
[INFO][11:25:49]: [Client #23] Loading its data source...
[INFO][11:25:49]: [Client #23] Dataset size: 2018
[INFO][11:25:49]: [Client #23] Sampler: iid
[INFO][11:25:50]: [Client #23] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:25:50]: [Client #23] Start to process inbound data.
[INFO][11:25:50]: [93m[1m[Client #23] Started training in communication round #57.[0m
[INFO][11:25:50]: [Client #97] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:25:50]: [Client #97] Start to process inbound data.
[INFO][11:25:51]: [93m[1m[Client #97] Started training in communication round #57.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.19s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:37,  2.13s/it]  2%|▏         | 1/48 [00:04<03:52,  4.95s/it]  6%|▋         | 3/48 [00:05<01:11,  1.59s/it]  4%|▍         | 2/48 [00:06<02:02,  2.67s/it]  8%|▊         | 4/48 [00:06<01:01,  1.39s/it]  6%|▋         | 3/48 [00:07<01:27,  1.94s/it] 10%|█         | 5/48 [00:07<00:54,  1.27s/it]  8%|▊         | 4/48 [00:08<01:10,  1.60s/it] 12%|█▎        | 6/48 [00:09<00:50,  1.20s/it] 10%|█         | 5/48 [00:09<00:59,  1.39s/it] 15%|█▍        | 7/48 [00:10<00:46,  1.14s/it] 12%|█▎        | 6/48 [00:10<00:53,  1.28s/it] 17%|█▋        | 8/48 [00:11<00:44,  1.12s/it] 15%|█▍        | 7/48 [00:11<00:48,  1.19s/it] 19%|█▉        | 9/48 [00:12<00:42,  1.08s/it] 17%|█▋        | 8/48 [00:12<00:45,  1.13s/it] 21%|██        | 10/48 [00:13<00:39,  1.05s/it] 19%|█▉        | 9/48 [00:13<00:43,  1.11s/it] 23%|██▎       | 11/48 [00:14<00:39,  1.06s/it] 21%|██        | 10/48 [00:14<00:41,  1.10s/it] 25%|██▌       | 12/48 [00:15<00:38,  1.07s/it] 23%|██▎       | 11/48 [00:15<00:40,  1.09s/it] 27%|██▋       | 13/48 [00:16<00:37,  1.07s/it] 25%|██▌       | 12/48 [00:16<00:39,  1.08s/it] 29%|██▉       | 14/48 [00:17<00:36,  1.08s/it] 27%|██▋       | 13/48 [00:17<00:37,  1.08s/it] 31%|███▏      | 15/48 [00:18<00:35,  1.08s/it] 29%|██▉       | 14/48 [00:18<00:35,  1.04s/it] 33%|███▎      | 16/48 [00:19<00:31,  1.02it/s] 31%|███▏      | 15/48 [00:19<00:31,  1.04it/s] 35%|███▌      | 17/48 [00:20<00:28,  1.10it/s] 33%|███▎      | 16/48 [00:19<00:27,  1.16it/s] 38%|███▊      | 18/48 [00:20<00:25,  1.17it/s] 35%|███▌      | 17/48 [00:20<00:25,  1.19it/s] 40%|███▉      | 19/48 [00:21<00:23,  1.23it/s] 38%|███▊      | 18/48 [00:21<00:24,  1.22it/s] 42%|████▏     | 20/48 [00:22<00:22,  1.26it/s] 40%|███▉      | 19/48 [00:22<00:23,  1.23it/s] 44%|████▍     | 21/48 [00:22<00:21,  1.28it/s] 42%|████▏     | 20/48 [00:23<00:22,  1.27it/s] 46%|████▌     | 22/48 [00:23<00:20,  1.29it/s] 44%|████▍     | 21/48 [00:23<00:20,  1.30it/s] 48%|████▊     | 23/48 [00:24<00:19,  1.31it/s] 46%|████▌     | 22/48 [00:24<00:19,  1.31it/s] 50%|█████     | 24/48 [00:25<00:18,  1.32it/s] 48%|████▊     | 23/48 [00:25<00:18,  1.32it/s] 52%|█████▏    | 25/48 [00:25<00:17,  1.33it/s] 50%|█████     | 24/48 [00:26<00:18,  1.32it/s] 54%|█████▍    | 26/48 [00:26<00:16,  1.33it/s] 52%|█████▏    | 25/48 [00:26<00:17,  1.32it/s] 56%|█████▋    | 27/48 [00:27<00:15,  1.33it/s] 54%|█████▍    | 26/48 [00:27<00:16,  1.33it/s] 58%|█████▊    | 28/48 [00:28<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:28<00:15,  1.31it/s] 60%|██████    | 29/48 [00:28<00:14,  1.33it/s] 58%|█████▊    | 28/48 [00:29<00:15,  1.32it/s] 62%|██████▎   | 30/48 [00:29<00:13,  1.32it/s] 60%|██████    | 29/48 [00:29<00:14,  1.33it/s] 65%|██████▍   | 31/48 [00:30<00:12,  1.33it/s] 62%|██████▎   | 30/48 [00:30<00:13,  1.33it/s] 67%|██████▋   | 32/48 [00:31<00:11,  1.37it/s] 65%|██████▍   | 31/48 [00:31<00:13,  1.30it/s] 69%|██████▉   | 33/48 [00:31<00:11,  1.32it/s] 67%|██████▋   | 32/48 [00:31<00:11,  1.39it/s] 71%|███████   | 34/48 [00:32<00:10,  1.33it/s] 69%|██████▉   | 33/48 [00:32<00:11,  1.36it/s] 73%|███████▎  | 35/48 [00:33<00:09,  1.34it/s] 71%|███████   | 34/48 [00:33<00:10,  1.35it/s] 75%|███████▌  | 36/48 [00:34<00:08,  1.34it/s] 73%|███████▎  | 35/48 [00:34<00:09,  1.34it/s] 77%|███████▋  | 37/48 [00:34<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:34<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:35<00:07,  1.34it/s] 77%|███████▋  | 37/48 [00:35<00:08,  1.34it/s] 81%|████████▏ | 39/48 [00:36<00:06,  1.34it/s] 79%|███████▉  | 38/48 [00:36<00:07,  1.33it/s] 83%|████████▎ | 40/48 [00:37<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:37<00:06,  1.34it/s] 85%|████████▌ | 41/48 [00:37<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:37<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:38<00:04,  1.34it/s] 85%|████████▌ | 41/48 [00:38<00:05,  1.34it/s] 90%|████████▉ | 43/48 [00:39<00:03,  1.34it/s] 88%|████████▊ | 42/48 [00:39<00:04,  1.34it/s] 92%|█████████▏| 44/48 [00:40<00:02,  1.34it/s] 90%|████████▉ | 43/48 [00:40<00:03,  1.31it/s] 94%|█████████▍| 45/48 [00:40<00:02,  1.33it/s] 92%|█████████▏| 44/48 [00:41<00:03,  1.33it/s] 96%|█████████▌| 46/48 [00:41<00:01,  1.32it/s] 94%|█████████▍| 45/48 [00:41<00:02,  1.33it/s] 98%|█████████▊| 47/48 [00:42<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:42<00:01,  1.33it/s]100%|██████████| 48/48 [00:43<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:43<00:00,  1.36it/s]100%|██████████| 48/48 [00:43<00:00,  1.11it/s]
 98%|█████████▊| 47/48 [00:43<00:00,  1.48it/s]100%|██████████| 48/48 [00:43<00:00,  1.67it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:43<00:00,  1.67it/s]100%|██████████| 48/48 [00:43<00:00,  1.11it/s]
[INFO][11:26:40]: [Client #23] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_23_3536585.pth.
{'train_runtime': 43.1079, 'train_samples_per_second': 140.438, 'train_steps_per_second': 1.113, 'train_loss': 2.7380733489990234, 'epoch': 3.0}
[INFO][11:26:41]: [Client #97] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_97_3536584.pth.
{'train_runtime': 43.4297, 'train_samples_per_second': 139.398, 'train_steps_per_second': 1.105, 'train_loss': 2.8540337880452475, 'epoch': 3.0}
[INFO][11:26:41]: [Client #23] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_23_3536585.pth.
[INFO][11:26:41]: [Client #23] Model trained.
[INFO][11:26:41]: [Client #23] Inbound data has been processed.
[INFO][11:26:41]: [Client #23] Outbound data is ready to be sent after being processed.
[INFO][11:26:42]: [Client #97] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_97_3536584.pth.
[INFO][11:26:42]: [Client #97] Model trained.
[INFO][11:26:42]: [Client #97] Inbound data has been processed.
[INFO][11:26:42]: [Client #97] Outbound data is ready to be sent after being processed.
[INFO][11:26:49]: [Client #23] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:26:50]: [Server #3536466] Received 507.38 MB of payload data from client #23 (simulated).
[INFO][11:26:50]: [Client #97] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:26:51]: [Server #3536466] Received 507.38 MB of payload data from client #97 (simulated).
[INFO][11:26:51]: [Server #3536466] Selecting client #7 for training.
[INFO][11:26:51]: [Server #3536466] Sending the current model to client #7 (simulated).
[INFO][11:26:56]: [Server #3536466] Sending 507.38 MB of payload data to client #7 (simulated).
[INFO][11:26:56]: [Client #7] Selected by the server.
[INFO][11:26:56]: [Client #7] Loading its data source...
[INFO][11:26:56]: [Client #7] Dataset size: 2018
[INFO][11:26:56]: [Client #7] Sampler: iid
[INFO][11:26:57]: [Client #7] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:26:57]: [Client #7] Start to process inbound data.
[INFO][11:26:58]: [93m[1m[Client #7] Started training in communication round #57.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.19s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:58,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.25it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.45it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.61it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:19,  1.90it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][11:27:30]: [Client #7] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536584.pth.
{'train_runtime': 26.6083, 'train_samples_per_second': 227.523, 'train_steps_per_second': 1.804, 'train_loss': 2.7119213740030923, 'epoch': 3.0}
[INFO][11:27:31]: [Client #7] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536584.pth.
[INFO][11:27:32]: [Client #7] Model trained.
[INFO][11:27:32]: [Client #7] Inbound data has been processed.
[INFO][11:27:32]: [Client #7] Outbound data is ready to be sent after being processed.
[INFO][11:27:37]: [Client #7] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:27:38]: [Server #3536466] Received 507.38 MB of payload data from client #7 (simulated).
[INFO][11:27:38]: [Server #3536466] Adding client #45 to the list of clients for aggregation.
[INFO][11:27:38]: [Server #3536466] Adding client #84 to the list of clients for aggregation.
[INFO][11:27:38]: [Server #3536466] Adding client #88 to the list of clients for aggregation.
[INFO][11:27:38]: [Server #3536466] Adding client #89 to the list of clients for aggregation.
[INFO][11:27:38]: [Server #3536466] Adding client #8 to the list of clients for aggregation.
[INFO][11:27:38]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:27:38]: [Server #3536466] Updated weights have been received.
[INFO][11:27:39]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:27:39]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:27:39]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0346e+00  1e+02  1e+00  1e+00
 1:  2.9539e+00  2.0546e+00  3e+00  2e-02  2e-02
 2:  3.0398e+00  2.3425e+00  7e-01  3e-06  4e-07
 3:  3.0394e+00  3.0272e+00  1e-02  6e-08  8e-09
 4:  3.0377e+00  3.0341e+00  4e-03  9e-08  2e-08
 5:  3.0362e+00  3.0332e+00  3e-03  9e-07  8e-07
 6:  3.0356e+00  3.0342e+00  1e-03  5e-07  4e-07
 7:  3.0348e+00  3.0343e+00  5e-04  3e-06  3e-06
 8:  3.0344e+00  3.0343e+00  1e-04  1e-06  1e-06
 9:  3.0343e+00  3.0343e+00  2e-06  8e-08  6e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 1.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 1.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 1.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.53it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.39it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.80it/s]100%|██████████| 8/8 [00:00<00:00, 11.60it/s]
[INFO][11:27:50]: [93m[1m[Server #3536466] Global model perplexity: 22.96
[0m
[INFO][11:27:50]: [Server #3536466] All client reports have been processed.
[INFO][11:27:50]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_57.pth.
[INFO][11:27:53]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_57.pth.
[INFO][11:27:53]: [93m[1m
[Server #3536466] Starting round 58/100.[0m
[INFO][11:27:53]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.08298805e-02, 2.08298805e-02, 2.08298805e-02, 2.08298805e-02,
       2.08298805e-02, 2.08298805e-02, 2.08298805e-02, 2.08298805e-02,
       4.61932077e-07, 1.01991986e-05, 2.08298805e-02, 1.01991986e-05,
       2.08298805e-02, 2.08298805e-02, 2.08298805e-02, 1.01991986e-05,
       2.85975064e-06, 2.08298805e-02, 2.21907977e-07, 2.21907977e-07,
       2.21907977e-07, 2.21907977e-07, 2.08298805e-02, 2.08298805e-02,
       1.08208764e-06, 1.01991986e-05, 2.21907977e-07, 1.01991986e-05,
       2.08298805e-02, 1.01991986e-05, 1.01991986e-05, 1.01991986e-05,
       2.08298805e-02, 2.08298805e-02, 2.21907977e-07, 4.61932077e-07,
       2.08298805e-02, 2.08298805e-02, 2.08298805e-02, 4.61932077e-07,
       2.08298805e-02, 2.08298805e-02, 1.08208764e-06, 2.08298805e-02,
       4.61932077e-07, 2.21907977e-07, 2.21907977e-07, 4.61932077e-07,
       2.08298805e-02, 2.08298805e-02, 2.08298805e-02, 2.21907977e-07,
       2.08298805e-02, 2.21907977e-07, 2.08298805e-02, 2.08298805e-02,
       2.08298805e-02, 2.08298805e-02, 2.85975064e-06, 4.61932077e-07,
       2.85975064e-06, 2.08298805e-02, 2.85975064e-06, 1.01991986e-05,
       2.08298805e-02, 2.08298805e-02, 2.08298805e-02, 2.85975064e-06,
       2.21907977e-07, 2.08298805e-02, 2.85975064e-06, 2.08298805e-02,
       2.08298805e-02, 2.08298805e-02, 1.01991986e-05, 2.08298805e-02,
       2.08298805e-02, 1.01991986e-05, 2.21907977e-07, 1.08208764e-06,
       2.08298805e-02, 2.21907977e-07, 2.21907977e-07, 2.08298805e-02,
       2.08298805e-02, 2.21907977e-07, 2.08298805e-02, 2.85975064e-06,
       2.85975064e-06, 2.08298805e-02, 1.01991986e-05, 1.01991986e-05,
       4.61932077e-07, 4.61932077e-07, 2.08298805e-02]),)
[INFO][11:27:53]: [Server #3536466] Selected clients: [ 9  2 70 57 77]
[INFO][11:27:53]: [Server #3536466] Selecting client #2 for training.
[INFO][11:27:53]: [Server #3536466] Sending the current model to client #2 (simulated).
[INFO][11:27:58]: [Server #3536466] Sending 507.38 MB of payload data to client #2 (simulated).
[INFO][11:27:58]: [Server #3536466] Selecting client #9 for training.
[INFO][11:27:58]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][11:28:03]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][11:28:03]: [Client #2] Selected by the server.
[INFO][11:28:03]: [Client #2] Loading its data source...
[INFO][11:28:03]: [Client #2] Dataset size: 2018
[INFO][11:28:03]: [Client #2] Sampler: iid
[INFO][11:28:03]: [Client #9] Selected by the server.
[INFO][11:28:03]: [Client #9] Loading its data source...
[INFO][11:28:03]: [Client #9] Dataset size: 2018
[INFO][11:28:03]: [Client #9] Sampler: iid
[INFO][11:28:04]: [Client #2] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:28:04]: [Client #2] Start to process inbound data.
[INFO][11:28:04]: [93m[1m[Client #2] Started training in communication round #58.[0m
[INFO][11:28:04]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:28:04]: [Client #9] Start to process inbound data.
[INFO][11:28:05]: [93m[1m[Client #9] Started training in communication round #58.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:30,  4.48s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:05<01:43,  2.25s/it]  2%|▏         | 1/48 [00:04<03:48,  4.87s/it]  6%|▋         | 3/48 [00:05<01:11,  1.60s/it]  4%|▍         | 2/48 [00:05<01:57,  2.55s/it]  8%|▊         | 4/48 [00:06<00:58,  1.34s/it]  6%|▋         | 3/48 [00:06<01:20,  1.79s/it] 10%|█         | 5/48 [00:07<00:52,  1.21s/it]  8%|▊         | 4/48 [00:07<01:04,  1.47s/it] 12%|█▎        | 6/48 [00:08<00:46,  1.10s/it] 10%|█         | 5/48 [00:08<00:54,  1.27s/it] 15%|█▍        | 7/48 [00:09<00:43,  1.07s/it] 12%|█▎        | 6/48 [00:09<00:47,  1.13s/it] 17%|█▋        | 8/48 [00:10<00:40,  1.02s/it] 15%|█▍        | 7/48 [00:10<00:43,  1.06s/it] 19%|█▉        | 9/48 [00:11<00:38,  1.02it/s] 17%|█▋        | 8/48 [00:11<00:40,  1.00s/it] 21%|██        | 10/48 [00:12<00:36,  1.05it/s] 19%|█▉        | 9/48 [00:12<00:38,  1.02it/s] 23%|██▎       | 11/48 [00:13<00:34,  1.07it/s] 21%|██        | 10/48 [00:13<00:35,  1.06it/s] 25%|██▌       | 12/48 [00:14<00:32,  1.10it/s] 23%|██▎       | 11/48 [00:13<00:34,  1.07it/s] 27%|██▋       | 13/48 [00:15<00:31,  1.12it/s] 25%|██▌       | 12/48 [00:14<00:33,  1.09it/s] 29%|██▉       | 14/48 [00:15<00:30,  1.11it/s] 27%|██▋       | 13/48 [00:15<00:32,  1.07it/s] 31%|███▏      | 15/48 [00:16<00:29,  1.11it/s] 29%|██▉       | 14/48 [00:16<00:33,  1.02it/s] 33%|███▎      | 16/48 [00:17<00:30,  1.06it/s] 31%|███▏      | 15/48 [00:17<00:32,  1.01it/s] 35%|███▌      | 17/48 [00:19<00:30,  1.00it/s] 33%|███▎      | 16/48 [00:18<00:29,  1.08it/s] 38%|███▊      | 18/48 [00:20<00:30,  1.01s/it] 35%|███▌      | 17/48 [00:19<00:30,  1.03it/s] 40%|███▉      | 19/48 [00:21<00:29,  1.01s/it] 38%|███▊      | 18/48 [00:20<00:29,  1.02it/s] 42%|████▏     | 20/48 [00:22<00:27,  1.02it/s] 40%|███▉      | 19/48 [00:21<00:27,  1.04it/s] 44%|████▍     | 21/48 [00:22<00:25,  1.07it/s] 42%|████▏     | 20/48 [00:22<00:25,  1.08it/s] 46%|████▌     | 22/48 [00:23<00:23,  1.11it/s] 44%|████▍     | 21/48 [00:23<00:25,  1.08it/s] 48%|████▊     | 23/48 [00:24<00:22,  1.10it/s] 46%|████▌     | 22/48 [00:24<00:24,  1.07it/s] 50%|█████     | 24/48 [00:25<00:22,  1.09it/s] 48%|████▊     | 23/48 [00:25<00:23,  1.07it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.09it/s] 50%|█████     | 24/48 [00:26<00:22,  1.09it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.10it/s] 52%|█████▏    | 25/48 [00:27<00:20,  1.11it/s] 56%|█████▋    | 27/48 [00:28<00:18,  1.11it/s] 54%|█████▍    | 26/48 [00:28<00:20,  1.08it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.06it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.07it/s] 60%|██████    | 29/48 [00:30<00:17,  1.06it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.08it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.06it/s] 60%|██████    | 29/48 [00:30<00:17,  1.09it/s] 65%|██████▍   | 31/48 [00:32<00:15,  1.07it/s] 62%|██████▎   | 30/48 [00:31<00:17,  1.01it/s] 67%|██████▋   | 32/48 [00:32<00:14,  1.08it/s] 65%|██████▍   | 31/48 [00:32<00:15,  1.07it/s] 69%|██████▉   | 33/48 [00:33<00:13,  1.15it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.07it/s] 71%|███████   | 34/48 [00:34<00:13,  1.08it/s] 69%|██████▉   | 33/48 [00:34<00:14,  1.04it/s] 73%|███████▎  | 35/48 [00:35<00:12,  1.04it/s] 71%|███████   | 34/48 [00:35<00:13,  1.03it/s] 75%|███████▌  | 36/48 [00:36<00:11,  1.01it/s] 73%|███████▎  | 35/48 [00:36<00:12,  1.05it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.05it/s] 75%|███████▌  | 36/48 [00:37<00:11,  1.08it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.07it/s] 77%|███████▋  | 37/48 [00:38<00:09,  1.11it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.09it/s] 79%|███████▉  | 38/48 [00:39<00:09,  1.09it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.07it/s] 81%|████████▏ | 39/48 [00:40<00:08,  1.09it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.08it/s] 83%|████████▎ | 40/48 [00:41<00:07,  1.09it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.10it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.10it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.10it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.08it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.10it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.10it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.08it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.08it/s] 96%|█████████▌| 46/48 [00:45<00:01,  1.09it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.06it/s] 98%|█████████▊| 47/48 [00:46<00:00,  1.08it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.02it/s]100%|██████████| 48/48 [00:47<00:00,  1.06it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.06it/s]100%|██████████| 48/48 [00:47<00:00,  1.00it/s]
 98%|█████████▊| 47/48 [00:47<00:00,  1.15it/s]100%|██████████| 48/48 [00:47<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.36it/s]100%|██████████| 48/48 [00:47<00:00,  1.00it/s]
[INFO][11:28:59]: [Client #2] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
{'train_runtime': 47.8932, 'train_samples_per_second': 126.406, 'train_steps_per_second': 1.002, 'train_loss': 3.0181735356648765, 'epoch': 3.0}
[INFO][11:28:59]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 47.8717, 'train_samples_per_second': 126.463, 'train_steps_per_second': 1.003, 'train_loss': 2.042235851287842, 'epoch': 3.0}
[INFO][11:29:00]: [Client #2] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
[INFO][11:29:00]: [Client #2] Model trained.
[INFO][11:29:00]: [Client #2] Inbound data has been processed.
[INFO][11:29:00]: [Client #2] Outbound data is ready to be sent after being processed.
[INFO][11:29:01]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][11:29:01]: [Client #9] Model trained.
[INFO][11:29:01]: [Client #9] Inbound data has been processed.
[INFO][11:29:01]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][11:29:08]: [Client #2] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:29:09]: [Server #3536466] Received 507.38 MB of payload data from client #2 (simulated).
[INFO][11:29:09]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:29:10]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][11:29:10]: [Server #3536466] Selecting client #70 for training.
[INFO][11:29:10]: [Server #3536466] Sending the current model to client #70 (simulated).
[INFO][11:29:14]: [Server #3536466] Sending 507.38 MB of payload data to client #70 (simulated).
[INFO][11:29:14]: [Server #3536466] Selecting client #77 for training.
[INFO][11:29:14]: [Server #3536466] Sending the current model to client #77 (simulated).
[INFO][11:29:19]: [Server #3536466] Sending 507.38 MB of payload data to client #77 (simulated).
[INFO][11:29:19]: [Client #70] Selected by the server.
[INFO][11:29:19]: [Client #77] Selected by the server.
[INFO][11:29:19]: [Client #70] Loading its data source...
[INFO][11:29:19]: [Client #77] Loading its data source...
[INFO][11:29:19]: [Client #70] Dataset size: 2018
[INFO][11:29:19]: [Client #77] Dataset size: 2018
[INFO][11:29:19]: [Client #70] Sampler: iid
[INFO][11:29:19]: [Client #77] Sampler: iid
[INFO][11:29:20]: [Client #77] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:29:20]: [Client #77] Start to process inbound data.
[INFO][11:29:20]: [Client #70] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:29:20]: [Client #70] Start to process inbound data.
[INFO][11:29:21]: [93m[1m[Client #70] Started training in communication round #58.[0m
[INFO][11:29:21]: [93m[1m[Client #77] Started training in communication round #58.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:33,  4.55s/it]  2%|▏         | 1/48 [00:05<03:57,  5.06s/it]  4%|▍         | 2/48 [00:05<01:46,  2.31s/it]  4%|▍         | 2/48 [00:05<01:57,  2.55s/it]  6%|▋         | 3/48 [00:05<01:11,  1.58s/it]  6%|▋         | 3/48 [00:06<01:18,  1.74s/it]  8%|▊         | 4/48 [00:06<00:54,  1.24s/it]  8%|▊         | 4/48 [00:07<00:59,  1.35s/it] 10%|█         | 5/48 [00:07<00:45,  1.06s/it] 10%|█         | 5/48 [00:08<00:48,  1.13s/it] 12%|█▎        | 6/48 [00:08<00:39,  1.05it/s] 12%|█▎        | 6/48 [00:08<00:42,  1.01s/it] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:38,  1.07it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:35,  1.14it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.22it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.20it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.36it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.34it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.33it/s] 50%|█████     | 24/48 [00:22<00:18,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.32it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.42it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.31it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
[INFO][11:30:07]: [Client #77] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_77_3536585.pth.
{'train_runtime': 39.5348, 'train_samples_per_second': 153.131, 'train_steps_per_second': 1.214, 'train_loss': 2.6844924290974936, 'epoch': 3.0}
[INFO][11:30:07]: [Client #70] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_70_3536584.pth.
{'train_runtime': 39.923, 'train_samples_per_second': 151.642, 'train_steps_per_second': 1.202, 'train_loss': 2.9548699061075845, 'epoch': 3.0}
[INFO][11:30:08]: [Client #70] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_70_3536584.pth.
[INFO][11:30:09]: [Client #77] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_77_3536585.pth.
[INFO][11:30:09]: [Client #70] Model trained.
[INFO][11:30:09]: [Client #70] Inbound data has been processed.
[INFO][11:30:09]: [Client #70] Outbound data is ready to be sent after being processed.
[INFO][11:30:09]: [Client #77] Model trained.
[INFO][11:30:09]: [Client #77] Inbound data has been processed.
[INFO][11:30:09]: [Client #77] Outbound data is ready to be sent after being processed.
[INFO][11:30:16]: [Client #77] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:30:17]: [Server #3536466] Received 507.38 MB of payload data from client #77 (simulated).
[INFO][11:30:18]: [Client #70] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:30:19]: [Server #3536466] Received 507.38 MB of payload data from client #70 (simulated).
[INFO][11:30:19]: [Server #3536466] Selecting client #57 for training.
[INFO][11:30:19]: [Server #3536466] Sending the current model to client #57 (simulated).
[INFO][11:30:23]: [Server #3536466] Sending 507.38 MB of payload data to client #57 (simulated).
[INFO][11:30:23]: [Client #57] Selected by the server.
[INFO][11:30:23]: [Client #57] Loading its data source...
[INFO][11:30:23]: [Client #57] Dataset size: 2018
[INFO][11:30:23]: [Client #57] Sampler: iid
[INFO][11:30:25]: [Client #57] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:30:25]: [Client #57] Start to process inbound data.
[INFO][11:30:25]: [93m[1m[Client #57] Started training in communication round #58.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.18s/it]  4%|▍         | 2/48 [00:04<01:32,  2.00s/it]  6%|▋         | 3/48 [00:05<00:58,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.25it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.45it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.61it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.02it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][11:30:58]: [Client #57] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536584.pth.
{'train_runtime': 26.6297, 'train_samples_per_second': 227.34, 'train_steps_per_second': 1.802, 'train_loss': 2.7542203267415366, 'epoch': 3.0}
[INFO][11:30:59]: [Client #57] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_57_3536584.pth.
[INFO][11:30:59]: [Client #57] Model trained.
[INFO][11:30:59]: [Client #57] Inbound data has been processed.
[INFO][11:30:59]: [Client #57] Outbound data is ready to be sent after being processed.
[INFO][11:31:04]: [Client #57] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:31:05]: [Server #3536466] Received 507.38 MB of payload data from client #57 (simulated).
[INFO][11:31:05]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][11:31:05]: [Server #3536466] Adding client #14 to the list of clients for aggregation.
[INFO][11:31:05]: [Server #3536466] Adding client #23 to the list of clients for aggregation.
[INFO][11:31:05]: [Server #3536466] Adding client #7 to the list of clients for aggregation.
[INFO][11:31:05]: [Server #3536466] Adding client #97 to the list of clients for aggregation.
[INFO][11:31:05]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:31:05]: [Server #3536466] Updated weights have been received.
[INFO][11:31:05]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:31:06]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:31:06]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0506e+00  1e+02  1e+00  1e+00
 1:  2.9718e+00  2.0706e+00  3e+00  2e-02  2e-02
 2:  3.0560e+00  2.3630e+00  7e-01  3e-06  4e-07
 3:  3.0556e+00  3.0444e+00  1e-02  5e-08  7e-09
 4:  3.0534e+00  3.0513e+00  2e-03  1e-07  2e-08
 5:  3.0514e+00  3.0513e+00  4e-05  5e-07  9e-08
 6:  3.0513e+00  3.0513e+00  8e-07  1e-08  2e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 1.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 1.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 1.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.01it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.30it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.85it/s]100%|██████████| 8/8 [00:00<00:00, 11.60it/s]
[INFO][11:31:16]: [93m[1m[Server #3536466] Global model perplexity: 24.99
[0m
[INFO][11:31:16]: [Server #3536466] All client reports have been processed.
[INFO][11:31:17]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_58.pth.
[INFO][11:31:20]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_58.pth.
[INFO][11:31:20]: [93m[1m
[Server #3536466] Starting round 59/100.[0m
[INFO][11:31:20]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.08298805e-02, 2.08298805e-02, 2.08298805e-02, 2.08298805e-02,
       2.08298805e-02, 2.08298805e-02, 2.08298805e-02, 2.08298805e-02,
       4.61932077e-07, 1.01991986e-05, 2.08298805e-02, 2.08298805e-02,
       1.01991986e-05, 2.08298805e-02, 2.08298805e-02, 2.08298805e-02,
       1.01991986e-05, 2.85975064e-06, 2.08298805e-02, 2.21907977e-07,
       2.08298805e-02, 2.21907977e-07, 2.21907977e-07, 2.21907977e-07,
       2.08298805e-02, 2.08298805e-02, 1.08208764e-06, 1.01991986e-05,
       2.21907977e-07, 1.01991986e-05, 2.08298805e-02, 1.01991986e-05,
       1.01991986e-05, 1.01991986e-05, 2.08298805e-02, 2.08298805e-02,
       2.21907977e-07, 4.61932077e-07, 2.08298805e-02, 2.08298805e-02,
       2.08298805e-02, 4.61932077e-07, 2.08298805e-02, 2.08298805e-02,
       1.08208764e-06, 2.08298805e-02, 4.61932077e-07, 2.21907977e-07,
       2.21907977e-07, 4.61932077e-07, 2.08298805e-02, 2.08298805e-02,
       2.08298805e-02, 2.21907977e-07, 2.21907977e-07, 2.08298805e-02,
       2.08298805e-02, 2.08298805e-02, 2.08298805e-02, 2.85975064e-06,
       4.61932077e-07, 2.85975064e-06, 2.08298805e-02, 2.85975064e-06,
       1.01991986e-05, 2.08298805e-02, 2.08298805e-02, 2.85975064e-06,
       2.21907977e-07, 2.08298805e-02, 2.85975064e-06, 2.08298805e-02,
       2.08298805e-02, 1.01991986e-05, 2.08298805e-02, 2.08298805e-02,
       1.01991986e-05, 2.21907977e-07, 1.08208764e-06, 2.08298805e-02,
       2.21907977e-07, 2.21907977e-07, 2.08298805e-02, 2.08298805e-02,
       2.21907977e-07, 2.08298805e-02, 2.85975064e-06, 2.85975064e-06,
       2.08298805e-02, 1.01991986e-05, 1.01991986e-05, 2.08298805e-02,
       4.61932077e-07, 4.61932077e-07, 2.08298805e-02]),)
[INFO][11:31:20]: [Server #3536466] Selected clients: [46 78 66 76 38]
[INFO][11:31:20]: [Server #3536466] Selecting client #66 for training.
[INFO][11:31:20]: [Server #3536466] Sending the current model to client #66 (simulated).
[INFO][11:31:25]: [Server #3536466] Sending 507.38 MB of payload data to client #66 (simulated).
[INFO][11:31:25]: [Client #66] Selected by the server.
[INFO][11:31:25]: [Client #66] Loading its data source...
[INFO][11:31:25]: [Client #66] Dataset size: 2018
[INFO][11:31:25]: [Client #66] Sampler: iid
[INFO][11:31:26]: [Client #66] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:31:26]: [Client #66] Start to process inbound data.
[INFO][11:31:26]: [93m[1m[Client #66] Started training in communication round #59.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.19s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:58,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:09<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.02it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.04it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.14it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.12it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.11it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.10it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.10it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][11:31:59]: [Client #66] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
{'train_runtime': 26.6132, 'train_samples_per_second': 227.481, 'train_steps_per_second': 1.804, 'train_loss': 2.92323366800944, 'epoch': 3.0}
[INFO][11:32:00]: [Client #66] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
[INFO][11:32:00]: [Client #66] Model trained.
[INFO][11:32:00]: [Client #66] Inbound data has been processed.
[INFO][11:32:00]: [Client #66] Outbound data is ready to be sent after being processed.
[INFO][11:32:05]: [Client #66] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:32:06]: [Server #3536466] Received 507.38 MB of payload data from client #66 (simulated).
[INFO][11:32:06]: [Server #3536466] Selecting client #38 for training.
[INFO][11:32:06]: [Server #3536466] Sending the current model to client #38 (simulated).
[INFO][11:32:11]: [Server #3536466] Sending 507.38 MB of payload data to client #38 (simulated).
[INFO][11:32:11]: [Client #38] Selected by the server.
[INFO][11:32:11]: [Client #38] Loading its data source...
[INFO][11:32:11]: [Client #38] Dataset size: 2018
[INFO][11:32:11]: [Client #38] Sampler: iid
[INFO][11:32:12]: [Client #38] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:32:12]: [Client #38] Start to process inbound data.
[INFO][11:32:12]: [93m[1m[Client #38] Started training in communication round #59.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.20s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:09<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.12it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.10it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.09it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.06it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][11:32:45]: [Client #38] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_38_3536584.pth.
{'train_runtime': 26.6614, 'train_samples_per_second': 227.07, 'train_steps_per_second': 1.8, 'train_loss': 3.076343218485514, 'epoch': 3.0}
[INFO][11:32:46]: [Client #38] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_38_3536584.pth.
[INFO][11:32:46]: [Client #38] Model trained.
[INFO][11:32:46]: [Client #38] Inbound data has been processed.
[INFO][11:32:46]: [Client #38] Outbound data is ready to be sent after being processed.
[INFO][11:32:51]: [Client #38] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:32:52]: [Server #3536466] Received 507.38 MB of payload data from client #38 (simulated).
[INFO][11:32:52]: [Server #3536466] Selecting client #46 for training.
[INFO][11:32:52]: [Server #3536466] Sending the current model to client #46 (simulated).
[INFO][11:32:57]: [Server #3536466] Sending 507.38 MB of payload data to client #46 (simulated).
[INFO][11:32:57]: [Client #46] Selected by the server.
[INFO][11:32:57]: [Client #46] Loading its data source...
[INFO][11:32:57]: [Client #46] Dataset size: 2018
[INFO][11:32:57]: [Client #46] Sampler: iid
[INFO][11:32:58]: [Client #46] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:32:58]: [Client #46] Start to process inbound data.
[INFO][11:32:58]: [93m[1m[Client #46] Started training in communication round #59.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.18s/it]  4%|▍         | 2/48 [00:04<01:32,  2.00s/it]  6%|▋         | 3/48 [00:05<00:58,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.25it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.88it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.97it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.03it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.12it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.10it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.09it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.13it/s] 71%|███████   | 34/48 [00:19<00:06,  2.11it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.09it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.08it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.06it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.06it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.06it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.06it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][11:33:31]: [Client #46] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
{'train_runtime': 26.7022, 'train_samples_per_second': 226.723, 'train_steps_per_second': 1.798, 'train_loss': 3.077434221903483, 'epoch': 3.0}
[INFO][11:33:32]: [Client #46] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
[INFO][11:33:33]: [Client #46] Model trained.
[INFO][11:33:33]: [Client #46] Inbound data has been processed.
[INFO][11:33:33]: [Client #46] Outbound data is ready to be sent after being processed.
[INFO][11:33:38]: [Client #46] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:33:39]: [Server #3536466] Received 507.38 MB of payload data from client #46 (simulated).
[INFO][11:33:39]: [Server #3536466] Selecting client #76 for training.
[INFO][11:33:39]: [Server #3536466] Sending the current model to client #76 (simulated).
[INFO][11:33:44]: [Server #3536466] Sending 507.38 MB of payload data to client #76 (simulated).
[INFO][11:33:44]: [Client #76] Selected by the server.
[INFO][11:33:44]: [Client #76] Loading its data source...
[INFO][11:33:44]: [Client #76] Dataset size: 2018
[INFO][11:33:44]: [Client #76] Sampler: iid
[INFO][11:33:45]: [Client #76] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:33:45]: [Client #76] Start to process inbound data.
[INFO][11:33:45]: [93m[1m[Client #76] Started training in communication round #59.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  4%|▍         | 2/48 [00:04<01:33,  2.04s/it]  6%|▋         | 3/48 [00:05<00:59,  1.33s/it]  8%|▊         | 4/48 [00:05<00:43,  1.00it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.42it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.58it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.70it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.80it/s] 21%|██        | 10/48 [00:08<00:20,  1.88it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.93it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.97it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.12it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][11:34:18]: [Client #76] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_76_3536584.pth.
{'train_runtime': 26.7633, 'train_samples_per_second': 226.205, 'train_steps_per_second': 1.793, 'train_loss': 2.968415896097819, 'epoch': 3.0}
[INFO][11:34:19]: [Client #76] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_76_3536584.pth.
[INFO][11:34:20]: [Client #76] Model trained.
[INFO][11:34:20]: [Client #76] Inbound data has been processed.
[INFO][11:34:20]: [Client #76] Outbound data is ready to be sent after being processed.
[INFO][11:34:24]: [Client #76] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:34:25]: [Server #3536466] Received 507.38 MB of payload data from client #76 (simulated).
[INFO][11:34:25]: [Server #3536466] Selecting client #78 for training.
[INFO][11:34:25]: [Server #3536466] Sending the current model to client #78 (simulated).
[INFO][11:34:30]: [Server #3536466] Sending 507.38 MB of payload data to client #78 (simulated).
[INFO][11:34:30]: [Client #78] Selected by the server.
[INFO][11:34:30]: [Client #78] Loading its data source...
[INFO][11:34:30]: [Client #78] Dataset size: 2018
[INFO][11:34:30]: [Client #78] Sampler: iid
[INFO][11:34:31]: [Client #78] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:34:31]: [Client #78] Start to process inbound data.
[INFO][11:34:31]: [93m[1m[Client #78] Started training in communication round #59.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.19s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.13it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.07it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.06it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.06it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.05it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.06it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.06it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.06it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.06it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][11:35:04]: [Client #78] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
{'train_runtime': 26.6753, 'train_samples_per_second': 226.951, 'train_steps_per_second': 1.799, 'train_loss': 2.8521315256754556, 'epoch': 3.0}
[INFO][11:35:05]: [Client #78] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
[INFO][11:35:06]: [Client #78] Model trained.
[INFO][11:35:06]: [Client #78] Inbound data has been processed.
[INFO][11:35:06]: [Client #78] Outbound data is ready to be sent after being processed.
[INFO][11:35:11]: [Client #78] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:35:12]: [Server #3536466] Received 507.38 MB of payload data from client #78 (simulated).
[INFO][11:35:12]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][11:35:12]: [Server #3536466] Adding client #57 to the list of clients for aggregation.
[INFO][11:35:12]: [Server #3536466] Adding client #2 to the list of clients for aggregation.
[INFO][11:35:12]: [Server #3536466] Adding client #77 to the list of clients for aggregation.
[INFO][11:35:12]: [Server #3536466] Adding client #70 to the list of clients for aggregation.
[INFO][11:35:12]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:35:12]: [Server #3536466] Updated weights have been received.
[INFO][11:35:12]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:35:13]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:35:13]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0506e+00  1e+02  1e+00  1e+00
 1:  2.9718e+00  2.0706e+00  3e+00  2e-02  2e-02
 2:  3.0560e+00  2.3630e+00  7e-01  3e-06  4e-07
 3:  3.0556e+00  3.0444e+00  1e-02  5e-08  7e-09
 4:  3.0534e+00  3.0513e+00  2e-03  1e-07  2e-08
 5:  3.0514e+00  3.0513e+00  4e-05  5e-07  9e-08
 6:  3.0513e+00  3.0513e+00  8e-07  1e-08  2e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 1.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 1.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 1.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.19it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.34it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.88it/s]100%|██████████| 8/8 [00:00<00:00, 11.64it/s]
[INFO][11:35:23]: [93m[1m[Server #3536466] Global model perplexity: 25.51
[0m
[INFO][11:35:23]: [Server #3536466] All client reports have been processed.
[INFO][11:35:23]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_59.pth.
[INFO][11:35:27]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_59.pth.
[INFO][11:35:27]: [93m[1m
[Server #3536466] Starting round 60/100.[0m
[INFO][11:35:27]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.08298805e-02, 2.08298805e-02, 2.08298805e-02, 2.08298805e-02,
       2.08298805e-02, 2.08298805e-02, 2.08298805e-02, 2.08298805e-02,
       2.08298805e-02, 2.08298805e-02, 4.61932077e-07, 1.01991986e-05,
       2.08298805e-02, 2.08298805e-02, 1.01991986e-05, 2.08298805e-02,
       2.08298805e-02, 2.08298805e-02, 1.01991986e-05, 2.85975064e-06,
       2.08298805e-02, 2.21907977e-07, 2.08298805e-02, 2.21907977e-07,
       2.21907977e-07, 2.21907977e-07, 2.08298805e-02, 2.08298805e-02,
       1.08208764e-06, 1.01991986e-05, 2.21907977e-07, 1.01991986e-05,
       2.08298805e-02, 1.01991986e-05, 1.01991986e-05, 1.01991986e-05,
       2.08298805e-02, 2.21907977e-07, 4.61932077e-07, 2.08298805e-02,
       2.08298805e-02, 2.08298805e-02, 4.61932077e-07, 2.08298805e-02,
       1.08208764e-06, 2.08298805e-02, 4.61932077e-07, 2.21907977e-07,
       2.21907977e-07, 4.61932077e-07, 2.08298805e-02, 2.08298805e-02,
       2.08298805e-02, 2.21907977e-07, 2.08298805e-02, 2.21907977e-07,
       2.08298805e-02, 2.08298805e-02, 2.08298805e-02, 2.08298805e-02,
       2.85975064e-06, 4.61932077e-07, 2.85975064e-06, 2.85975064e-06,
       1.01991986e-05, 2.08298805e-02, 2.08298805e-02, 2.08298805e-02,
       2.85975064e-06, 2.21907977e-07, 2.08298805e-02, 2.85975064e-06,
       2.08298805e-02, 1.01991986e-05, 2.08298805e-02, 2.08298805e-02,
       1.01991986e-05, 2.21907977e-07, 1.08208764e-06, 2.08298805e-02,
       2.21907977e-07, 2.21907977e-07, 2.08298805e-02, 2.08298805e-02,
       2.21907977e-07, 2.08298805e-02, 2.85975064e-06, 2.85975064e-06,
       2.08298805e-02, 1.01991986e-05, 1.01991986e-05, 2.08298805e-02,
       4.61932077e-07, 4.61932077e-07, 2.08298805e-02]),)
[INFO][11:35:27]: [Server #3536466] Selected clients: [60  9 21 33 14]
[INFO][11:35:27]: [Server #3536466] Selecting client #60 for training.
[INFO][11:35:27]: [Server #3536466] Sending the current model to client #60 (simulated).
[INFO][11:35:31]: [Server #3536466] Sending 507.38 MB of payload data to client #60 (simulated).
[INFO][11:35:31]: [Server #3536466] Selecting client #33 for training.
[INFO][11:35:31]: [Server #3536466] Sending the current model to client #33 (simulated).
[INFO][11:35:36]: [Server #3536466] Sending 507.38 MB of payload data to client #33 (simulated).
[INFO][11:35:36]: [Client #60] Selected by the server.
[INFO][11:35:36]: [Client #60] Loading its data source...
[INFO][11:35:36]: [Client #60] Dataset size: 2018
[INFO][11:35:36]: [Client #60] Sampler: iid
[INFO][11:35:36]: [Client #33] Selected by the server.
[INFO][11:35:36]: [Client #33] Loading its data source...
[INFO][11:35:36]: [Client #33] Dataset size: 2018
[INFO][11:35:36]: [Client #33] Sampler: iid
[INFO][11:35:37]: [Client #60] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:35:37]: [Client #60] Start to process inbound data.
[INFO][11:35:38]: [93m[1m[Client #60] Started training in communication round #60.[0m
[INFO][11:35:38]: [Client #33] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:35:38]: [Client #33] Start to process inbound data.
[INFO][11:35:38]: [93m[1m[Client #33] Started training in communication round #60.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:41,  4.72s/it]  2%|▏         | 1/48 [00:04<03:43,  4.75s/it]  4%|▍         | 2/48 [00:05<01:48,  2.37s/it]  4%|▍         | 2/48 [00:05<01:50,  2.41s/it]  6%|▋         | 3/48 [00:06<01:13,  1.62s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:55,  1.27s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.37it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.37it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.30it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][11:36:24]: [Client #33] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
{'train_runtime': 39.4816, 'train_samples_per_second': 153.337, 'train_steps_per_second': 1.216, 'train_loss': 2.507422924041748, 'epoch': 3.0}
[INFO][11:36:24]: [Client #60] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
{'train_runtime': 39.4211, 'train_samples_per_second': 153.573, 'train_steps_per_second': 1.218, 'train_loss': 2.9619579315185547, 'epoch': 3.0}
[INFO][11:36:25]: [Client #33] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
[INFO][11:36:25]: [Client #60] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
[INFO][11:36:25]: [Client #33] Model trained.
[INFO][11:36:25]: [Client #33] Inbound data has been processed.
[INFO][11:36:25]: [Client #33] Outbound data is ready to be sent after being processed.
[INFO][11:36:25]: [Client #60] Model trained.
[INFO][11:36:25]: [Client #60] Inbound data has been processed.
[INFO][11:36:25]: [Client #60] Outbound data is ready to be sent after being processed.
[INFO][11:36:33]: [Client #60] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:36:33]: [Client #33] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:36:34]: [Server #3536466] Received 507.38 MB of payload data from client #60 (simulated).
[INFO][11:36:35]: [Server #3536466] Received 507.38 MB of payload data from client #33 (simulated).
[INFO][11:36:35]: [Server #3536466] Selecting client #14 for training.
[INFO][11:36:35]: [Server #3536466] Sending the current model to client #14 (simulated).
[INFO][11:36:39]: [Server #3536466] Sending 507.38 MB of payload data to client #14 (simulated).
[INFO][11:36:39]: [Server #3536466] Selecting client #21 for training.
[INFO][11:36:39]: [Server #3536466] Sending the current model to client #21 (simulated).
[INFO][11:36:44]: [Server #3536466] Sending 507.38 MB of payload data to client #21 (simulated).
[INFO][11:36:44]: [Client #14] Selected by the server.
[INFO][11:36:44]: [Client #14] Loading its data source...
[INFO][11:36:44]: [Client #14] Dataset size: 2018
[INFO][11:36:44]: [Client #14] Sampler: iid
[INFO][11:36:44]: [Client #21] Selected by the server.
[INFO][11:36:44]: [Client #21] Loading its data source...
[INFO][11:36:44]: [Client #21] Dataset size: 2018
[INFO][11:36:44]: [Client #21] Sampler: iid
[INFO][11:36:45]: [Client #21] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:36:45]: [Client #21] Start to process inbound data.
[INFO][11:36:45]: [93m[1m[Client #21] Started training in communication round #60.[0m
[INFO][11:36:45]: [Client #14] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:36:45]: [Client #14] Start to process inbound data.
[INFO][11:36:45]: [93m[1m[Client #14] Started training in communication round #60.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:38,  4.65s/it]  2%|▏         | 1/48 [00:05<03:57,  5.06s/it]  4%|▍         | 2/48 [00:05<01:52,  2.44s/it]  4%|▍         | 2/48 [00:06<02:01,  2.64s/it]  6%|▋         | 3/48 [00:06<01:19,  1.76s/it]  6%|▋         | 3/48 [00:06<01:23,  1.85s/it]  8%|▊         | 4/48 [00:07<01:02,  1.43s/it]  8%|▊         | 4/48 [00:07<01:04,  1.47s/it] 10%|█         | 5/48 [00:08<00:53,  1.24s/it] 10%|█         | 5/48 [00:08<00:53,  1.24s/it] 12%|█▎        | 6/48 [00:09<00:47,  1.12s/it] 12%|█▎        | 6/48 [00:09<00:46,  1.12s/it] 15%|█▍        | 7/48 [00:10<00:42,  1.04s/it] 15%|█▍        | 7/48 [00:10<00:42,  1.04s/it] 17%|█▋        | 8/48 [00:10<00:39,  1.01it/s] 17%|█▋        | 8/48 [00:11<00:41,  1.03s/it] 19%|█▉        | 9/48 [00:11<00:37,  1.03it/s] 19%|█▉        | 9/48 [00:12<00:38,  1.02it/s] 21%|██        | 10/48 [00:12<00:36,  1.05it/s] 21%|██        | 10/48 [00:13<00:35,  1.07it/s] 23%|██▎       | 11/48 [00:13<00:34,  1.07it/s] 23%|██▎       | 11/48 [00:14<00:34,  1.08it/s] 25%|██▌       | 12/48 [00:14<00:32,  1.10it/s] 25%|██▌       | 12/48 [00:14<00:32,  1.10it/s] 27%|██▋       | 13/48 [00:15<00:31,  1.10it/s] 27%|██▋       | 13/48 [00:15<00:32,  1.09it/s] 29%|██▉       | 14/48 [00:16<00:31,  1.08it/s] 29%|██▉       | 14/48 [00:16<00:31,  1.09it/s] 31%|███▏      | 15/48 [00:17<00:30,  1.09it/s] 31%|███▏      | 15/48 [00:17<00:31,  1.04it/s] 33%|███▎      | 16/48 [00:18<00:29,  1.09it/s] 33%|███▎      | 16/48 [00:18<00:27,  1.15it/s] 35%|███▌      | 17/48 [00:19<00:29,  1.07it/s] 35%|███▌      | 17/48 [00:19<00:28,  1.08it/s] 38%|███▊      | 18/48 [00:20<00:28,  1.06it/s] 38%|███▊      | 18/48 [00:20<00:28,  1.04it/s] 40%|███▉      | 19/48 [00:21<00:26,  1.08it/s] 40%|███▉      | 19/48 [00:21<00:27,  1.07it/s] 42%|████▏     | 20/48 [00:21<00:25,  1.08it/s] 42%|████▏     | 20/48 [00:22<00:25,  1.09it/s] 44%|████▍     | 21/48 [00:22<00:24,  1.10it/s] 44%|████▍     | 21/48 [00:23<00:24,  1.10it/s] 46%|████▌     | 22/48 [00:23<00:23,  1.11it/s] 46%|████▌     | 22/48 [00:24<00:23,  1.11it/s] 48%|████▊     | 23/48 [00:24<00:22,  1.11it/s] 48%|████▊     | 23/48 [00:25<00:23,  1.08it/s] 50%|█████     | 24/48 [00:25<00:21,  1.10it/s] 50%|█████     | 24/48 [00:26<00:22,  1.07it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.08it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.08it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.09it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.06it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.07it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.07it/s] 58%|█████▊    | 28/48 [00:29<00:19,  1.05it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.08it/s] 60%|██████    | 29/48 [00:30<00:17,  1.08it/s] 60%|██████    | 29/48 [00:30<00:17,  1.10it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.10it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.10it/s] 65%|██████▍   | 31/48 [00:32<00:15,  1.10it/s] 65%|██████▍   | 31/48 [00:32<00:16,  1.03it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.07it/s] 67%|██████▋   | 32/48 [00:33<00:13,  1.15it/s] 69%|██████▉   | 33/48 [00:34<00:14,  1.02it/s] 69%|██████▉   | 33/48 [00:34<00:14,  1.07it/s] 71%|███████   | 34/48 [00:35<00:14,  1.02s/it] 71%|███████   | 34/48 [00:35<00:13,  1.01it/s] 73%|███████▎  | 35/48 [00:36<00:13,  1.04s/it] 73%|███████▎  | 35/48 [00:36<00:13,  1.02s/it] 75%|███████▌  | 36/48 [00:37<00:12,  1.05s/it] 75%|███████▌  | 36/48 [00:37<00:12,  1.04s/it] 77%|███████▋  | 37/48 [00:38<00:11,  1.06s/it] 77%|███████▋  | 37/48 [00:38<00:11,  1.06s/it] 79%|███████▉  | 38/48 [00:39<00:10,  1.02s/it] 79%|███████▉  | 38/48 [00:39<00:10,  1.05s/it] 81%|████████▏ | 39/48 [00:40<00:08,  1.02it/s] 81%|████████▏ | 39/48 [00:40<00:09,  1.03s/it] 83%|████████▎ | 40/48 [00:41<00:07,  1.02it/s] 83%|████████▎ | 40/48 [00:41<00:08,  1.01s/it] 85%|████████▌ | 41/48 [00:42<00:07,  1.00s/it] 85%|████████▌ | 41/48 [00:42<00:07,  1.00s/it] 88%|████████▊ | 42/48 [00:43<00:05,  1.02it/s] 88%|████████▊ | 42/48 [00:43<00:05,  1.00it/s] 90%|████████▉ | 43/48 [00:44<00:04,  1.03it/s] 90%|████████▉ | 43/48 [00:44<00:04,  1.02it/s] 92%|█████████▏| 44/48 [00:45<00:03,  1.04it/s] 92%|█████████▏| 44/48 [00:45<00:03,  1.03it/s] 94%|█████████▍| 45/48 [00:46<00:02,  1.02it/s] 94%|█████████▍| 45/48 [00:46<00:02,  1.03it/s] 96%|█████████▌| 46/48 [00:47<00:01,  1.04it/s] 96%|█████████▌| 46/48 [00:47<00:01,  1.06it/s] 98%|█████████▊| 47/48 [00:48<00:00,  1.04it/s] 98%|█████████▊| 47/48 [00:48<00:00,  1.02it/s]100%|██████████| 48/48 [00:48<00:00,  1.07it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:48<00:00,  1.07it/s]100%|██████████| 48/48 [00:48<00:00,  1.02s/it]
100%|██████████| 48/48 [00:49<00:00,  1.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:49<00:00,  1.17it/s]100%|██████████| 48/48 [00:49<00:00,  1.02s/it]
[INFO][11:37:41]: [Client #14] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
{'train_runtime': 48.9438, 'train_samples_per_second': 123.693, 'train_steps_per_second': 0.981, 'train_loss': 2.8623278935750327, 'epoch': 3.0}
[INFO][11:37:41]: [Client #21] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_21_3536585.pth.
{'train_runtime': 49.0504, 'train_samples_per_second': 123.424, 'train_steps_per_second': 0.979, 'train_loss': 2.842076301574707, 'epoch': 3.0}
[INFO][11:37:42]: [Client #21] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_21_3536585.pth.
[INFO][11:37:42]: [Client #14] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
[INFO][11:37:42]: [Client #21] Model trained.
[INFO][11:37:42]: [Client #21] Inbound data has been processed.
[INFO][11:37:42]: [Client #21] Outbound data is ready to be sent after being processed.
[INFO][11:37:43]: [Client #14] Model trained.
[INFO][11:37:43]: [Client #14] Inbound data has been processed.
[INFO][11:37:43]: [Client #14] Outbound data is ready to be sent after being processed.
[INFO][11:37:51]: [Client #14] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:37:51]: [Client #21] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:37:51]: [Server #3536466] Received 507.38 MB of payload data from client #14 (simulated).
[INFO][11:37:52]: [Server #3536466] Received 507.38 MB of payload data from client #21 (simulated).
[INFO][11:37:52]: [Server #3536466] Selecting client #9 for training.
[INFO][11:37:52]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][11:37:57]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][11:37:57]: [Client #9] Selected by the server.
[INFO][11:37:57]: [Client #9] Loading its data source...
[INFO][11:37:57]: [Client #9] Dataset size: 2018
[INFO][11:37:57]: [Client #9] Sampler: iid
[INFO][11:37:58]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:37:58]: [Client #9] Start to process inbound data.
[INFO][11:37:58]: [93m[1m[Client #9] Started training in communication round #60.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.21s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.25it/s] 12%|█▎        | 6/48 [00:06<00:28,  1.45it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.61it/s] 17%|█▋        | 8/48 [00:07<00:22,  1.74it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.84it/s] 21%|██        | 10/48 [00:08<00:19,  1.91it/s] 23%|██▎       | 11/48 [00:08<00:18,  1.96it/s] 25%|██▌       | 12/48 [00:09<00:18,  2.00it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.02it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.04it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.06it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.18it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.15it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.13it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.13it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.11it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.11it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.10it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:15<00:11,  2.09it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.09it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.09it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.09it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.09it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.09it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.09it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.20it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.17it/s] 71%|███████   | 34/48 [00:19<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.12it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.11it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.10it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.81it/s]
[INFO][11:38:31]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
{'train_runtime': 26.5134, 'train_samples_per_second': 228.337, 'train_steps_per_second': 1.81, 'train_loss': 1.942994753519694, 'epoch': 3.0}
[INFO][11:38:32]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536584.pth.
[INFO][11:38:32]: [Client #9] Model trained.
[INFO][11:38:32]: [Client #9] Inbound data has been processed.
[INFO][11:38:32]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][11:38:37]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:38:38]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][11:38:38]: [Server #3536466] Adding client #46 to the list of clients for aggregation.
[INFO][11:38:38]: [Server #3536466] Adding client #66 to the list of clients for aggregation.
[INFO][11:38:38]: [Server #3536466] Adding client #78 to the list of clients for aggregation.
[INFO][11:38:38]: [Server #3536466] Adding client #76 to the list of clients for aggregation.
[INFO][11:38:38]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][11:38:38]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:38:38]: [Server #3536466] Updated weights have been received.
[INFO][11:38:38]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:38:39]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:38:39]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0506e+00  1e+02  1e+00  1e+00
 1:  2.9718e+00  2.0706e+00  3e+00  2e-02  2e-02
 2:  3.0560e+00  2.3630e+00  7e-01  3e-06  4e-07
 3:  3.0556e+00  3.0444e+00  1e-02  5e-08  7e-09
 4:  3.0534e+00  3.0513e+00  2e-03  1e-07  2e-08
 5:  3.0514e+00  3.0513e+00  4e-05  5e-07  9e-08
 6:  3.0513e+00  3.0513e+00  8e-07  1e-08  2e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 0.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 1.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 1.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 1.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.28it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.40it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.37it/s]100%|██████████| 8/8 [00:00<00:00, 11.55it/s]
[INFO][11:38:50]: [93m[1m[Server #3536466] Global model perplexity: 25.00
[0m
[INFO][11:38:50]: [Server #3536466] All client reports have been processed.
[INFO][11:38:50]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_60.pth.
[INFO][11:38:53]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_60.pth.
[INFO][11:38:53]: [93m[1m
[Server #3536466] Starting round 61/100.[0m
[INFO][11:38:53]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([4.55131329e-05, 4.55131329e-05, 4.55131329e-05, 4.55131329e-05,
       4.55131329e-05, 4.55131329e-05, 4.55131329e-05, 4.55131329e-05,
       9.97748533e-01, 4.55131329e-05, 7.97854787e-07, 5.79768233e-06,
       4.55131329e-05, 5.79768233e-06, 4.55131329e-05, 4.55131329e-05,
       4.55131329e-05, 5.79768233e-06, 2.31823380e-06, 5.50837192e-07,
       4.55131329e-05, 5.50837192e-07, 5.50837192e-07, 5.50837192e-07,
       4.55131329e-05, 4.55131329e-05, 1.26272877e-06, 5.79768233e-06,
       5.50837192e-07, 5.79768233e-06, 5.79768233e-06, 5.79768233e-06,
       5.79768233e-06, 4.55131329e-05, 5.50837192e-07, 7.97854787e-07,
       4.55131329e-05, 4.55131329e-05, 4.55131329e-05, 7.97854787e-07,
       4.55131329e-05, 4.55131329e-05, 1.26272877e-06, 4.55131329e-05,
       7.97854787e-07, 5.50837192e-07, 5.50837192e-07, 7.97854787e-07,
       4.55131329e-05, 4.55131329e-05, 4.55131329e-05, 5.50837192e-07,
       4.55131329e-05, 5.50837192e-07, 4.55131329e-05, 4.55131329e-05,
       4.55131329e-05, 2.31823380e-06, 7.97854787e-07, 2.31823380e-06,
       4.55131329e-05, 2.31823380e-06, 5.79768233e-06, 4.55131329e-05,
       4.55131329e-05, 4.55131329e-05, 2.31823380e-06, 5.50837192e-07,
       4.55131329e-05, 2.31823380e-06, 4.55131329e-05, 4.55131329e-05,
       4.55131329e-05, 5.79768233e-06, 4.55131329e-05, 4.55131329e-05,
       5.79768233e-06, 5.50837192e-07, 1.26272877e-06, 4.55131329e-05,
       5.50837192e-07, 5.50837192e-07, 4.55131329e-05, 4.55131329e-05,
       5.50837192e-07, 4.55131329e-05, 2.31823380e-06, 2.31823380e-06,
       4.55131329e-05, 5.79768233e-06, 5.79768233e-06, 4.55131329e-05,
       7.97854787e-07, 7.97854787e-07, 4.55131329e-05]),)
[INFO][11:38:53]: [Server #3536466] Selected clients: [ 9 41 85 62 18]
[INFO][11:38:53]: [Server #3536466] Selecting client #18 for training.
[INFO][11:38:53]: [Server #3536466] Sending the current model to client #18 (simulated).
[INFO][11:38:58]: [Server #3536466] Sending 507.38 MB of payload data to client #18 (simulated).
[INFO][11:38:58]: [Server #3536466] Selecting client #85 for training.
[INFO][11:38:58]: [Server #3536466] Sending the current model to client #85 (simulated).
[INFO][11:39:02]: [Server #3536466] Sending 507.38 MB of payload data to client #85 (simulated).
[INFO][11:39:02]: [Client #18] Selected by the server.
[INFO][11:39:02]: [Client #18] Loading its data source...
[INFO][11:39:02]: [Client #18] Dataset size: 2018
[INFO][11:39:02]: [Client #18] Sampler: iid
[INFO][11:39:02]: [Client #85] Selected by the server.
[INFO][11:39:02]: [Client #85] Loading its data source...
[INFO][11:39:02]: [Client #85] Dataset size: 2018
[INFO][11:39:02]: [Client #85] Sampler: iid
[INFO][11:39:04]: [Client #18] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:39:04]: [Client #18] Start to process inbound data.
[INFO][11:39:04]: [93m[1m[Client #18] Started training in communication round #61.[0m
[INFO][11:39:04]: [Client #85] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:39:04]: [Client #85] Start to process inbound data.
[INFO][11:39:05]: [93m[1m[Client #85] Started training in communication round #61.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:27,  4.42s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:05<01:48,  2.36s/it]  2%|▏         | 1/48 [00:05<03:58,  5.08s/it]  6%|▋         | 3/48 [00:06<01:11,  1.60s/it]  4%|▍         | 2/48 [00:05<01:57,  2.54s/it]  8%|▊         | 4/48 [00:06<00:54,  1.25s/it]  6%|▋         | 3/48 [00:06<01:17,  1.73s/it] 10%|█         | 5/48 [00:07<00:45,  1.06s/it]  8%|▊         | 4/48 [00:07<00:58,  1.34s/it] 12%|█▎        | 6/48 [00:08<00:39,  1.05it/s] 10%|█         | 5/48 [00:08<00:48,  1.12s/it] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 12%|█▎        | 6/48 [00:08<00:42,  1.01s/it] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 19%|█▉        | 9/48 [00:11<00:31,  1.22it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.34it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.34it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.34it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.32it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.33it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.33it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.41it/s] 71%|███████   | 34/48 [00:29<00:10,  1.33it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:09,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
 98%|█████████▊| 47/48 [00:39<00:00,  1.48it/s]100%|██████████| 48/48 [00:39<00:00,  1.67it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.67it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][11:39:50]: [Client #18] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
{'train_runtime': 39.4581, 'train_samples_per_second': 153.429, 'train_steps_per_second': 1.216, 'train_loss': 2.809593836466471, 'epoch': 3.0}
[INFO][11:39:51]: [Client #18] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
[INFO][11:39:51]: [Client #85] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_85_3536585.pth.
{'train_runtime': 39.5709, 'train_samples_per_second': 152.991, 'train_steps_per_second': 1.213, 'train_loss': 2.812957445780436, 'epoch': 3.0}
[INFO][11:39:51]: [Client #18] Model trained.
[INFO][11:39:51]: [Client #18] Inbound data has been processed.
[INFO][11:39:51]: [Client #18] Outbound data is ready to be sent after being processed.
[INFO][11:39:52]: [Client #85] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_85_3536585.pth.
[INFO][11:39:53]: [Client #85] Model trained.
[INFO][11:39:53]: [Client #85] Inbound data has been processed.
[INFO][11:39:53]: [Client #85] Outbound data is ready to be sent after being processed.
[INFO][11:39:58]: [Client #18] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:39:59]: [Server #3536466] Received 507.38 MB of payload data from client #18 (simulated).
[INFO][11:40:00]: [Client #85] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:40:01]: [Server #3536466] Received 507.38 MB of payload data from client #85 (simulated).
[INFO][11:40:01]: [Server #3536466] Selecting client #62 for training.
[INFO][11:40:01]: [Server #3536466] Sending the current model to client #62 (simulated).
[INFO][11:40:05]: [Server #3536466] Sending 507.38 MB of payload data to client #62 (simulated).
[INFO][11:40:05]: [Server #3536466] Selecting client #9 for training.
[INFO][11:40:05]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][11:40:09]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][11:40:09]: [Client #62] Selected by the server.
[INFO][11:40:09]: [Client #62] Loading its data source...
[INFO][11:40:09]: [Client #62] Dataset size: 2018
[INFO][11:40:09]: [Client #9] Selected by the server.
[INFO][11:40:09]: [Client #62] Sampler: iid
[INFO][11:40:09]: [Client #9] Loading its data source...
[INFO][11:40:09]: [Client #9] Dataset size: 2018
[INFO][11:40:09]: [Client #9] Sampler: iid
[INFO][11:40:11]: [Client #62] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:40:11]: [Client #62] Start to process inbound data.
[INFO][11:40:11]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:40:11]: [Client #9] Start to process inbound data.
[INFO][11:40:12]: [93m[1m[Client #9] Started training in communication round #61.[0m
[INFO][11:40:12]: [93m[1m[Client #62] Started training in communication round #61.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:36,  4.62s/it]  2%|▏         | 1/48 [00:05<03:59,  5.09s/it]  4%|▍         | 2/48 [00:05<01:52,  2.45s/it]  4%|▍         | 2/48 [00:06<02:06,  2.74s/it]  6%|▋         | 3/48 [00:06<01:22,  1.83s/it]  6%|▋         | 3/48 [00:07<01:29,  1.98s/it]  8%|▊         | 4/48 [00:07<01:07,  1.54s/it]  8%|▊         | 4/48 [00:08<01:07,  1.54s/it] 10%|█         | 5/48 [00:08<00:56,  1.32s/it] 10%|█         | 5/48 [00:09<00:56,  1.31s/it] 12%|█▎        | 6/48 [00:09<00:49,  1.19s/it] 12%|█▎        | 6/48 [00:09<00:50,  1.19s/it] 15%|█▍        | 7/48 [00:10<00:45,  1.12s/it] 15%|█▍        | 7/48 [00:10<00:45,  1.12s/it] 17%|█▋        | 8/48 [00:11<00:42,  1.06s/it] 17%|█▋        | 8/48 [00:11<00:41,  1.05s/it] 19%|█▉        | 9/48 [00:12<00:39,  1.02s/it] 19%|█▉        | 9/48 [00:12<00:39,  1.00s/it] 21%|██        | 10/48 [00:13<00:37,  1.02it/s] 21%|██        | 10/48 [00:13<00:36,  1.04it/s] 23%|██▎       | 11/48 [00:14<00:35,  1.05it/s] 23%|██▎       | 11/48 [00:14<00:34,  1.08it/s] 25%|██▌       | 12/48 [00:15<00:33,  1.08it/s] 25%|██▌       | 12/48 [00:15<00:34,  1.06it/s] 27%|██▋       | 13/48 [00:15<00:31,  1.10it/s] 27%|██▋       | 13/48 [00:16<00:32,  1.08it/s] 29%|██▉       | 14/48 [00:16<00:31,  1.10it/s] 29%|██▉       | 14/48 [00:17<00:31,  1.08it/s] 31%|███▏      | 15/48 [00:17<00:30,  1.10it/s] 31%|███▏      | 15/48 [00:18<00:32,  1.02it/s] 33%|███▎      | 16/48 [00:18<00:29,  1.07it/s] 33%|███▎      | 16/48 [00:19<00:28,  1.12it/s] 35%|███▌      | 17/48 [00:19<00:29,  1.06it/s] 35%|███▌      | 17/48 [00:20<00:28,  1.09it/s] 38%|███▊      | 18/48 [00:20<00:26,  1.11it/s] 38%|███▊      | 18/48 [00:20<00:27,  1.09it/s] 40%|███▉      | 19/48 [00:21<00:26,  1.10it/s] 40%|███▉      | 19/48 [00:21<00:26,  1.09it/s] 42%|████▏     | 20/48 [00:22<00:25,  1.09it/s] 42%|████▏     | 20/48 [00:22<00:25,  1.11it/s] 44%|████▍     | 21/48 [00:23<00:24,  1.08it/s] 44%|████▍     | 21/48 [00:23<00:24,  1.12it/s] 46%|████▌     | 22/48 [00:24<00:23,  1.09it/s] 46%|████▌     | 22/48 [00:24<00:23,  1.10it/s] 48%|████▊     | 23/48 [00:25<00:22,  1.11it/s] 48%|████▊     | 23/48 [00:25<00:22,  1.11it/s] 50%|█████     | 24/48 [00:26<00:21,  1.10it/s] 50%|█████     | 24/48 [00:26<00:21,  1.11it/s] 52%|█████▏    | 25/48 [00:26<00:20,  1.10it/s] 52%|█████▏    | 25/48 [00:27<00:20,  1.11it/s] 54%|█████▍    | 26/48 [00:27<00:19,  1.10it/s] 54%|█████▍    | 26/48 [00:28<00:20,  1.10it/s] 56%|█████▋    | 27/48 [00:28<00:18,  1.11it/s] 56%|█████▋    | 27/48 [00:29<00:18,  1.11it/s] 58%|█████▊    | 28/48 [00:29<00:17,  1.12it/s] 58%|█████▊    | 28/48 [00:29<00:17,  1.11it/s] 60%|██████    | 29/48 [00:30<00:16,  1.13it/s] 60%|██████    | 29/48 [00:30<00:17,  1.10it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.08it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.07it/s] 65%|██████▍   | 31/48 [00:32<00:15,  1.09it/s] 65%|██████▍   | 31/48 [00:32<00:16,  1.02it/s] 67%|██████▋   | 32/48 [00:33<00:15,  1.06it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.13it/s] 69%|██████▉   | 33/48 [00:34<00:14,  1.03it/s] 69%|██████▉   | 33/48 [00:34<00:13,  1.07it/s] 71%|███████   | 34/48 [00:35<00:13,  1.03it/s] 71%|███████   | 34/48 [00:35<00:13,  1.05it/s] 73%|███████▎  | 35/48 [00:36<00:12,  1.05it/s] 73%|███████▎  | 35/48 [00:36<00:12,  1.07it/s] 75%|███████▌  | 36/48 [00:37<00:11,  1.05it/s] 75%|███████▌  | 36/48 [00:37<00:11,  1.07it/s] 77%|███████▋  | 37/48 [00:38<00:10,  1.08it/s] 77%|███████▋  | 37/48 [00:38<00:10,  1.05it/s] 79%|███████▉  | 38/48 [00:39<00:09,  1.05it/s] 79%|███████▉  | 38/48 [00:39<00:09,  1.06it/s] 81%|████████▏ | 39/48 [00:40<00:08,  1.06it/s] 81%|████████▏ | 39/48 [00:40<00:08,  1.04it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.06it/s] 83%|████████▎ | 40/48 [00:41<00:07,  1.06it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.05it/s] 85%|████████▌ | 41/48 [00:42<00:06,  1.07it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.08it/s] 88%|████████▊ | 42/48 [00:43<00:05,  1.05it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.06it/s] 90%|████████▉ | 43/48 [00:44<00:04,  1.08it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.06it/s] 92%|█████████▏| 44/48 [00:45<00:03,  1.07it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.10it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.08it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.07it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.08it/s] 98%|█████████▊| 47/48 [00:47<00:00,  1.06it/s] 98%|█████████▊| 47/48 [00:48<00:00,  1.00it/s]100%|██████████| 48/48 [00:48<00:00,  1.07it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:48<00:00,  1.07it/s]100%|██████████| 48/48 [00:48<00:00,  1.01s/it]
100%|██████████| 48/48 [00:48<00:00,  1.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:48<00:00,  1.17it/s]100%|██████████| 48/48 [00:48<00:00,  1.01s/it]
[INFO][11:41:07]: [Client #62] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_62_3536584.pth.
{'train_runtime': 48.4917, 'train_samples_per_second': 124.846, 'train_steps_per_second': 0.99, 'train_loss': 3.0180435180664062, 'epoch': 3.0}
[INFO][11:41:07]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 48.6118, 'train_samples_per_second': 124.538, 'train_steps_per_second': 0.987, 'train_loss': 1.9158557256062825, 'epoch': 3.0}
[INFO][11:41:08]: [Client #62] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_62_3536584.pth.
[INFO][11:41:08]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][11:41:09]: [Client #62] Model trained.
[INFO][11:41:09]: [Client #62] Inbound data has been processed.
[INFO][11:41:09]: [Client #62] Outbound data is ready to be sent after being processed.
[INFO][11:41:09]: [Client #9] Model trained.
[INFO][11:41:09]: [Client #9] Inbound data has been processed.
[INFO][11:41:09]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][11:41:17]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:41:17]: [Client #62] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:41:18]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][11:41:19]: [Server #3536466] Received 507.38 MB of payload data from client #62 (simulated).
[INFO][11:41:19]: [Server #3536466] Selecting client #41 for training.
[INFO][11:41:19]: [Server #3536466] Sending the current model to client #41 (simulated).
[INFO][11:41:24]: [Server #3536466] Sending 507.38 MB of payload data to client #41 (simulated).
[INFO][11:41:24]: [Client #41] Selected by the server.
[INFO][11:41:24]: [Client #41] Loading its data source...
[INFO][11:41:24]: [Client #41] Dataset size: 2018
[INFO][11:41:24]: [Client #41] Sampler: iid
[INFO][11:41:25]: [Client #41] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:41:25]: [Client #41] Start to process inbound data.
[INFO][11:41:25]: [93m[1m[Client #41] Started training in communication round #61.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.19s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:58,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.25it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.11it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.11it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][11:41:58]: [Client #41] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536584.pth.
{'train_runtime': 26.6582, 'train_samples_per_second': 227.097, 'train_steps_per_second': 1.801, 'train_loss': 2.6388626098632812, 'epoch': 3.0}
[INFO][11:41:59]: [Client #41] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536584.pth.
[INFO][11:42:00]: [Client #41] Model trained.
[INFO][11:42:00]: [Client #41] Inbound data has been processed.
[INFO][11:42:00]: [Client #41] Outbound data is ready to be sent after being processed.
[INFO][11:42:05]: [Client #41] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:42:06]: [Server #3536466] Received 507.38 MB of payload data from client #41 (simulated).
[INFO][11:42:06]: [Server #3536466] Adding client #14 to the list of clients for aggregation.
[INFO][11:42:06]: [Server #3536466] Adding client #21 to the list of clients for aggregation.
[INFO][11:42:06]: [Server #3536466] Adding client #33 to the list of clients for aggregation.
[INFO][11:42:06]: [Server #3536466] Adding client #38 to the list of clients for aggregation.
[INFO][11:42:06]: [Server #3536466] Adding client #60 to the list of clients for aggregation.
[INFO][11:42:06]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:42:06]: [Server #3536466] Updated weights have been received.
[INFO][11:42:07]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:42:07]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:42:07]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0495e+00  1e+02  1e+00  1e+00
 1:  2.9705e+00  2.0695e+00  3e+00  2e-02  2e-02
 2:  3.0548e+00  2.3616e+00  7e-01  3e-06  4e-07
 3:  3.0544e+00  3.0422e+00  1e-02  6e-08  7e-09
 4:  3.0526e+00  3.0490e+00  4e-03  9e-08  2e-08
 5:  3.0511e+00  3.0481e+00  3e-03  9e-07  8e-07
 6:  3.0505e+00  3.0491e+00  1e-03  5e-07  4e-07
 7:  3.0497e+00  3.0492e+00  5e-04  3e-06  2e-06
 8:  3.0493e+00  3.0492e+00  7e-05  1e-06  9e-07
 9:  3.0492e+00  3.0492e+00  3e-06  7e-08  6e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 0.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 1.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 1.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.92it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.17it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.89it/s]100%|██████████| 8/8 [00:00<00:00, 11.69it/s]
[INFO][11:42:18]: [93m[1m[Server #3536466] Global model perplexity: 22.99
[0m
[INFO][11:42:18]: [Server #3536466] All client reports have been processed.
[INFO][11:42:18]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_61.pth.
[INFO][11:42:21]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_61.pth.
[INFO][11:42:21]: [93m[1m
[Server #3536466] Starting round 62/100.[0m
[INFO][11:42:21]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.12723906e-02, 2.12723906e-02, 2.12723906e-02, 2.12723906e-02,
       2.12723906e-02, 2.12723906e-02, 2.12723906e-02, 2.12723906e-02,
       2.12723906e-02, 5.31102900e-07, 1.14545107e-05, 2.12723906e-02,
       2.12723906e-02, 1.14545107e-05, 2.12723906e-02, 2.12723906e-02,
       1.14545107e-05, 3.17496437e-06, 2.12723906e-02, 2.65902160e-07,
       2.12723906e-02, 2.65902160e-07, 2.65902160e-07, 2.65902160e-07,
       2.12723906e-02, 2.12723906e-02, 1.21360659e-06, 1.14545107e-05,
       2.65902160e-07, 1.14545107e-05, 2.12723906e-02, 1.14545107e-05,
       1.14545107e-05, 1.14545107e-05, 2.12723906e-02, 1.14545107e-05,
       2.65902160e-07, 5.31102900e-07, 2.12723906e-02, 2.12723906e-02,
       5.31102900e-07, 2.12723906e-02, 2.12723906e-02, 1.21360659e-06,
       2.12723906e-02, 5.31102900e-07, 2.65902160e-07, 2.65902160e-07,
       5.31102900e-07, 2.12723906e-02, 2.12723906e-02, 2.12723906e-02,
       2.65902160e-07, 2.12723906e-02, 2.65902160e-07, 2.12723906e-02,
       2.12723906e-02, 2.12723906e-02, 3.17496437e-06, 5.31102900e-07,
       3.17496437e-06, 2.12723906e-02, 3.17496437e-06, 1.14545107e-05,
       2.12723906e-02, 2.12723906e-02, 2.12723906e-02, 3.17496437e-06,
       2.65902160e-07, 2.12723906e-02, 3.17496437e-06, 2.12723906e-02,
       2.12723906e-02, 2.12723906e-02, 1.14545107e-05, 2.12723906e-02,
       2.12723906e-02, 1.14545107e-05, 2.65902160e-07, 1.21360659e-06,
       2.65902160e-07, 2.65902160e-07, 2.12723906e-02, 2.12723906e-02,
       2.65902160e-07, 2.12723906e-02, 3.17496437e-06, 3.17496437e-06,
       2.12723906e-02, 1.14545107e-05, 1.14545107e-05, 2.12723906e-02,
       5.31102900e-07, 5.31102900e-07, 2.12723906e-02]),)
[INFO][11:42:21]: [Server #3536466] Selected clients: [77 43 28 27 69]
[INFO][11:42:21]: [Server #3536466] Selecting client #28 for training.
[INFO][11:42:21]: [Server #3536466] Sending the current model to client #28 (simulated).
[INFO][11:42:26]: [Server #3536466] Sending 507.38 MB of payload data to client #28 (simulated).
[INFO][11:42:26]: [Server #3536466] Selecting client #69 for training.
[INFO][11:42:26]: [Server #3536466] Sending the current model to client #69 (simulated).
[INFO][11:42:31]: [Server #3536466] Sending 507.38 MB of payload data to client #69 (simulated).
[INFO][11:42:31]: [Client #69] Selected by the server.
[INFO][11:42:31]: [Client #69] Loading its data source...
[INFO][11:42:31]: [Client #69] Dataset size: 2018
[INFO][11:42:31]: [Client #69] Sampler: iid
[INFO][11:42:31]: [Client #28] Selected by the server.
[INFO][11:42:31]: [Client #28] Loading its data source...
[INFO][11:42:31]: [Client #28] Dataset size: 2018
[INFO][11:42:31]: [Client #28] Sampler: iid
[INFO][11:42:32]: [Client #69] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:42:32]: [Client #28] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:42:32]: [Client #69] Start to process inbound data.
[INFO][11:42:32]: [Client #28] Start to process inbound data.
[INFO][11:42:33]: [93m[1m[Client #28] Started training in communication round #62.[0m
[INFO][11:42:33]: [93m[1m[Client #69] Started training in communication round #62.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:41,  4.71s/it]  2%|▏         | 1/48 [00:04<03:45,  4.80s/it]  4%|▍         | 2/48 [00:05<01:48,  2.37s/it]  4%|▍         | 2/48 [00:05<01:50,  2.40s/it]  6%|▋         | 3/48 [00:06<01:13,  1.62s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  8%|▊         | 4/48 [00:06<00:55,  1.27s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.33it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.31it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.31it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.31it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][11:43:19]: [Client #69] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536585.pth.
{'train_runtime': 39.5245, 'train_samples_per_second': 153.171, 'train_steps_per_second': 1.214, 'train_loss': 2.8044093449910483, 'epoch': 3.0}
[INFO][11:43:19]: [Client #28] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_28_3536584.pth.
{'train_runtime': 39.479, 'train_samples_per_second': 153.347, 'train_steps_per_second': 1.216, 'train_loss': 2.9935309092203775, 'epoch': 3.0}
[INFO][11:43:20]: [Client #69] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536585.pth.
[INFO][11:43:20]: [Client #28] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_28_3536584.pth.
[INFO][11:43:21]: [Client #69] Model trained.
[INFO][11:43:21]: [Client #69] Inbound data has been processed.
[INFO][11:43:21]: [Client #69] Outbound data is ready to be sent after being processed.
[INFO][11:43:21]: [Client #28] Model trained.
[INFO][11:43:21]: [Client #28] Inbound data has been processed.
[INFO][11:43:21]: [Client #28] Outbound data is ready to be sent after being processed.
[INFO][11:43:29]: [Client #69] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:43:29]: [Client #28] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:43:30]: [Server #3536466] Received 507.38 MB of payload data from client #69 (simulated).
[INFO][11:43:31]: [Server #3536466] Received 507.38 MB of payload data from client #28 (simulated).
[INFO][11:43:31]: [Server #3536466] Selecting client #27 for training.
[INFO][11:43:31]: [Server #3536466] Sending the current model to client #27 (simulated).
[INFO][11:43:36]: [Server #3536466] Sending 507.38 MB of payload data to client #27 (simulated).
[INFO][11:43:36]: [Server #3536466] Selecting client #43 for training.
[INFO][11:43:36]: [Server #3536466] Sending the current model to client #43 (simulated).
[INFO][11:43:40]: [Server #3536466] Sending 507.38 MB of payload data to client #43 (simulated).
[INFO][11:43:40]: [Client #27] Selected by the server.
[INFO][11:43:40]: [Client #27] Loading its data source...
[INFO][11:43:40]: [Client #27] Dataset size: 2018
[INFO][11:43:40]: [Client #27] Sampler: iid
[INFO][11:43:40]: [Client #43] Selected by the server.
[INFO][11:43:40]: [Client #43] Loading its data source...
[INFO][11:43:40]: [Client #43] Dataset size: 2018
[INFO][11:43:40]: [Client #43] Sampler: iid
[INFO][11:43:42]: [Client #27] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:43:42]: [Client #27] Start to process inbound data.
[INFO][11:43:42]: [Client #43] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:43:42]: [Client #43] Start to process inbound data.
[INFO][11:43:42]: [93m[1m[Client #43] Started training in communication round #62.[0m
[INFO][11:43:43]: [93m[1m[Client #27] Started training in communication round #62.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:14,  4.13s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:36,  2.10s/it]  2%|▏         | 1/48 [00:04<03:41,  4.72s/it]  6%|▋         | 3/48 [00:05<01:07,  1.51s/it]  4%|▍         | 2/48 [00:05<01:52,  2.44s/it]  8%|▊         | 4/48 [00:06<00:52,  1.19s/it]  6%|▋         | 3/48 [00:06<01:15,  1.68s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it]  8%|▊         | 4/48 [00:07<00:57,  1.31s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.06it/s] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.18it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 35%|███▌      | 17/48 [00:15<00:23,  1.35it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:16,  1.31it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.31it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.32it/s] 60%|██████    | 29/48 [00:24<00:14,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.31it/s] 60%|██████    | 29/48 [00:25<00:14,  1.32it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s]100%|██████████| 48/48 [00:38<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.40it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
 98%|█████████▊| 47/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.57it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.57it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][11:44:28]: [Client #43] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536585.pth.
{'train_runtime': 38.9971, 'train_samples_per_second': 155.242, 'train_steps_per_second': 1.231, 'train_loss': 2.792475700378418, 'epoch': 3.0}
[INFO][11:44:28]: [Client #27] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_27_3536584.pth.
{'train_runtime': 39.4685, 'train_samples_per_second': 153.388, 'train_steps_per_second': 1.216, 'train_loss': 2.8308493296305337, 'epoch': 3.0}
[INFO][11:44:29]: [Client #43] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536585.pth.
[INFO][11:44:29]: [Client #43] Model trained.
[INFO][11:44:29]: [Client #43] Inbound data has been processed.
[INFO][11:44:29]: [Client #43] Outbound data is ready to be sent after being processed.
[INFO][11:44:29]: [Client #27] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_27_3536584.pth.
[INFO][11:44:30]: [Client #27] Model trained.
[INFO][11:44:30]: [Client #27] Inbound data has been processed.
[INFO][11:44:30]: [Client #27] Outbound data is ready to be sent after being processed.
[INFO][11:44:38]: [Client #43] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:44:38]: [Client #27] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:44:39]: [Server #3536466] Received 507.38 MB of payload data from client #43 (simulated).
[INFO][11:44:40]: [Server #3536466] Received 507.38 MB of payload data from client #27 (simulated).
[INFO][11:44:40]: [Server #3536466] Selecting client #77 for training.
[INFO][11:44:40]: [Server #3536466] Sending the current model to client #77 (simulated).
[INFO][11:44:44]: [Server #3536466] Sending 507.38 MB of payload data to client #77 (simulated).
[INFO][11:44:44]: [Client #77] Selected by the server.
[INFO][11:44:44]: [Client #77] Loading its data source...
[INFO][11:44:44]: [Client #77] Dataset size: 2018
[INFO][11:44:44]: [Client #77] Sampler: iid
[INFO][11:44:45]: [Client #77] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:44:45]: [Client #77] Start to process inbound data.
[INFO][11:44:45]: [93m[1m[Client #77] Started training in communication round #62.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.19s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.25it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][11:45:18]: [Client #77] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_77_3536584.pth.
{'train_runtime': 26.6614, 'train_samples_per_second': 227.07, 'train_steps_per_second': 1.8, 'train_loss': 2.5759404500325522, 'epoch': 3.0}
[INFO][11:45:19]: [Client #77] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_77_3536584.pth.
[INFO][11:45:20]: [Client #77] Model trained.
[INFO][11:45:20]: [Client #77] Inbound data has been processed.
[INFO][11:45:20]: [Client #77] Outbound data is ready to be sent after being processed.
[INFO][11:45:25]: [Client #77] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:45:26]: [Server #3536466] Received 507.38 MB of payload data from client #77 (simulated).
[INFO][11:45:26]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][11:45:26]: [Server #3536466] Adding client #41 to the list of clients for aggregation.
[INFO][11:45:26]: [Server #3536466] Adding client #62 to the list of clients for aggregation.
[INFO][11:45:26]: [Server #3536466] Adding client #85 to the list of clients for aggregation.
[INFO][11:45:26]: [Server #3536466] Adding client #18 to the list of clients for aggregation.
[INFO][11:45:26]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:45:26]: [Server #3536466] Updated weights have been received.
[INFO][11:45:26]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:45:27]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:45:27]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0537e+00  1e+02  1e+00  1e+00
 1:  2.9752e+00  2.0736e+00  3e+00  2e-02  2e-02
 2:  3.0590e+00  2.3669e+00  7e-01  3e-06  4e-07
 3:  3.0586e+00  3.0475e+00  1e-02  5e-08  6e-09
 4:  3.0565e+00  3.0543e+00  2e-03  1e-07  2e-08
 5:  3.0544e+00  3.0544e+00  5e-05  5e-07  9e-08
 6:  3.0544e+00  3.0544e+00  1e-06  1e-08  2e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 1.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 1.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.11it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.44it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.83it/s]100%|██████████| 8/8 [00:00<00:00, 11.64it/s]
[INFO][11:45:37]: [93m[1m[Server #3536466] Global model perplexity: 25.92
[0m
[INFO][11:45:37]: [Server #3536466] All client reports have been processed.
[INFO][11:45:37]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_62.pth.
[INFO][11:45:41]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_62.pth.
[INFO][11:45:41]: [93m[1m
[Server #3536466] Starting round 63/100.[0m
[INFO][11:45:41]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.12723906e-02, 2.12723906e-02, 2.12723906e-02, 2.12723906e-02,
       2.12723906e-02, 2.12723906e-02, 2.12723906e-02, 2.12723906e-02,
       2.12723906e-02, 2.12723906e-02, 5.31102900e-07, 1.14545107e-05,
       2.12723906e-02, 2.12723906e-02, 1.14545107e-05, 2.12723906e-02,
       2.12723906e-02, 2.12723906e-02, 1.14545107e-05, 3.17496437e-06,
       2.12723906e-02, 2.65902160e-07, 2.12723906e-02, 2.65902160e-07,
       2.65902160e-07, 2.65902160e-07, 1.21360659e-06, 1.14545107e-05,
       2.65902160e-07, 1.14545107e-05, 2.12723906e-02, 1.14545107e-05,
       1.14545107e-05, 1.14545107e-05, 2.12723906e-02, 1.14545107e-05,
       2.65902160e-07, 5.31102900e-07, 2.12723906e-02, 2.12723906e-02,
       5.31102900e-07, 2.12723906e-02, 2.12723906e-02, 1.21360659e-06,
       2.12723906e-02, 5.31102900e-07, 2.65902160e-07, 2.65902160e-07,
       5.31102900e-07, 2.12723906e-02, 2.12723906e-02, 2.12723906e-02,
       2.65902160e-07, 2.12723906e-02, 2.65902160e-07, 2.12723906e-02,
       2.12723906e-02, 2.12723906e-02, 2.12723906e-02, 3.17496437e-06,
       5.31102900e-07, 3.17496437e-06, 2.12723906e-02, 3.17496437e-06,
       1.14545107e-05, 2.12723906e-02, 2.12723906e-02, 3.17496437e-06,
       2.65902160e-07, 2.12723906e-02, 3.17496437e-06, 2.12723906e-02,
       2.12723906e-02, 1.14545107e-05, 2.12723906e-02, 2.12723906e-02,
       1.14545107e-05, 2.65902160e-07, 1.21360659e-06, 2.12723906e-02,
       2.65902160e-07, 2.65902160e-07, 2.12723906e-02, 2.12723906e-02,
       2.65902160e-07, 2.12723906e-02, 3.17496437e-06, 3.17496437e-06,
       2.12723906e-02, 1.14545107e-05, 1.14545107e-05, 2.12723906e-02,
       5.31102900e-07, 5.31102900e-07, 2.12723906e-02]),)
[INFO][11:45:41]: [Server #3536466] Selected clients: [16 78 17 54 46]
[INFO][11:45:41]: [Server #3536466] Selecting client #16 for training.
[INFO][11:45:41]: [Server #3536466] Sending the current model to client #16 (simulated).
[INFO][11:45:46]: [Server #3536466] Sending 507.38 MB of payload data to client #16 (simulated).
[INFO][11:45:46]: [Server #3536466] Selecting client #17 for training.
[INFO][11:45:46]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][11:45:50]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][11:45:50]: [Client #16] Selected by the server.
[INFO][11:45:50]: [Client #16] Loading its data source...
[INFO][11:45:50]: [Client #16] Dataset size: 2018
[INFO][11:45:50]: [Client #16] Sampler: iid
[INFO][11:45:50]: [Client #17] Selected by the server.
[INFO][11:45:50]: [Client #17] Loading its data source...
[INFO][11:45:50]: [Client #17] Dataset size: 2018
[INFO][11:45:50]: [Client #17] Sampler: iid
[INFO][11:45:51]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:45:51]: [Client #17] Start to process inbound data.
[INFO][11:45:51]: [Client #16] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:45:51]: [Client #16] Start to process inbound data.
[INFO][11:45:52]: [93m[1m[Client #17] Started training in communication round #63.[0m
[INFO][11:45:52]: [93m[1m[Client #16] Started training in communication round #63.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:37,  4.63s/it]  2%|▏         | 1/48 [00:04<03:43,  4.75s/it]  4%|▍         | 2/48 [00:05<01:48,  2.36s/it]  4%|▍         | 2/48 [00:05<01:49,  2.38s/it]  6%|▋         | 3/48 [00:06<01:12,  1.62s/it]  6%|▋         | 3/48 [00:06<01:13,  1.62s/it]  8%|▊         | 4/48 [00:06<00:56,  1.27s/it]  8%|▊         | 4/48 [00:06<00:56,  1.27s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][11:46:38]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 39.4733, 'train_samples_per_second': 153.369, 'train_steps_per_second': 1.216, 'train_loss': 2.6060193379720054, 'epoch': 3.0}
[INFO][11:46:38]: [Client #16] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_16_3536584.pth.
{'train_runtime': 39.4896, 'train_samples_per_second': 153.306, 'train_steps_per_second': 1.216, 'train_loss': 2.9812609354654946, 'epoch': 3.0}
[INFO][11:46:39]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][11:46:39]: [Client #17] Model trained.
[INFO][11:46:39]: [Client #17] Inbound data has been processed.
[INFO][11:46:39]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][11:46:39]: [Client #16] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_16_3536584.pth.
[INFO][11:46:40]: [Client #16] Model trained.
[INFO][11:46:40]: [Client #16] Inbound data has been processed.
[INFO][11:46:40]: [Client #16] Outbound data is ready to be sent after being processed.
[INFO][11:46:46]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:46:47]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][11:46:48]: [Client #16] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:46:49]: [Server #3536466] Received 507.38 MB of payload data from client #16 (simulated).
[INFO][11:46:49]: [Server #3536466] Selecting client #54 for training.
[INFO][11:46:49]: [Server #3536466] Sending the current model to client #54 (simulated).
[INFO][11:46:53]: [Server #3536466] Sending 507.38 MB of payload data to client #54 (simulated).
[INFO][11:46:53]: [Client #54] Selected by the server.
[INFO][11:46:53]: [Client #54] Loading its data source...
[INFO][11:46:53]: [Client #54] Dataset size: 2018
[INFO][11:46:53]: [Client #54] Sampler: iid
[INFO][11:46:55]: [Client #54] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:46:55]: [Client #54] Start to process inbound data.
[INFO][11:46:55]: [93m[1m[Client #54] Started training in communication round #63.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.19s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:09<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.10it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:15<00:11,  2.09it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.19it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][11:47:28]: [Client #54] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_54_3536584.pth.
{'train_runtime': 26.6001, 'train_samples_per_second': 227.593, 'train_steps_per_second': 1.805, 'train_loss': 2.9259494145711265, 'epoch': 3.0}
[INFO][11:47:29]: [Client #54] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_54_3536584.pth.
[INFO][11:47:29]: [Client #54] Model trained.
[INFO][11:47:29]: [Client #54] Inbound data has been processed.
[INFO][11:47:29]: [Client #54] Outbound data is ready to be sent after being processed.
[INFO][11:47:34]: [Client #54] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:47:35]: [Server #3536466] Received 507.38 MB of payload data from client #54 (simulated).
[INFO][11:47:35]: [Server #3536466] Selecting client #78 for training.
[INFO][11:47:35]: [Server #3536466] Sending the current model to client #78 (simulated).
[INFO][11:47:40]: [Server #3536466] Sending 507.38 MB of payload data to client #78 (simulated).
[INFO][11:47:40]: [Client #78] Selected by the server.
[INFO][11:47:40]: [Client #78] Loading its data source...
[INFO][11:47:40]: [Client #78] Dataset size: 2018
[INFO][11:47:40]: [Client #78] Sampler: iid
[INFO][11:47:41]: [Client #78] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:47:41]: [Client #78] Start to process inbound data.
[INFO][11:47:41]: [93m[1m[Client #78] Started training in communication round #63.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.58it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.71it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.13it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][11:48:14]: [Client #78] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
{'train_runtime': 26.684, 'train_samples_per_second': 226.878, 'train_steps_per_second': 1.799, 'train_loss': 2.729952812194824, 'epoch': 3.0}
[INFO][11:48:15]: [Client #78] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
[INFO][11:48:15]: [Client #78] Model trained.
[INFO][11:48:15]: [Client #78] Inbound data has been processed.
[INFO][11:48:15]: [Client #78] Outbound data is ready to be sent after being processed.
[INFO][11:48:20]: [Client #78] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:48:21]: [Server #3536466] Received 507.38 MB of payload data from client #78 (simulated).
[INFO][11:48:21]: [Server #3536466] Selecting client #46 for training.
[INFO][11:48:21]: [Server #3536466] Sending the current model to client #46 (simulated).
[INFO][11:48:26]: [Server #3536466] Sending 507.38 MB of payload data to client #46 (simulated).
[INFO][11:48:26]: [Client #46] Selected by the server.
[INFO][11:48:26]: [Client #46] Loading its data source...
[INFO][11:48:26]: [Client #46] Dataset size: 2018
[INFO][11:48:26]: [Client #46] Sampler: iid
[INFO][11:48:28]: [Client #46] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:48:28]: [Client #46] Start to process inbound data.
[INFO][11:48:28]: [93m[1m[Client #46] Started training in communication round #63.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.18s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:58,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.25it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.88it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.92it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.96it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.99it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.01it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.14it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.11it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.10it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.09it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.19it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.13it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.09it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.08it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][11:49:01]: [Client #46] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
{'train_runtime': 26.6511, 'train_samples_per_second': 227.158, 'train_steps_per_second': 1.801, 'train_loss': 2.9324165980021157, 'epoch': 3.0}
[INFO][11:49:02]: [Client #46] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
[INFO][11:49:02]: [Client #46] Model trained.
[INFO][11:49:02]: [Client #46] Inbound data has been processed.
[INFO][11:49:02]: [Client #46] Outbound data is ready to be sent after being processed.
[INFO][11:49:07]: [Client #46] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:49:08]: [Server #3536466] Received 507.38 MB of payload data from client #46 (simulated).
[INFO][11:49:08]: [Server #3536466] Adding client #43 to the list of clients for aggregation.
[INFO][11:49:08]: [Server #3536466] Adding client #27 to the list of clients for aggregation.
[INFO][11:49:08]: [Server #3536466] Adding client #69 to the list of clients for aggregation.
[INFO][11:49:08]: [Server #3536466] Adding client #77 to the list of clients for aggregation.
[INFO][11:49:08]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][11:49:08]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:49:08]: [Server #3536466] Updated weights have been received.
[INFO][11:49:09]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:49:09]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:49:09]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0537e+00  1e+02  1e+00  1e+00
 1:  2.9752e+00  2.0736e+00  3e+00  2e-02  2e-02
 2:  3.0590e+00  2.3669e+00  7e-01  3e-06  4e-07
 3:  3.0586e+00  3.0475e+00  1e-02  5e-08  6e-09
 4:  3.0565e+00  3.0543e+00  2e-03  1e-07  2e-08
 5:  3.0544e+00  3.0544e+00  5e-05  5e-07  9e-08
 6:  3.0544e+00  3.0544e+00  1e-06  1e-08  2e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 0.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 1.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 1.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.23it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.48it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.06it/s]100%|██████████| 8/8 [00:00<00:00, 11.84it/s]
[INFO][11:49:20]: [93m[1m[Server #3536466] Global model perplexity: 23.28
[0m
[INFO][11:49:20]: [Server #3536466] All client reports have been processed.
[INFO][11:49:20]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_63.pth.
[INFO][11:49:23]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_63.pth.
[INFO][11:49:23]: [93m[1m
[Server #3536466] Starting round 64/100.[0m
[INFO][11:49:23]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.41415084e-05, 2.41415084e-05, 2.41415084e-05, 2.41415084e-05,
       2.41415084e-05, 2.41415084e-05, 2.41415084e-05, 2.41415084e-05,
       2.41415084e-05, 2.41415084e-05, 2.94791911e-07, 2.39525001e-06,
       2.41415084e-05, 2.41415084e-05, 2.39525001e-06, 9.98842014e-01,
       2.41415084e-05, 2.39525001e-06, 8.92030797e-07, 2.41415084e-05,
       2.02047164e-07, 2.41415084e-05, 2.02047164e-07, 2.02047164e-07,
       2.02047164e-07, 2.41415084e-05, 4.72742132e-07, 2.39525001e-06,
       2.02047164e-07, 2.39525001e-06, 2.41415084e-05, 2.39525001e-06,
       2.39525001e-06, 2.39525001e-06, 2.41415084e-05, 2.39525001e-06,
       2.02047164e-07, 2.94791911e-07, 2.41415084e-05, 2.41415084e-05,
       2.41415084e-05, 2.94791911e-07, 2.41415084e-05, 4.72742132e-07,
       2.41415084e-05, 2.94791911e-07, 2.02047164e-07, 2.02047164e-07,
       2.94791911e-07, 2.41415084e-05, 2.41415084e-05, 2.02047164e-07,
       2.41415084e-05, 2.02047164e-07, 2.41415084e-05, 2.41415084e-05,
       2.41415084e-05, 2.41415084e-05, 8.92030797e-07, 2.94791911e-07,
       8.92030797e-07, 2.41415084e-05, 8.92030797e-07, 2.39525001e-06,
       2.41415084e-05, 2.41415084e-05, 2.41415084e-05, 8.92030797e-07,
       2.02047164e-07, 2.41415084e-05, 8.92030797e-07, 2.41415084e-05,
       2.41415084e-05, 2.39525001e-06, 2.41415084e-05, 2.41415084e-05,
       2.39525001e-06, 2.02047164e-07, 4.72742132e-07, 2.41415084e-05,
       2.02047164e-07, 2.02047164e-07, 2.41415084e-05, 2.41415084e-05,
       2.02047164e-07, 2.41415084e-05, 8.92030797e-07, 8.92030797e-07,
       2.41415084e-05, 2.39525001e-06, 2.39525001e-06, 2.41415084e-05,
       2.94791911e-07, 2.94791911e-07, 2.41415084e-05]),)
[INFO][11:49:24]: [Server #3536466] Selected clients: [17 43 91 21 61]
[INFO][11:49:24]: [Server #3536466] Selecting client #17 for training.
[INFO][11:49:24]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][11:49:28]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][11:49:28]: [Server #3536466] Selecting client #21 for training.
[INFO][11:49:28]: [Server #3536466] Sending the current model to client #21 (simulated).
[INFO][11:49:33]: [Server #3536466] Sending 507.38 MB of payload data to client #21 (simulated).
[INFO][11:49:33]: [Client #17] Selected by the server.
[INFO][11:49:33]: [Client #17] Loading its data source...
[INFO][11:49:33]: [Client #17] Dataset size: 2018
[INFO][11:49:33]: [Client #17] Sampler: iid
[INFO][11:49:33]: [Client #21] Selected by the server.
[INFO][11:49:33]: [Client #21] Loading its data source...
[INFO][11:49:33]: [Client #21] Dataset size: 2018
[INFO][11:49:33]: [Client #21] Sampler: iid
[INFO][11:49:34]: [Client #21] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:49:34]: [Client #21] Start to process inbound data.
[INFO][11:49:34]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:49:34]: [Client #17] Start to process inbound data.
[INFO][11:49:35]: [93m[1m[Client #17] Started training in communication round #64.[0m
[INFO][11:49:35]: [93m[1m[Client #21] Started training in communication round #64.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:10,  4.06s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:35,  2.07s/it]  2%|▏         | 1/48 [00:04<03:44,  4.77s/it]  6%|▋         | 3/48 [00:05<01:06,  1.48s/it]  4%|▍         | 2/48 [00:05<01:52,  2.44s/it]  8%|▊         | 4/48 [00:06<00:52,  1.18s/it]  6%|▋         | 3/48 [00:06<01:15,  1.68s/it] 10%|█         | 5/48 [00:06<00:43,  1.02s/it]  8%|▊         | 4/48 [00:07<00:57,  1.31s/it] 12%|█▎        | 6/48 [00:07<00:38,  1.08it/s] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.16it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 17%|█▋        | 8/48 [00:09<00:32,  1.22it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 19%|█▉        | 9/48 [00:09<00:30,  1.26it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 21%|██        | 10/48 [00:10<00:29,  1.29it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.31it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.32it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.35it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:17<00:20,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 50%|█████     | 24/48 [00:20<00:17,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 58%|█████▊    | 28/48 [00:23<00:14,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.40it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.35it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 71%|███████   | 34/48 [00:28<00:10,  1.34it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 83%|████████▎ | 40/48 [00:32<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.29it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.31it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.31it/s] 92%|█████████▏| 44/48 [00:35<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.31it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.30it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s]100%|██████████| 48/48 [00:38<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.39it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
 98%|█████████▊| 47/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.56it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.56it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][11:50:20]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536584.pth.
{'train_runtime': 38.8736, 'train_samples_per_second': 155.735, 'train_steps_per_second': 1.235, 'train_loss': 2.4784849484761557, 'epoch': 3.0}
[INFO][11:50:21]: [Client #21] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_21_3536585.pth.
{'train_runtime': 39.4527, 'train_samples_per_second': 153.45, 'train_steps_per_second': 1.217, 'train_loss': 2.701639175415039, 'epoch': 3.0}
[INFO][11:50:22]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536584.pth.
[INFO][11:50:22]: [Client #17] Model trained.
[INFO][11:50:22]: [Client #17] Inbound data has been processed.
[INFO][11:50:22]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][11:50:22]: [Client #21] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_21_3536585.pth.
[INFO][11:50:23]: [Client #21] Model trained.
[INFO][11:50:23]: [Client #21] Inbound data has been processed.
[INFO][11:50:23]: [Client #21] Outbound data is ready to be sent after being processed.
[INFO][11:50:30]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:50:31]: [Client #21] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:50:31]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][11:50:32]: [Server #3536466] Received 507.38 MB of payload data from client #21 (simulated).
[INFO][11:50:32]: [Server #3536466] Selecting client #91 for training.
[INFO][11:50:32]: [Server #3536466] Sending the current model to client #91 (simulated).
[INFO][11:50:36]: [Server #3536466] Sending 507.38 MB of payload data to client #91 (simulated).
[INFO][11:50:36]: [Server #3536466] Selecting client #43 for training.
[INFO][11:50:36]: [Server #3536466] Sending the current model to client #43 (simulated).
[INFO][11:50:41]: [Server #3536466] Sending 507.38 MB of payload data to client #43 (simulated).
[INFO][11:50:41]: [Client #91] Selected by the server.
[INFO][11:50:41]: [Client #43] Selected by the server.
[INFO][11:50:41]: [Client #91] Loading its data source...
[INFO][11:50:41]: [Client #43] Loading its data source...
[INFO][11:50:41]: [Client #91] Dataset size: 2018
[INFO][11:50:41]: [Client #91] Sampler: iid
[INFO][11:50:41]: [Client #43] Dataset size: 2018
[INFO][11:50:41]: [Client #43] Sampler: iid
[INFO][11:50:42]: [Client #91] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:50:42]: [Client #91] Start to process inbound data.
[INFO][11:50:42]: [Client #43] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:50:42]: [Client #43] Start to process inbound data.
[INFO][11:50:43]: [93m[1m[Client #43] Started training in communication round #64.[0m
[INFO][11:50:43]: [93m[1m[Client #91] Started training in communication round #64.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:05<03:55,  5.02s/it]  2%|▏         | 1/48 [00:05<03:56,  5.03s/it]  4%|▍         | 2/48 [00:05<01:57,  2.56s/it]  4%|▍         | 2/48 [00:05<01:59,  2.59s/it]  6%|▋         | 3/48 [00:06<01:17,  1.73s/it]  6%|▋         | 3/48 [00:06<01:19,  1.77s/it]  8%|▊         | 4/48 [00:07<00:58,  1.33s/it]  8%|▊         | 4/48 [00:07<01:00,  1.37s/it] 10%|█         | 5/48 [00:08<00:48,  1.12s/it] 10%|█         | 5/48 [00:08<00:49,  1.14s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 12%|█▎        | 6/48 [00:08<00:42,  1.00s/it] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.21it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.21it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.30it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:21,  1.33it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.31it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.32it/s] 50%|█████     | 24/48 [00:22<00:17,  1.33it/s] 50%|█████     | 24/48 [00:22<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.31it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:26<00:14,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:31<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:31<00:09,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.34it/s]100%|██████████| 48/48 [00:40<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.39it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
100%|██████████| 48/48 [00:40<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.41it/s]100%|██████████| 48/48 [00:40<00:00,  1.19it/s]
[INFO][11:51:29]: [Client #91] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_91_3536584.pth.
{'train_runtime': 40.1776, 'train_samples_per_second': 150.681, 'train_steps_per_second': 1.195, 'train_loss': 2.673328081766764, 'epoch': 3.0}
[INFO][11:51:29]: [Client #43] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536585.pth.
{'train_runtime': 40.0756, 'train_samples_per_second': 151.064, 'train_steps_per_second': 1.198, 'train_loss': 2.6442187627156577, 'epoch': 3.0}
[INFO][11:51:30]: [Client #91] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_91_3536584.pth.
[INFO][11:51:30]: [Client #43] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536585.pth.
[INFO][11:51:31]: [Client #91] Model trained.
[INFO][11:51:31]: [Client #91] Inbound data has been processed.
[INFO][11:51:31]: [Client #91] Outbound data is ready to be sent after being processed.
[INFO][11:51:31]: [Client #43] Model trained.
[INFO][11:51:31]: [Client #43] Inbound data has been processed.
[INFO][11:51:31]: [Client #43] Outbound data is ready to be sent after being processed.
[INFO][11:51:39]: [Client #91] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:51:39]: [Client #43] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:51:40]: [Server #3536466] Received 507.38 MB of payload data from client #91 (simulated).
[INFO][11:51:41]: [Server #3536466] Received 507.38 MB of payload data from client #43 (simulated).
[INFO][11:51:41]: [Server #3536466] Selecting client #61 for training.
[INFO][11:51:41]: [Server #3536466] Sending the current model to client #61 (simulated).
[INFO][11:51:45]: [Server #3536466] Sending 507.38 MB of payload data to client #61 (simulated).
[INFO][11:51:45]: [Client #61] Selected by the server.
[INFO][11:51:45]: [Client #61] Loading its data source...
[INFO][11:51:45]: [Client #61] Dataset size: 2018
[INFO][11:51:45]: [Client #61] Sampler: iid
[INFO][11:51:47]: [Client #61] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:51:47]: [Client #61] Start to process inbound data.
[INFO][11:51:47]: [93m[1m[Client #61] Started training in communication round #64.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.25s/it]  4%|▍         | 2/48 [00:04<01:33,  2.04s/it]  6%|▋         | 3/48 [00:05<00:59,  1.33s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.19it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.19it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.19it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][11:52:20]: [Client #61] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536584.pth.
{'train_runtime': 26.7101, 'train_samples_per_second': 226.656, 'train_steps_per_second': 1.797, 'train_loss': 2.5882712999979653, 'epoch': 3.0}
[INFO][11:52:21]: [Client #61] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536584.pth.
[INFO][11:52:21]: [Client #61] Model trained.
[INFO][11:52:21]: [Client #61] Inbound data has been processed.
[INFO][11:52:21]: [Client #61] Outbound data is ready to be sent after being processed.
[INFO][11:52:26]: [Client #61] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:52:27]: [Server #3536466] Received 507.38 MB of payload data from client #61 (simulated).
[INFO][11:52:27]: [Server #3536466] Adding client #28 to the list of clients for aggregation.
[INFO][11:52:27]: [Server #3536466] Adding client #46 to the list of clients for aggregation.
[INFO][11:52:27]: [Server #3536466] Adding client #54 to the list of clients for aggregation.
[INFO][11:52:27]: [Server #3536466] Adding client #78 to the list of clients for aggregation.
[INFO][11:52:27]: [Server #3536466] Adding client #16 to the list of clients for aggregation.
[INFO][11:52:27]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:52:27]: [Server #3536466] Updated weights have been received.
[INFO][11:52:28]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:52:28]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:52:28]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0525e+00  1e+02  1e+00  1e+00
 1:  2.9739e+00  2.0725e+00  3e+00  2e-02  2e-02
 2:  3.0579e+00  2.3655e+00  7e-01  3e-06  4e-07
 3:  3.0575e+00  3.0452e+00  1e-02  6e-08  7e-09
 4:  3.0557e+00  3.0520e+00  4e-03  9e-08  2e-08
 5:  3.0541e+00  3.0511e+00  3e-03  9e-07  8e-07
 6:  3.0535e+00  3.0522e+00  1e-03  5e-07  4e-07
 7:  3.0527e+00  3.0522e+00  5e-04  3e-06  2e-06
 8:  3.0523e+00  3.0523e+00  3e-05  1e-06  9e-07
 9:  3.0523e+00  3.0523e+00  1e-06  5e-08  4e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 0.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 1.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.18it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.03it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.92it/s]100%|██████████| 8/8 [00:00<00:00, 11.71it/s]
[INFO][11:52:39]: [93m[1m[Server #3536466] Global model perplexity: 22.56
[0m
[INFO][11:52:39]: [Server #3536466] All client reports have been processed.
[INFO][11:52:39]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_64.pth.
[INFO][11:52:42]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_64.pth.
[INFO][11:52:43]: [93m[1m
[Server #3536466] Starting round 65/100.[0m
[INFO][11:52:43]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.17339925e-02, 2.17339925e-02, 2.17339925e-02, 2.17339925e-02,
       2.17339925e-02, 2.17339925e-02, 2.17339925e-02, 2.17339925e-02,
       2.17339925e-02, 2.17339925e-02, 6.20721563e-07, 1.29302400e-05,
       2.17339925e-02, 2.17339925e-02, 1.29302400e-05, 2.17339925e-02,
       2.17339925e-02, 1.29302400e-05, 3.55655016e-06, 3.22213081e-07,
       2.17339925e-02, 3.22213081e-07, 3.22213081e-07, 3.22213081e-07,
       2.17339925e-02, 1.29302400e-05, 1.37952406e-06, 1.29302400e-05,
       3.22213081e-07, 1.29302400e-05, 2.17339925e-02, 1.29302400e-05,
       1.29302400e-05, 1.29302400e-05, 2.17339925e-02, 1.29302400e-05,
       3.22213081e-07, 6.20721563e-07, 2.17339925e-02, 2.17339925e-02,
       6.20721563e-07, 2.17339925e-02, 2.17339925e-02, 1.37952406e-06,
       2.17339925e-02, 6.20721563e-07, 3.22213081e-07, 3.22213081e-07,
       6.20721563e-07, 2.17339925e-02, 2.17339925e-02, 2.17339925e-02,
       3.22213081e-07, 2.17339925e-02, 3.22213081e-07, 2.17339925e-02,
       2.17339925e-02, 2.17339925e-02, 3.55655016e-06, 6.20721563e-07,
       3.55655016e-06, 2.17339925e-02, 3.55655016e-06, 1.29302400e-05,
       2.17339925e-02, 2.17339925e-02, 2.17339925e-02, 3.55655016e-06,
       3.22213081e-07, 2.17339925e-02, 3.55655016e-06, 2.17339925e-02,
       2.17339925e-02, 2.17339925e-02, 1.29302400e-05, 2.17339925e-02,
       2.17339925e-02, 1.29302400e-05, 3.22213081e-07, 1.37952406e-06,
       2.17339925e-02, 3.22213081e-07, 3.22213081e-07, 2.17339925e-02,
       2.17339925e-02, 3.22213081e-07, 3.55655016e-06, 3.55655016e-06,
       2.17339925e-02, 1.29302400e-05, 1.29302400e-05, 2.17339925e-02,
       6.20721563e-07, 6.20721563e-07, 2.17339925e-02]),)
[INFO][11:52:43]: [Server #3536466] Selected clients: [69 13  1 42 94]
[INFO][11:52:43]: [Server #3536466] Selecting client #42 for training.
[INFO][11:52:43]: [Server #3536466] Sending the current model to client #42 (simulated).
[INFO][11:52:47]: [Server #3536466] Sending 507.38 MB of payload data to client #42 (simulated).
[INFO][11:52:47]: [Server #3536466] Selecting client #1 for training.
[INFO][11:52:47]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][11:52:52]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][11:52:52]: [Client #42] Selected by the server.
[INFO][11:52:52]: [Client #42] Loading its data source...
[INFO][11:52:52]: [Client #42] Dataset size: 2018
[INFO][11:52:52]: [Client #42] Sampler: iid
[INFO][11:52:52]: [Client #1] Selected by the server.
[INFO][11:52:52]: [Client #1] Loading its data source...
[INFO][11:52:52]: [Client #1] Dataset size: 2018
[INFO][11:52:52]: [Client #1] Sampler: iid
[INFO][11:52:53]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:52:53]: [Client #1] Start to process inbound data.
[INFO][11:52:53]: [Client #42] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:52:53]: [Client #42] Start to process inbound data.
[INFO][11:52:54]: [93m[1m[Client #1] Started training in communication round #65.[0m
[INFO][11:52:54]: [93m[1m[Client #42] Started training in communication round #65.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:54,  4.98s/it]  2%|▏         | 1/48 [00:05<03:56,  5.03s/it]  4%|▍         | 2/48 [00:05<01:58,  2.58s/it]  4%|▍         | 2/48 [00:05<01:59,  2.60s/it]  6%|▋         | 3/48 [00:06<01:21,  1.81s/it]  6%|▋         | 3/48 [00:06<01:22,  1.82s/it]  8%|▊         | 4/48 [00:07<01:01,  1.40s/it]  8%|▊         | 4/48 [00:07<01:02,  1.42s/it] 10%|█         | 5/48 [00:08<00:49,  1.16s/it] 10%|█         | 5/48 [00:08<00:50,  1.18s/it] 12%|█▎        | 6/48 [00:09<00:42,  1.01s/it] 12%|█▎        | 6/48 [00:09<00:43,  1.03s/it] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 15%|█▍        | 7/48 [00:09<00:38,  1.07it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.14it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.21it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.20it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:12<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:15<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:20<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.31it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:29<00:11,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.33it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:40<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.39it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
100%|██████████| 48/48 [00:40<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.41it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
[INFO][11:53:41]: [Client #42] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
{'train_runtime': 40.1688, 'train_samples_per_second': 150.714, 'train_steps_per_second': 1.195, 'train_loss': 2.9863478342692056, 'epoch': 3.0}
[INFO][11:53:41]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 40.0542, 'train_samples_per_second': 151.145, 'train_steps_per_second': 1.198, 'train_loss': 2.318571408589681, 'epoch': 3.0}
[INFO][11:53:42]: [Client #42] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
[INFO][11:53:42]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][11:53:42]: [Client #42] Model trained.
[INFO][11:53:42]: [Client #42] Inbound data has been processed.
[INFO][11:53:42]: [Client #42] Outbound data is ready to be sent after being processed.
[INFO][11:53:42]: [Client #1] Model trained.
[INFO][11:53:42]: [Client #1] Inbound data has been processed.
[INFO][11:53:42]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][11:53:50]: [Client #42] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:53:50]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:53:51]: [Server #3536466] Received 507.38 MB of payload data from client #42 (simulated).
[INFO][11:53:52]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][11:53:52]: [Server #3536466] Selecting client #94 for training.
[INFO][11:53:52]: [Server #3536466] Sending the current model to client #94 (simulated).
[INFO][11:53:57]: [Server #3536466] Sending 507.38 MB of payload data to client #94 (simulated).
[INFO][11:53:57]: [Server #3536466] Selecting client #69 for training.
[INFO][11:53:57]: [Server #3536466] Sending the current model to client #69 (simulated).
[INFO][11:54:01]: [Server #3536466] Sending 507.38 MB of payload data to client #69 (simulated).
[INFO][11:54:01]: [Client #94] Selected by the server.
[INFO][11:54:01]: [Client #94] Loading its data source...
[INFO][11:54:01]: [Client #69] Selected by the server.
[INFO][11:54:01]: [Client #69] Loading its data source...
[INFO][11:54:01]: [Client #94] Dataset size: 2018
[INFO][11:54:01]: [Client #94] Sampler: iid
[INFO][11:54:01]: [Client #69] Dataset size: 2018
[INFO][11:54:01]: [Client #69] Sampler: iid
[INFO][11:54:03]: [Client #69] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:54:03]: [Client #69] Start to process inbound data.
[INFO][11:54:03]: [Client #94] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:54:03]: [Client #94] Start to process inbound data.
[INFO][11:54:03]: [93m[1m[Client #94] Started training in communication round #65.[0m
[INFO][11:54:03]: [93m[1m[Client #69] Started training in communication round #65.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.20s/it]  2%|▏         | 1/48 [00:04<03:46,  4.82s/it]  4%|▍         | 2/48 [00:04<01:38,  2.14s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it]  8%|▊         | 4/48 [00:07<00:56,  1.28s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 10%|█         | 5/48 [00:07<00:47,  1.09s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.06it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:10<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:28,  1.28it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:21,  1.33it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.30it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.32it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:18,  1.32it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.54it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.54it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][11:54:49]: [Client #69] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536585.pth.
{'train_runtime': 39.1884, 'train_samples_per_second': 154.485, 'train_steps_per_second': 1.225, 'train_loss': 2.80891482035319, 'epoch': 3.0}
[INFO][11:54:49]: [Client #94] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_94_3536584.pth.
{'train_runtime': 39.5407, 'train_samples_per_second': 153.108, 'train_steps_per_second': 1.214, 'train_loss': 2.9341065088907876, 'epoch': 3.0}
[INFO][11:54:50]: [Client #69] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536585.pth.
[INFO][11:54:50]: [Client #94] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_94_3536584.pth.
[INFO][11:54:51]: [Client #69] Model trained.
[INFO][11:54:51]: [Client #69] Inbound data has been processed.
[INFO][11:54:51]: [Client #69] Outbound data is ready to be sent after being processed.
[INFO][11:54:51]: [Client #94] Model trained.
[INFO][11:54:51]: [Client #94] Inbound data has been processed.
[INFO][11:54:51]: [Client #94] Outbound data is ready to be sent after being processed.
[INFO][11:54:59]: [Client #69] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:55:00]: [Client #94] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:55:00]: [Server #3536466] Received 507.38 MB of payload data from client #69 (simulated).
[INFO][11:55:01]: [Server #3536466] Received 507.38 MB of payload data from client #94 (simulated).
[INFO][11:55:01]: [Server #3536466] Selecting client #13 for training.
[INFO][11:55:01]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][11:55:06]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][11:55:06]: [Client #13] Selected by the server.
[INFO][11:55:06]: [Client #13] Loading its data source...
[INFO][11:55:06]: [Client #13] Dataset size: 2018
[INFO][11:55:06]: [Client #13] Sampler: iid
[INFO][11:55:08]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:55:08]: [Client #13] Start to process inbound data.
[INFO][11:55:08]: [93m[1m[Client #13] Started training in communication round #65.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.00it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.12it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.11it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][11:55:40]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
{'train_runtime': 26.743, 'train_samples_per_second': 226.377, 'train_steps_per_second': 1.795, 'train_loss': 2.3318780263264975, 'epoch': 3.0}
[INFO][11:55:42]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
[INFO][11:55:42]: [Client #13] Model trained.
[INFO][11:55:42]: [Client #13] Inbound data has been processed.
[INFO][11:55:42]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][11:55:47]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:55:48]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][11:55:48]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][11:55:48]: [Server #3536466] Adding client #21 to the list of clients for aggregation.
[INFO][11:55:48]: [Server #3536466] Adding client #43 to the list of clients for aggregation.
[INFO][11:55:48]: [Server #3536466] Adding client #61 to the list of clients for aggregation.
[INFO][11:55:48]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][11:55:48]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:55:48]: [Server #3536466] Updated weights have been received.
[INFO][11:55:48]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:55:49]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:55:49]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0567e+00  1e+02  1e+00  1e+00
 1:  2.9786e+00  2.0767e+00  3e+00  2e-02  2e-02
 2:  3.0621e+00  2.3708e+00  7e-01  3e-06  4e-07
 3:  3.0617e+00  3.0505e+00  1e-02  5e-08  6e-09
 4:  3.0596e+00  3.0573e+00  2e-03  1e-07  2e-08
 5:  3.0574e+00  3.0574e+00  6e-05  6e-07  1e-07
 6:  3.0574e+00  3.0574e+00  1e-06  1e-08  2e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 1.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.00it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.28it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.86it/s]100%|██████████| 8/8 [00:00<00:00, 11.60it/s]
[INFO][11:56:00]: [93m[1m[Server #3536466] Global model perplexity: 25.31
[0m
[INFO][11:56:00]: [Server #3536466] All client reports have been processed.
[INFO][11:56:00]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_65.pth.
[INFO][11:56:03]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_65.pth.
[INFO][11:56:03]: [93m[1m
[Server #3536466] Starting round 66/100.[0m
[INFO][11:56:03]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([9.98880542e-01, 2.37936058e-05, 2.37936058e-05, 2.37936058e-05,
       2.37936058e-05, 2.37936058e-05, 2.37936058e-05, 2.37936058e-05,
       2.37936058e-05, 2.37936058e-05, 2.87629663e-07, 2.34238958e-06,
       2.37936058e-05, 2.34238958e-06, 2.37936058e-05, 2.37936058e-05,
       2.37936058e-05, 2.34238958e-06, 8.71016870e-07, 2.37936058e-05,
       1.97112846e-07, 2.37936058e-05, 1.97112846e-07, 1.97112846e-07,
       1.97112846e-07, 2.37936058e-05, 2.34238958e-06, 4.61366115e-07,
       2.34238958e-06, 1.97112846e-07, 2.34238958e-06, 2.37936058e-05,
       2.34238958e-06, 2.34238958e-06, 2.34238958e-06, 2.37936058e-05,
       2.34238958e-06, 1.97112846e-07, 2.87629663e-07, 2.37936058e-05,
       2.37936058e-05, 2.87629663e-07, 2.37936058e-05, 2.37936058e-05,
       4.61366115e-07, 2.37936058e-05, 2.87629663e-07, 1.97112846e-07,
       1.97112846e-07, 2.87629663e-07, 2.37936058e-05, 2.37936058e-05,
       2.37936058e-05, 1.97112846e-07, 2.37936058e-05, 1.97112846e-07,
       2.37936058e-05, 2.37936058e-05, 2.37936058e-05, 2.37936058e-05,
       8.71016870e-07, 2.87629663e-07, 8.71016870e-07, 2.37936058e-05,
       8.71016870e-07, 2.34238958e-06, 2.37936058e-05, 2.37936058e-05,
       8.71016870e-07, 1.97112846e-07, 2.37936058e-05, 8.71016870e-07,
       2.37936058e-05, 2.37936058e-05, 2.37936058e-05, 2.34238958e-06,
       2.37936058e-05, 2.37936058e-05, 2.34238958e-06, 1.97112846e-07,
       4.61366115e-07, 2.37936058e-05, 1.97112846e-07, 1.97112846e-07,
       2.37936058e-05, 2.37936058e-05, 1.97112846e-07, 8.71016870e-07,
       8.71016870e-07, 2.34238958e-06, 2.34238958e-06, 2.37936058e-05,
       2.87629663e-07, 2.87629663e-07, 2.37936058e-05]),)
[INFO][11:56:03]: [Server #3536466] Selected clients: [ 1 70 66 17 62]
[INFO][11:56:03]: [Server #3536466] Selecting client #66 for training.
[INFO][11:56:03]: [Server #3536466] Sending the current model to client #66 (simulated).
[INFO][11:56:08]: [Server #3536466] Sending 507.38 MB of payload data to client #66 (simulated).
[INFO][11:56:08]: [Server #3536466] Selecting client #1 for training.
[INFO][11:56:08]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][11:56:13]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][11:56:13]: [Client #66] Selected by the server.
[INFO][11:56:13]: [Client #66] Loading its data source...
[INFO][11:56:13]: [Client #66] Dataset size: 2018
[INFO][11:56:13]: [Client #66] Sampler: iid
[INFO][11:56:13]: [Client #1] Selected by the server.
[INFO][11:56:13]: [Client #1] Loading its data source...
[INFO][11:56:13]: [Client #1] Dataset size: 2018
[INFO][11:56:13]: [Client #1] Sampler: iid
[INFO][11:56:14]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:56:14]: [Client #1] Start to process inbound data.
[INFO][11:56:14]: [Client #66] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:56:14]: [Client #66] Start to process inbound data.
[INFO][11:56:15]: [93m[1m[Client #66] Started training in communication round #66.[0m
[INFO][11:56:15]: [93m[1m[Client #1] Started training in communication round #66.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:47,  4.84s/it]  2%|▏         | 1/48 [00:04<03:49,  4.88s/it]  4%|▍         | 2/48 [00:05<01:52,  2.44s/it]  4%|▍         | 2/48 [00:05<01:53,  2.48s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it]  6%|▋         | 3/48 [00:06<01:16,  1.69s/it]  8%|▊         | 4/48 [00:07<00:57,  1.30s/it]  8%|▊         | 4/48 [00:07<00:57,  1.32s/it] 10%|█         | 5/48 [00:07<00:47,  1.09s/it] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.16it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.20it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:21,  1.33it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.35it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.35it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.35it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.34it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][11:57:01]: [Client #66] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
{'train_runtime': 39.7042, 'train_samples_per_second': 152.477, 'train_steps_per_second': 1.209, 'train_loss': 2.8508504231770835, 'epoch': 3.0}
[INFO][11:57:01]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 39.6199, 'train_samples_per_second': 152.802, 'train_steps_per_second': 1.212, 'train_loss': 2.183552106221517, 'epoch': 3.0}
[INFO][11:57:02]: [Client #66] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
[INFO][11:57:02]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][11:57:02]: [Client #66] Model trained.
[INFO][11:57:02]: [Client #66] Inbound data has been processed.
[INFO][11:57:02]: [Client #66] Outbound data is ready to be sent after being processed.
[INFO][11:57:03]: [Client #1] Model trained.
[INFO][11:57:03]: [Client #1] Inbound data has been processed.
[INFO][11:57:03]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][11:57:11]: [Client #66] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:57:11]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:57:12]: [Server #3536466] Received 507.38 MB of payload data from client #66 (simulated).
[INFO][11:57:13]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][11:57:13]: [Server #3536466] Selecting client #70 for training.
[INFO][11:57:13]: [Server #3536466] Sending the current model to client #70 (simulated).
[INFO][11:57:17]: [Server #3536466] Sending 507.38 MB of payload data to client #70 (simulated).
[INFO][11:57:17]: [Server #3536466] Selecting client #17 for training.
[INFO][11:57:17]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][11:57:22]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][11:57:22]: [Client #70] Selected by the server.
[INFO][11:57:22]: [Client #70] Loading its data source...
[INFO][11:57:22]: [Client #17] Selected by the server.
[INFO][11:57:22]: [Client #17] Loading its data source...
[INFO][11:57:22]: [Client #70] Dataset size: 2018
[INFO][11:57:22]: [Client #70] Sampler: iid
[INFO][11:57:22]: [Client #17] Dataset size: 2018
[INFO][11:57:22]: [Client #17] Sampler: iid
[INFO][11:57:23]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:57:23]: [Client #17] Start to process inbound data.
[INFO][11:57:23]: [93m[1m[Client #17] Started training in communication round #66.[0m
[INFO][11:57:23]: [Client #70] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:57:23]: [Client #70] Start to process inbound data.
[INFO][11:57:24]: [93m[1m[Client #70] Started training in communication round #66.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:38,  4.65s/it]  2%|▏         | 1/48 [00:04<03:46,  4.82s/it]  4%|▍         | 2/48 [00:05<01:53,  2.46s/it]  4%|▍         | 2/48 [00:05<01:58,  2.57s/it]  6%|▋         | 3/48 [00:06<01:21,  1.80s/it]  6%|▋         | 3/48 [00:06<01:20,  1.78s/it]  8%|▊         | 4/48 [00:07<01:04,  1.47s/it]  8%|▊         | 4/48 [00:07<01:04,  1.46s/it] 10%|█         | 5/48 [00:08<00:54,  1.27s/it] 10%|█         | 5/48 [00:08<00:53,  1.25s/it] 12%|█▎        | 6/48 [00:09<00:48,  1.15s/it] 12%|█▎        | 6/48 [00:09<00:47,  1.13s/it] 15%|█▍        | 7/48 [00:10<00:43,  1.07s/it] 15%|█▍        | 7/48 [00:10<00:44,  1.08s/it] 17%|█▋        | 8/48 [00:11<00:41,  1.05s/it] 17%|█▋        | 8/48 [00:11<00:42,  1.06s/it] 19%|█▉        | 9/48 [00:12<00:39,  1.02s/it] 19%|█▉        | 9/48 [00:12<00:39,  1.02s/it] 21%|██        | 10/48 [00:13<00:37,  1.02it/s] 21%|██        | 10/48 [00:13<00:37,  1.01it/s] 23%|██▎       | 11/48 [00:14<00:35,  1.05it/s] 23%|██▎       | 11/48 [00:14<00:36,  1.02it/s] 25%|██▌       | 12/48 [00:15<00:34,  1.04it/s] 25%|██▌       | 12/48 [00:15<00:35,  1.03it/s] 27%|██▋       | 13/48 [00:15<00:33,  1.04it/s] 27%|██▋       | 13/48 [00:16<00:33,  1.04it/s] 29%|██▉       | 14/48 [00:16<00:32,  1.05it/s] 29%|██▉       | 14/48 [00:17<00:32,  1.03it/s] 31%|███▏      | 15/48 [00:17<00:32,  1.02it/s] 31%|███▏      | 15/48 [00:18<00:33,  1.02s/it] 33%|███▎      | 16/48 [00:18<00:31,  1.02it/s] 33%|███▎      | 16/48 [00:18<00:30,  1.06it/s] 35%|███▌      | 17/48 [00:19<00:29,  1.05it/s] 35%|███▌      | 17/48 [00:19<00:28,  1.09it/s] 38%|███▊      | 18/48 [00:20<00:27,  1.09it/s] 38%|███▊      | 18/48 [00:20<00:26,  1.11it/s] 40%|███▉      | 19/48 [00:21<00:26,  1.08it/s] 40%|███▉      | 19/48 [00:21<00:26,  1.08it/s] 42%|████▏     | 20/48 [00:22<00:25,  1.09it/s] 42%|████▏     | 20/48 [00:22<00:25,  1.09it/s] 44%|████▍     | 21/48 [00:23<00:25,  1.07it/s] 44%|████▍     | 21/48 [00:23<00:24,  1.08it/s] 46%|████▌     | 22/48 [00:24<00:23,  1.09it/s] 46%|████▌     | 22/48 [00:24<00:23,  1.09it/s] 48%|████▊     | 23/48 [00:25<00:22,  1.10it/s] 48%|████▊     | 23/48 [00:25<00:23,  1.08it/s] 50%|█████     | 24/48 [00:26<00:22,  1.05it/s] 50%|█████     | 24/48 [00:26<00:22,  1.08it/s] 52%|█████▏    | 25/48 [00:27<00:21,  1.07it/s] 52%|█████▏    | 25/48 [00:27<00:21,  1.06it/s] 54%|█████▍    | 26/48 [00:28<00:20,  1.08it/s] 54%|█████▍    | 26/48 [00:28<00:20,  1.07it/s] 56%|█████▋    | 27/48 [00:29<00:19,  1.09it/s] 56%|█████▋    | 27/48 [00:29<00:19,  1.06it/s] 58%|█████▊    | 28/48 [00:30<00:19,  1.04it/s] 58%|█████▊    | 28/48 [00:30<00:18,  1.07it/s] 60%|██████    | 29/48 [00:31<00:18,  1.04it/s] 60%|██████    | 29/48 [00:31<00:17,  1.07it/s] 62%|██████▎   | 30/48 [00:31<00:17,  1.05it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.07it/s] 65%|██████▍   | 31/48 [00:32<00:16,  1.06it/s] 65%|██████▍   | 31/48 [00:33<00:16,  1.02it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.09it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.12it/s] 69%|██████▉   | 33/48 [00:34<00:13,  1.10it/s] 69%|██████▉   | 33/48 [00:34<00:13,  1.13it/s] 71%|███████   | 34/48 [00:35<00:12,  1.11it/s] 71%|███████   | 34/48 [00:35<00:12,  1.09it/s] 73%|███████▎  | 35/48 [00:36<00:11,  1.09it/s] 73%|███████▎  | 35/48 [00:36<00:11,  1.10it/s] 75%|███████▌  | 36/48 [00:37<00:11,  1.08it/s] 75%|███████▌  | 36/48 [00:37<00:10,  1.09it/s] 77%|███████▋  | 37/48 [00:38<00:10,  1.08it/s] 77%|███████▋  | 37/48 [00:38<00:10,  1.07it/s] 79%|███████▉  | 38/48 [00:39<00:09,  1.09it/s] 79%|███████▉  | 38/48 [00:39<00:09,  1.04it/s] 81%|████████▏ | 39/48 [00:40<00:08,  1.08it/s] 81%|████████▏ | 39/48 [00:40<00:08,  1.04it/s] 83%|████████▎ | 40/48 [00:41<00:07,  1.06it/s] 83%|████████▎ | 40/48 [00:41<00:07,  1.03it/s] 85%|████████▌ | 41/48 [00:42<00:06,  1.05it/s] 85%|████████▌ | 41/48 [00:42<00:06,  1.04it/s] 88%|████████▊ | 42/48 [00:43<00:05,  1.05it/s] 88%|████████▊ | 42/48 [00:43<00:05,  1.07it/s] 90%|████████▉ | 43/48 [00:44<00:04,  1.05it/s] 90%|████████▉ | 43/48 [00:44<00:04,  1.07it/s] 92%|█████████▏| 44/48 [00:45<00:03,  1.05it/s] 92%|█████████▏| 44/48 [00:45<00:03,  1.07it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.07it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.08it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.05it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.07it/s] 98%|█████████▊| 47/48 [00:47<00:00,  1.07it/s] 98%|█████████▊| 47/48 [00:48<00:00,  1.02it/s]100%|██████████| 48/48 [00:48<00:00,  1.08it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:48<00:00,  1.08it/s]100%|██████████| 48/48 [00:48<00:00,  1.01s/it]
100%|██████████| 48/48 [00:48<00:00,  1.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:48<00:00,  1.18it/s]100%|██████████| 48/48 [00:48<00:00,  1.01s/it]
[INFO][11:58:18]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 48.7159, 'train_samples_per_second': 124.272, 'train_steps_per_second': 0.985, 'train_loss': 2.37503989537557, 'epoch': 3.0}
[INFO][11:58:19]: [Client #70] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_70_3536584.pth.
{'train_runtime': 48.5597, 'train_samples_per_second': 124.671, 'train_steps_per_second': 0.988, 'train_loss': 2.8938608169555664, 'epoch': 3.0}
[INFO][11:58:20]: [Client #70] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_70_3536584.pth.
[INFO][11:58:20]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][11:58:21]: [Client #70] Model trained.
[INFO][11:58:21]: [Client #70] Inbound data has been processed.
[INFO][11:58:21]: [Client #70] Outbound data is ready to be sent after being processed.
[INFO][11:58:21]: [Client #17] Model trained.
[INFO][11:58:21]: [Client #17] Inbound data has been processed.
[INFO][11:58:21]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][11:58:30]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:58:30]: [Client #70] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:58:31]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][11:58:31]: [Server #3536466] Received 507.38 MB of payload data from client #70 (simulated).
[INFO][11:58:31]: [Server #3536466] Selecting client #62 for training.
[INFO][11:58:31]: [Server #3536466] Sending the current model to client #62 (simulated).
[INFO][11:58:36]: [Server #3536466] Sending 507.38 MB of payload data to client #62 (simulated).
[INFO][11:58:36]: [Client #62] Selected by the server.
[INFO][11:58:36]: [Client #62] Loading its data source...
[INFO][11:58:36]: [Client #62] Dataset size: 2018
[INFO][11:58:36]: [Client #62] Sampler: iid
[INFO][11:58:38]: [Client #62] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:58:38]: [Client #62] Start to process inbound data.
[INFO][11:58:38]: [93m[1m[Client #62] Started training in communication round #66.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.18s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:58,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.58it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.71it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.80it/s] 21%|██        | 10/48 [00:08<00:20,  1.87it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.92it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.96it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.98it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.00it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.13it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.11it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.09it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.08it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.07it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.06it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.06it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.06it/s] 50%|█████     | 24/48 [00:15<00:11,  2.05it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.06it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.06it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.06it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.08it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.08it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.08it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][11:59:10]: [Client #62] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_62_3536584.pth.
{'train_runtime': 26.7401, 'train_samples_per_second': 226.402, 'train_steps_per_second': 1.795, 'train_loss': 2.9728066126505532, 'epoch': 3.0}
[INFO][11:59:11]: [Client #62] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_62_3536584.pth.
[INFO][11:59:12]: [Client #62] Model trained.
[INFO][11:59:12]: [Client #62] Inbound data has been processed.
[INFO][11:59:12]: [Client #62] Outbound data is ready to be sent after being processed.
[INFO][11:59:17]: [Client #62] Sent 507.38 MB of payload data to the server (simulated).
[INFO][11:59:18]: [Server #3536466] Received 507.38 MB of payload data from client #62 (simulated).
[INFO][11:59:18]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][11:59:18]: [Server #3536466] Adding client #91 to the list of clients for aggregation.
[INFO][11:59:18]: [Server #3536466] Adding client #42 to the list of clients for aggregation.
[INFO][11:59:18]: [Server #3536466] Adding client #69 to the list of clients for aggregation.
[INFO][11:59:18]: [Server #3536466] Adding client #94 to the list of clients for aggregation.
[INFO][11:59:18]: [Server #3536466] Aggregating 5 clients in total.
[INFO][11:59:18]: [Server #3536466] Updated weights have been received.
[INFO][11:59:18]: [Server #3536466] Aggregating model weight deltas.
[INFO][11:59:19]: [Server #3536466] Finished aggregating updated weights.
[INFO][11:59:19]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0556e+00  1e+02  1e+00  1e+00
 1:  2.9773e+00  2.0755e+00  3e+00  2e-02  2e-02
 2:  3.0609e+00  2.3694e+00  7e-01  3e-06  4e-07
 3:  3.0605e+00  3.0482e+00  1e-02  6e-08  7e-09
 4:  3.0588e+00  3.0550e+00  4e-03  9e-08  2e-08
 5:  3.0572e+00  3.0541e+00  3e-03  9e-07  8e-07
 6:  3.0565e+00  3.0552e+00  1e-03  5e-07  4e-07
 7:  3.0557e+00  3.0553e+00  5e-04  3e-06  2e-06
 8:  3.0553e+00  3.0553e+00  3e-05  1e-06  8e-07
 9:  3.0553e+00  3.0553e+00  1e-06  5e-08  4e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.21it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.30it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.94it/s]100%|██████████| 8/8 [00:00<00:00, 11.76it/s]
[INFO][11:59:30]: [93m[1m[Server #3536466] Global model perplexity: 23.65
[0m
[INFO][11:59:30]: [Server #3536466] All client reports have been processed.
[INFO][11:59:30]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_66.pth.
[INFO][11:59:33]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_66.pth.
[INFO][11:59:33]: [93m[1m
[Server #3536466] Starting round 67/100.[0m
[INFO][11:59:33]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.22159410e-02, 2.22159410e-02, 2.22159410e-02, 2.22159410e-02,
       2.22159410e-02, 2.22159410e-02, 2.22159410e-02, 2.22159410e-02,
       2.22159410e-02, 7.27069430e-07, 1.46425647e-05, 2.22159410e-02,
       2.22159410e-02, 1.46425647e-05, 2.22159410e-02, 2.22159410e-02,
       1.46425647e-05, 3.99830840e-06, 2.22159410e-02, 3.89885364e-07,
       2.22159410e-02, 3.89885364e-07, 3.89885364e-07, 3.89885364e-07,
       2.22159410e-02, 1.46425647e-05, 1.57362114e-06, 1.46425647e-05,
       3.89885364e-07, 1.46425647e-05, 2.22159410e-02, 1.46425647e-05,
       1.46425647e-05, 1.46425647e-05, 2.22159410e-02, 1.46425647e-05,
       3.89885364e-07, 7.27069430e-07, 2.22159410e-02, 2.22159410e-02,
       2.22159410e-02, 7.27069430e-07, 2.22159410e-02, 2.22159410e-02,
       1.57362114e-06, 2.22159410e-02, 7.27069430e-07, 3.89885364e-07,
       3.89885364e-07, 7.27069430e-07, 2.22159410e-02, 2.22159410e-02,
       2.22159410e-02, 3.89885364e-07, 2.22159410e-02, 3.89885364e-07,
       2.22159410e-02, 2.22159410e-02, 2.22159410e-02, 3.99830840e-06,
       7.27069430e-07, 3.99830840e-06, 3.99830840e-06, 1.46425647e-05,
       2.22159410e-02, 2.22159410e-02, 3.99830840e-06, 3.89885364e-07,
       2.22159410e-02, 3.99830840e-06, 2.22159410e-02, 2.22159410e-02,
       2.22159410e-02, 1.46425647e-05, 2.22159410e-02, 2.22159410e-02,
       1.46425647e-05, 3.89885364e-07, 1.57362114e-06, 2.22159410e-02,
       3.89885364e-07, 3.89885364e-07, 2.22159410e-02, 2.22159410e-02,
       3.89885364e-07, 1.46425647e-05, 3.99830840e-06, 3.99830840e-06,
       2.22159410e-02, 1.46425647e-05, 1.46425647e-05, 2.22159410e-02,
       7.27069430e-07, 7.27069430e-07, 2.22159410e-02]),)
[INFO][11:59:33]: [Server #3536466] Selected clients: [14 42 33 27  4]
[INFO][11:59:33]: [Server #3536466] Selecting client #4 for training.
[INFO][11:59:33]: [Server #3536466] Sending the current model to client #4 (simulated).
[INFO][11:59:38]: [Server #3536466] Sending 507.38 MB of payload data to client #4 (simulated).
[INFO][11:59:38]: [Server #3536466] Selecting client #33 for training.
[INFO][11:59:38]: [Server #3536466] Sending the current model to client #33 (simulated).
[INFO][11:59:43]: [Server #3536466] Sending 507.38 MB of payload data to client #33 (simulated).
[INFO][11:59:43]: [Client #4] Selected by the server.
[INFO][11:59:43]: [Client #4] Loading its data source...
[INFO][11:59:43]: [Client #4] Dataset size: 2018
[INFO][11:59:43]: [Client #4] Sampler: iid
[INFO][11:59:43]: [Client #33] Selected by the server.
[INFO][11:59:43]: [Client #33] Loading its data source...
[INFO][11:59:43]: [Client #33] Dataset size: 2018
[INFO][11:59:43]: [Client #33] Sampler: iid
[INFO][11:59:44]: [Client #4] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:59:44]: [Client #4] Start to process inbound data.
[INFO][11:59:44]: [93m[1m[Client #4] Started training in communication round #67.[0m
[INFO][11:59:44]: [Client #33] Received 507.38 MB of payload data from the server (simulated).
[INFO][11:59:44]: [Client #33] Start to process inbound data.
[INFO][11:59:44]: [93m[1m[Client #33] Started training in communication round #67.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
  0%|          | 0/48 [00:00<?, ?it/s]***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:13,  4.12s/it]  4%|▍         | 2/48 [00:04<01:36,  2.10s/it]  2%|▏         | 1/48 [00:04<03:46,  4.81s/it]  6%|▋         | 3/48 [00:05<01:09,  1.55s/it]  4%|▍         | 2/48 [00:05<01:55,  2.52s/it]  8%|▊         | 4/48 [00:06<00:54,  1.24s/it]  6%|▋         | 3/48 [00:06<01:18,  1.73s/it] 10%|█         | 5/48 [00:07<00:45,  1.05s/it]  8%|▊         | 4/48 [00:07<00:59,  1.35s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.06it/s] 10%|█         | 5/48 [00:08<00:48,  1.13s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.00it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.36it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.32it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.35it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.32it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.31it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.30it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
 98%|█████████▊| 47/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.57it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.57it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][12:00:29]: [Client #4] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_4_3536584.pth.
{'train_runtime': 39.0195, 'train_samples_per_second': 155.153, 'train_steps_per_second': 1.23, 'train_loss': 2.924290657043457, 'epoch': 3.0}
[INFO][12:00:30]: [Client #33] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
{'train_runtime': 39.5906, 'train_samples_per_second': 152.915, 'train_steps_per_second': 1.212, 'train_loss': 2.4552820523579917, 'epoch': 3.0}
[INFO][12:00:31]: [Client #4] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_4_3536584.pth.
[INFO][12:00:31]: [Client #4] Model trained.
[INFO][12:00:31]: [Client #4] Inbound data has been processed.
[INFO][12:00:31]: [Client #4] Outbound data is ready to be sent after being processed.
[INFO][12:00:31]: [Client #33] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
[INFO][12:00:32]: [Client #33] Model trained.
[INFO][12:00:32]: [Client #33] Inbound data has been processed.
[INFO][12:00:32]: [Client #33] Outbound data is ready to be sent after being processed.
[INFO][12:00:38]: [Client #4] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:00:39]: [Server #3536466] Received 507.38 MB of payload data from client #4 (simulated).
[INFO][12:00:39]: [Client #33] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:00:40]: [Server #3536466] Received 507.38 MB of payload data from client #33 (simulated).
[INFO][12:00:40]: [Server #3536466] Selecting client #42 for training.
[INFO][12:00:40]: [Server #3536466] Sending the current model to client #42 (simulated).
[INFO][12:00:45]: [Server #3536466] Sending 507.38 MB of payload data to client #42 (simulated).
[INFO][12:00:45]: [Server #3536466] Selecting client #27 for training.
[INFO][12:00:45]: [Server #3536466] Sending the current model to client #27 (simulated).
[INFO][12:00:49]: [Server #3536466] Sending 507.38 MB of payload data to client #27 (simulated).
[INFO][12:00:49]: [Client #42] Selected by the server.
[INFO][12:00:49]: [Client #42] Loading its data source...
[INFO][12:00:49]: [Client #27] Selected by the server.
[INFO][12:00:49]: [Client #42] Dataset size: 2018
[INFO][12:00:49]: [Client #27] Loading its data source...
[INFO][12:00:49]: [Client #42] Sampler: iid
[INFO][12:00:49]: [Client #27] Dataset size: 2018
[INFO][12:00:49]: [Client #27] Sampler: iid
[INFO][12:00:51]: [Client #27] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:00:51]: [Client #27] Start to process inbound data.
[INFO][12:00:51]: [93m[1m[Client #27] Started training in communication round #67.[0m
[INFO][12:00:51]: [Client #42] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:00:51]: [Client #42] Start to process inbound data.
[INFO][12:00:52]: [93m[1m[Client #42] Started training in communication round #67.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:33,  4.54s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:05<01:42,  2.22s/it]  2%|▏         | 1/48 [00:04<03:47,  4.85s/it]  6%|▋         | 3/48 [00:05<01:08,  1.53s/it]  4%|▍         | 2/48 [00:05<01:51,  2.43s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 12%|█▎        | 6/48 [00:08<00:39,  1.06it/s] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.18it/s] 21%|██        | 10/48 [00:11<00:29,  1.28it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.30it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.32it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.34it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.33it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 42%|████▏     | 20/48 [00:18<00:21,  1.33it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.33it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:16,  1.31it/s] 60%|██████    | 29/48 [00:25<00:14,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 71%|███████   | 34/48 [00:28<00:10,  1.33it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.35it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.35it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
 98%|█████████▊| 47/48 [00:38<00:00,  1.47it/s]100%|██████████| 48/48 [00:39<00:00,  1.67it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.67it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][12:01:37]: [Client #27] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_27_3536585.pth.
{'train_runtime': 39.4164, 'train_samples_per_second': 153.591, 'train_steps_per_second': 1.218, 'train_loss': 2.7794227600097656, 'epoch': 3.0}
[INFO][12:01:37]: [Client #42] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
{'train_runtime': 39.4197, 'train_samples_per_second': 153.578, 'train_steps_per_second': 1.218, 'train_loss': 2.8779160181681314, 'epoch': 3.0}
[INFO][12:01:38]: [Client #27] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_27_3536585.pth.
[INFO][12:01:38]: [Client #27] Model trained.
[INFO][12:01:38]: [Client #27] Inbound data has been processed.
[INFO][12:01:38]: [Client #27] Outbound data is ready to be sent after being processed.
[INFO][12:01:39]: [Client #42] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
[INFO][12:01:39]: [Client #42] Model trained.
[INFO][12:01:39]: [Client #42] Inbound data has been processed.
[INFO][12:01:39]: [Client #42] Outbound data is ready to be sent after being processed.
[INFO][12:01:45]: [Client #27] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:01:46]: [Server #3536466] Received 507.38 MB of payload data from client #27 (simulated).
[INFO][12:01:47]: [Client #42] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:01:48]: [Server #3536466] Received 507.38 MB of payload data from client #42 (simulated).
[INFO][12:01:48]: [Server #3536466] Selecting client #14 for training.
[INFO][12:01:48]: [Server #3536466] Sending the current model to client #14 (simulated).
[INFO][12:01:52]: [Server #3536466] Sending 507.38 MB of payload data to client #14 (simulated).
[INFO][12:01:52]: [Client #14] Selected by the server.
[INFO][12:01:52]: [Client #14] Loading its data source...
[INFO][12:01:52]: [Client #14] Dataset size: 2018
[INFO][12:01:52]: [Client #14] Sampler: iid
[INFO][12:01:54]: [Client #14] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:01:54]: [Client #14] Start to process inbound data.
[INFO][12:01:54]: [93m[1m[Client #14] Started training in communication round #67.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:20,  4.27s/it]  4%|▍         | 2/48 [00:04<01:33,  2.04s/it]  6%|▋         | 3/48 [00:05<00:59,  1.33s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.42it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.58it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.71it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.09it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.08it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][12:02:27]: [Client #14] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
{'train_runtime': 26.7106, 'train_samples_per_second': 226.652, 'train_steps_per_second': 1.797, 'train_loss': 2.7202609380086265, 'epoch': 3.0}
[INFO][12:02:28]: [Client #14] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
[INFO][12:02:28]: [Client #14] Model trained.
[INFO][12:02:28]: [Client #14] Inbound data has been processed.
[INFO][12:02:28]: [Client #14] Outbound data is ready to be sent after being processed.
[INFO][12:02:33]: [Client #14] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:02:34]: [Server #3536466] Received 507.38 MB of payload data from client #14 (simulated).
[INFO][12:02:34]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][12:02:34]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][12:02:34]: [Server #3536466] Adding client #62 to the list of clients for aggregation.
[INFO][12:02:34]: [Server #3536466] Adding client #66 to the list of clients for aggregation.
[INFO][12:02:34]: [Server #3536466] Adding client #70 to the list of clients for aggregation.
[INFO][12:02:34]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:02:34]: [Server #3536466] Updated weights have been received.
[INFO][12:02:34]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:02:35]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:02:35]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0597e+00  1e+02  1e+00  1e+00
 1:  2.9820e+00  2.0797e+00  3e+00  2e-02  2e-02
 2:  3.0651e+00  2.3747e+00  7e-01  3e-06  4e-07
 3:  3.0647e+00  3.0535e+00  1e-02  5e-08  6e-09
 4:  3.0626e+00  3.0603e+00  2e-03  1e-07  2e-08
 5:  3.0604e+00  3.0604e+00  7e-05  6e-07  1e-07
 6:  3.0604e+00  3.0604e+00  1e-06  1e-08  2e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.79it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.40it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.66it/s]100%|██████████| 8/8 [00:00<00:00, 11.60it/s]
[INFO][12:02:45]: [93m[1m[Server #3536466] Global model perplexity: 24.54
[0m
[INFO][12:02:45]: [Server #3536466] All client reports have been processed.
[INFO][12:02:45]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_67.pth.
[INFO][12:02:49]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_67.pth.
[INFO][12:02:49]: [93m[1m
[Server #3536466] Starting round 68/100.[0m
[INFO][12:02:49]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.22159410e-02, 2.22159410e-02, 2.22159410e-02, 2.22159410e-02,
       2.22159410e-02, 2.22159410e-02, 2.22159410e-02, 2.22159410e-02,
       2.22159410e-02, 7.27069430e-07, 1.46425647e-05, 2.22159410e-02,
       1.46425647e-05, 2.22159410e-02, 2.22159410e-02, 2.22159410e-02,
       1.46425647e-05, 3.99830840e-06, 2.22159410e-02, 3.89885364e-07,
       2.22159410e-02, 3.89885364e-07, 3.89885364e-07, 3.89885364e-07,
       1.46425647e-05, 1.57362114e-06, 1.46425647e-05, 3.89885364e-07,
       1.46425647e-05, 1.46425647e-05, 1.46425647e-05, 1.46425647e-05,
       2.22159410e-02, 1.46425647e-05, 3.89885364e-07, 7.27069430e-07,
       2.22159410e-02, 2.22159410e-02, 7.27069430e-07, 2.22159410e-02,
       2.22159410e-02, 1.57362114e-06, 2.22159410e-02, 7.27069430e-07,
       3.89885364e-07, 3.89885364e-07, 7.27069430e-07, 2.22159410e-02,
       2.22159410e-02, 2.22159410e-02, 3.89885364e-07, 2.22159410e-02,
       3.89885364e-07, 2.22159410e-02, 2.22159410e-02, 2.22159410e-02,
       2.22159410e-02, 3.99830840e-06, 7.27069430e-07, 3.99830840e-06,
       2.22159410e-02, 3.99830840e-06, 1.46425647e-05, 2.22159410e-02,
       2.22159410e-02, 2.22159410e-02, 3.99830840e-06, 3.89885364e-07,
       2.22159410e-02, 3.99830840e-06, 2.22159410e-02, 2.22159410e-02,
       2.22159410e-02, 1.46425647e-05, 2.22159410e-02, 2.22159410e-02,
       1.46425647e-05, 3.89885364e-07, 1.57362114e-06, 2.22159410e-02,
       3.89885364e-07, 3.89885364e-07, 2.22159410e-02, 2.22159410e-02,
       3.89885364e-07, 1.46425647e-05, 3.99830840e-06, 3.99830840e-06,
       2.22159410e-02, 1.46425647e-05, 1.46425647e-05, 2.22159410e-02,
       7.27069430e-07, 7.27069430e-07, 2.22159410e-02]),)
[INFO][12:02:49]: [Server #3536466] Selected clients: [62 70 61 66  9]
[INFO][12:02:49]: [Server #3536466] Selecting client #66 for training.
[INFO][12:02:49]: [Server #3536466] Sending the current model to client #66 (simulated).
[INFO][12:02:53]: [Server #3536466] Sending 507.38 MB of payload data to client #66 (simulated).
[INFO][12:02:53]: [Server #3536466] Selecting client #9 for training.
[INFO][12:02:53]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][12:02:58]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][12:02:58]: [Client #66] Selected by the server.
[INFO][12:02:58]: [Client #66] Loading its data source...
[INFO][12:02:58]: [Client #66] Dataset size: 2018
[INFO][12:02:58]: [Client #66] Sampler: iid
[INFO][12:02:58]: [Client #9] Selected by the server.
[INFO][12:02:58]: [Client #9] Loading its data source...
[INFO][12:02:58]: [Client #9] Dataset size: 2018
[INFO][12:02:58]: [Client #9] Sampler: iid
[INFO][12:03:00]: [Client #66] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:03:00]: [Client #66] Start to process inbound data.
[INFO][12:03:00]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:03:00]: [Client #9] Start to process inbound data.
[INFO][12:03:00]: [93m[1m[Client #66] Started training in communication round #68.[0m
[INFO][12:03:00]: [93m[1m[Client #9] Started training in communication round #68.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.22s/it]  2%|▏         | 1/48 [00:04<03:47,  4.83s/it]  4%|▍         | 2/48 [00:04<01:38,  2.15s/it]  4%|▍         | 2/48 [00:05<01:51,  2.43s/it]  6%|▋         | 3/48 [00:05<01:07,  1.50s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:47,  1.09s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.30it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.31it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.30it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.31it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][12:03:46]: [Client #66] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
{'train_runtime': 39.0794, 'train_samples_per_second': 154.915, 'train_steps_per_second': 1.228, 'train_loss': 2.738266944885254, 'epoch': 3.0}
[INFO][12:03:46]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.4972, 'train_samples_per_second': 153.277, 'train_steps_per_second': 1.215, 'train_loss': 1.891384760538737, 'epoch': 3.0}
[INFO][12:03:47]: [Client #66] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
[INFO][12:03:47]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][12:03:47]: [Client #66] Model trained.
[INFO][12:03:47]: [Client #66] Inbound data has been processed.
[INFO][12:03:47]: [Client #66] Outbound data is ready to be sent after being processed.
[INFO][12:03:47]: [Client #9] Model trained.
[INFO][12:03:47]: [Client #9] Inbound data has been processed.
[INFO][12:03:47]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][12:03:56]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:03:57]: [Client #66] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:03:57]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][12:03:58]: [Server #3536466] Received 507.38 MB of payload data from client #66 (simulated).
[INFO][12:03:58]: [Server #3536466] Selecting client #70 for training.
[INFO][12:03:58]: [Server #3536466] Sending the current model to client #70 (simulated).
[INFO][12:04:02]: [Server #3536466] Sending 507.38 MB of payload data to client #70 (simulated).
[INFO][12:04:02]: [Server #3536466] Selecting client #61 for training.
[INFO][12:04:02]: [Server #3536466] Sending the current model to client #61 (simulated).
[INFO][12:04:07]: [Server #3536466] Sending 507.38 MB of payload data to client #61 (simulated).
[INFO][12:04:07]: [Client #61] Selected by the server.
[INFO][12:04:07]: [Client #70] Selected by the server.
[INFO][12:04:07]: [Client #61] Loading its data source...
[INFO][12:04:07]: [Client #70] Loading its data source...
[INFO][12:04:07]: [Client #61] Dataset size: 2018
[INFO][12:04:07]: [Client #70] Dataset size: 2018
[INFO][12:04:07]: [Client #61] Sampler: iid
[INFO][12:04:07]: [Client #70] Sampler: iid
[INFO][12:04:08]: [Client #70] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:04:08]: [Client #70] Start to process inbound data.
[INFO][12:04:09]: [93m[1m[Client #70] Started training in communication round #68.[0m
[INFO][12:04:09]: [Client #61] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:04:09]: [Client #61] Start to process inbound data.
[INFO][12:04:09]: [93m[1m[Client #61] Started training in communication round #68.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:09,  4.02s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:34,  2.05s/it]  2%|▏         | 1/48 [00:04<03:42,  4.73s/it]  6%|▋         | 3/48 [00:05<01:07,  1.49s/it]  4%|▍         | 2/48 [00:05<01:52,  2.45s/it]  8%|▊         | 4/48 [00:06<00:55,  1.26s/it]  6%|▋         | 3/48 [00:06<01:18,  1.74s/it] 10%|█         | 5/48 [00:07<00:48,  1.13s/it]  8%|▊         | 4/48 [00:07<01:00,  1.39s/it] 12%|█▎        | 6/48 [00:08<00:44,  1.05s/it] 10%|█         | 5/48 [00:08<00:53,  1.24s/it] 15%|█▍        | 7/48 [00:09<00:41,  1.02s/it] 12%|█▎        | 6/48 [00:09<00:47,  1.12s/it] 17%|█▋        | 8/48 [00:10<00:38,  1.03it/s] 15%|█▍        | 7/48 [00:10<00:42,  1.04s/it] 19%|█▉        | 9/48 [00:10<00:36,  1.06it/s] 17%|█▋        | 8/48 [00:10<00:39,  1.01it/s] 21%|██        | 10/48 [00:11<00:35,  1.08it/s] 19%|█▉        | 9/48 [00:11<00:37,  1.03it/s] 23%|██▎       | 11/48 [00:12<00:35,  1.05it/s] 21%|██        | 10/48 [00:12<00:36,  1.05it/s] 25%|██▌       | 12/48 [00:13<00:33,  1.07it/s] 23%|██▎       | 11/48 [00:13<00:34,  1.06it/s] 27%|██▋       | 13/48 [00:14<00:31,  1.11it/s] 25%|██▌       | 12/48 [00:14<00:33,  1.08it/s] 29%|██▉       | 14/48 [00:15<00:30,  1.12it/s] 27%|██▋       | 13/48 [00:15<00:32,  1.09it/s] 31%|███▏      | 15/48 [00:16<00:29,  1.12it/s] 29%|██▉       | 14/48 [00:16<00:32,  1.04it/s] 33%|███▎      | 16/48 [00:17<00:29,  1.09it/s] 31%|███▏      | 15/48 [00:17<00:30,  1.09it/s] 35%|███▌      | 17/48 [00:18<00:27,  1.14it/s] 33%|███▎      | 16/48 [00:18<00:27,  1.18it/s] 38%|███▊      | 18/48 [00:19<00:27,  1.10it/s] 35%|███▌      | 17/48 [00:19<00:27,  1.13it/s] 40%|███▉      | 19/48 [00:19<00:25,  1.12it/s] 38%|███▊      | 18/48 [00:19<00:27,  1.10it/s] 42%|████▏     | 20/48 [00:20<00:25,  1.08it/s] 40%|███▉      | 19/48 [00:20<00:26,  1.11it/s] 44%|████▍     | 21/48 [00:21<00:24,  1.10it/s] 42%|████▏     | 20/48 [00:21<00:25,  1.10it/s] 46%|████▌     | 22/48 [00:22<00:23,  1.10it/s] 44%|████▍     | 21/48 [00:22<00:24,  1.10it/s] 48%|████▊     | 23/48 [00:23<00:22,  1.10it/s] 46%|████▌     | 22/48 [00:23<00:23,  1.11it/s] 50%|█████     | 24/48 [00:24<00:21,  1.11it/s] 48%|████▊     | 23/48 [00:24<00:22,  1.13it/s] 52%|█████▏    | 25/48 [00:25<00:20,  1.12it/s] 50%|█████     | 24/48 [00:25<00:21,  1.13it/s] 54%|█████▍    | 26/48 [00:26<00:19,  1.10it/s] 52%|█████▏    | 25/48 [00:26<00:20,  1.10it/s] 56%|█████▋    | 27/48 [00:27<00:19,  1.10it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.07it/s] 58%|█████▊    | 28/48 [00:28<00:18,  1.08it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.07it/s] 60%|██████    | 29/48 [00:29<00:17,  1.08it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.08it/s] 62%|██████▎   | 30/48 [00:30<00:16,  1.08it/s] 60%|██████    | 29/48 [00:30<00:17,  1.08it/s] 65%|██████▍   | 31/48 [00:30<00:15,  1.07it/s] 62%|██████▎   | 30/48 [00:31<00:17,  1.03it/s] 67%|██████▋   | 32/48 [00:31<00:14,  1.09it/s] 65%|██████▍   | 31/48 [00:31<00:15,  1.08it/s] 69%|██████▉   | 33/48 [00:32<00:13,  1.15it/s] 67%|██████▋   | 32/48 [00:32<00:14,  1.08it/s] 71%|███████   | 34/48 [00:33<00:12,  1.08it/s] 69%|██████▉   | 33/48 [00:33<00:14,  1.05it/s] 73%|███████▎  | 35/48 [00:34<00:12,  1.04it/s] 71%|███████   | 34/48 [00:34<00:13,  1.04it/s] 75%|███████▌  | 36/48 [00:35<00:11,  1.01it/s] 73%|███████▎  | 35/48 [00:35<00:12,  1.07it/s] 77%|███████▋  | 37/48 [00:36<00:10,  1.04it/s] 75%|███████▌  | 36/48 [00:36<00:11,  1.07it/s] 79%|███████▉  | 38/48 [00:37<00:09,  1.05it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.07it/s] 81%|████████▏ | 39/48 [00:38<00:08,  1.05it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.05it/s] 83%|████████▎ | 40/48 [00:39<00:07,  1.04it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.08it/s] 85%|████████▌ | 41/48 [00:40<00:06,  1.05it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.06it/s] 88%|████████▊ | 42/48 [00:41<00:05,  1.07it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.06it/s] 90%|████████▉ | 43/48 [00:42<00:04,  1.04it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.07it/s] 92%|█████████▏| 44/48 [00:43<00:03,  1.06it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.06it/s] 94%|█████████▍| 45/48 [00:44<00:02,  1.06it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.05it/s] 96%|█████████▌| 46/48 [00:45<00:01,  1.05it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.05it/s] 98%|█████████▊| 47/48 [00:46<00:00,  1.06it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.01it/s]100%|██████████| 48/48 [00:47<00:00,  1.06it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.06it/s]100%|██████████| 48/48 [00:47<00:00,  1.02it/s]
 98%|█████████▊| 47/48 [00:46<00:00,  1.13it/s]100%|██████████| 48/48 [00:47<00:00,  1.34it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.34it/s]100%|██████████| 48/48 [00:47<00:00,  1.01it/s]
[INFO][12:05:02]: [Client #70] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_70_3536584.pth.
{'train_runtime': 47.0537, 'train_samples_per_second': 128.662, 'train_steps_per_second': 1.02, 'train_loss': 2.777989705403646, 'epoch': 3.0}
[INFO][12:05:02]: [Client #61] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536585.pth.
{'train_runtime': 47.3409, 'train_samples_per_second': 127.881, 'train_steps_per_second': 1.014, 'train_loss': 2.4583781560262046, 'epoch': 3.0}
[INFO][12:05:03]: [Client #70] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_70_3536584.pth.
[INFO][12:05:03]: [Client #70] Model trained.
[INFO][12:05:03]: [Client #70] Inbound data has been processed.
[INFO][12:05:03]: [Client #70] Outbound data is ready to be sent after being processed.
[INFO][12:05:03]: [Client #61] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536585.pth.
[INFO][12:05:04]: [Client #61] Model trained.
[INFO][12:05:04]: [Client #61] Inbound data has been processed.
[INFO][12:05:04]: [Client #61] Outbound data is ready to be sent after being processed.
[INFO][12:05:11]: [Client #70] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:05:12]: [Client #61] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:05:12]: [Server #3536466] Received 507.38 MB of payload data from client #70 (simulated).
[INFO][12:05:13]: [Server #3536466] Received 507.38 MB of payload data from client #61 (simulated).
[INFO][12:05:13]: [Server #3536466] Selecting client #62 for training.
[INFO][12:05:13]: [Server #3536466] Sending the current model to client #62 (simulated).
[INFO][12:05:18]: [Server #3536466] Sending 507.38 MB of payload data to client #62 (simulated).
[INFO][12:05:18]: [Client #62] Selected by the server.
[INFO][12:05:18]: [Client #62] Loading its data source...
[INFO][12:05:18]: [Client #62] Dataset size: 2018
[INFO][12:05:18]: [Client #62] Sampler: iid
[INFO][12:05:19]: [Client #62] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:05:19]: [Client #62] Start to process inbound data.
[INFO][12:05:19]: [93m[1m[Client #62] Started training in communication round #68.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.19s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.88it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.93it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.97it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.03it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.12it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.10it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.09it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.16it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.16it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][12:05:52]: [Client #62] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_62_3536584.pth.
{'train_runtime': 26.6936, 'train_samples_per_second': 226.796, 'train_steps_per_second': 1.798, 'train_loss': 2.8538436889648438, 'epoch': 3.0}
[INFO][12:05:53]: [Client #62] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_62_3536584.pth.
[INFO][12:05:53]: [Client #62] Model trained.
[INFO][12:05:53]: [Client #62] Inbound data has been processed.
[INFO][12:05:53]: [Client #62] Outbound data is ready to be sent after being processed.
[INFO][12:05:58]: [Client #62] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:06:00]: [Server #3536466] Received 507.38 MB of payload data from client #62 (simulated).
[INFO][12:06:00]: [Server #3536466] Adding client #14 to the list of clients for aggregation.
[INFO][12:06:00]: [Server #3536466] Adding client #33 to the list of clients for aggregation.
[INFO][12:06:00]: [Server #3536466] Adding client #27 to the list of clients for aggregation.
[INFO][12:06:00]: [Server #3536466] Adding client #42 to the list of clients for aggregation.
[INFO][12:06:00]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][12:06:00]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:06:00]: [Server #3536466] Updated weights have been received.
[INFO][12:06:00]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:06:01]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:06:01]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0597e+00  1e+02  1e+00  1e+00
 1:  2.9820e+00  2.0797e+00  3e+00  2e-02  2e-02
 2:  3.0651e+00  2.3747e+00  7e-01  3e-06  4e-07
 3:  3.0647e+00  3.0535e+00  1e-02  5e-08  6e-09
 4:  3.0626e+00  3.0603e+00  2e-03  1e-07  2e-08
 5:  3.0604e+00  3.0604e+00  7e-05  6e-07  1e-07
 6:  3.0604e+00  3.0604e+00  1e-06  1e-08  2e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 1.1 1.1 1.1 1.1 1.1 0.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.59it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.48it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.95it/s]100%|██████████| 8/8 [00:00<00:00, 11.72it/s]
[INFO][12:06:11]: [93m[1m[Server #3536466] Global model perplexity: 26.20
[0m
[INFO][12:06:11]: [Server #3536466] All client reports have been processed.
[INFO][12:06:12]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_68.pth.
[INFO][12:06:15]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_68.pth.
[INFO][12:06:15]: [93m[1m
[Server #3536466] Starting round 69/100.[0m
[INFO][12:06:15]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.31406306e-05, 2.31406306e-05, 2.31406306e-05, 2.31406306e-05,
       2.31406306e-05, 2.31406306e-05, 2.31406306e-05, 9.98932541e-01,
       2.31406306e-05, 2.76914350e-07, 2.26022452e-06, 2.31406306e-05,
       2.31406306e-05, 2.26022452e-06, 2.31406306e-05, 2.31406306e-05,
       2.31406306e-05, 2.26022452e-06, 8.39195301e-07, 2.31406306e-05,
       1.89745527e-07, 2.31406306e-05, 1.89745527e-07, 1.89745527e-07,
       1.89745527e-07, 2.31406306e-05, 2.26022452e-06, 4.44282719e-07,
       2.26022452e-06, 1.89745527e-07, 2.26022452e-06, 2.31406306e-05,
       2.26022452e-06, 2.26022452e-06, 2.26022452e-06, 2.31406306e-05,
       2.26022452e-06, 1.89745527e-07, 2.76914350e-07, 2.31406306e-05,
       2.31406306e-05, 2.31406306e-05, 2.76914350e-07, 2.31406306e-05,
       2.31406306e-05, 4.44282719e-07, 2.31406306e-05, 2.76914350e-07,
       1.89745527e-07, 1.89745527e-07, 2.76914350e-07, 2.31406306e-05,
       2.31406306e-05, 2.31406306e-05, 1.89745527e-07, 2.31406306e-05,
       1.89745527e-07, 2.31406306e-05, 2.31406306e-05, 8.39195301e-07,
       2.76914350e-07, 8.39195301e-07, 8.39195301e-07, 2.26022452e-06,
       2.31406306e-05, 2.31406306e-05, 8.39195301e-07, 1.89745527e-07,
       2.31406306e-05, 8.39195301e-07, 2.31406306e-05, 2.31406306e-05,
       2.31406306e-05, 2.26022452e-06, 2.31406306e-05, 2.31406306e-05,
       2.26022452e-06, 1.89745527e-07, 4.44282719e-07, 2.31406306e-05,
       1.89745527e-07, 1.89745527e-07, 2.31406306e-05, 2.31406306e-05,
       1.89745527e-07, 2.26022452e-06, 8.39195301e-07, 8.39195301e-07,
       2.31406306e-05, 2.26022452e-06, 2.26022452e-06, 2.31406306e-05,
       2.76914350e-07, 2.76914350e-07, 2.31406306e-05]),)
[INFO][12:06:15]: [Server #3536466] Selected clients: [ 9 41 45 10 27]
[INFO][12:06:15]: [Server #3536466] Selecting client #10 for training.
[INFO][12:06:15]: [Server #3536466] Sending the current model to client #10 (simulated).
[INFO][12:06:20]: [Server #3536466] Sending 507.38 MB of payload data to client #10 (simulated).
[INFO][12:06:20]: [Server #3536466] Selecting client #9 for training.
[INFO][12:06:20]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][12:06:24]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][12:06:24]: [Client #10] Selected by the server.
[INFO][12:06:24]: [Client #10] Loading its data source...
[INFO][12:06:24]: [Client #10] Dataset size: 2018
[INFO][12:06:24]: [Client #10] Sampler: iid
[INFO][12:06:24]: [Client #9] Selected by the server.
[INFO][12:06:24]: [Client #9] Loading its data source...
[INFO][12:06:24]: [Client #9] Dataset size: 2018
[INFO][12:06:24]: [Client #9] Sampler: iid
[INFO][12:06:26]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:06:26]: [Client #9] Start to process inbound data.
[INFO][12:06:26]: [Client #10] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:06:26]: [Client #10] Start to process inbound data.
[INFO][12:06:27]: [93m[1m[Client #9] Started training in communication round #69.[0m
[INFO][12:06:27]: [93m[1m[Client #10] Started training in communication round #69.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:09,  4.03s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:32,  2.00s/it]  2%|▏         | 1/48 [00:04<03:43,  4.75s/it]  6%|▋         | 3/48 [00:05<01:03,  1.42s/it]  4%|▍         | 2/48 [00:05<01:49,  2.38s/it]  8%|▊         | 4/48 [00:06<00:50,  1.15s/it]  6%|▋         | 3/48 [00:06<01:13,  1.62s/it] 10%|█         | 5/48 [00:06<00:43,  1.00s/it]  8%|▊         | 4/48 [00:06<00:56,  1.27s/it] 12%|█▎        | 6/48 [00:07<00:38,  1.10it/s] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 15%|█▍        | 7/48 [00:08<00:34,  1.17it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 17%|█▋        | 8/48 [00:09<00:32,  1.23it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 19%|█▉        | 9/48 [00:09<00:30,  1.27it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 21%|██        | 10/48 [00:10<00:29,  1.29it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.31it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 25%|██▌       | 12/48 [00:11<00:27,  1.32it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.33it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 33%|███▎      | 16/48 [00:14<00:23,  1.38it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 35%|███▌      | 17/48 [00:15<00:23,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.33it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.34it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.34it/s] 42%|████▏     | 20/48 [00:17<00:20,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 50%|█████     | 24/48 [00:20<00:17,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 58%|█████▊    | 28/48 [00:23<00:14,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.38it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.32it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 71%|███████   | 34/48 [00:28<00:10,  1.34it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.32it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 83%|████████▎ | 40/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.31it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 92%|█████████▏| 44/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s]100%|██████████| 48/48 [00:38<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.36it/s]100%|██████████| 48/48 [00:38<00:00,  1.24it/s]
 98%|█████████▊| 47/48 [00:38<00:00,  1.47it/s]100%|██████████| 48/48 [00:39<00:00,  1.67it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.67it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][12:07:12]: [Client #10] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
{'train_runtime': 38.7845, 'train_samples_per_second': 156.093, 'train_steps_per_second': 1.238, 'train_loss': 2.818878491719564, 'epoch': 3.0}
[INFO][12:07:12]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.1475, 'train_samples_per_second': 154.646, 'train_steps_per_second': 1.226, 'train_loss': 1.7962775230407715, 'epoch': 3.0}
[INFO][12:07:13]: [Client #10] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
[INFO][12:07:13]: [Client #10] Model trained.
[INFO][12:07:13]: [Client #10] Inbound data has been processed.
[INFO][12:07:13]: [Client #10] Outbound data is ready to be sent after being processed.
[INFO][12:07:13]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][12:07:14]: [Client #9] Model trained.
[INFO][12:07:14]: [Client #9] Inbound data has been processed.
[INFO][12:07:14]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][12:07:21]: [Client #10] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:07:22]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:07:22]: [Server #3536466] Received 507.38 MB of payload data from client #10 (simulated).
[INFO][12:07:23]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][12:07:23]: [Server #3536466] Selecting client #27 for training.
[INFO][12:07:23]: [Server #3536466] Sending the current model to client #27 (simulated).
[INFO][12:07:28]: [Server #3536466] Sending 507.38 MB of payload data to client #27 (simulated).
[INFO][12:07:28]: [Server #3536466] Selecting client #45 for training.
[INFO][12:07:28]: [Server #3536466] Sending the current model to client #45 (simulated).
[INFO][12:07:32]: [Server #3536466] Sending 507.38 MB of payload data to client #45 (simulated).
[INFO][12:07:32]: [Client #27] Selected by the server.
[INFO][12:07:32]: [Client #27] Loading its data source...
[INFO][12:07:32]: [Client #45] Selected by the server.
[INFO][12:07:32]: [Client #27] Dataset size: 2018
[INFO][12:07:32]: [Client #27] Sampler: iid
[INFO][12:07:32]: [Client #45] Loading its data source...
[INFO][12:07:32]: [Client #45] Dataset size: 2018
[INFO][12:07:32]: [Client #45] Sampler: iid
[INFO][12:07:34]: [Client #27] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:07:34]: [Client #27] Start to process inbound data.
[INFO][12:07:34]: [Client #45] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:07:34]: [Client #45] Start to process inbound data.
[INFO][12:07:34]: [93m[1m[Client #27] Started training in communication round #69.[0m
[INFO][12:07:35]: [93m[1m[Client #45] Started training in communication round #69.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:10,  4.05s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:33,  2.02s/it]  2%|▏         | 1/48 [00:04<03:43,  4.75s/it]  6%|▋         | 3/48 [00:05<01:03,  1.42s/it]  4%|▍         | 2/48 [00:05<01:50,  2.40s/it]  8%|▊         | 4/48 [00:06<00:50,  1.15s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it] 10%|█         | 5/48 [00:06<00:42,  1.00it/s]  8%|▊         | 4/48 [00:06<00:56,  1.29s/it] 12%|█▎        | 6/48 [00:07<00:38,  1.10it/s] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.16it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 19%|█▉        | 9/48 [00:09<00:31,  1.25it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:14<00:23,  1.38it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 35%|███▌      | 17/48 [00:15<00:23,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.34it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 42%|████▏     | 20/48 [00:17<00:20,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 50%|█████     | 24/48 [00:20<00:17,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 58%|█████▊    | 28/48 [00:23<00:14,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.32it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.37it/s] 65%|██████▍   | 31/48 [00:27<00:13,  1.31it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 71%|███████   | 34/48 [00:28<00:10,  1.31it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.33it/s] 71%|███████   | 34/48 [00:29<00:10,  1.33it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.33it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.31it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.31it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 83%|████████▎ | 40/48 [00:32<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.31it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 92%|█████████▏| 44/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s]100%|██████████| 48/48 [00:38<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.37it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
 98%|█████████▊| 47/48 [00:38<00:00,  1.48it/s]100%|██████████| 48/48 [00:39<00:00,  1.68it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.68it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][12:08:20]: [Client #27] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_27_3536584.pth.
{'train_runtime': 38.91, 'train_samples_per_second': 155.59, 'train_steps_per_second': 1.234, 'train_loss': 2.643702189127604, 'epoch': 3.0}
[INFO][12:08:20]: [Client #45] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_45_3536585.pth.
{'train_runtime': 39.3103, 'train_samples_per_second': 154.005, 'train_steps_per_second': 1.221, 'train_loss': 2.627146085103353, 'epoch': 3.0}
[INFO][12:08:21]: [Client #27] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_27_3536584.pth.
[INFO][12:08:21]: [Client #27] Model trained.
[INFO][12:08:21]: [Client #27] Inbound data has been processed.
[INFO][12:08:21]: [Client #27] Outbound data is ready to be sent after being processed.
[INFO][12:08:21]: [Client #45] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_45_3536585.pth.
[INFO][12:08:22]: [Client #45] Model trained.
[INFO][12:08:22]: [Client #45] Inbound data has been processed.
[INFO][12:08:22]: [Client #45] Outbound data is ready to be sent after being processed.
[INFO][12:08:29]: [Client #27] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:08:30]: [Client #45] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:08:30]: [Server #3536466] Received 507.38 MB of payload data from client #27 (simulated).
[INFO][12:08:32]: [Server #3536466] Received 507.38 MB of payload data from client #45 (simulated).
[INFO][12:08:32]: [Server #3536466] Selecting client #41 for training.
[INFO][12:08:32]: [Server #3536466] Sending the current model to client #41 (simulated).
[INFO][12:08:36]: [Server #3536466] Sending 507.38 MB of payload data to client #41 (simulated).
[INFO][12:08:36]: [Client #41] Selected by the server.
[INFO][12:08:36]: [Client #41] Loading its data source...
[INFO][12:08:36]: [Client #41] Dataset size: 2018
[INFO][12:08:36]: [Client #41] Sampler: iid
[INFO][12:08:38]: [Client #41] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:08:38]: [Client #41] Start to process inbound data.
[INFO][12:08:38]: [93m[1m[Client #41] Started training in communication round #69.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.23s/it]  4%|▍         | 2/48 [00:04<01:33,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.33s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.08it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.06it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.06it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.16it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.16it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][12:09:11]: [Client #41] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536584.pth.
{'train_runtime': 26.7458, 'train_samples_per_second': 226.354, 'train_steps_per_second': 1.795, 'train_loss': 2.5221681594848633, 'epoch': 3.0}
[INFO][12:09:12]: [Client #41] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536584.pth.
[INFO][12:09:13]: [Client #41] Model trained.
[INFO][12:09:13]: [Client #41] Inbound data has been processed.
[INFO][12:09:13]: [Client #41] Outbound data is ready to be sent after being processed.
[INFO][12:09:18]: [Client #41] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:09:19]: [Server #3536466] Received 507.38 MB of payload data from client #41 (simulated).
[INFO][12:09:19]: [Server #3536466] Adding client #62 to the list of clients for aggregation.
[INFO][12:09:19]: [Server #3536466] Adding client #66 to the list of clients for aggregation.
[INFO][12:09:19]: [Server #3536466] Adding client #61 to the list of clients for aggregation.
[INFO][12:09:19]: [Server #3536466] Adding client #70 to the list of clients for aggregation.
[INFO][12:09:19]: [Server #3536466] Adding client #4 to the list of clients for aggregation.
[INFO][12:09:19]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:09:19]: [Server #3536466] Updated weights have been received.
[INFO][12:09:19]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:09:20]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:09:20]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0586e+00  1e+02  1e+00  1e+00
 1:  2.9807e+00  2.0785e+00  3e+00  2e-02  2e-02
 2:  3.0640e+00  2.3732e+00  7e-01  3e-06  4e-07
 3:  3.0636e+00  3.0513e+00  1e-02  6e-08  7e-09
 4:  3.0618e+00  3.0580e+00  4e-03  9e-08  2e-08
 5:  3.0602e+00  3.0571e+00  3e-03  9e-07  8e-07
 6:  3.0596e+00  3.0582e+00  1e-03  5e-07  4e-07
 7:  3.0587e+00  3.0583e+00  5e-04  3e-06  2e-06
 8:  3.0583e+00  3.0583e+00  3e-05  1e-06  8e-07
 9:  3.0583e+00  3.0583e+00  1e-06  5e-08  4e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 1.1 1.1 1.1 0.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.04it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.34it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.81it/s]100%|██████████| 8/8 [00:00<00:00, 11.61it/s]
[INFO][12:09:31]: [93m[1m[Server #3536466] Global model perplexity: 23.04
[0m
[INFO][12:09:31]: [Server #3536466] All client reports have been processed.
[INFO][12:09:31]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_69.pth.
[INFO][12:09:34]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_69.pth.
[INFO][12:09:34]: [93m[1m
[Server #3536466] Starting round 70/100.[0m
[INFO][12:09:34]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.27195868e-02, 2.27195868e-02, 2.27195868e-02, 1.66341679e-05,
       2.27195868e-02, 2.27195868e-02, 2.27195868e-02, 2.27195868e-02,
       8.53543193e-07, 1.66341679e-05, 2.27195868e-02, 2.27195868e-02,
       1.66341679e-05, 2.27195868e-02, 2.27195868e-02, 2.27195868e-02,
       1.66341679e-05, 4.51211027e-06, 2.27195868e-02, 4.71229814e-07,
       2.27195868e-02, 4.71229814e-07, 4.71229814e-07, 4.71229814e-07,
       1.66341679e-05, 1.80158318e-06, 1.66341679e-05, 4.71229814e-07,
       1.66341679e-05, 2.27195868e-02, 1.66341679e-05, 1.66341679e-05,
       1.66341679e-05, 2.27195868e-02, 1.66341679e-05, 4.71229814e-07,
       8.53543193e-07, 2.27195868e-02, 2.27195868e-02, 8.53543193e-07,
       2.27195868e-02, 1.80158318e-06, 2.27195868e-02, 8.53543193e-07,
       4.71229814e-07, 4.71229814e-07, 8.53543193e-07, 2.27195868e-02,
       2.27195868e-02, 2.27195868e-02, 4.71229814e-07, 2.27195868e-02,
       4.71229814e-07, 2.27195868e-02, 2.27195868e-02, 2.27195868e-02,
       2.27195868e-02, 4.51211027e-06, 8.53543193e-07, 4.51211027e-06,
       2.27195868e-02, 4.51211027e-06, 1.66341679e-05, 2.27195868e-02,
       2.27195868e-02, 2.27195868e-02, 4.51211027e-06, 4.71229814e-07,
       2.27195868e-02, 4.51211027e-06, 2.27195868e-02, 2.27195868e-02,
       2.27195868e-02, 1.66341679e-05, 2.27195868e-02, 2.27195868e-02,
       1.66341679e-05, 4.71229814e-07, 1.80158318e-06, 2.27195868e-02,
       4.71229814e-07, 4.71229814e-07, 2.27195868e-02, 2.27195868e-02,
       4.71229814e-07, 1.66341679e-05, 4.51211027e-06, 4.51211027e-06,
       2.27195868e-02, 1.66341679e-05, 1.66341679e-05, 2.27195868e-02,
       8.53543193e-07, 8.53543193e-07, 2.27195868e-02]),)
[INFO][12:09:34]: [Server #3536466] Selected clients: [18 81 78 46 61]
[INFO][12:09:34]: [Server #3536466] Selecting client #18 for training.
[INFO][12:09:34]: [Server #3536466] Sending the current model to client #18 (simulated).
[INFO][12:09:39]: [Server #3536466] Sending 507.38 MB of payload data to client #18 (simulated).
[INFO][12:09:39]: [Server #3536466] Selecting client #81 for training.
[INFO][12:09:39]: [Server #3536466] Sending the current model to client #81 (simulated).
[INFO][12:09:44]: [Server #3536466] Sending 507.38 MB of payload data to client #81 (simulated).
[INFO][12:09:44]: [Client #18] Selected by the server.
[INFO][12:09:44]: [Client #18] Loading its data source...
[INFO][12:09:44]: [Client #18] Dataset size: 2018
[INFO][12:09:44]: [Client #18] Sampler: iid
[INFO][12:09:44]: [Client #81] Selected by the server.
[INFO][12:09:44]: [Client #81] Loading its data source...
[INFO][12:09:44]: [Client #81] Dataset size: 2018
[INFO][12:09:44]: [Client #81] Sampler: iid
[INFO][12:09:45]: [Client #81] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:09:45]: [Client #81] Start to process inbound data.
[INFO][12:09:46]: [Client #18] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:09:46]: [Client #18] Start to process inbound data.
[INFO][12:09:46]: [93m[1m[Client #81] Started training in communication round #70.[0m
[INFO][12:09:46]: [93m[1m[Client #18] Started training in communication round #70.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:10,  4.05s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:36,  2.09s/it]  2%|▏         | 1/48 [00:04<03:42,  4.74s/it]  6%|▋         | 3/48 [00:05<01:05,  1.47s/it]  4%|▍         | 2/48 [00:05<01:49,  2.39s/it]  8%|▊         | 4/48 [00:06<00:52,  1.18s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it] 10%|█         | 5/48 [00:06<00:43,  1.02s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it] 12%|█▎        | 6/48 [00:07<00:38,  1.08it/s] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.16it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 19%|█▉        | 9/48 [00:09<00:31,  1.23it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 21%|██        | 10/48 [00:10<00:30,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.29it/s] 29%|██▉       | 14/48 [00:13<00:26,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.30it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.35it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 50%|█████     | 24/48 [00:21<00:18,  1.32it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.41it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 83%|████████▎ | 40/48 [00:32<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.31it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s]100%|██████████| 48/48 [00:38<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.39it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
 98%|█████████▊| 47/48 [00:38<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.56it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.56it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][12:10:31]: [Client #18] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
{'train_runtime': 38.944, 'train_samples_per_second': 155.454, 'train_steps_per_second': 1.233, 'train_loss': 2.7726945877075195, 'epoch': 3.0}
[INFO][12:10:32]: [Client #18] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
[INFO][12:10:32]: [Client #81] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_81_3536585.pth.
{'train_runtime': 39.4142, 'train_samples_per_second': 153.6, 'train_steps_per_second': 1.218, 'train_loss': 2.720121701558431, 'epoch': 3.0}
[INFO][12:10:33]: [Client #18] Model trained.
[INFO][12:10:33]: [Client #18] Inbound data has been processed.
[INFO][12:10:33]: [Client #18] Outbound data is ready to be sent after being processed.
[INFO][12:10:33]: [Client #81] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_81_3536585.pth.
[INFO][12:10:34]: [Client #81] Model trained.
[INFO][12:10:34]: [Client #81] Inbound data has been processed.
[INFO][12:10:34]: [Client #81] Outbound data is ready to be sent after being processed.
[INFO][12:10:41]: [Client #18] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:10:42]: [Server #3536466] Received 507.38 MB of payload data from client #18 (simulated).
[INFO][12:10:42]: [Client #81] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:10:43]: [Server #3536466] Received 507.38 MB of payload data from client #81 (simulated).
[INFO][12:10:43]: [Server #3536466] Selecting client #78 for training.
[INFO][12:10:43]: [Server #3536466] Sending the current model to client #78 (simulated).
[INFO][12:10:47]: [Server #3536466] Sending 507.38 MB of payload data to client #78 (simulated).
[INFO][12:10:47]: [Server #3536466] Selecting client #61 for training.
[INFO][12:10:47]: [Server #3536466] Sending the current model to client #61 (simulated).
[INFO][12:10:52]: [Server #3536466] Sending 507.38 MB of payload data to client #61 (simulated).
[INFO][12:10:52]: [Client #78] Selected by the server.
[INFO][12:10:52]: [Client #78] Loading its data source...
[INFO][12:10:52]: [Client #61] Selected by the server.
[INFO][12:10:52]: [Client #78] Dataset size: 2018
[INFO][12:10:52]: [Client #61] Loading its data source...
[INFO][12:10:52]: [Client #78] Sampler: iid
[INFO][12:10:52]: [Client #61] Dataset size: 2018
[INFO][12:10:52]: [Client #61] Sampler: iid
[INFO][12:10:53]: [Client #61] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:10:53]: [Client #61] Start to process inbound data.
[INFO][12:10:53]: [Client #78] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:10:53]: [Client #78] Start to process inbound data.
[INFO][12:10:54]: [93m[1m[Client #61] Started training in communication round #70.[0m
[INFO][12:10:54]: [93m[1m[Client #78] Started training in communication round #70.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:05<03:57,  5.05s/it]  2%|▏         | 1/48 [00:04<03:54,  4.99s/it]  4%|▍         | 2/48 [00:06<02:02,  2.66s/it]  4%|▍         | 2/48 [00:05<02:01,  2.64s/it]  6%|▋         | 3/48 [00:06<01:23,  1.85s/it]  6%|▋         | 3/48 [00:06<01:23,  1.85s/it]  8%|▊         | 4/48 [00:07<01:02,  1.43s/it]  8%|▊         | 4/48 [00:07<01:03,  1.44s/it] 10%|█         | 5/48 [00:08<00:50,  1.17s/it] 10%|█         | 5/48 [00:08<00:51,  1.20s/it] 12%|█▎        | 6/48 [00:09<00:42,  1.02s/it] 12%|█▎        | 6/48 [00:09<00:43,  1.04s/it] 15%|█▍        | 7/48 [00:09<00:38,  1.07it/s] 15%|█▍        | 7/48 [00:09<00:38,  1.06it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 17%|█▋        | 8/48 [00:10<00:35,  1.14it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.21it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.20it/s] 21%|██        | 10/48 [00:12<00:30,  1.24it/s] 21%|██        | 10/48 [00:12<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:15<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:15<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:18<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:20<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:21<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:24<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:26<00:14,  1.31it/s] 60%|██████    | 29/48 [00:26<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:27<00:13,  1.32it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.31it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.38it/s] 69%|██████▉   | 33/48 [00:29<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:29<00:11,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.34it/s]100%|██████████| 48/48 [00:40<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.39it/s]100%|██████████| 48/48 [00:40<00:00,  1.19it/s]
100%|██████████| 48/48 [00:40<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.40it/s]100%|██████████| 48/48 [00:40<00:00,  1.19it/s]
[INFO][12:11:41]: [Client #78] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
{'train_runtime': 40.3331, 'train_samples_per_second': 150.1, 'train_steps_per_second': 1.19, 'train_loss': 2.742041269938151, 'epoch': 3.0}
[INFO][12:11:41]: [Client #61] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536585.pth.
{'train_runtime': 40.2901, 'train_samples_per_second': 150.26, 'train_steps_per_second': 1.191, 'train_loss': 2.3898205757141113, 'epoch': 3.0}
[INFO][12:11:42]: [Client #78] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
[INFO][12:11:42]: [Client #61] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536585.pth.
[INFO][12:11:43]: [Client #78] Model trained.
[INFO][12:11:43]: [Client #78] Inbound data has been processed.
[INFO][12:11:43]: [Client #78] Outbound data is ready to be sent after being processed.
[INFO][12:11:43]: [Client #61] Model trained.
[INFO][12:11:43]: [Client #61] Inbound data has been processed.
[INFO][12:11:43]: [Client #61] Outbound data is ready to be sent after being processed.
[INFO][12:11:51]: [Client #78] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:11:51]: [Client #61] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:11:52]: [Server #3536466] Received 507.38 MB of payload data from client #78 (simulated).
[INFO][12:11:53]: [Server #3536466] Received 507.38 MB of payload data from client #61 (simulated).
[INFO][12:11:53]: [Server #3536466] Selecting client #46 for training.
[INFO][12:11:53]: [Server #3536466] Sending the current model to client #46 (simulated).
[INFO][12:11:57]: [Server #3536466] Sending 507.38 MB of payload data to client #46 (simulated).
[INFO][12:11:57]: [Client #46] Selected by the server.
[INFO][12:11:57]: [Client #46] Loading its data source...
[INFO][12:11:57]: [Client #46] Dataset size: 2018
[INFO][12:11:57]: [Client #46] Sampler: iid
[INFO][12:11:59]: [Client #46] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:11:59]: [Client #46] Start to process inbound data.
[INFO][12:11:59]: [93m[1m[Client #46] Started training in communication round #70.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.20s/it]  4%|▍         | 2/48 [00:04<01:32,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.88it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.06it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.06it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.05it/s] 60%|██████    | 29/48 [00:17<00:09,  2.05it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.05it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.05it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.15it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.11it/s] 71%|███████   | 34/48 [00:20<00:06,  2.09it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.07it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.06it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.06it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.05it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.05it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.05it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.05it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.04it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.04it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.04it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.04it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.04it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.04it/s]100%|██████████| 48/48 [00:26<00:00,  2.14it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.14it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][12:12:32]: [Client #46] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
{'train_runtime': 26.8535, 'train_samples_per_second': 225.446, 'train_steps_per_second': 1.787, 'train_loss': 2.8984012603759766, 'epoch': 3.0}
[INFO][12:12:33]: [Client #46] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
[INFO][12:12:34]: [Client #46] Model trained.
[INFO][12:12:34]: [Client #46] Inbound data has been processed.
[INFO][12:12:34]: [Client #46] Outbound data is ready to be sent after being processed.
[INFO][12:12:39]: [Client #46] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:12:40]: [Server #3536466] Received 507.38 MB of payload data from client #46 (simulated).
[INFO][12:12:40]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][12:12:40]: [Server #3536466] Adding client #10 to the list of clients for aggregation.
[INFO][12:12:40]: [Server #3536466] Adding client #41 to the list of clients for aggregation.
[INFO][12:12:40]: [Server #3536466] Adding client #45 to the list of clients for aggregation.
[INFO][12:12:40]: [Server #3536466] Adding client #27 to the list of clients for aggregation.
[INFO][12:12:40]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:12:40]: [Server #3536466] Updated weights have been received.
[INFO][12:12:40]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:12:41]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:12:41]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0627e+00  1e+02  1e+00  1e+00
 1:  2.9854e+00  2.0827e+00  3e+00  2e-02  2e-02
 2:  3.0682e+00  2.3786e+00  7e-01  3e-06  4e-07
 3:  3.0677e+00  3.0565e+00  1e-02  5e-08  6e-09
 4:  3.0657e+00  3.0633e+00  2e-03  1e-07  2e-08
 5:  3.0634e+00  3.0634e+00  8e-05  6e-07  1e-07
 6:  3.0634e+00  3.0634e+00  2e-06  2e-08  3e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.83it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.39it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.00it/s]100%|██████████| 8/8 [00:00<00:00, 11.75it/s]
[INFO][12:12:52]: [93m[1m[Server #3536466] Global model perplexity: 26.08
[0m
[INFO][12:12:52]: [Server #3536466] All client reports have been processed.
[INFO][12:12:52]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_70.pth.
[INFO][12:12:55]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_70.pth.
[INFO][12:12:55]: [93m[1m
[Server #3536466] Starting round 71/100.[0m
[INFO][12:12:55]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.27195868e-02, 2.27195868e-02, 2.27195868e-02, 1.66341679e-05,
       2.27195868e-02, 2.27195868e-02, 2.27195868e-02, 2.27195868e-02,
       2.27195868e-02, 2.27195868e-02, 8.53543193e-07, 1.66341679e-05,
       2.27195868e-02, 2.27195868e-02, 1.66341679e-05, 2.27195868e-02,
       2.27195868e-02, 1.66341679e-05, 4.51211027e-06, 2.27195868e-02,
       4.71229814e-07, 2.27195868e-02, 4.71229814e-07, 4.71229814e-07,
       4.71229814e-07, 2.27195868e-02, 1.66341679e-05, 1.80158318e-06,
       1.66341679e-05, 4.71229814e-07, 1.66341679e-05, 2.27195868e-02,
       1.66341679e-05, 1.66341679e-05, 1.66341679e-05, 2.27195868e-02,
       1.66341679e-05, 4.71229814e-07, 8.53543193e-07, 2.27195868e-02,
       2.27195868e-02, 2.27195868e-02, 8.53543193e-07, 2.27195868e-02,
       1.80158318e-06, 2.27195868e-02, 8.53543193e-07, 4.71229814e-07,
       4.71229814e-07, 8.53543193e-07, 2.27195868e-02, 2.27195868e-02,
       2.27195868e-02, 4.71229814e-07, 2.27195868e-02, 4.71229814e-07,
       2.27195868e-02, 2.27195868e-02, 2.27195868e-02, 4.51211027e-06,
       8.53543193e-07, 4.51211027e-06, 2.27195868e-02, 4.51211027e-06,
       1.66341679e-05, 2.27195868e-02, 2.27195868e-02, 2.27195868e-02,
       4.51211027e-06, 4.71229814e-07, 2.27195868e-02, 4.51211027e-06,
       2.27195868e-02, 2.27195868e-02, 1.66341679e-05, 2.27195868e-02,
       1.66341679e-05, 4.71229814e-07, 1.80158318e-06, 2.27195868e-02,
       4.71229814e-07, 4.71229814e-07, 2.27195868e-02, 2.27195868e-02,
       4.71229814e-07, 1.66341679e-05, 4.51211027e-06, 4.51211027e-06,
       2.27195868e-02, 1.66341679e-05, 1.66341679e-05, 2.27195868e-02,
       8.53543193e-07, 8.53543193e-07, 2.27195868e-02]),)
[INFO][12:12:55]: [Server #3536466] Selected clients: [ 8 48 21 80 62]
[INFO][12:12:55]: [Server #3536466] Selecting client #48 for training.
[INFO][12:12:55]: [Server #3536466] Sending the current model to client #48 (simulated).
[INFO][12:13:00]: [Server #3536466] Sending 507.38 MB of payload data to client #48 (simulated).
[INFO][12:13:00]: [Server #3536466] Selecting client #21 for training.
[INFO][12:13:00]: [Server #3536466] Sending the current model to client #21 (simulated).
[INFO][12:13:05]: [Server #3536466] Sending 507.38 MB of payload data to client #21 (simulated).
[INFO][12:13:05]: [Client #48] Selected by the server.
[INFO][12:13:05]: [Client #48] Loading its data source...
[INFO][12:13:05]: [Client #48] Dataset size: 2018
[INFO][12:13:05]: [Client #48] Sampler: iid
[INFO][12:13:05]: [Client #21] Selected by the server.
[INFO][12:13:05]: [Client #21] Loading its data source...
[INFO][12:13:05]: [Client #21] Dataset size: 2018
[INFO][12:13:05]: [Client #21] Sampler: iid
[INFO][12:13:06]: [Client #21] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:13:06]: [Client #21] Start to process inbound data.
[INFO][12:13:06]: [Client #48] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:13:06]: [Client #48] Start to process inbound data.
[INFO][12:13:07]: [93m[1m[Client #48] Started training in communication round #71.[0m
[INFO][12:13:07]: [93m[1m[Client #21] Started training in communication round #71.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:09,  4.03s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:36,  2.09s/it]  2%|▏         | 1/48 [00:04<03:37,  4.63s/it]  6%|▋         | 3/48 [00:05<01:11,  1.59s/it]  4%|▍         | 2/48 [00:05<01:56,  2.54s/it]  8%|▊         | 4/48 [00:06<01:00,  1.38s/it]  6%|▋         | 3/48 [00:06<01:24,  1.87s/it] 10%|█         | 5/48 [00:07<00:54,  1.27s/it]  8%|▊         | 4/48 [00:07<01:08,  1.56s/it] 12%|█▎        | 6/48 [00:08<00:50,  1.21s/it] 10%|█         | 5/48 [00:08<00:59,  1.39s/it] 15%|█▍        | 7/48 [00:10<00:47,  1.16s/it] 12%|█▎        | 6/48 [00:10<00:54,  1.30s/it] 17%|█▋        | 8/48 [00:10<00:42,  1.07s/it] 15%|█▍        | 7/48 [00:11<00:48,  1.19s/it] 19%|█▉        | 9/48 [00:11<00:39,  1.02s/it] 17%|█▋        | 8/48 [00:11<00:43,  1.09s/it] 21%|██        | 10/48 [00:12<00:36,  1.03it/s] 19%|█▉        | 9/48 [00:12<00:40,  1.04s/it] 23%|██▎       | 11/48 [00:13<00:35,  1.05it/s] 21%|██        | 10/48 [00:13<00:38,  1.00s/it] 25%|██▌       | 12/48 [00:14<00:33,  1.06it/s] 23%|██▎       | 11/48 [00:14<00:36,  1.03it/s] 27%|██▋       | 13/48 [00:15<00:32,  1.07it/s] 25%|██▌       | 12/48 [00:15<00:33,  1.06it/s] 29%|██▉       | 14/48 [00:16<00:32,  1.06it/s] 27%|██▋       | 13/48 [00:16<00:32,  1.07it/s] 31%|███▏      | 15/48 [00:17<00:30,  1.09it/s] 29%|██▉       | 14/48 [00:17<00:33,  1.01it/s] 33%|███▎      | 16/48 [00:18<00:29,  1.07it/s] 31%|███▏      | 15/48 [00:18<00:30,  1.07it/s] 35%|███▌      | 17/48 [00:18<00:27,  1.14it/s] 33%|███▎      | 16/48 [00:19<00:29,  1.10it/s] 38%|███▊      | 18/48 [00:19<00:27,  1.09it/s] 35%|███▌      | 17/48 [00:20<00:29,  1.06it/s] 40%|███▉      | 19/48 [00:20<00:27,  1.06it/s] 38%|███▊      | 18/48 [00:21<00:28,  1.06it/s] 42%|████▏     | 20/48 [00:21<00:26,  1.06it/s] 40%|███▉      | 19/48 [00:22<00:27,  1.07it/s] 44%|████▍     | 21/48 [00:22<00:25,  1.04it/s] 42%|████▏     | 20/48 [00:23<00:25,  1.08it/s] 46%|████▌     | 22/48 [00:23<00:24,  1.07it/s] 44%|████▍     | 21/48 [00:23<00:24,  1.08it/s] 48%|████▊     | 23/48 [00:24<00:23,  1.08it/s] 46%|████▌     | 22/48 [00:24<00:24,  1.07it/s] 50%|█████     | 24/48 [00:25<00:22,  1.08it/s] 48%|████▊     | 23/48 [00:25<00:23,  1.09it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.09it/s] 50%|█████     | 24/48 [00:26<00:21,  1.10it/s] 54%|█████▍    | 26/48 [00:27<00:19,  1.10it/s] 52%|█████▏    | 25/48 [00:27<00:21,  1.09it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.10it/s] 54%|█████▍    | 26/48 [00:28<00:20,  1.09it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.09it/s] 56%|█████▋    | 27/48 [00:29<00:19,  1.09it/s] 60%|██████    | 29/48 [00:30<00:17,  1.09it/s] 58%|█████▊    | 28/48 [00:30<00:18,  1.10it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.08it/s] 60%|██████    | 29/48 [00:31<00:17,  1.10it/s] 65%|██████▍   | 31/48 [00:32<00:15,  1.11it/s] 62%|██████▎   | 30/48 [00:32<00:17,  1.04it/s] 67%|██████▋   | 32/48 [00:32<00:14,  1.08it/s] 65%|██████▍   | 31/48 [00:33<00:15,  1.09it/s] 69%|██████▉   | 33/48 [00:33<00:13,  1.14it/s] 67%|██████▋   | 32/48 [00:34<00:14,  1.08it/s] 71%|███████   | 34/48 [00:34<00:13,  1.07it/s] 69%|██████▉   | 33/48 [00:35<00:14,  1.05it/s] 73%|███████▎  | 35/48 [00:35<00:12,  1.04it/s] 71%|███████   | 34/48 [00:35<00:13,  1.06it/s] 75%|███████▌  | 36/48 [00:36<00:11,  1.05it/s] 73%|███████▎  | 35/48 [00:36<00:12,  1.08it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.06it/s] 75%|███████▌  | 36/48 [00:37<00:10,  1.09it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.07it/s] 77%|███████▋  | 37/48 [00:38<00:10,  1.06it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.06it/s] 79%|███████▉  | 38/48 [00:39<00:09,  1.07it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.05it/s] 81%|████████▏ | 39/48 [00:40<00:08,  1.07it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.07it/s] 83%|████████▎ | 40/48 [00:41<00:07,  1.08it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.05it/s] 85%|████████▌ | 41/48 [00:42<00:06,  1.07it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.06it/s] 88%|████████▊ | 42/48 [00:43<00:05,  1.09it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.05it/s] 90%|████████▉ | 43/48 [00:44<00:04,  1.08it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.06it/s] 92%|█████████▏| 44/48 [00:45<00:03,  1.08it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.07it/s] 94%|█████████▍| 45/48 [00:46<00:02,  1.06it/s] 98%|█████████▊| 47/48 [00:47<00:00,  1.08it/s] 96%|█████████▌| 46/48 [00:47<00:01,  1.01it/s]100%|██████████| 48/48 [00:47<00:00,  1.08it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:48<00:00,  1.08it/s]100%|██████████| 48/48 [00:48<00:00,  1.00s/it]
 98%|█████████▊| 47/48 [00:47<00:00,  1.14it/s]100%|██████████| 48/48 [00:48<00:00,  1.35it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:48<00:00,  1.35it/s]100%|██████████| 48/48 [00:48<00:00,  1.01s/it]
[INFO][12:14:01]: [Client #48] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_48_3536584.pth.
{'train_runtime': 48.003, 'train_samples_per_second': 126.117, 'train_steps_per_second': 1.0, 'train_loss': 2.9140211741129556, 'epoch': 3.0}
[INFO][12:14:02]: [Client #21] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_21_3536585.pth.
{'train_runtime': 48.3745, 'train_samples_per_second': 125.149, 'train_steps_per_second': 0.992, 'train_loss': 2.701448440551758, 'epoch': 3.0}
[INFO][12:14:02]: [Client #48] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_48_3536584.pth.
[INFO][12:14:02]: [Client #48] Model trained.
[INFO][12:14:02]: [Client #48] Inbound data has been processed.
[INFO][12:14:02]: [Client #48] Outbound data is ready to be sent after being processed.
[INFO][12:14:03]: [Client #21] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_21_3536585.pth.
[INFO][12:14:03]: [Client #21] Model trained.
[INFO][12:14:03]: [Client #21] Inbound data has been processed.
[INFO][12:14:03]: [Client #21] Outbound data is ready to be sent after being processed.
[INFO][12:14:10]: [Client #48] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:14:11]: [Server #3536466] Received 507.38 MB of payload data from client #48 (simulated).
[INFO][12:14:11]: [Client #21] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:14:12]: [Server #3536466] Received 507.38 MB of payload data from client #21 (simulated).
[INFO][12:14:12]: [Server #3536466] Selecting client #80 for training.
[INFO][12:14:12]: [Server #3536466] Sending the current model to client #80 (simulated).
[INFO][12:14:17]: [Server #3536466] Sending 507.38 MB of payload data to client #80 (simulated).
[INFO][12:14:17]: [Client #80] Selected by the server.
[INFO][12:14:17]: [Client #80] Loading its data source...
[INFO][12:14:17]: [Client #80] Dataset size: 2018
[INFO][12:14:17]: [Client #80] Sampler: iid
[INFO][12:14:18]: [Client #80] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:14:18]: [Client #80] Start to process inbound data.
[INFO][12:14:18]: [93m[1m[Client #80] Started training in communication round #71.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.20s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.71it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.80it/s] 21%|██        | 10/48 [00:08<00:20,  1.87it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.92it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.95it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.98it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.00it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.13it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.10it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.09it/s] 40%|███▉      | 19/48 [00:12<00:14,  2.07it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.07it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.06it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.06it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.05it/s] 50%|█████     | 24/48 [00:15<00:11,  2.06it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.06it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.08it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.08it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][12:14:51]: [Client #80] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_80_3536584.pth.
{'train_runtime': 26.7651, 'train_samples_per_second': 226.19, 'train_steps_per_second': 1.793, 'train_loss': 2.9299596150716147, 'epoch': 3.0}
[INFO][12:14:52]: [Client #80] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_80_3536584.pth.
[INFO][12:14:53]: [Client #80] Model trained.
[INFO][12:14:53]: [Client #80] Inbound data has been processed.
[INFO][12:14:53]: [Client #80] Outbound data is ready to be sent after being processed.
[INFO][12:14:58]: [Client #80] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:14:59]: [Server #3536466] Received 507.38 MB of payload data from client #80 (simulated).
[INFO][12:14:59]: [Server #3536466] Selecting client #8 for training.
[INFO][12:14:59]: [Server #3536466] Sending the current model to client #8 (simulated).
[INFO][12:15:03]: [Server #3536466] Sending 507.38 MB of payload data to client #8 (simulated).
[INFO][12:15:03]: [Client #8] Selected by the server.
[INFO][12:15:03]: [Client #8] Loading its data source...
[INFO][12:15:03]: [Client #8] Dataset size: 2018
[INFO][12:15:03]: [Client #8] Sampler: iid
[INFO][12:15:05]: [Client #8] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:15:05]: [Client #8] Start to process inbound data.
[INFO][12:15:05]: [93m[1m[Client #8] Started training in communication round #71.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.21s/it]  4%|▍         | 2/48 [00:04<01:32,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:09<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.97it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.99it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.00it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.13it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.10it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.08it/s] 40%|███▉      | 19/48 [00:12<00:14,  2.07it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.06it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.06it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.05it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.05it/s] 50%|█████     | 24/48 [00:15<00:11,  2.05it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.05it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.05it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.04it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.04it/s] 60%|██████    | 29/48 [00:17<00:09,  2.04it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.04it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.04it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.15it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.11it/s] 71%|███████   | 34/48 [00:20<00:06,  2.09it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.08it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.07it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.06it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.05it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.05it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.05it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.05it/s] 88%|████████▊ | 42/48 [00:24<00:02,  2.04it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.04it/s] 92%|█████████▏| 44/48 [00:25<00:01,  2.04it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.04it/s] 96%|█████████▌| 46/48 [00:26<00:00,  2.04it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.04it/s]100%|██████████| 48/48 [00:26<00:00,  2.14it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.14it/s]100%|██████████| 48/48 [00:26<00:00,  1.78it/s]
[INFO][12:15:38]: [Client #8] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_8_3536584.pth.
{'train_runtime': 26.9183, 'train_samples_per_second': 224.902, 'train_steps_per_second': 1.783, 'train_loss': 2.9419466654459634, 'epoch': 3.0}
[INFO][12:15:39]: [Client #8] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_8_3536584.pth.
[INFO][12:15:40]: [Client #8] Model trained.
[INFO][12:15:40]: [Client #8] Inbound data has been processed.
[INFO][12:15:40]: [Client #8] Outbound data is ready to be sent after being processed.
[INFO][12:15:45]: [Client #8] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:15:46]: [Server #3536466] Received 507.38 MB of payload data from client #8 (simulated).
[INFO][12:15:46]: [Server #3536466] Selecting client #62 for training.
[INFO][12:15:46]: [Server #3536466] Sending the current model to client #62 (simulated).
[INFO][12:15:51]: [Server #3536466] Sending 507.38 MB of payload data to client #62 (simulated).
[INFO][12:15:51]: [Client #62] Selected by the server.
[INFO][12:15:51]: [Client #62] Loading its data source...
[INFO][12:15:51]: [Client #62] Dataset size: 2018
[INFO][12:15:51]: [Client #62] Sampler: iid
[INFO][12:15:52]: [Client #62] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:15:52]: [Client #62] Start to process inbound data.
[INFO][12:15:52]: [93m[1m[Client #62] Started training in communication round #71.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:21,  4.28s/it]  4%|▍         | 2/48 [00:04<01:34,  2.04s/it]  6%|▋         | 3/48 [00:05<00:59,  1.33s/it]  8%|▊         | 4/48 [00:05<00:43,  1.00it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.12it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.08it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][12:16:25]: [Client #62] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_62_3536584.pth.
{'train_runtime': 26.7016, 'train_samples_per_second': 226.728, 'train_steps_per_second': 1.798, 'train_loss': 2.876542409261068, 'epoch': 3.0}
[INFO][12:16:26]: [Client #62] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_62_3536584.pth.
[INFO][12:16:27]: [Client #62] Model trained.
[INFO][12:16:27]: [Client #62] Inbound data has been processed.
[INFO][12:16:27]: [Client #62] Outbound data is ready to be sent after being processed.
[INFO][12:16:32]: [Client #62] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:16:33]: [Server #3536466] Received 507.38 MB of payload data from client #62 (simulated).
[INFO][12:16:33]: [Server #3536466] Adding client #46 to the list of clients for aggregation.
[INFO][12:16:33]: [Server #3536466] Adding client #78 to the list of clients for aggregation.
[INFO][12:16:33]: [Server #3536466] Adding client #61 to the list of clients for aggregation.
[INFO][12:16:33]: [Server #3536466] Adding client #81 to the list of clients for aggregation.
[INFO][12:16:33]: [Server #3536466] Adding client #18 to the list of clients for aggregation.
[INFO][12:16:33]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:16:33]: [Server #3536466] Updated weights have been received.
[INFO][12:16:33]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:16:34]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:16:34]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0627e+00  1e+02  1e+00  1e+00
 1:  2.9854e+00  2.0827e+00  3e+00  2e-02  2e-02
 2:  3.0682e+00  2.3786e+00  7e-01  3e-06  4e-07
 3:  3.0677e+00  3.0565e+00  1e-02  5e-08  6e-09
 4:  3.0657e+00  3.0633e+00  2e-03  1e-07  2e-08
 5:  3.0634e+00  3.0634e+00  8e-05  6e-07  1e-07
 6:  3.0634e+00  3.0634e+00  2e-06  2e-08  3e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.14it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.35it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.86it/s]100%|██████████| 8/8 [00:00<00:00, 11.70it/s]
[INFO][12:16:45]: [93m[1m[Server #3536466] Global model perplexity: 23.19
[0m
[INFO][12:16:45]: [Server #3536466] All client reports have been processed.
[INFO][12:16:45]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_71.pth.
[INFO][12:16:48]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_71.pth.
[INFO][12:16:48]: [93m[1m
[Server #3536466] Starting round 72/100.[0m
[INFO][12:16:48]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.27195868e-02, 2.27195868e-02, 2.27195868e-02, 1.66341679e-05,
       2.27195868e-02, 2.27195868e-02, 2.27195868e-02, 2.27195868e-02,
       2.27195868e-02, 8.53543193e-07, 1.66341679e-05, 2.27195868e-02,
       2.27195868e-02, 1.66341679e-05, 2.27195868e-02, 2.27195868e-02,
       2.27195868e-02, 1.66341679e-05, 4.51211027e-06, 4.71229814e-07,
       2.27195868e-02, 4.71229814e-07, 4.71229814e-07, 4.71229814e-07,
       2.27195868e-02, 1.66341679e-05, 1.80158318e-06, 1.66341679e-05,
       4.71229814e-07, 1.66341679e-05, 2.27195868e-02, 1.66341679e-05,
       1.66341679e-05, 1.66341679e-05, 2.27195868e-02, 1.66341679e-05,
       4.71229814e-07, 8.53543193e-07, 2.27195868e-02, 2.27195868e-02,
       2.27195868e-02, 8.53543193e-07, 2.27195868e-02, 2.27195868e-02,
       1.80158318e-06, 8.53543193e-07, 4.71229814e-07, 4.71229814e-07,
       8.53543193e-07, 2.27195868e-02, 2.27195868e-02, 2.27195868e-02,
       4.71229814e-07, 2.27195868e-02, 4.71229814e-07, 2.27195868e-02,
       2.27195868e-02, 2.27195868e-02, 4.51211027e-06, 8.53543193e-07,
       4.51211027e-06, 2.27195868e-02, 4.51211027e-06, 1.66341679e-05,
       2.27195868e-02, 2.27195868e-02, 2.27195868e-02, 4.51211027e-06,
       4.71229814e-07, 2.27195868e-02, 4.51211027e-06, 2.27195868e-02,
       2.27195868e-02, 2.27195868e-02, 1.66341679e-05, 2.27195868e-02,
       1.66341679e-05, 4.71229814e-07, 1.80158318e-06, 2.27195868e-02,
       4.71229814e-07, 4.71229814e-07, 2.27195868e-02, 2.27195868e-02,
       4.71229814e-07, 1.66341679e-05, 4.51211027e-06, 4.51211027e-06,
       2.27195868e-02, 1.66341679e-05, 1.66341679e-05, 2.27195868e-02,
       8.53543193e-07, 8.53543193e-07, 2.27195868e-02]),)
[INFO][12:16:48]: [Server #3536466] Selected clients: [ 60   7  45 100  94]
[INFO][12:16:48]: [Server #3536466] Selecting client #100 for training.
[INFO][12:16:48]: [Server #3536466] Sending the current model to client #100 (simulated).
[INFO][12:16:53]: [Server #3536466] Sending 507.38 MB of payload data to client #100 (simulated).
[INFO][12:16:53]: [Server #3536466] Selecting client #7 for training.
[INFO][12:16:53]: [Server #3536466] Sending the current model to client #7 (simulated).
[INFO][12:16:58]: [Server #3536466] Sending 507.38 MB of payload data to client #7 (simulated).
[INFO][12:16:58]: [Client #100] Selected by the server.
[INFO][12:16:58]: [Client #100] Loading its data source...
[INFO][12:16:58]: [Client #100] Dataset size: 2018
[INFO][12:16:58]: [Client #100] Sampler: iid
[INFO][12:16:58]: [Client #7] Selected by the server.
[INFO][12:16:58]: [Client #7] Loading its data source...
[INFO][12:16:58]: [Client #7] Dataset size: 2018
[INFO][12:16:58]: [Client #7] Sampler: iid
[INFO][12:16:59]: [Client #7] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:16:59]: [Client #7] Start to process inbound data.
[INFO][12:16:59]: [Client #100] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:16:59]: [Client #100] Start to process inbound data.
[INFO][12:17:00]: [93m[1m[Client #100] Started training in communication round #72.[0m
[INFO][12:17:00]: [93m[1m[Client #7] Started training in communication round #72.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:09,  4.03s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:34,  2.05s/it]  2%|▏         | 1/48 [00:04<03:46,  4.82s/it]  6%|▋         | 3/48 [00:05<01:08,  1.53s/it]  4%|▍         | 2/48 [00:05<01:56,  2.53s/it]  8%|▊         | 4/48 [00:06<00:57,  1.31s/it]  6%|▋         | 3/48 [00:06<01:19,  1.76s/it] 10%|█         | 5/48 [00:07<00:51,  1.20s/it]  8%|▊         | 4/48 [00:07<01:03,  1.44s/it] 12%|█▎        | 6/48 [00:08<00:45,  1.07s/it] 10%|█         | 5/48 [00:08<00:53,  1.24s/it] 15%|█▍        | 7/48 [00:09<00:41,  1.01s/it] 12%|█▎        | 6/48 [00:09<00:46,  1.11s/it] 17%|█▋        | 8/48 [00:10<00:39,  1.02it/s] 15%|█▍        | 7/48 [00:10<00:42,  1.04s/it] 19%|█▉        | 9/48 [00:11<00:37,  1.05it/s] 17%|█▋        | 8/48 [00:11<00:39,  1.01it/s] 21%|██        | 10/48 [00:11<00:35,  1.09it/s] 19%|█▉        | 9/48 [00:12<00:38,  1.02it/s] 23%|██▎       | 11/48 [00:12<00:33,  1.09it/s] 21%|██        | 10/48 [00:12<00:36,  1.04it/s] 25%|██▌       | 12/48 [00:13<00:32,  1.09it/s] 23%|██▎       | 11/48 [00:13<00:35,  1.05it/s] 27%|██▋       | 13/48 [00:14<00:33,  1.05it/s] 25%|██▌       | 12/48 [00:14<00:33,  1.07it/s] 29%|██▉       | 14/48 [00:15<00:32,  1.06it/s] 27%|██▋       | 13/48 [00:15<00:33,  1.04it/s] 31%|███▏      | 15/48 [00:16<00:30,  1.07it/s] 29%|██▉       | 14/48 [00:16<00:33,  1.01it/s] 33%|███▎      | 16/48 [00:17<00:29,  1.07it/s] 31%|███▏      | 15/48 [00:17<00:30,  1.07it/s] 35%|███▌      | 17/48 [00:18<00:27,  1.14it/s] 33%|███▎      | 16/48 [00:18<00:29,  1.10it/s] 38%|███▊      | 18/48 [00:19<00:27,  1.10it/s] 35%|███▌      | 17/48 [00:19<00:28,  1.10it/s] 40%|███▉      | 19/48 [00:20<00:26,  1.09it/s] 38%|███▊      | 18/48 [00:20<00:26,  1.12it/s] 42%|████▏     | 20/48 [00:21<00:25,  1.10it/s] 40%|███▉      | 19/48 [00:21<00:26,  1.11it/s] 44%|████▍     | 21/48 [00:22<00:24,  1.10it/s] 42%|████▏     | 20/48 [00:22<00:25,  1.10it/s] 46%|████▌     | 22/48 [00:23<00:24,  1.08it/s] 44%|████▍     | 21/48 [00:23<00:25,  1.08it/s] 48%|████▊     | 23/48 [00:23<00:23,  1.08it/s] 46%|████▌     | 22/48 [00:24<00:24,  1.08it/s] 50%|█████     | 24/48 [00:24<00:22,  1.07it/s] 48%|████▊     | 23/48 [00:24<00:23,  1.07it/s] 52%|█████▏    | 25/48 [00:25<00:21,  1.07it/s] 50%|█████     | 24/48 [00:25<00:22,  1.05it/s] 54%|█████▍    | 26/48 [00:26<00:20,  1.05it/s] 52%|█████▏    | 25/48 [00:26<00:22,  1.04it/s] 56%|█████▋    | 27/48 [00:27<00:20,  1.05it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.05it/s] 58%|█████▊    | 28/48 [00:28<00:18,  1.06it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.06it/s] 60%|██████    | 29/48 [00:29<00:17,  1.06it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.09it/s] 62%|██████▎   | 30/48 [00:30<00:17,  1.05it/s] 60%|██████    | 29/48 [00:30<00:17,  1.07it/s] 65%|██████▍   | 31/48 [00:31<00:16,  1.06it/s] 62%|██████▎   | 30/48 [00:31<00:17,  1.02it/s] 67%|██████▋   | 32/48 [00:32<00:14,  1.08it/s] 65%|██████▍   | 31/48 [00:32<00:15,  1.08it/s] 69%|██████▉   | 33/48 [00:33<00:13,  1.14it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.07it/s] 71%|███████   | 34/48 [00:34<00:13,  1.07it/s] 69%|██████▉   | 33/48 [00:34<00:14,  1.05it/s] 73%|███████▎  | 35/48 [00:35<00:12,  1.03it/s] 71%|███████   | 34/48 [00:35<00:13,  1.07it/s] 75%|███████▌  | 36/48 [00:36<00:11,  1.06it/s] 73%|███████▎  | 35/48 [00:36<00:12,  1.06it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.06it/s] 75%|███████▌  | 36/48 [00:37<00:11,  1.06it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.06it/s] 77%|███████▋  | 37/48 [00:38<00:10,  1.07it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.05it/s] 79%|███████▉  | 38/48 [00:39<00:09,  1.09it/s] 83%|████████▎ | 40/48 [00:39<00:07,  1.05it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.09it/s] 85%|████████▌ | 41/48 [00:40<00:06,  1.05it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.09it/s] 88%|████████▊ | 42/48 [00:41<00:05,  1.05it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.08it/s] 90%|████████▉ | 43/48 [00:42<00:04,  1.05it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.06it/s] 92%|█████████▏| 44/48 [00:43<00:03,  1.06it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.07it/s] 94%|█████████▍| 45/48 [00:44<00:02,  1.06it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.06it/s] 96%|█████████▌| 46/48 [00:45<00:01,  1.06it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.04it/s] 98%|█████████▊| 47/48 [00:46<00:00,  1.06it/s] 96%|█████████▌| 46/48 [00:46<00:02,  1.02s/it]100%|██████████| 48/48 [00:47<00:00,  1.04it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.04it/s]100%|██████████| 48/48 [00:47<00:00,  1.01it/s]
 98%|█████████▊| 47/48 [00:47<00:00,  1.11it/s]100%|██████████| 48/48 [00:47<00:00,  1.33it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.33it/s]100%|██████████| 48/48 [00:47<00:00,  1.00it/s]
[INFO][12:17:53]: [Client #100] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_100_3536584.pth.
{'train_runtime': 47.6084, 'train_samples_per_second': 127.163, 'train_steps_per_second': 1.008, 'train_loss': 2.9349543253580728, 'epoch': 3.0}
[INFO][12:17:54]: [Client #7] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536585.pth.
{'train_runtime': 47.8992, 'train_samples_per_second': 126.39, 'train_steps_per_second': 1.002, 'train_loss': 2.570119539896647, 'epoch': 3.0}
[INFO][12:17:55]: [Client #100] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_100_3536584.pth.
[INFO][12:17:55]: [Client #100] Model trained.
[INFO][12:17:55]: [Client #100] Inbound data has been processed.
[INFO][12:17:55]: [Client #100] Outbound data is ready to be sent after being processed.
[INFO][12:17:55]: [Client #7] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536585.pth.
[INFO][12:17:56]: [Client #7] Model trained.
[INFO][12:17:56]: [Client #7] Inbound data has been processed.
[INFO][12:17:56]: [Client #7] Outbound data is ready to be sent after being processed.
[INFO][12:18:03]: [Client #100] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:18:04]: [Client #7] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:18:04]: [Server #3536466] Received 507.38 MB of payload data from client #100 (simulated).
[INFO][12:18:05]: [Server #3536466] Received 507.38 MB of payload data from client #7 (simulated).
[INFO][12:18:05]: [Server #3536466] Selecting client #60 for training.
[INFO][12:18:05]: [Server #3536466] Sending the current model to client #60 (simulated).
[INFO][12:18:09]: [Server #3536466] Sending 507.38 MB of payload data to client #60 (simulated).
[INFO][12:18:09]: [Server #3536466] Selecting client #45 for training.
[INFO][12:18:09]: [Server #3536466] Sending the current model to client #45 (simulated).
[INFO][12:18:14]: [Server #3536466] Sending 507.38 MB of payload data to client #45 (simulated).
[INFO][12:18:14]: [Client #60] Selected by the server.
[INFO][12:18:14]: [Client #60] Loading its data source...
[INFO][12:18:14]: [Client #60] Dataset size: 2018
[INFO][12:18:14]: [Client #60] Sampler: iid
[INFO][12:18:14]: [Client #45] Selected by the server.
[INFO][12:18:14]: [Client #45] Loading its data source...
[INFO][12:18:14]: [Client #45] Dataset size: 2018
[INFO][12:18:14]: [Client #45] Sampler: iid
[INFO][12:18:15]: [Client #45] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:18:15]: [Client #45] Start to process inbound data.
[INFO][12:18:16]: [Client #60] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:18:16]: [Client #60] Start to process inbound data.
[INFO][12:18:16]: [93m[1m[Client #45] Started training in communication round #72.[0m
[INFO][12:18:16]: [93m[1m[Client #60] Started training in communication round #72.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:08,  4.02s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:34,  2.06s/it]  2%|▏         | 1/48 [00:04<03:46,  4.82s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  4%|▍         | 2/48 [00:05<01:57,  2.56s/it]  8%|▊         | 4/48 [00:06<00:57,  1.31s/it]  6%|▋         | 3/48 [00:06<01:21,  1.81s/it] 10%|█         | 5/48 [00:07<00:51,  1.19s/it]  8%|▊         | 4/48 [00:07<01:02,  1.42s/it] 12%|█▎        | 6/48 [00:08<00:45,  1.08s/it] 10%|█         | 5/48 [00:08<00:52,  1.22s/it] 15%|█▍        | 7/48 [00:09<00:41,  1.01s/it] 12%|█▎        | 6/48 [00:09<00:47,  1.12s/it] 17%|█▋        | 8/48 [00:10<00:38,  1.04it/s] 15%|█▍        | 7/48 [00:10<00:43,  1.06s/it] 19%|█▉        | 9/48 [00:11<00:36,  1.05it/s] 17%|█▋        | 8/48 [00:11<00:40,  1.01s/it] 21%|██        | 10/48 [00:11<00:35,  1.07it/s] 19%|█▉        | 9/48 [00:12<00:37,  1.04it/s] 23%|██▎       | 11/48 [00:12<00:33,  1.09it/s] 21%|██        | 10/48 [00:12<00:35,  1.07it/s] 25%|██▌       | 12/48 [00:13<00:32,  1.10it/s] 23%|██▎       | 11/48 [00:13<00:33,  1.09it/s] 27%|██▋       | 13/48 [00:14<00:32,  1.08it/s] 25%|██▌       | 12/48 [00:14<00:33,  1.09it/s] 29%|██▉       | 14/48 [00:15<00:31,  1.10it/s] 27%|██▋       | 13/48 [00:15<00:32,  1.08it/s] 31%|███▏      | 15/48 [00:16<00:30,  1.09it/s] 29%|██▉       | 14/48 [00:16<00:32,  1.04it/s] 33%|███▎      | 16/48 [00:17<00:28,  1.10it/s] 31%|███▏      | 15/48 [00:17<00:30,  1.09it/s] 35%|███▌      | 17/48 [00:18<00:26,  1.17it/s] 33%|███▎      | 16/48 [00:18<00:29,  1.10it/s] 38%|███▊      | 18/48 [00:19<00:27,  1.09it/s] 35%|███▌      | 17/48 [00:19<00:27,  1.11it/s] 40%|███▉      | 19/48 [00:20<00:26,  1.10it/s] 38%|███▊      | 18/48 [00:20<00:26,  1.11it/s] 42%|████▏     | 20/48 [00:21<00:25,  1.09it/s] 40%|███▉      | 19/48 [00:21<00:25,  1.12it/s] 44%|████▍     | 21/48 [00:21<00:24,  1.09it/s] 42%|████▏     | 20/48 [00:21<00:24,  1.12it/s] 46%|████▌     | 22/48 [00:22<00:23,  1.10it/s] 44%|████▍     | 21/48 [00:22<00:24,  1.09it/s] 48%|████▊     | 23/48 [00:23<00:23,  1.08it/s] 46%|████▌     | 22/48 [00:23<00:23,  1.09it/s] 50%|█████     | 24/48 [00:24<00:22,  1.07it/s] 48%|████▊     | 23/48 [00:24<00:23,  1.08it/s] 52%|█████▏    | 25/48 [00:25<00:21,  1.07it/s] 50%|█████     | 24/48 [00:25<00:22,  1.09it/s] 54%|█████▍    | 26/48 [00:26<00:20,  1.08it/s] 52%|█████▏    | 25/48 [00:26<00:20,  1.10it/s] 56%|█████▋    | 27/48 [00:27<00:19,  1.08it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.08it/s] 58%|█████▊    | 28/48 [00:28<00:18,  1.09it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.05it/s] 60%|██████    | 29/48 [00:29<00:17,  1.09it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.05it/s] 62%|██████▎   | 30/48 [00:30<00:16,  1.08it/s] 60%|██████    | 29/48 [00:30<00:17,  1.06it/s] 65%|██████▍   | 31/48 [00:31<00:15,  1.08it/s] 62%|██████▎   | 30/48 [00:31<00:17,  1.02it/s] 67%|██████▋   | 32/48 [00:32<00:15,  1.06it/s] 65%|██████▍   | 31/48 [00:32<00:15,  1.08it/s] 69%|██████▉   | 33/48 [00:32<00:13,  1.13it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.08it/s] 71%|███████   | 34/48 [00:33<00:13,  1.07it/s] 69%|██████▉   | 33/48 [00:34<00:14,  1.06it/s] 73%|███████▎  | 35/48 [00:35<00:12,  1.03it/s] 71%|███████   | 34/48 [00:35<00:13,  1.05it/s] 75%|███████▌  | 36/48 [00:35<00:11,  1.04it/s] 73%|███████▎  | 35/48 [00:36<00:12,  1.06it/s] 77%|███████▋  | 37/48 [00:36<00:10,  1.05it/s] 75%|███████▌  | 36/48 [00:36<00:11,  1.08it/s] 79%|███████▉  | 38/48 [00:37<00:09,  1.03it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.06it/s] 81%|████████▏ | 39/48 [00:38<00:08,  1.06it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.08it/s] 83%|████████▎ | 40/48 [00:39<00:07,  1.05it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.08it/s] 85%|████████▌ | 41/48 [00:40<00:06,  1.05it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.08it/s] 88%|████████▊ | 42/48 [00:41<00:05,  1.05it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.07it/s] 90%|████████▉ | 43/48 [00:42<00:04,  1.05it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.07it/s] 92%|█████████▏| 44/48 [00:43<00:03,  1.08it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.06it/s] 94%|█████████▍| 45/48 [00:44<00:02,  1.08it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.05it/s] 96%|█████████▌| 46/48 [00:45<00:01,  1.08it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.06it/s] 98%|█████████▊| 47/48 [00:46<00:00,  1.08it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.01it/s]100%|██████████| 48/48 [00:47<00:00,  1.06it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.06it/s]100%|██████████| 48/48 [00:47<00:00,  1.02it/s]
 98%|█████████▊| 47/48 [00:47<00:00,  1.14it/s]100%|██████████| 48/48 [00:47<00:00,  1.35it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.35it/s]100%|██████████| 48/48 [00:47<00:00,  1.01it/s]
[INFO][12:19:09]: [Client #60] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
{'train_runtime': 47.2453, 'train_samples_per_second': 128.14, 'train_steps_per_second': 1.016, 'train_loss': 2.816979726155599, 'epoch': 3.0}
[INFO][12:19:10]: [Client #45] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_45_3536585.pth.
{'train_runtime': 47.6057, 'train_samples_per_second': 127.17, 'train_steps_per_second': 1.008, 'train_loss': 2.6007320086161294, 'epoch': 3.0}
[INFO][12:19:11]: [Client #60] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
[INFO][12:19:11]: [Client #60] Model trained.
[INFO][12:19:11]: [Client #60] Inbound data has been processed.
[INFO][12:19:11]: [Client #60] Outbound data is ready to be sent after being processed.
[INFO][12:19:11]: [Client #45] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_45_3536585.pth.
[INFO][12:19:12]: [Client #45] Model trained.
[INFO][12:19:12]: [Client #45] Inbound data has been processed.
[INFO][12:19:12]: [Client #45] Outbound data is ready to be sent after being processed.
[INFO][12:19:18]: [Client #60] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:19:19]: [Server #3536466] Received 507.38 MB of payload data from client #60 (simulated).
[INFO][12:19:19]: [Client #45] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:19:20]: [Server #3536466] Received 507.38 MB of payload data from client #45 (simulated).
[INFO][12:19:20]: [Server #3536466] Selecting client #94 for training.
[INFO][12:19:20]: [Server #3536466] Sending the current model to client #94 (simulated).
[INFO][12:19:25]: [Server #3536466] Sending 507.38 MB of payload data to client #94 (simulated).
[INFO][12:19:25]: [Client #94] Selected by the server.
[INFO][12:19:25]: [Client #94] Loading its data source...
[INFO][12:19:25]: [Client #94] Dataset size: 2018
[INFO][12:19:25]: [Client #94] Sampler: iid
[INFO][12:19:27]: [Client #94] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:19:27]: [Client #94] Start to process inbound data.
[INFO][12:19:27]: [93m[1m[Client #94] Started training in communication round #72.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.21s/it]  4%|▍         | 2/48 [00:04<01:33,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.12it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][12:20:00]: [Client #94] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_94_3536584.pth.
{'train_runtime': 26.6439, 'train_samples_per_second': 227.219, 'train_steps_per_second': 1.802, 'train_loss': 2.8679412206014, 'epoch': 3.0}
[INFO][12:20:01]: [Client #94] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_94_3536584.pth.
[INFO][12:20:01]: [Client #94] Model trained.
[INFO][12:20:01]: [Client #94] Inbound data has been processed.
[INFO][12:20:01]: [Client #94] Outbound data is ready to be sent after being processed.
[INFO][12:20:06]: [Client #94] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:20:07]: [Server #3536466] Received 507.38 MB of payload data from client #94 (simulated).
[INFO][12:20:07]: [Server #3536466] Adding client #21 to the list of clients for aggregation.
[INFO][12:20:07]: [Server #3536466] Adding client #48 to the list of clients for aggregation.
[INFO][12:20:07]: [Server #3536466] Adding client #62 to the list of clients for aggregation.
[INFO][12:20:07]: [Server #3536466] Adding client #80 to the list of clients for aggregation.
[INFO][12:20:07]: [Server #3536466] Adding client #8 to the list of clients for aggregation.
[INFO][12:20:07]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:20:07]: [Server #3536466] Updated weights have been received.
[INFO][12:20:08]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:20:09]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:20:09]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0627e+00  1e+02  1e+00  1e+00
 1:  2.9854e+00  2.0827e+00  3e+00  2e-02  2e-02
 2:  3.0682e+00  2.3786e+00  7e-01  3e-06  4e-07
 3:  3.0677e+00  3.0565e+00  1e-02  5e-08  6e-09
 4:  3.0657e+00  3.0633e+00  2e-03  1e-07  2e-08
 5:  3.0634e+00  3.0634e+00  8e-05  6e-07  1e-07
 6:  3.0634e+00  3.0634e+00  2e-06  2e-08  3e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.83it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.29it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.79it/s]100%|██████████| 8/8 [00:00<00:00, 11.57it/s]
[INFO][12:20:20]: [93m[1m[Server #3536466] Global model perplexity: 22.15
[0m
[INFO][12:20:20]: [Server #3536466] All client reports have been processed.
[INFO][12:20:20]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_72.pth.
[INFO][12:20:23]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_72.pth.
[INFO][12:20:23]: [93m[1m
[Server #3536466] Starting round 73/100.[0m
[INFO][12:20:23]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.27195868e-02, 2.27195868e-02, 2.27195868e-02, 1.66341679e-05,
       2.27195868e-02, 2.27195868e-02, 2.27195868e-02, 2.27195868e-02,
       2.27195868e-02, 8.53543193e-07, 1.66341679e-05, 2.27195868e-02,
       2.27195868e-02, 1.66341679e-05, 2.27195868e-02, 2.27195868e-02,
       2.27195868e-02, 1.66341679e-05, 4.51211027e-06, 2.27195868e-02,
       4.71229814e-07, 2.27195868e-02, 4.71229814e-07, 4.71229814e-07,
       4.71229814e-07, 2.27195868e-02, 1.66341679e-05, 1.80158318e-06,
       1.66341679e-05, 4.71229814e-07, 1.66341679e-05, 2.27195868e-02,
       1.66341679e-05, 1.66341679e-05, 1.66341679e-05, 2.27195868e-02,
       1.66341679e-05, 4.71229814e-07, 8.53543193e-07, 2.27195868e-02,
       2.27195868e-02, 2.27195868e-02, 8.53543193e-07, 2.27195868e-02,
       1.80158318e-06, 2.27195868e-02, 8.53543193e-07, 4.71229814e-07,
       4.71229814e-07, 8.53543193e-07, 2.27195868e-02, 2.27195868e-02,
       2.27195868e-02, 4.71229814e-07, 2.27195868e-02, 4.71229814e-07,
       2.27195868e-02, 2.27195868e-02, 2.27195868e-02, 4.51211027e-06,
       8.53543193e-07, 4.51211027e-06, 2.27195868e-02, 4.51211027e-06,
       1.66341679e-05, 2.27195868e-02, 2.27195868e-02, 2.27195868e-02,
       4.51211027e-06, 4.71229814e-07, 2.27195868e-02, 4.51211027e-06,
       2.27195868e-02, 2.27195868e-02, 2.27195868e-02, 1.66341679e-05,
       2.27195868e-02, 2.27195868e-02, 1.66341679e-05, 4.71229814e-07,
       1.80158318e-06, 2.27195868e-02, 4.71229814e-07, 4.71229814e-07,
       2.27195868e-02, 2.27195868e-02, 4.71229814e-07, 1.66341679e-05,
       4.51211027e-06, 4.51211027e-06, 1.66341679e-05, 1.66341679e-05,
       2.27195868e-02, 8.53543193e-07, 8.53543193e-07]),)
[INFO][12:20:23]: [Server #3536466] Selected clients: [61  9 54 43 41]
[INFO][12:20:23]: [Server #3536466] Selecting client #54 for training.
[INFO][12:20:23]: [Server #3536466] Sending the current model to client #54 (simulated).
[INFO][12:20:28]: [Server #3536466] Sending 507.38 MB of payload data to client #54 (simulated).
[INFO][12:20:28]: [Server #3536466] Selecting client #9 for training.
[INFO][12:20:28]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][12:20:33]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][12:20:33]: [Client #54] Selected by the server.
[INFO][12:20:33]: [Client #54] Loading its data source...
[INFO][12:20:33]: [Client #54] Dataset size: 2018
[INFO][12:20:33]: [Client #54] Sampler: iid
[INFO][12:20:33]: [Client #9] Selected by the server.
[INFO][12:20:33]: [Client #9] Loading its data source...
[INFO][12:20:33]: [Client #9] Dataset size: 2018
[INFO][12:20:33]: [Client #9] Sampler: iid
[INFO][12:20:34]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:20:34]: [Client #9] Start to process inbound data.
[INFO][12:20:34]: [Client #54] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:20:34]: [Client #54] Start to process inbound data.
[INFO][12:20:35]: [93m[1m[Client #9] Started training in communication round #73.[0m
[INFO][12:20:35]: [93m[1m[Client #54] Started training in communication round #73.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.19s/it]  2%|▏         | 1/48 [00:04<03:39,  4.67s/it]  4%|▍         | 2/48 [00:04<01:38,  2.14s/it]  4%|▍         | 2/48 [00:05<01:50,  2.40s/it]  6%|▋         | 3/48 [00:05<01:07,  1.49s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it]  8%|▊         | 4/48 [00:06<00:52,  1.19s/it]  8%|▊         | 4/48 [00:06<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.08it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.16it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.13it/s] 17%|█▋        | 8/48 [00:09<00:32,  1.22it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.31it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.33it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.31it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.31it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 60%|██████    | 29/48 [00:24<00:14,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.31it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.31it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][12:21:21]: [Client #54] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_54_3536584.pth.
{'train_runtime': 39.1287, 'train_samples_per_second': 154.72, 'train_steps_per_second': 1.227, 'train_loss': 2.7747933069864907, 'epoch': 3.0}
[INFO][12:21:21]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.4771, 'train_samples_per_second': 153.355, 'train_steps_per_second': 1.216, 'train_loss': 1.7460420926411946, 'epoch': 3.0}
[INFO][12:21:22]: [Client #54] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_54_3536584.pth.
[INFO][12:21:22]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][12:21:22]: [Client #54] Model trained.
[INFO][12:21:22]: [Client #54] Inbound data has been processed.
[INFO][12:21:22]: [Client #54] Outbound data is ready to be sent after being processed.
[INFO][12:21:23]: [Client #9] Model trained.
[INFO][12:21:23]: [Client #9] Inbound data has been processed.
[INFO][12:21:23]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][12:21:30]: [Client #54] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:21:31]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:21:32]: [Server #3536466] Received 507.38 MB of payload data from client #54 (simulated).
[INFO][12:21:33]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][12:21:33]: [Server #3536466] Selecting client #43 for training.
[INFO][12:21:33]: [Server #3536466] Sending the current model to client #43 (simulated).
[INFO][12:21:38]: [Server #3536466] Sending 507.38 MB of payload data to client #43 (simulated).
[INFO][12:21:38]: [Server #3536466] Selecting client #61 for training.
[INFO][12:21:38]: [Server #3536466] Sending the current model to client #61 (simulated).
[INFO][12:21:42]: [Server #3536466] Sending 507.38 MB of payload data to client #61 (simulated).
[INFO][12:21:42]: [Client #43] Selected by the server.
[INFO][12:21:42]: [Client #43] Loading its data source...
[INFO][12:21:42]: [Client #61] Selected by the server.
[INFO][12:21:42]: [Client #43] Dataset size: 2018
[INFO][12:21:42]: [Client #61] Loading its data source...
[INFO][12:21:42]: [Client #43] Sampler: iid
[INFO][12:21:42]: [Client #61] Dataset size: 2018
[INFO][12:21:42]: [Client #61] Sampler: iid
[INFO][12:21:44]: [Client #43] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:21:44]: [Client #43] Start to process inbound data.
[INFO][12:21:44]: [93m[1m[Client #43] Started training in communication round #73.[0m
[INFO][12:21:44]: [Client #61] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:21:44]: [Client #61] Start to process inbound data.
[INFO][12:21:44]: [93m[1m[Client #61] Started training in communication round #73.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.17s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:39,  2.17s/it]  2%|▏         | 1/48 [00:04<03:39,  4.67s/it]  6%|▋         | 3/48 [00:05<01:08,  1.53s/it]  4%|▍         | 2/48 [00:05<01:49,  2.37s/it]  8%|▊         | 4/48 [00:06<00:54,  1.23s/it]  6%|▋         | 3/48 [00:06<01:12,  1.62s/it] 10%|█         | 5/48 [00:07<00:45,  1.06s/it]  8%|▊         | 4/48 [00:06<00:55,  1.26s/it] 12%|█▎        | 6/48 [00:07<00:40,  1.05it/s] 10%|█         | 5/48 [00:07<00:46,  1.07s/it] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.13it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.32it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:16,  1.31it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 71%|███████   | 34/48 [00:28<00:10,  1.32it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.31it/s] 71%|███████   | 34/48 [00:29<00:10,  1.32it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.31it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.32it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.30it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.31it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.31it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.31it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
 98%|█████████▊| 47/48 [00:38<00:00,  1.35it/s]100%|██████████| 48/48 [00:39<00:00,  1.55it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.55it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][12:22:29]: [Client #43] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536584.pth.
{'train_runtime': 39.2994, 'train_samples_per_second': 154.048, 'train_steps_per_second': 1.221, 'train_loss': 2.666932741800944, 'epoch': 3.0}
[INFO][12:22:29]: [Client #61] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536585.pth.
{'train_runtime': 39.3792, 'train_samples_per_second': 153.736, 'train_steps_per_second': 1.219, 'train_loss': 2.5142923990885415, 'epoch': 3.0}
[INFO][12:22:30]: [Client #43] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536584.pth.
[INFO][12:22:30]: [Client #61] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536585.pth.
[INFO][12:22:31]: [Client #43] Model trained.
[INFO][12:22:31]: [Client #43] Inbound data has been processed.
[INFO][12:22:31]: [Client #43] Outbound data is ready to be sent after being processed.
[INFO][12:22:31]: [Client #61] Model trained.
[INFO][12:22:31]: [Client #61] Inbound data has been processed.
[INFO][12:22:31]: [Client #61] Outbound data is ready to be sent after being processed.
[INFO][12:22:38]: [Client #43] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:22:39]: [Client #61] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:22:39]: [Server #3536466] Received 507.38 MB of payload data from client #43 (simulated).
[INFO][12:22:40]: [Server #3536466] Received 507.38 MB of payload data from client #61 (simulated).
[INFO][12:22:40]: [Server #3536466] Selecting client #41 for training.
[INFO][12:22:40]: [Server #3536466] Sending the current model to client #41 (simulated).
[INFO][12:22:45]: [Server #3536466] Sending 507.38 MB of payload data to client #41 (simulated).
[INFO][12:22:45]: [Client #41] Selected by the server.
[INFO][12:22:45]: [Client #41] Loading its data source...
[INFO][12:22:45]: [Client #41] Dataset size: 2018
[INFO][12:22:45]: [Client #41] Sampler: iid
[INFO][12:22:46]: [Client #41] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:22:46]: [Client #41] Start to process inbound data.
[INFO][12:22:47]: [93m[1m[Client #41] Started training in communication round #73.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.22s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.12it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.09it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.06it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.06it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][12:23:20]: [Client #41] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536584.pth.
{'train_runtime': 26.7234, 'train_samples_per_second': 226.543, 'train_steps_per_second': 1.796, 'train_loss': 2.4204139709472656, 'epoch': 3.0}
[INFO][12:23:21]: [Client #41] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_41_3536584.pth.
[INFO][12:23:21]: [Client #41] Model trained.
[INFO][12:23:21]: [Client #41] Inbound data has been processed.
[INFO][12:23:21]: [Client #41] Outbound data is ready to be sent after being processed.
[INFO][12:23:26]: [Client #41] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:23:28]: [Server #3536466] Received 507.38 MB of payload data from client #41 (simulated).
[INFO][12:23:28]: [Server #3536466] Adding client #45 to the list of clients for aggregation.
[INFO][12:23:28]: [Server #3536466] Adding client #7 to the list of clients for aggregation.
[INFO][12:23:28]: [Server #3536466] Adding client #60 to the list of clients for aggregation.
[INFO][12:23:28]: [Server #3536466] Adding client #100 to the list of clients for aggregation.
[INFO][12:23:28]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][12:23:28]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:23:28]: [Server #3536466] Updated weights have been received.
[INFO][12:23:28]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:23:29]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:23:29]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0627e+00  1e+02  1e+00  1e+00
 1:  2.9854e+00  2.0827e+00  3e+00  2e-02  2e-02
 2:  3.0682e+00  2.3786e+00  7e-01  3e-06  4e-07
 3:  3.0677e+00  3.0565e+00  1e-02  5e-08  6e-09
 4:  3.0657e+00  3.0633e+00  2e-03  1e-07  2e-08
 5:  3.0634e+00  3.0634e+00  8e-05  6e-07  1e-07
 6:  3.0634e+00  3.0634e+00  2e-06  2e-08  3e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 1.1 1.1 1.1 0.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 1.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.76it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.37it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.87it/s]100%|██████████| 8/8 [00:00<00:00, 11.69it/s]
[INFO][12:23:40]: [93m[1m[Server #3536466] Global model perplexity: 25.69
[0m
[INFO][12:23:40]: [Server #3536466] All client reports have been processed.
[INFO][12:23:40]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_73.pth.
[INFO][12:23:43]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_73.pth.
[INFO][12:23:43]: [93m[1m
[Server #3536466] Starting round 74/100.[0m
[INFO][12:23:43]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.54411833e-05, 2.54411833e-05, 2.54411833e-05, 2.49268970e-06,
       2.54411833e-05, 2.54411833e-05, 2.54411833e-05, 2.54411833e-05,
       9.98849205e-01, 2.54411833e-05, 3.05181515e-07, 2.49268970e-06,
       2.54411833e-05, 2.54411833e-05, 2.49268970e-06, 2.54411833e-05,
       2.54411833e-05, 2.54411833e-05, 2.49268970e-06, 9.25194937e-07,
       2.54411833e-05, 2.09094657e-07, 2.54411833e-05, 2.09094657e-07,
       2.09094657e-07, 2.09094657e-07, 2.54411833e-05, 2.49268970e-06,
       4.89703396e-07, 2.49268970e-06, 2.09094657e-07, 2.49268970e-06,
       2.54411833e-05, 2.49268970e-06, 2.49268970e-06, 2.49268970e-06,
       2.54411833e-05, 2.49268970e-06, 2.09094657e-07, 3.05181515e-07,
       2.54411833e-05, 3.05181515e-07, 2.54411833e-05, 2.54411833e-05,
       4.89703396e-07, 2.54411833e-05, 3.05181515e-07, 2.09094657e-07,
       2.09094657e-07, 3.05181515e-07, 2.54411833e-05, 2.54411833e-05,
       2.09094657e-07, 2.54411833e-05, 2.09094657e-07, 2.54411833e-05,
       2.54411833e-05, 2.54411833e-05, 9.25194937e-07, 3.05181515e-07,
       9.25194937e-07, 2.54411833e-05, 9.25194937e-07, 2.49268970e-06,
       2.54411833e-05, 2.54411833e-05, 2.54411833e-05, 9.25194937e-07,
       2.09094657e-07, 2.54411833e-05, 9.25194937e-07, 2.54411833e-05,
       2.54411833e-05, 2.54411833e-05, 2.49268970e-06, 2.54411833e-05,
       2.54411833e-05, 2.49268970e-06, 2.09094657e-07, 4.89703396e-07,
       2.54411833e-05, 2.09094657e-07, 2.09094657e-07, 2.54411833e-05,
       2.54411833e-05, 2.09094657e-07, 2.49268970e-06, 9.25194937e-07,
       9.25194937e-07, 2.49268970e-06, 2.49268970e-06, 2.54411833e-05,
       3.05181515e-07, 3.05181515e-07, 2.54411833e-05]),)
[INFO][12:23:43]: [Server #3536466] Selected clients: [  9   3 100  13  42]
[INFO][12:23:43]: [Server #3536466] Selecting client #100 for training.
[INFO][12:23:43]: [Server #3536466] Sending the current model to client #100 (simulated).
[INFO][12:23:48]: [Server #3536466] Sending 507.38 MB of payload data to client #100 (simulated).
[INFO][12:23:48]: [Server #3536466] Selecting client #3 for training.
[INFO][12:23:48]: [Server #3536466] Sending the current model to client #3 (simulated).
[INFO][12:23:53]: [Server #3536466] Sending 507.38 MB of payload data to client #3 (simulated).
[INFO][12:23:53]: [Client #100] Selected by the server.
[INFO][12:23:53]: [Client #100] Loading its data source...
[INFO][12:23:53]: [Client #100] Dataset size: 2018
[INFO][12:23:53]: [Client #100] Sampler: iid
[INFO][12:23:53]: [Client #3] Selected by the server.
[INFO][12:23:53]: [Client #3] Loading its data source...
[INFO][12:23:53]: [Client #3] Dataset size: 2018
[INFO][12:23:53]: [Client #3] Sampler: iid
[INFO][12:23:54]: [Client #3] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:23:54]: [Client #3] Start to process inbound data.
[INFO][12:23:54]: [Client #100] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:23:54]: [Client #100] Start to process inbound data.
[INFO][12:23:55]: [93m[1m[Client #3] Started training in communication round #74.[0m
[INFO][12:23:55]: [93m[1m[Client #100] Started training in communication round #74.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:14,  4.13s/it]  2%|▏         | 1/48 [00:04<03:49,  4.87s/it]  4%|▍         | 2/48 [00:04<01:38,  2.13s/it]  4%|▍         | 2/48 [00:05<01:56,  2.52s/it]  6%|▋         | 3/48 [00:05<01:10,  1.57s/it]  6%|▋         | 3/48 [00:06<01:17,  1.73s/it]  8%|▊         | 4/48 [00:06<00:55,  1.27s/it]  8%|▊         | 4/48 [00:07<00:58,  1.33s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:48,  1.12s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.20it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.32it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.33it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.42it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.34it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.30it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][12:24:41]: [Client #100] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_100_3536584.pth.
{'train_runtime': 39.2665, 'train_samples_per_second': 154.177, 'train_steps_per_second': 1.222, 'train_loss': 2.819478670756022, 'epoch': 3.0}
[INFO][12:24:41]: [Client #3] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_3_3536585.pth.
{'train_runtime': 39.6819, 'train_samples_per_second': 152.563, 'train_steps_per_second': 1.21, 'train_loss': 2.740335464477539, 'epoch': 3.0}
[INFO][12:24:42]: [Client #100] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_100_3536584.pth.
[INFO][12:24:42]: [Client #3] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_3_3536585.pth.
[INFO][12:24:42]: [Client #100] Model trained.
[INFO][12:24:42]: [Client #100] Inbound data has been processed.
[INFO][12:24:42]: [Client #100] Outbound data is ready to be sent after being processed.
[INFO][12:24:43]: [Client #3] Model trained.
[INFO][12:24:43]: [Client #3] Inbound data has been processed.
[INFO][12:24:43]: [Client #3] Outbound data is ready to be sent after being processed.
[INFO][12:24:51]: [Client #3] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:24:52]: [Client #100] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:24:52]: [Server #3536466] Received 507.38 MB of payload data from client #3 (simulated).
[INFO][12:24:53]: [Server #3536466] Received 507.38 MB of payload data from client #100 (simulated).
[INFO][12:24:53]: [Server #3536466] Selecting client #42 for training.
[INFO][12:24:53]: [Server #3536466] Sending the current model to client #42 (simulated).
[INFO][12:24:58]: [Server #3536466] Sending 507.38 MB of payload data to client #42 (simulated).
[INFO][12:24:58]: [Server #3536466] Selecting client #9 for training.
[INFO][12:24:58]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][12:25:02]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][12:25:02]: [Client #42] Selected by the server.
[INFO][12:25:02]: [Client #9] Selected by the server.
[INFO][12:25:02]: [Client #9] Loading its data source...
[INFO][12:25:02]: [Client #42] Loading its data source...
[INFO][12:25:02]: [Client #42] Dataset size: 2018
[INFO][12:25:02]: [Client #9] Dataset size: 2018
[INFO][12:25:02]: [Client #42] Sampler: iid
[INFO][12:25:02]: [Client #9] Sampler: iid
[INFO][12:25:04]: [Client #42] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:25:04]: [Client #42] Start to process inbound data.
[INFO][12:25:04]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:25:04]: [Client #9] Start to process inbound data.
[INFO][12:25:05]: [93m[1m[Client #42] Started training in communication round #74.[0m
[INFO][12:25:05]: [93m[1m[Client #9] Started training in communication round #74.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:09,  4.02s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:41,  2.20s/it]  2%|▏         | 1/48 [00:04<03:53,  4.97s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  4%|▍         | 2/48 [00:05<01:55,  2.51s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  6%|▋         | 3/48 [00:06<01:16,  1.71s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it]  8%|▊         | 4/48 [00:07<00:58,  1.33s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 10%|█         | 5/48 [00:08<00:48,  1.12s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.11it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 35%|███▌      | 17/48 [00:15<00:23,  1.34it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.34it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:22,  1.31it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.33it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.33it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.30it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.31it/s] 60%|██████    | 29/48 [00:24<00:14,  1.32it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.31it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.31it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.31it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:13,  1.29it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.30it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.30it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.32it/s] 71%|███████   | 34/48 [00:29<00:10,  1.31it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.32it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 75%|███████▌  | 36/48 [00:31<00:09,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.31it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
 98%|█████████▊| 47/48 [00:39<00:00,  1.48it/s]100%|██████████| 48/48 [00:39<00:00,  1.67it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.67it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][12:25:50]: [Client #42] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
{'train_runtime': 39.2044, 'train_samples_per_second': 154.422, 'train_steps_per_second': 1.224, 'train_loss': 2.887582461039225, 'epoch': 3.0}
[INFO][12:25:51]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 39.6191, 'train_samples_per_second': 152.805, 'train_steps_per_second': 1.212, 'train_loss': 1.7882561683654785, 'epoch': 3.0}
[INFO][12:25:51]: [Client #42] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
[INFO][12:25:51]: [Client #42] Model trained.
[INFO][12:25:51]: [Client #42] Inbound data has been processed.
[INFO][12:25:51]: [Client #42] Outbound data is ready to be sent after being processed.
[INFO][12:25:52]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][12:25:52]: [Client #9] Model trained.
[INFO][12:25:52]: [Client #9] Inbound data has been processed.
[INFO][12:25:52]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][12:25:58]: [Client #42] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:25:59]: [Server #3536466] Received 507.38 MB of payload data from client #42 (simulated).
[INFO][12:26:00]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:26:01]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][12:26:01]: [Server #3536466] Selecting client #13 for training.
[INFO][12:26:01]: [Server #3536466] Sending the current model to client #13 (simulated).
[INFO][12:26:05]: [Server #3536466] Sending 507.38 MB of payload data to client #13 (simulated).
[INFO][12:26:05]: [Client #13] Selected by the server.
[INFO][12:26:05]: [Client #13] Loading its data source...
[INFO][12:26:05]: [Client #13] Dataset size: 2018
[INFO][12:26:05]: [Client #13] Sampler: iid
[INFO][12:26:07]: [Client #13] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:26:07]: [Client #13] Start to process inbound data.
[INFO][12:26:07]: [93m[1m[Client #13] Started training in communication round #74.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  4%|▍         | 2/48 [00:04<01:33,  2.04s/it]  6%|▋         | 3/48 [00:05<00:59,  1.33s/it]  8%|▊         | 4/48 [00:05<00:43,  1.00it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.88it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.93it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.97it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.03it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.09it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.07it/s] 40%|███▉      | 19/48 [00:12<00:14,  2.06it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.05it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.04it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.04it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.05it/s] 50%|█████     | 24/48 [00:15<00:11,  2.06it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.06it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.06it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.06it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.06it/s] 60%|██████    | 29/48 [00:17<00:09,  2.06it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.06it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.13it/s] 71%|███████   | 34/48 [00:20<00:06,  2.11it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:24<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.06it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.06it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][12:26:40]: [Client #13] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
{'train_runtime': 26.8663, 'train_samples_per_second': 225.338, 'train_steps_per_second': 1.787, 'train_loss': 2.2412115732828775, 'epoch': 3.0}
[INFO][12:26:41]: [Client #13] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_13_3536584.pth.
[INFO][12:26:42]: [Client #13] Model trained.
[INFO][12:26:42]: [Client #13] Inbound data has been processed.
[INFO][12:26:42]: [Client #13] Outbound data is ready to be sent after being processed.
[INFO][12:26:47]: [Client #13] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:26:48]: [Server #3536466] Received 507.38 MB of payload data from client #13 (simulated).
[INFO][12:26:48]: [Server #3536466] Adding client #41 to the list of clients for aggregation.
[INFO][12:26:48]: [Server #3536466] Adding client #43 to the list of clients for aggregation.
[INFO][12:26:48]: [Server #3536466] Adding client #54 to the list of clients for aggregation.
[INFO][12:26:48]: [Server #3536466] Adding client #61 to the list of clients for aggregation.
[INFO][12:26:48]: [Server #3536466] Adding client #94 to the list of clients for aggregation.
[INFO][12:26:48]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:26:48]: [Server #3536466] Updated weights have been received.
[INFO][12:26:48]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:26:49]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:26:49]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0616e+00  1e+02  1e+00  1e+00
 1:  2.9841e+00  2.0815e+00  3e+00  2e-02  2e-02
 2:  3.0670e+00  2.3771e+00  7e-01  3e-06  4e-07
 3:  3.0666e+00  3.0543e+00  1e-02  6e-08  7e-09
 4:  3.0649e+00  3.0610e+00  4e-03  9e-08  2e-08
 5:  3.0632e+00  3.0601e+00  3e-03  9e-07  8e-07
 6:  3.0626e+00  3.0612e+00  1e-03  5e-07  4e-07
 7:  3.0617e+00  3.0613e+00  5e-04  3e-06  2e-06
 8:  3.0613e+00  3.0613e+00  3e-05  1e-06  8e-07
 9:  3.0613e+00  3.0613e+00  1e-06  5e-08  4e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 1.1 1.1 1.1 0.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.13it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.25it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.83it/s]100%|██████████| 8/8 [00:00<00:00, 11.61it/s]
[INFO][12:27:00]: [93m[1m[Server #3536466] Global model perplexity: 23.30
[0m
[INFO][12:27:00]: [Server #3536466] All client reports have been processed.
[INFO][12:27:00]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_74.pth.
[INFO][12:27:03]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_74.pth.
[INFO][12:27:03]: [93m[1m
[Server #3536466] Starting round 75/100.[0m
[INFO][12:27:03]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.32464004e-02, 2.32464004e-02, 1.89512055e-05, 2.32464004e-02,
       2.32464004e-02, 2.32464004e-02, 2.32464004e-02, 2.32464004e-02,
       1.00402015e-06, 1.89512055e-05, 2.32464004e-02, 1.89512055e-05,
       2.32464004e-02, 2.32464004e-02, 2.32464004e-02, 1.89512055e-05,
       5.11096477e-06, 2.32464004e-02, 5.68919653e-07, 2.32464004e-02,
       5.68919653e-07, 5.68919653e-07, 5.68919653e-07, 2.32464004e-02,
       1.89512055e-05, 2.06977442e-06, 1.89512055e-05, 5.68919653e-07,
       1.89512055e-05, 2.32464004e-02, 1.89512055e-05, 1.89512055e-05,
       1.89512055e-05, 2.32464004e-02, 1.89512055e-05, 5.68919653e-07,
       1.00402015e-06, 2.32464004e-02, 2.32464004e-02, 1.00402015e-06,
       2.32464004e-02, 2.32464004e-02, 2.06977442e-06, 2.32464004e-02,
       1.00402015e-06, 5.68919653e-07, 5.68919653e-07, 1.00402015e-06,
       2.32464004e-02, 2.32464004e-02, 2.32464004e-02, 5.68919653e-07,
       2.32464004e-02, 5.68919653e-07, 2.32464004e-02, 2.32464004e-02,
       2.32464004e-02, 2.32464004e-02, 5.11096477e-06, 1.00402015e-06,
       5.11096477e-06, 2.32464004e-02, 5.11096477e-06, 1.89512055e-05,
       2.32464004e-02, 2.32464004e-02, 2.32464004e-02, 5.11096477e-06,
       5.68919653e-07, 2.32464004e-02, 5.11096477e-06, 2.32464004e-02,
       2.32464004e-02, 2.32464004e-02, 1.89512055e-05, 2.32464004e-02,
       2.32464004e-02, 1.89512055e-05, 5.68919653e-07, 2.06977442e-06,
       2.32464004e-02, 5.68919653e-07, 5.68919653e-07, 2.32464004e-02,
       2.32464004e-02, 5.68919653e-07, 1.89512055e-05, 5.11096477e-06,
       5.11096477e-06, 1.89512055e-05, 1.89512055e-05, 1.89512055e-05,
       2.32464004e-02, 1.00402015e-06, 1.00402015e-06]),)
[INFO][12:27:03]: [Server #3536466] Selected clients: [ 7 60  5 23 70]
[INFO][12:27:03]: [Server #3536466] Selecting client #70 for training.
[INFO][12:27:03]: [Server #3536466] Sending the current model to client #70 (simulated).
[INFO][12:27:08]: [Server #3536466] Sending 507.38 MB of payload data to client #70 (simulated).
[INFO][12:27:08]: [Server #3536466] Selecting client #23 for training.
[INFO][12:27:08]: [Server #3536466] Sending the current model to client #23 (simulated).
[INFO][12:27:13]: [Server #3536466] Sending 507.38 MB of payload data to client #23 (simulated).
[INFO][12:27:13]: [Client #70] Selected by the server.
[INFO][12:27:13]: [Client #70] Loading its data source...
[INFO][12:27:13]: [Client #70] Dataset size: 2018
[INFO][12:27:13]: [Client #70] Sampler: iid
[INFO][12:27:13]: [Client #23] Selected by the server.
[INFO][12:27:13]: [Client #23] Loading its data source...
[INFO][12:27:13]: [Client #23] Dataset size: 2018
[INFO][12:27:13]: [Client #23] Sampler: iid
[INFO][12:27:14]: [Client #23] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:27:14]: [Client #23] Start to process inbound data.
[INFO][12:27:14]: [Client #70] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:27:14]: [Client #70] Start to process inbound data.
[INFO][12:27:15]: [93m[1m[Client #23] Started training in communication round #75.[0m
[INFO][12:27:15]: [93m[1m[Client #70] Started training in communication round #75.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
  0%|          | 0/48 [00:00<?, ?it/s]***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:48,  4.86s/it]  2%|▏         | 1/48 [00:04<03:49,  4.89s/it]  4%|▍         | 2/48 [00:05<01:55,  2.51s/it]  4%|▍         | 2/48 [00:05<01:56,  2.53s/it]  6%|▋         | 3/48 [00:06<01:16,  1.70s/it]  6%|▋         | 3/48 [00:06<01:17,  1.73s/it]  8%|▊         | 4/48 [00:07<00:57,  1.32s/it]  8%|▊         | 4/48 [00:07<00:59,  1.35s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 10%|█         | 5/48 [00:08<00:48,  1.13s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.31it/s] 60%|██████    | 29/48 [00:25<00:14,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
[INFO][12:28:01]: [Client #70] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_70_3536584.pth.
{'train_runtime': 39.8705, 'train_samples_per_second': 151.841, 'train_steps_per_second': 1.204, 'train_loss': 2.7700347900390625, 'epoch': 3.0}
[INFO][12:28:02]: [Client #23] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_23_3536585.pth.
{'train_runtime': 39.7969, 'train_samples_per_second': 152.122, 'train_steps_per_second': 1.206, 'train_loss': 2.559628168741862, 'epoch': 3.0}
[INFO][12:28:02]: [Client #70] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_70_3536584.pth.
[INFO][12:28:03]: [Client #23] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_23_3536585.pth.
[INFO][12:28:03]: [Client #70] Model trained.
[INFO][12:28:03]: [Client #70] Inbound data has been processed.
[INFO][12:28:03]: [Client #70] Outbound data is ready to be sent after being processed.
[INFO][12:28:03]: [Client #23] Model trained.
[INFO][12:28:03]: [Client #23] Inbound data has been processed.
[INFO][12:28:03]: [Client #23] Outbound data is ready to be sent after being processed.
[INFO][12:28:12]: [Client #70] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:28:12]: [Client #23] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:28:13]: [Server #3536466] Received 507.38 MB of payload data from client #70 (simulated).
[INFO][12:28:14]: [Server #3536466] Received 507.38 MB of payload data from client #23 (simulated).
[INFO][12:28:14]: [Server #3536466] Selecting client #60 for training.
[INFO][12:28:14]: [Server #3536466] Sending the current model to client #60 (simulated).
[INFO][12:28:18]: [Server #3536466] Sending 507.38 MB of payload data to client #60 (simulated).
[INFO][12:28:18]: [Server #3536466] Selecting client #5 for training.
[INFO][12:28:18]: [Server #3536466] Sending the current model to client #5 (simulated).
[INFO][12:28:23]: [Server #3536466] Sending 507.38 MB of payload data to client #5 (simulated).
[INFO][12:28:23]: [Client #60] Selected by the server.
[INFO][12:28:23]: [Client #60] Loading its data source...
[INFO][12:28:23]: [Client #60] Dataset size: 2018
[INFO][12:28:23]: [Client #60] Sampler: iid
[INFO][12:28:23]: [Client #5] Selected by the server.
[INFO][12:28:23]: [Client #5] Loading its data source...
[INFO][12:28:23]: [Client #5] Dataset size: 2018
[INFO][12:28:23]: [Client #5] Sampler: iid
[INFO][12:28:25]: [Client #60] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:28:25]: [Client #60] Start to process inbound data.
[INFO][12:28:25]: [Client #5] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:28:25]: [Client #5] Start to process inbound data.
[INFO][12:28:25]: [93m[1m[Client #60] Started training in communication round #75.[0m
[INFO][12:28:26]: [93m[1m[Client #5] Started training in communication round #75.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:30,  4.49s/it]  2%|▏         | 1/48 [00:04<03:37,  4.62s/it]  4%|▍         | 2/48 [00:05<01:43,  2.25s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  6%|▋         | 3/48 [00:06<01:12,  1.61s/it]  6%|▋         | 3/48 [00:06<01:18,  1.74s/it]  8%|▊         | 4/48 [00:06<00:59,  1.34s/it]  8%|▊         | 4/48 [00:07<01:00,  1.38s/it] 10%|█         | 5/48 [00:07<00:50,  1.17s/it] 10%|█         | 5/48 [00:08<00:49,  1.15s/it] 12%|█▎        | 6/48 [00:08<00:43,  1.04s/it] 12%|█▎        | 6/48 [00:08<00:42,  1.01s/it] 15%|█▍        | 7/48 [00:09<00:38,  1.06it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 17%|█▋        | 8/48 [00:10<00:35,  1.14it/s] 17%|█▋        | 8/48 [00:10<00:35,  1.14it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 21%|██        | 10/48 [00:11<00:30,  1.23it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.36it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.34it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.34it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.31it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.42it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.30it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.31it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.31it/s]100%|██████████| 48/48 [00:39<00:00,  1.35it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.35it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
100%|██████████| 48/48 [00:39<00:00,  1.52it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.52it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][12:29:11]: [Client #60] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
{'train_runtime': 39.8772, 'train_samples_per_second': 151.816, 'train_steps_per_second': 1.204, 'train_loss': 2.8106940587361655, 'epoch': 3.0}
[INFO][12:29:12]: [Client #5] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536585.pth.
{'train_runtime': 39.7571, 'train_samples_per_second': 152.275, 'train_steps_per_second': 1.207, 'train_loss': 2.5291261672973633, 'epoch': 3.0}
[INFO][12:29:12]: [Client #60] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
[INFO][12:29:13]: [Client #5] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536585.pth.
[INFO][12:29:13]: [Client #60] Model trained.
[INFO][12:29:13]: [Client #60] Inbound data has been processed.
[INFO][12:29:13]: [Client #60] Outbound data is ready to be sent after being processed.
[INFO][12:29:13]: [Client #5] Model trained.
[INFO][12:29:13]: [Client #5] Inbound data has been processed.
[INFO][12:29:13]: [Client #5] Outbound data is ready to be sent after being processed.
[INFO][12:29:22]: [Client #60] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:29:22]: [Client #5] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:29:23]: [Server #3536466] Received 507.38 MB of payload data from client #60 (simulated).
[INFO][12:29:24]: [Server #3536466] Received 507.38 MB of payload data from client #5 (simulated).
[INFO][12:29:24]: [Server #3536466] Selecting client #7 for training.
[INFO][12:29:24]: [Server #3536466] Sending the current model to client #7 (simulated).
[INFO][12:29:29]: [Server #3536466] Sending 507.38 MB of payload data to client #7 (simulated).
[INFO][12:29:29]: [Client #7] Selected by the server.
[INFO][12:29:29]: [Client #7] Loading its data source...
[INFO][12:29:29]: [Client #7] Dataset size: 2018
[INFO][12:29:29]: [Client #7] Sampler: iid
[INFO][12:29:30]: [Client #7] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:29:30]: [Client #7] Start to process inbound data.
[INFO][12:29:31]: [93m[1m[Client #7] Started training in communication round #75.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.19s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:58,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.25it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.12it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.13it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.07it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.07it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.06it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.06it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.06it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.05it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.05it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.05it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.05it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.05it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.05it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.05it/s]100%|██████████| 48/48 [00:26<00:00,  2.15it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.15it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][12:30:03]: [Client #7] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536584.pth.
{'train_runtime': 26.6949, 'train_samples_per_second': 226.785, 'train_steps_per_second': 1.798, 'train_loss': 2.5394728978474936, 'epoch': 3.0}
[INFO][12:30:05]: [Client #7] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536584.pth.
[INFO][12:30:05]: [Client #7] Model trained.
[INFO][12:30:05]: [Client #7] Inbound data has been processed.
[INFO][12:30:05]: [Client #7] Outbound data is ready to be sent after being processed.
[INFO][12:30:10]: [Client #7] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:30:11]: [Server #3536466] Received 507.38 MB of payload data from client #7 (simulated).
[INFO][12:30:11]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][12:30:11]: [Server #3536466] Adding client #13 to the list of clients for aggregation.
[INFO][12:30:11]: [Server #3536466] Adding client #3 to the list of clients for aggregation.
[INFO][12:30:11]: [Server #3536466] Adding client #42 to the list of clients for aggregation.
[INFO][12:30:11]: [Server #3536466] Adding client #5 to the list of clients for aggregation.
[INFO][12:30:11]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:30:11]: [Server #3536466] Updated weights have been received.
[INFO][12:30:12]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:30:13]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:30:13]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0657e+00  1e+02  1e+00  1e+00
 1:  2.9887e+00  2.0857e+00  3e+00  2e-02  2e-02
 2:  3.0712e+00  2.3824e+00  7e-01  3e-06  4e-07
 3:  3.0708e+00  3.0595e+00  1e-02  5e-08  6e-09
 4:  3.0687e+00  3.0663e+00  2e-03  1e-07  2e-08
 5:  3.0664e+00  3.0663e+00  9e-05  7e-07  1e-07
 6:  3.0664e+00  3.0664e+00  2e-06  2e-08  3e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 0.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 1.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.24it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.38it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.53it/s]100%|██████████| 8/8 [00:00<00:00, 11.63it/s]
[INFO][12:30:23]: [93m[1m[Server #3536466] Global model perplexity: 27.09
[0m
[INFO][12:30:23]: [Server #3536466] All client reports have been processed.
[INFO][12:30:23]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_75.pth.
[INFO][12:30:27]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_75.pth.
[INFO][12:30:27]: [93m[1m
[Server #3536466] Starting round 76/100.[0m
[INFO][12:30:27]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.80439850e-05, 2.80439850e-05, 2.80439850e-05, 2.75786537e-06,
       9.98756532e-01, 2.80439850e-05, 2.80439850e-05, 2.80439850e-05,
       2.80439850e-05, 3.37463711e-07, 2.75786537e-06, 2.80439850e-05,
       2.80439850e-05, 2.75786537e-06, 2.80439850e-05, 2.80439850e-05,
       2.80439850e-05, 2.75786537e-06, 1.02337527e-06, 2.80439850e-05,
       2.31193317e-07, 2.31193317e-07, 2.31193317e-07, 2.31193317e-07,
       2.80439850e-05, 2.75786537e-06, 5.41569950e-07, 2.75786537e-06,
       2.31193317e-07, 2.75786537e-06, 2.80439850e-05, 2.75786537e-06,
       2.75786537e-06, 2.75786537e-06, 2.80439850e-05, 2.75786537e-06,
       2.31193317e-07, 3.37463711e-07, 2.80439850e-05, 2.80439850e-05,
       2.80439850e-05, 3.37463711e-07, 2.80439850e-05, 2.80439850e-05,
       5.41569950e-07, 2.80439850e-05, 3.37463711e-07, 2.31193317e-07,
       2.31193317e-07, 3.37463711e-07, 2.80439850e-05, 2.80439850e-05,
       2.80439850e-05, 2.31193317e-07, 2.80439850e-05, 2.31193317e-07,
       2.80439850e-05, 2.80439850e-05, 2.80439850e-05, 1.02337527e-06,
       3.37463711e-07, 1.02337527e-06, 2.80439850e-05, 1.02337527e-06,
       2.75786537e-06, 2.80439850e-05, 2.80439850e-05, 1.02337527e-06,
       2.31193317e-07, 2.80439850e-05, 1.02337527e-06, 2.80439850e-05,
       2.80439850e-05, 2.80439850e-05, 2.75786537e-06, 2.80439850e-05,
       2.80439850e-05, 2.75786537e-06, 2.31193317e-07, 5.41569950e-07,
       2.80439850e-05, 2.31193317e-07, 2.31193317e-07, 2.80439850e-05,
       2.80439850e-05, 2.31193317e-07, 2.75786537e-06, 1.02337527e-06,
       1.02337527e-06, 2.75786537e-06, 2.75786537e-06, 2.75786537e-06,
       2.80439850e-05, 3.37463711e-07, 3.37463711e-07]),)
[INFO][12:30:27]: [Server #3536466] Selected clients: [ 5 76 46 53  2]
[INFO][12:30:27]: [Server #3536466] Selecting client #2 for training.
[INFO][12:30:27]: [Server #3536466] Sending the current model to client #2 (simulated).
[INFO][12:30:32]: [Server #3536466] Sending 507.38 MB of payload data to client #2 (simulated).
[INFO][12:30:32]: [Server #3536466] Selecting client #5 for training.
[INFO][12:30:32]: [Server #3536466] Sending the current model to client #5 (simulated).
[INFO][12:30:36]: [Server #3536466] Sending 507.38 MB of payload data to client #5 (simulated).
[INFO][12:30:36]: [Client #2] Selected by the server.
[INFO][12:30:36]: [Client #2] Loading its data source...
[INFO][12:30:36]: [Client #2] Dataset size: 2018
[INFO][12:30:36]: [Client #2] Sampler: iid
[INFO][12:30:36]: [Client #5] Selected by the server.
[INFO][12:30:36]: [Client #5] Loading its data source...
[INFO][12:30:36]: [Client #5] Dataset size: 2018
[INFO][12:30:36]: [Client #5] Sampler: iid
[INFO][12:30:38]: [Client #2] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:30:38]: [Client #2] Start to process inbound data.
[INFO][12:30:38]: [93m[1m[Client #2] Started training in communication round #76.[0m
[INFO][12:30:38]: [Client #5] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:30:38]: [Client #5] Start to process inbound data.
[INFO][12:30:39]: [93m[1m[Client #5] Started training in communication round #76.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:30,  4.49s/it]  4%|▍         | 2/48 [00:04<01:38,  2.14s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  6%|▋         | 3/48 [00:05<01:06,  1.47s/it]  2%|▏         | 1/48 [00:04<03:46,  4.83s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  4%|▍         | 2/48 [00:05<01:53,  2.46s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it]  6%|▋         | 3/48 [00:06<01:15,  1.68s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s]  8%|▊         | 4/48 [00:07<00:57,  1.31s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.16it/s] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 17%|█▋        | 8/48 [00:09<00:32,  1.22it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.26it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 21%|██        | 10/48 [00:10<00:29,  1.29it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.31it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 21%|██        | 10/48 [00:11<00:30,  1.27it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.33it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.34it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.32it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 71%|███████   | 34/48 [00:28<00:10,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.31it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.32it/s] 71%|███████   | 34/48 [00:29<00:10,  1.32it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.33it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.32it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.32it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.30it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.31it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.30it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.30it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.31it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
 96%|█████████▌| 46/48 [00:38<00:01,  1.37it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.52it/s][INFO][12:31:23]: [Client #2] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
{'train_runtime': 39.1758, 'train_samples_per_second': 154.534, 'train_steps_per_second': 1.225, 'train_loss': 2.850017865498861, 'epoch': 3.0}
100%|██████████| 48/48 [00:39<00:00,  1.72it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.72it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][12:31:24]: [Client #5] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536585.pth.
{'train_runtime': 39.3696, 'train_samples_per_second': 153.774, 'train_steps_per_second': 1.219, 'train_loss': 2.3998443285624185, 'epoch': 3.0}
[INFO][12:31:24]: [Client #2] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
[INFO][12:31:25]: [Client #2] Model trained.
[INFO][12:31:25]: [Client #2] Inbound data has been processed.
[INFO][12:31:25]: [Client #2] Outbound data is ready to be sent after being processed.
[INFO][12:31:25]: [Client #5] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536585.pth.
[INFO][12:31:26]: [Client #5] Model trained.
[INFO][12:31:26]: [Client #5] Inbound data has been processed.
[INFO][12:31:26]: [Client #5] Outbound data is ready to be sent after being processed.
[INFO][12:31:32]: [Client #2] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:31:33]: [Server #3536466] Received 507.38 MB of payload data from client #2 (simulated).
[INFO][12:31:34]: [Client #5] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:31:35]: [Server #3536466] Received 507.38 MB of payload data from client #5 (simulated).
[INFO][12:31:35]: [Server #3536466] Selecting client #76 for training.
[INFO][12:31:35]: [Server #3536466] Sending the current model to client #76 (simulated).
[INFO][12:31:39]: [Server #3536466] Sending 507.38 MB of payload data to client #76 (simulated).
[INFO][12:31:39]: [Server #3536466] Selecting client #53 for training.
[INFO][12:31:39]: [Server #3536466] Sending the current model to client #53 (simulated).
[INFO][12:31:44]: [Server #3536466] Sending 507.38 MB of payload data to client #53 (simulated).
[INFO][12:31:44]: [Client #76] Selected by the server.
[INFO][12:31:44]: [Client #76] Loading its data source...
[INFO][12:31:44]: [Client #53] Selected by the server.
[INFO][12:31:44]: [Client #76] Dataset size: 2018
[INFO][12:31:44]: [Client #53] Loading its data source...
[INFO][12:31:44]: [Client #76] Sampler: iid
[INFO][12:31:44]: [Client #53] Dataset size: 2018
[INFO][12:31:44]: [Client #53] Sampler: iid
[INFO][12:31:45]: [Client #53] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:31:45]: [Client #53] Start to process inbound data.
[INFO][12:31:45]: [93m[1m[Client #53] Started training in communication round #76.[0m
[INFO][12:31:45]: [Client #76] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:31:45]: [Client #76] Start to process inbound data.
[INFO][12:31:46]: [93m[1m[Client #76] Started training in communication round #76.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:35,  4.58s/it]  2%|▏         | 1/48 [00:04<03:12,  4.10s/it]  4%|▍         | 2/48 [00:05<01:47,  2.33s/it]  4%|▍         | 2/48 [00:04<01:39,  2.16s/it]  6%|▋         | 3/48 [00:06<01:11,  1.59s/it]  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  8%|▊         | 4/48 [00:06<00:55,  1.26s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it] 10%|█         | 5/48 [00:07<00:46,  1.07s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.05it/s] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.34it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:21,  1.33it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.33it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.32it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.32it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.31it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
[INFO][12:32:31]: [Client #76] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_76_3536584.pth.
{'train_runtime': 39.0597, 'train_samples_per_second': 154.993, 'train_steps_per_second': 1.229, 'train_loss': 2.783890724182129, 'epoch': 3.0}
[INFO][12:32:32]: [Client #53] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_53_3536585.pth.
{'train_runtime': 39.4812, 'train_samples_per_second': 153.339, 'train_steps_per_second': 1.216, 'train_loss': 2.6876840591430664, 'epoch': 3.0}
[INFO][12:32:32]: [Client #76] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_76_3536584.pth.
[INFO][12:32:33]: [Client #53] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_53_3536585.pth.
[INFO][12:32:33]: [Client #76] Model trained.
[INFO][12:32:33]: [Client #76] Inbound data has been processed.
[INFO][12:32:33]: [Client #76] Outbound data is ready to be sent after being processed.
[INFO][12:32:33]: [Client #53] Model trained.
[INFO][12:32:33]: [Client #53] Inbound data has been processed.
[INFO][12:32:33]: [Client #53] Outbound data is ready to be sent after being processed.
[INFO][12:32:41]: [Client #76] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:32:42]: [Client #53] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:32:42]: [Server #3536466] Received 507.38 MB of payload data from client #76 (simulated).
[INFO][12:32:43]: [Server #3536466] Received 507.38 MB of payload data from client #53 (simulated).
[INFO][12:32:43]: [Server #3536466] Selecting client #46 for training.
[INFO][12:32:43]: [Server #3536466] Sending the current model to client #46 (simulated).
[INFO][12:32:48]: [Server #3536466] Sending 507.38 MB of payload data to client #46 (simulated).
[INFO][12:32:48]: [Client #46] Selected by the server.
[INFO][12:32:48]: [Client #46] Loading its data source...
[INFO][12:32:48]: [Client #46] Dataset size: 2018
[INFO][12:32:48]: [Client #46] Sampler: iid
[INFO][12:32:49]: [Client #46] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:32:49]: [Client #46] Start to process inbound data.
[INFO][12:32:50]: [93m[1m[Client #46] Started training in communication round #76.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.25s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.33s/it]  8%|▊         | 4/48 [00:05<00:43,  1.00it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.92it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.95it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.97it/s] 29%|██▉       | 14/48 [00:10<00:17,  1.99it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.01it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.11it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.09it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.08it/s] 40%|███▉      | 19/48 [00:12<00:14,  2.07it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.06it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.06it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.06it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.06it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.07it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:24<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.06it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][12:33:23]: [Client #46] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
{'train_runtime': 26.847, 'train_samples_per_second': 225.5, 'train_steps_per_second': 1.788, 'train_loss': 2.784498850504557, 'epoch': 3.0}
[INFO][12:33:24]: [Client #46] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
[INFO][12:33:24]: [Client #46] Model trained.
[INFO][12:33:24]: [Client #46] Inbound data has been processed.
[INFO][12:33:24]: [Client #46] Outbound data is ready to be sent after being processed.
[INFO][12:33:29]: [Client #46] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:33:31]: [Server #3536466] Received 507.38 MB of payload data from client #46 (simulated).
[INFO][12:33:31]: [Server #3536466] Adding client #23 to the list of clients for aggregation.
[INFO][12:33:31]: [Server #3536466] Adding client #7 to the list of clients for aggregation.
[INFO][12:33:31]: [Server #3536466] Adding client #60 to the list of clients for aggregation.
[INFO][12:33:31]: [Server #3536466] Adding client #70 to the list of clients for aggregation.
[INFO][12:33:31]: [Server #3536466] Adding client #100 to the list of clients for aggregation.
[INFO][12:33:31]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:33:31]: [Server #3536466] Updated weights have been received.
[INFO][12:33:31]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:33:32]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:33:32]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0646e+00  1e+02  1e+00  1e+00
 1:  2.9875e+00  2.0845e+00  3e+00  2e-02  2e-02
 2:  3.0700e+00  2.3810e+00  7e-01  3e-06  4e-07
 3:  3.0696e+00  3.0573e+00  1e-02  6e-08  7e-09
 4:  3.0679e+00  3.0640e+00  4e-03  9e-08  2e-08
 5:  3.0663e+00  3.0631e+00  3e-03  9e-07  8e-07
 6:  3.0656e+00  3.0642e+00  1e-03  5e-07  4e-07
 7:  3.0648e+00  3.0643e+00  5e-04  2e-06  2e-06
 8:  3.0643e+00  3.0643e+00  4e-05  1e-06  9e-07
 9:  3.0643e+00  3.0643e+00  1e-06  5e-08  4e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 0.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.26it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.37it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.84it/s]100%|██████████| 8/8 [00:00<00:00, 11.70it/s]
[INFO][12:33:42]: [93m[1m[Server #3536466] Global model perplexity: 22.84
[0m
[INFO][12:33:42]: [Server #3536466] All client reports have been processed.
[INFO][12:33:43]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_76.pth.
[INFO][12:33:46]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_76.pth.
[INFO][12:33:46]: [93m[1m
[Server #3536466] Starting round 77/100.[0m
[INFO][12:33:46]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.37979840e-02, 2.37979840e-02, 2.16462619e-05, 2.37979840e-02,
       2.37979840e-02, 2.37979840e-02, 2.37979840e-02, 2.37979840e-02,
       1.18305921e-06, 2.16462619e-05, 2.37979840e-02, 2.37979840e-02,
       2.16462619e-05, 2.37979840e-02, 2.37979840e-02, 2.37979840e-02,
       2.16462619e-05, 5.80993318e-06, 2.37979840e-02, 6.86110188e-07,
       2.37979840e-02, 6.86110188e-07, 6.86110188e-07, 6.86110188e-07,
       2.37979840e-02, 2.16462619e-05, 2.38563069e-06, 2.16462619e-05,
       6.86110188e-07, 2.16462619e-05, 2.37979840e-02, 2.16462619e-05,
       2.16462619e-05, 2.16462619e-05, 2.37979840e-02, 2.16462619e-05,
       6.86110188e-07, 1.18305921e-06, 2.37979840e-02, 2.37979840e-02,
       2.37979840e-02, 1.18305921e-06, 2.37979840e-02, 2.38563069e-06,
       2.37979840e-02, 1.18305921e-06, 6.86110188e-07, 6.86110188e-07,
       1.18305921e-06, 2.37979840e-02, 2.37979840e-02, 6.86110188e-07,
       2.37979840e-02, 6.86110188e-07, 2.37979840e-02, 2.37979840e-02,
       2.37979840e-02, 2.37979840e-02, 5.80993318e-06, 1.18305921e-06,
       5.80993318e-06, 2.37979840e-02, 5.80993318e-06, 2.16462619e-05,
       2.37979840e-02, 2.37979840e-02, 2.37979840e-02, 5.80993318e-06,
       6.86110188e-07, 2.37979840e-02, 5.80993318e-06, 2.37979840e-02,
       2.37979840e-02, 2.16462619e-05, 2.37979840e-02, 2.37979840e-02,
       2.16462619e-05, 6.86110188e-07, 2.38563069e-06, 2.37979840e-02,
       6.86110188e-07, 6.86110188e-07, 2.37979840e-02, 2.37979840e-02,
       6.86110188e-07, 2.16462619e-05, 5.80993318e-06, 5.80993318e-06,
       2.16462619e-05, 2.16462619e-05, 2.16462619e-05, 2.37979840e-02,
       1.18305921e-06, 1.18305921e-06, 2.16462619e-05]),)
[INFO][12:33:46]: [Server #3536466] Selected clients: [61 27 16 42 37]
[INFO][12:33:46]: [Server #3536466] Selecting client #16 for training.
[INFO][12:33:46]: [Server #3536466] Sending the current model to client #16 (simulated).
[INFO][12:33:51]: [Server #3536466] Sending 507.38 MB of payload data to client #16 (simulated).
[INFO][12:33:51]: [Server #3536466] Selecting client #37 for training.
[INFO][12:33:51]: [Server #3536466] Sending the current model to client #37 (simulated).
[INFO][12:33:56]: [Server #3536466] Sending 507.38 MB of payload data to client #37 (simulated).
[INFO][12:33:56]: [Client #16] Selected by the server.
[INFO][12:33:56]: [Client #16] Loading its data source...
[INFO][12:33:56]: [Client #16] Dataset size: 2018
[INFO][12:33:56]: [Client #16] Sampler: iid
[INFO][12:33:56]: [Client #37] Selected by the server.
[INFO][12:33:56]: [Client #37] Loading its data source...
[INFO][12:33:56]: [Client #37] Dataset size: 2018
[INFO][12:33:56]: [Client #37] Sampler: iid
[INFO][12:33:57]: [Client #37] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:33:57]: [Client #37] Start to process inbound data.
[INFO][12:33:57]: [Client #16] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:33:57]: [Client #16] Start to process inbound data.
[INFO][12:33:57]: [93m[1m[Client #37] Started training in communication round #77.[0m
[INFO][12:33:58]: [93m[1m[Client #16] Started training in communication round #77.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.18s/it]  2%|▏         | 1/48 [00:04<03:44,  4.77s/it]  4%|▍         | 2/48 [00:04<01:38,  2.14s/it]  4%|▍         | 2/48 [00:05<01:50,  2.41s/it]  6%|▋         | 3/48 [00:05<01:07,  1.49s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:52,  1.19s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.34it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:19,  1.31it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][12:34:43]: [Client #16] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_16_3536584.pth.
{'train_runtime': 39.0367, 'train_samples_per_second': 155.085, 'train_steps_per_second': 1.23, 'train_loss': 2.800344467163086, 'epoch': 3.0}
[INFO][12:34:43]: [Client #37] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_37_3536585.pth.
{'train_runtime': 39.4529, 'train_samples_per_second': 153.449, 'train_steps_per_second': 1.217, 'train_loss': 2.7091897328694663, 'epoch': 3.0}
[INFO][12:34:44]: [Client #16] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_16_3536584.pth.
[INFO][12:34:44]: [Client #37] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_37_3536585.pth.
[INFO][12:34:44]: [Client #16] Model trained.
[INFO][12:34:44]: [Client #16] Inbound data has been processed.
[INFO][12:34:44]: [Client #16] Outbound data is ready to be sent after being processed.
[INFO][12:34:45]: [Client #37] Model trained.
[INFO][12:34:45]: [Client #37] Inbound data has been processed.
[INFO][12:34:45]: [Client #37] Outbound data is ready to be sent after being processed.
[INFO][12:34:53]: [Client #16] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:34:53]: [Client #37] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:34:54]: [Server #3536466] Received 507.38 MB of payload data from client #16 (simulated).
[INFO][12:34:55]: [Server #3536466] Received 507.38 MB of payload data from client #37 (simulated).
[INFO][12:34:55]: [Server #3536466] Selecting client #42 for training.
[INFO][12:34:55]: [Server #3536466] Sending the current model to client #42 (simulated).
[INFO][12:34:59]: [Server #3536466] Sending 507.38 MB of payload data to client #42 (simulated).
[INFO][12:34:59]: [Server #3536466] Selecting client #27 for training.
[INFO][12:34:59]: [Server #3536466] Sending the current model to client #27 (simulated).
[INFO][12:35:04]: [Server #3536466] Sending 507.38 MB of payload data to client #27 (simulated).
[INFO][12:35:04]: [Client #42] Selected by the server.
[INFO][12:35:04]: [Client #42] Loading its data source...
[INFO][12:35:04]: [Client #42] Dataset size: 2018
[INFO][12:35:04]: [Client #27] Selected by the server.
[INFO][12:35:04]: [Client #42] Sampler: iid
[INFO][12:35:04]: [Client #27] Loading its data source...
[INFO][12:35:04]: [Client #27] Dataset size: 2018
[INFO][12:35:04]: [Client #27] Sampler: iid
[INFO][12:35:05]: [Client #42] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:35:05]: [Client #42] Start to process inbound data.
[INFO][12:35:05]: [Client #27] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:35:05]: [Client #27] Start to process inbound data.
[INFO][12:35:06]: [93m[1m[Client #42] Started training in communication round #77.[0m
[INFO][12:35:06]: [93m[1m[Client #27] Started training in communication round #77.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:37,  4.63s/it]  2%|▏         | 1/48 [00:04<03:18,  4.23s/it]  4%|▍         | 2/48 [00:05<01:54,  2.49s/it]  4%|▍         | 2/48 [00:05<01:46,  2.32s/it]  6%|▋         | 3/48 [00:06<01:20,  1.79s/it]  6%|▋         | 3/48 [00:06<01:16,  1.70s/it]  8%|▊         | 4/48 [00:07<01:03,  1.43s/it]  8%|▊         | 4/48 [00:07<01:00,  1.38s/it] 10%|█         | 5/48 [00:08<00:51,  1.19s/it] 10%|█         | 5/48 [00:07<00:50,  1.17s/it] 12%|█▎        | 6/48 [00:08<00:43,  1.03s/it] 12%|█▎        | 6/48 [00:08<00:43,  1.04s/it] 15%|█▍        | 7/48 [00:09<00:38,  1.07it/s] 15%|█▍        | 7/48 [00:09<00:38,  1.07it/s] 17%|█▋        | 8/48 [00:10<00:35,  1.12it/s] 17%|█▋        | 8/48 [00:10<00:35,  1.13it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.19it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:20<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.29it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.31it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.31it/s]100%|██████████| 48/48 [00:40<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.38it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][12:35:52]: [Client #42] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
{'train_runtime': 40.1373, 'train_samples_per_second': 150.832, 'train_steps_per_second': 1.196, 'train_loss': 2.788158416748047, 'epoch': 3.0}
[INFO][12:35:53]: [Client #27] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_27_3536585.pth.
{'train_runtime': 39.8018, 'train_samples_per_second': 152.104, 'train_steps_per_second': 1.206, 'train_loss': 2.5572072664896646, 'epoch': 3.0}
[INFO][12:35:53]: [Client #42] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
[INFO][12:35:54]: [Client #27] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_27_3536585.pth.
[INFO][12:35:54]: [Client #42] Model trained.
[INFO][12:35:54]: [Client #42] Inbound data has been processed.
[INFO][12:35:54]: [Client #42] Outbound data is ready to be sent after being processed.
[INFO][12:35:54]: [Client #27] Model trained.
[INFO][12:35:54]: [Client #27] Inbound data has been processed.
[INFO][12:35:54]: [Client #27] Outbound data is ready to be sent after being processed.
[INFO][12:36:02]: [Client #42] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:36:03]: [Client #27] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:36:03]: [Server #3536466] Received 507.38 MB of payload data from client #42 (simulated).
[INFO][12:36:04]: [Server #3536466] Received 507.38 MB of payload data from client #27 (simulated).
[INFO][12:36:04]: [Server #3536466] Selecting client #61 for training.
[INFO][12:36:04]: [Server #3536466] Sending the current model to client #61 (simulated).
[INFO][12:36:09]: [Server #3536466] Sending 507.38 MB of payload data to client #61 (simulated).
[INFO][12:36:09]: [Client #61] Selected by the server.
[INFO][12:36:09]: [Client #61] Loading its data source...
[INFO][12:36:09]: [Client #61] Dataset size: 2018
[INFO][12:36:09]: [Client #61] Sampler: iid
[INFO][12:36:10]: [Client #61] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:36:10]: [Client #61] Start to process inbound data.
[INFO][12:36:11]: [93m[1m[Client #61] Started training in communication round #77.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.19s/it]  4%|▍         | 2/48 [00:04<01:33,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.03it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.14it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.12it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.10it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.09it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.11it/s] 71%|███████   | 34/48 [00:20<00:06,  2.10it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.09it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.08it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.07it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.06it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.06it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.06it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][12:36:43]: [Client #61] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536584.pth.
{'train_runtime': 26.7392, 'train_samples_per_second': 226.409, 'train_steps_per_second': 1.795, 'train_loss': 2.3371898333231607, 'epoch': 3.0}
[INFO][12:36:44]: [Client #61] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536584.pth.
[INFO][12:36:45]: [Client #61] Model trained.
[INFO][12:36:45]: [Client #61] Inbound data has been processed.
[INFO][12:36:45]: [Client #61] Outbound data is ready to be sent after being processed.
[INFO][12:36:50]: [Client #61] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:36:51]: [Server #3536466] Received 507.38 MB of payload data from client #61 (simulated).
[INFO][12:36:51]: [Server #3536466] Adding client #5 to the list of clients for aggregation.
[INFO][12:36:51]: [Server #3536466] Adding client #46 to the list of clients for aggregation.
[INFO][12:36:51]: [Server #3536466] Adding client #53 to the list of clients for aggregation.
[INFO][12:36:51]: [Server #3536466] Adding client #2 to the list of clients for aggregation.
[INFO][12:36:51]: [Server #3536466] Adding client #76 to the list of clients for aggregation.
[INFO][12:36:51]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:36:51]: [Server #3536466] Updated weights have been received.
[INFO][12:36:52]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:36:52]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:36:52]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0687e+00  1e+02  1e+00  1e+00
 1:  2.9921e+00  2.0886e+00  3e+00  2e-02  2e-02
 2:  3.0742e+00  2.3863e+00  7e-01  3e-06  4e-07
 3:  3.0738e+00  3.0625e+00  1e-02  5e-08  6e-09
 4:  3.0717e+00  3.0693e+00  2e-03  1e-07  2e-08
 5:  3.0694e+00  3.0693e+00  1e-04  7e-07  1e-07
 6:  3.0693e+00  3.0693e+00  2e-06  2e-08  3e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.03it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.35it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.82it/s]100%|██████████| 8/8 [00:00<00:00, 11.61it/s]
[INFO][12:37:03]: [93m[1m[Server #3536466] Global model perplexity: 22.80
[0m
[INFO][12:37:03]: [Server #3536466] All client reports have been processed.
[INFO][12:37:03]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_77.pth.
[INFO][12:37:06]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_77.pth.
[INFO][12:37:06]: [93m[1m
[Server #3536466] Starting round 78/100.[0m
[INFO][12:37:06]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.37979840e-02, 2.37979840e-02, 2.37979840e-02, 2.16462619e-05,
       2.37979840e-02, 2.37979840e-02, 2.37979840e-02, 2.37979840e-02,
       2.37979840e-02, 2.37979840e-02, 1.18305921e-06, 2.16462619e-05,
       2.37979840e-02, 2.37979840e-02, 2.16462619e-05, 2.37979840e-02,
       2.37979840e-02, 2.16462619e-05, 5.80993318e-06, 2.37979840e-02,
       6.86110188e-07, 2.37979840e-02, 6.86110188e-07, 6.86110188e-07,
       6.86110188e-07, 2.16462619e-05, 2.38563069e-06, 2.16462619e-05,
       6.86110188e-07, 2.16462619e-05, 2.37979840e-02, 2.16462619e-05,
       2.16462619e-05, 2.16462619e-05, 2.16462619e-05, 6.86110188e-07,
       1.18305921e-06, 2.37979840e-02, 2.37979840e-02, 1.18305921e-06,
       2.37979840e-02, 2.37979840e-02, 2.38563069e-06, 2.37979840e-02,
       1.18305921e-06, 6.86110188e-07, 6.86110188e-07, 1.18305921e-06,
       2.37979840e-02, 2.37979840e-02, 2.37979840e-02, 6.86110188e-07,
       2.37979840e-02, 6.86110188e-07, 2.37979840e-02, 2.37979840e-02,
       2.37979840e-02, 5.80993318e-06, 1.18305921e-06, 5.80993318e-06,
       2.37979840e-02, 5.80993318e-06, 2.16462619e-05, 2.37979840e-02,
       2.37979840e-02, 2.37979840e-02, 5.80993318e-06, 6.86110188e-07,
       2.37979840e-02, 5.80993318e-06, 2.37979840e-02, 2.37979840e-02,
       2.37979840e-02, 2.16462619e-05, 2.37979840e-02, 2.37979840e-02,
       2.16462619e-05, 6.86110188e-07, 2.38563069e-06, 2.37979840e-02,
       6.86110188e-07, 6.86110188e-07, 2.37979840e-02, 2.37979840e-02,
       6.86110188e-07, 2.16462619e-05, 5.80993318e-06, 5.80993318e-06,
       2.16462619e-05, 2.16462619e-05, 2.16462619e-05, 2.37979840e-02,
       1.18305921e-06, 1.18305921e-06, 2.16462619e-05]),)
[INFO][12:37:06]: [Server #3536466] Selected clients: [46 97 33 74 55]
[INFO][12:37:06]: [Server #3536466] Selecting client #74 for training.
[INFO][12:37:06]: [Server #3536466] Sending the current model to client #74 (simulated).
[INFO][12:37:11]: [Server #3536466] Sending 507.38 MB of payload data to client #74 (simulated).
[INFO][12:37:11]: [Server #3536466] Selecting client #97 for training.
[INFO][12:37:11]: [Server #3536466] Sending the current model to client #97 (simulated).
[INFO][12:37:16]: [Server #3536466] Sending 507.38 MB of payload data to client #97 (simulated).
[INFO][12:37:16]: [Client #74] Selected by the server.
[INFO][12:37:16]: [Client #74] Loading its data source...
[INFO][12:37:16]: [Client #74] Dataset size: 2018
[INFO][12:37:16]: [Client #74] Sampler: iid
[INFO][12:37:16]: [Client #97] Selected by the server.
[INFO][12:37:16]: [Client #97] Loading its data source...
[INFO][12:37:16]: [Client #97] Dataset size: 2018
[INFO][12:37:16]: [Client #97] Sampler: iid
[INFO][12:37:17]: [Client #74] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:37:17]: [Client #74] Start to process inbound data.
[INFO][12:37:17]: [Client #97] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:37:17]: [Client #97] Start to process inbound data.
[INFO][12:37:18]: [93m[1m[Client #74] Started training in communication round #78.[0m
[INFO][12:37:18]: [93m[1m[Client #97] Started training in communication round #78.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:36,  4.60s/it]  2%|▏         | 1/48 [00:04<03:41,  4.71s/it]  4%|▍         | 2/48 [00:05<01:47,  2.33s/it]  4%|▍         | 2/48 [00:05<01:50,  2.39s/it]  6%|▋         | 3/48 [00:06<01:12,  1.60s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it]  8%|▊         | 4/48 [00:06<00:55,  1.27s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.31it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.31it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s]100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][12:38:04]: [Client #97] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_97_3536585.pth.
{'train_runtime': 39.5119, 'train_samples_per_second': 153.22, 'train_steps_per_second': 1.215, 'train_loss': 2.6488340695699057, 'epoch': 3.0}
[INFO][12:38:04]: [Client #74] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_74_3536584.pth.
{'train_runtime': 39.4198, 'train_samples_per_second': 153.578, 'train_steps_per_second': 1.218, 'train_loss': 2.8572896321614585, 'epoch': 3.0}
[INFO][12:38:05]: [Client #97] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_97_3536585.pth.
[INFO][12:38:05]: [Client #74] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_74_3536584.pth.
[INFO][12:38:05]: [Client #97] Model trained.
[INFO][12:38:05]: [Client #97] Inbound data has been processed.
[INFO][12:38:05]: [Client #97] Outbound data is ready to be sent after being processed.
[INFO][12:38:05]: [Client #74] Model trained.
[INFO][12:38:05]: [Client #74] Inbound data has been processed.
[INFO][12:38:05]: [Client #74] Outbound data is ready to be sent after being processed.
[INFO][12:38:13]: [Client #97] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:38:15]: [Client #74] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:38:15]: [Server #3536466] Received 507.38 MB of payload data from client #97 (simulated).
[INFO][12:38:15]: [Server #3536466] Received 507.38 MB of payload data from client #74 (simulated).
[INFO][12:38:15]: [Server #3536466] Selecting client #46 for training.
[INFO][12:38:15]: [Server #3536466] Sending the current model to client #46 (simulated).
[INFO][12:38:20]: [Server #3536466] Sending 507.38 MB of payload data to client #46 (simulated).
[INFO][12:38:20]: [Server #3536466] Selecting client #33 for training.
[INFO][12:38:20]: [Server #3536466] Sending the current model to client #33 (simulated).
[INFO][12:38:25]: [Server #3536466] Sending 507.38 MB of payload data to client #33 (simulated).
[INFO][12:38:25]: [Client #46] Selected by the server.
[INFO][12:38:25]: [Client #46] Loading its data source...
[INFO][12:38:25]: [Client #46] Dataset size: 2018
[INFO][12:38:25]: [Client #46] Sampler: iid
[INFO][12:38:25]: [Client #33] Selected by the server.
[INFO][12:38:25]: [Client #33] Loading its data source...
[INFO][12:38:25]: [Client #33] Dataset size: 2018
[INFO][12:38:25]: [Client #33] Sampler: iid
[INFO][12:38:26]: [Client #33] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:38:26]: [Client #33] Start to process inbound data.
[INFO][12:38:26]: [93m[1m[Client #33] Started training in communication round #78.[0m
[INFO][12:38:26]: [Client #46] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:38:26]: [Client #46] Start to process inbound data.
[INFO][12:38:26]: [93m[1m[Client #46] Started training in communication round #78.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:39,  4.67s/it]  2%|▏         | 1/48 [00:04<03:45,  4.81s/it]  4%|▍         | 2/48 [00:05<01:48,  2.35s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  6%|▋         | 3/48 [00:06<01:13,  1.62s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:55,  1.27s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.33it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.30it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.31it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][12:39:12]: [Client #33] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
{'train_runtime': 39.6659, 'train_samples_per_second': 152.625, 'train_steps_per_second': 1.21, 'train_loss': 2.339182217915853, 'epoch': 3.0}
[INFO][12:39:13]: [Client #46] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
{'train_runtime': 39.5547, 'train_samples_per_second': 153.054, 'train_steps_per_second': 1.214, 'train_loss': 2.673696517944336, 'epoch': 3.0}
[INFO][12:39:13]: [Client #33] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
[INFO][12:39:14]: [Client #46] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
[INFO][12:39:14]: [Client #33] Model trained.
[INFO][12:39:14]: [Client #33] Inbound data has been processed.
[INFO][12:39:14]: [Client #33] Outbound data is ready to be sent after being processed.
[INFO][12:39:14]: [Client #46] Model trained.
[INFO][12:39:14]: [Client #46] Inbound data has been processed.
[INFO][12:39:14]: [Client #46] Outbound data is ready to be sent after being processed.
[INFO][12:39:21]: [Client #33] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:39:22]: [Client #46] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:39:22]: [Server #3536466] Received 507.38 MB of payload data from client #33 (simulated).
[INFO][12:39:24]: [Server #3536466] Received 507.38 MB of payload data from client #46 (simulated).
[INFO][12:39:24]: [Server #3536466] Selecting client #55 for training.
[INFO][12:39:24]: [Server #3536466] Sending the current model to client #55 (simulated).
[INFO][12:39:28]: [Server #3536466] Sending 507.38 MB of payload data to client #55 (simulated).
[INFO][12:39:28]: [Client #55] Selected by the server.
[INFO][12:39:28]: [Client #55] Loading its data source...
[INFO][12:39:28]: [Client #55] Dataset size: 2018
[INFO][12:39:28]: [Client #55] Sampler: iid
[INFO][12:39:30]: [Client #55] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:39:30]: [Client #55] Start to process inbound data.
[INFO][12:39:30]: [93m[1m[Client #55] Started training in communication round #78.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:25,  4.37s/it]  4%|▍         | 2/48 [00:04<01:35,  2.09s/it]  6%|▋         | 3/48 [00:05<01:01,  1.36s/it]  8%|▊         | 4/48 [00:05<00:44,  1.01s/it] 10%|█         | 5/48 [00:06<00:35,  1.21it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.41it/s] 15%|█▍        | 7/48 [00:07<00:26,  1.57it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.70it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.79it/s] 21%|██        | 10/48 [00:08<00:20,  1.86it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.92it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.95it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.98it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.00it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.13it/s] 35%|███▌      | 17/48 [00:12<00:14,  2.10it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.08it/s] 40%|███▉      | 19/48 [00:13<00:13,  2.07it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.06it/s] 44%|████▍     | 21/48 [00:14<00:13,  2.06it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.05it/s] 48%|████▊     | 23/48 [00:15<00:12,  2.05it/s] 50%|█████     | 24/48 [00:15<00:11,  2.05it/s] 52%|█████▏    | 25/48 [00:16<00:11,  2.04it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.04it/s] 56%|█████▋    | 27/48 [00:17<00:10,  2.04it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.04it/s] 60%|██████    | 29/48 [00:17<00:09,  2.04it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.04it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.04it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.16it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.13it/s] 71%|███████   | 34/48 [00:20<00:06,  2.11it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:24<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:25<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:26<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:27<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:27<00:00,  2.18it/s]100%|██████████| 48/48 [00:27<00:00,  1.78it/s]
[INFO][12:40:03]: [Client #55] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_55_3536584.pth.
{'train_runtime': 27.0221, 'train_samples_per_second': 224.039, 'train_steps_per_second': 1.776, 'train_loss': 2.645850658416748, 'epoch': 3.0}
[INFO][12:40:04]: [Client #55] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_55_3536584.pth.
[INFO][12:40:04]: [Client #55] Model trained.
[INFO][12:40:04]: [Client #55] Inbound data has been processed.
[INFO][12:40:04]: [Client #55] Outbound data is ready to be sent after being processed.
[INFO][12:40:09]: [Client #55] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:40:10]: [Server #3536466] Received 507.38 MB of payload data from client #55 (simulated).
[INFO][12:40:10]: [Server #3536466] Adding client #37 to the list of clients for aggregation.
[INFO][12:40:10]: [Server #3536466] Adding client #27 to the list of clients for aggregation.
[INFO][12:40:10]: [Server #3536466] Adding client #42 to the list of clients for aggregation.
[INFO][12:40:10]: [Server #3536466] Adding client #61 to the list of clients for aggregation.
[INFO][12:40:10]: [Server #3536466] Adding client #16 to the list of clients for aggregation.
[INFO][12:40:10]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:40:10]: [Server #3536466] Updated weights have been received.
[INFO][12:40:11]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:40:12]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:40:12]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0687e+00  1e+02  1e+00  1e+00
 1:  2.9921e+00  2.0886e+00  3e+00  2e-02  2e-02
 2:  3.0742e+00  2.3863e+00  7e-01  3e-06  4e-07
 3:  3.0738e+00  3.0625e+00  1e-02  5e-08  6e-09
 4:  3.0717e+00  3.0693e+00  2e-03  1e-07  2e-08
 5:  3.0694e+00  3.0693e+00  1e-04  7e-07  1e-07
 6:  3.0693e+00  3.0693e+00  2e-06  2e-08  3e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.26it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.58it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.10it/s]100%|██████████| 8/8 [00:00<00:00, 11.84it/s]
[INFO][12:40:23]: [93m[1m[Server #3536466] Global model perplexity: 23.22
[0m
[INFO][12:40:23]: [Server #3536466] All client reports have been processed.
[INFO][12:40:23]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_78.pth.
[INFO][12:40:26]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_78.pth.
[INFO][12:40:26]: [93m[1m
[Server #3536466] Starting round 79/100.[0m
[INFO][12:40:26]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.37979840e-02, 2.37979840e-02, 2.37979840e-02, 2.16462619e-05,
       2.37979840e-02, 2.37979840e-02, 2.37979840e-02, 2.37979840e-02,
       2.37979840e-02, 2.37979840e-02, 1.18305921e-06, 2.16462619e-05,
       2.37979840e-02, 2.37979840e-02, 2.16462619e-05, 2.37979840e-02,
       2.37979840e-02, 2.37979840e-02, 2.16462619e-05, 5.80993318e-06,
       2.37979840e-02, 6.86110188e-07, 2.37979840e-02, 6.86110188e-07,
       6.86110188e-07, 6.86110188e-07, 2.37979840e-02, 2.16462619e-05,
       2.38563069e-06, 2.16462619e-05, 6.86110188e-07, 2.16462619e-05,
       2.16462619e-05, 2.16462619e-05, 2.16462619e-05, 2.37979840e-02,
       2.16462619e-05, 6.86110188e-07, 1.18305921e-06, 2.37979840e-02,
       2.37979840e-02, 2.37979840e-02, 1.18305921e-06, 2.37979840e-02,
       2.38563069e-06, 2.37979840e-02, 1.18305921e-06, 6.86110188e-07,
       6.86110188e-07, 1.18305921e-06, 2.37979840e-02, 2.37979840e-02,
       6.86110188e-07, 2.37979840e-02, 6.86110188e-07, 2.37979840e-02,
       2.37979840e-02, 2.37979840e-02, 2.37979840e-02, 5.80993318e-06,
       1.18305921e-06, 5.80993318e-06, 2.37979840e-02, 5.80993318e-06,
       2.16462619e-05, 2.37979840e-02, 2.37979840e-02, 2.37979840e-02,
       5.80993318e-06, 6.86110188e-07, 5.80993318e-06, 2.37979840e-02,
       2.37979840e-02, 2.37979840e-02, 2.16462619e-05, 2.37979840e-02,
       2.37979840e-02, 2.16462619e-05, 6.86110188e-07, 2.38563069e-06,
       2.37979840e-02, 6.86110188e-07, 6.86110188e-07, 2.37979840e-02,
       2.37979840e-02, 6.86110188e-07, 2.16462619e-05, 5.80993318e-06,
       5.80993318e-06, 2.16462619e-05, 2.16462619e-05, 2.16462619e-05,
       1.18305921e-06, 1.18305921e-06, 2.16462619e-05]),)
[INFO][12:40:26]: [Server #3536466] Selected clients: [80 21 14 81  2]
[INFO][12:40:26]: [Server #3536466] Selecting client #80 for training.
[INFO][12:40:26]: [Server #3536466] Sending the current model to client #80 (simulated).
[INFO][12:40:31]: [Server #3536466] Sending 507.38 MB of payload data to client #80 (simulated).
[INFO][12:40:31]: [Server #3536466] Selecting client #81 for training.
[INFO][12:40:31]: [Server #3536466] Sending the current model to client #81 (simulated).
[INFO][12:40:36]: [Server #3536466] Sending 507.38 MB of payload data to client #81 (simulated).
[INFO][12:40:36]: [Client #80] Selected by the server.
[INFO][12:40:36]: [Client #80] Loading its data source...
[INFO][12:40:36]: [Client #80] Dataset size: 2018
[INFO][12:40:36]: [Client #80] Sampler: iid
[INFO][12:40:36]: [Client #81] Selected by the server.
[INFO][12:40:36]: [Client #81] Loading its data source...
[INFO][12:40:36]: [Client #81] Dataset size: 2018
[INFO][12:40:36]: [Client #81] Sampler: iid
[INFO][12:40:38]: [Client #81] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:40:38]: [Client #81] Start to process inbound data.
[INFO][12:40:38]: [Client #80] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:40:38]: [Client #80] Start to process inbound data.
[INFO][12:40:38]: [93m[1m[Client #80] Started training in communication round #79.[0m
[INFO][12:40:38]: [93m[1m[Client #81] Started training in communication round #79.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:37,  4.62s/it]  2%|▏         | 1/48 [00:04<03:43,  4.76s/it]  4%|▍         | 2/48 [00:05<01:53,  2.47s/it]  4%|▍         | 2/48 [00:05<01:52,  2.45s/it]  6%|▋         | 3/48 [00:06<01:19,  1.77s/it]  6%|▋         | 3/48 [00:06<01:17,  1.72s/it]  8%|▊         | 4/48 [00:07<01:03,  1.43s/it]  8%|▊         | 4/48 [00:07<01:02,  1.43s/it] 10%|█         | 5/48 [00:08<00:54,  1.26s/it] 10%|█         | 5/48 [00:08<00:53,  1.24s/it] 12%|█▎        | 6/48 [00:09<00:48,  1.16s/it] 12%|█▎        | 6/48 [00:09<00:47,  1.14s/it] 15%|█▍        | 7/48 [00:10<00:43,  1.07s/it] 15%|█▍        | 7/48 [00:10<00:43,  1.06s/it] 17%|█▋        | 8/48 [00:11<00:40,  1.01s/it] 17%|█▋        | 8/48 [00:11<00:40,  1.01s/it] 19%|█▉        | 9/48 [00:11<00:37,  1.03it/s] 19%|█▉        | 9/48 [00:11<00:38,  1.03it/s] 21%|██        | 10/48 [00:12<00:36,  1.05it/s] 21%|██        | 10/48 [00:12<00:36,  1.04it/s] 23%|██▎       | 11/48 [00:13<00:34,  1.07it/s] 23%|██▎       | 11/48 [00:13<00:34,  1.07it/s] 25%|██▌       | 12/48 [00:14<00:33,  1.09it/s] 25%|██▌       | 12/48 [00:14<00:33,  1.08it/s] 27%|██▋       | 13/48 [00:15<00:32,  1.09it/s] 27%|██▋       | 13/48 [00:15<00:31,  1.10it/s] 29%|██▉       | 14/48 [00:16<00:31,  1.07it/s] 29%|██▉       | 14/48 [00:16<00:32,  1.06it/s] 31%|███▏      | 15/48 [00:17<00:30,  1.09it/s] 31%|███▏      | 15/48 [00:17<00:32,  1.02it/s] 33%|███▎      | 16/48 [00:18<00:29,  1.08it/s] 33%|███▎      | 16/48 [00:18<00:28,  1.13it/s] 35%|███▌      | 17/48 [00:19<00:28,  1.08it/s] 35%|███▌      | 17/48 [00:19<00:27,  1.11it/s] 38%|███▊      | 18/48 [00:20<00:27,  1.09it/s] 38%|███▊      | 18/48 [00:20<00:27,  1.10it/s] 40%|███▉      | 19/48 [00:21<00:26,  1.10it/s] 40%|███▉      | 19/48 [00:21<00:26,  1.10it/s] 42%|████▏     | 20/48 [00:22<00:25,  1.08it/s] 42%|████▏     | 20/48 [00:22<00:25,  1.10it/s] 44%|████▍     | 21/48 [00:22<00:24,  1.09it/s] 44%|████▍     | 21/48 [00:22<00:24,  1.09it/s] 46%|████▌     | 22/48 [00:23<00:23,  1.09it/s] 46%|████▌     | 22/48 [00:23<00:23,  1.10it/s] 48%|████▊     | 23/48 [00:24<00:22,  1.11it/s] 48%|████▊     | 23/48 [00:24<00:23,  1.08it/s] 50%|█████     | 24/48 [00:25<00:22,  1.08it/s] 50%|█████     | 24/48 [00:25<00:22,  1.08it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.07it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.07it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.06it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.05it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.08it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.08it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.09it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.10it/s] 60%|██████    | 29/48 [00:30<00:17,  1.10it/s] 60%|██████    | 29/48 [00:30<00:17,  1.10it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.11it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.08it/s] 65%|██████▍   | 31/48 [00:32<00:15,  1.10it/s] 65%|██████▍   | 31/48 [00:32<00:16,  1.02it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.07it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.14it/s] 69%|██████▉   | 33/48 [00:34<00:14,  1.03it/s] 69%|██████▉   | 33/48 [00:34<00:14,  1.06it/s] 71%|███████   | 34/48 [00:35<00:13,  1.01it/s] 71%|███████   | 34/48 [00:35<00:13,  1.03it/s] 73%|███████▎  | 35/48 [00:36<00:12,  1.04it/s] 73%|███████▎  | 35/48 [00:36<00:12,  1.02it/s] 75%|███████▌  | 36/48 [00:37<00:11,  1.04it/s] 75%|███████▌  | 36/48 [00:37<00:11,  1.05it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.07it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.05it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.07it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.04it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.07it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.04it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.06it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.07it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.09it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.07it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.08it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.08it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.05it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.06it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.06it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.06it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.06it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.08it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.07it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.05it/s] 98%|█████████▊| 47/48 [00:47<00:00,  1.07it/s] 98%|█████████▊| 47/48 [00:47<00:00,  1.01it/s]100%|██████████| 48/48 [00:48<00:00,  1.06it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:48<00:00,  1.06it/s]100%|██████████| 48/48 [00:48<00:00,  1.01s/it]
100%|██████████| 48/48 [00:48<00:00,  1.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:48<00:00,  1.17it/s]100%|██████████| 48/48 [00:48<00:00,  1.00s/it]
[INFO][12:41:33]: [Client #80] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_80_3536584.pth.
{'train_runtime': 48.3028, 'train_samples_per_second': 125.334, 'train_steps_per_second': 0.994, 'train_loss': 2.7776781717936196, 'epoch': 3.0}
[INFO][12:41:33]: [Client #81] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_81_3536585.pth.
{'train_runtime': 48.0912, 'train_samples_per_second': 125.886, 'train_steps_per_second': 0.998, 'train_loss': 2.618271827697754, 'epoch': 3.0}
[INFO][12:41:34]: [Client #81] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_81_3536585.pth.
[INFO][12:41:34]: [Client #80] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_80_3536584.pth.
[INFO][12:41:35]: [Client #81] Model trained.
[INFO][12:41:35]: [Client #81] Inbound data has been processed.
[INFO][12:41:35]: [Client #81] Outbound data is ready to be sent after being processed.
[INFO][12:41:35]: [Client #80] Model trained.
[INFO][12:41:35]: [Client #80] Inbound data has been processed.
[INFO][12:41:35]: [Client #80] Outbound data is ready to be sent after being processed.
[INFO][12:41:44]: [Client #81] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:41:44]: [Client #80] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:41:45]: [Server #3536466] Received 507.38 MB of payload data from client #81 (simulated).
[INFO][12:41:46]: [Server #3536466] Received 507.38 MB of payload data from client #80 (simulated).
[INFO][12:41:46]: [Server #3536466] Selecting client #2 for training.
[INFO][12:41:46]: [Server #3536466] Sending the current model to client #2 (simulated).
[INFO][12:41:51]: [Server #3536466] Sending 507.38 MB of payload data to client #2 (simulated).
[INFO][12:41:51]: [Server #3536466] Selecting client #21 for training.
[INFO][12:41:51]: [Server #3536466] Sending the current model to client #21 (simulated).
[INFO][12:41:55]: [Server #3536466] Sending 507.38 MB of payload data to client #21 (simulated).
[INFO][12:41:55]: [Client #2] Selected by the server.
[INFO][12:41:55]: [Client #2] Loading its data source...
[INFO][12:41:55]: [Client #2] Dataset size: 2018
[INFO][12:41:55]: [Client #2] Sampler: iid
[INFO][12:41:55]: [Client #21] Selected by the server.
[INFO][12:41:55]: [Client #21] Loading its data source...
[INFO][12:41:55]: [Client #21] Dataset size: 2018
[INFO][12:41:55]: [Client #21] Sampler: iid
[INFO][12:41:57]: [Client #21] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:41:57]: [Client #21] Start to process inbound data.
[INFO][12:41:57]: [93m[1m[Client #21] Started training in communication round #79.[0m
[INFO][12:41:57]: [Client #2] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:41:57]: [Client #2] Start to process inbound data.
[INFO][12:41:57]: [93m[1m[Client #2] Started training in communication round #79.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:49,  4.87s/it]  2%|▏         | 1/48 [00:04<03:54,  4.98s/it]  4%|▍         | 2/48 [00:05<01:53,  2.46s/it]  4%|▍         | 2/48 [00:05<01:56,  2.52s/it]  6%|▋         | 3/48 [00:06<01:15,  1.67s/it]  6%|▋         | 3/48 [00:06<01:17,  1.73s/it]  8%|▊         | 4/48 [00:07<00:57,  1.30s/it]  8%|▊         | 4/48 [00:07<00:58,  1.34s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 10%|█         | 5/48 [00:08<00:48,  1.12s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.31it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
[INFO][12:42:43]: [Client #21] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_21_3536585.pth.
{'train_runtime': 39.8542, 'train_samples_per_second': 151.904, 'train_steps_per_second': 1.204, 'train_loss': 2.552973429361979, 'epoch': 3.0}
[INFO][12:42:43]: [Client #2] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
{'train_runtime': 39.7029, 'train_samples_per_second': 152.483, 'train_steps_per_second': 1.209, 'train_loss': 2.8059616088867188, 'epoch': 3.0}
[INFO][12:42:44]: [Client #21] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_21_3536585.pth.
[INFO][12:42:44]: [Client #2] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
[INFO][12:42:45]: [Client #21] Model trained.
[INFO][12:42:45]: [Client #21] Inbound data has been processed.
[INFO][12:42:45]: [Client #21] Outbound data is ready to be sent after being processed.
[INFO][12:42:45]: [Client #2] Model trained.
[INFO][12:42:45]: [Client #2] Inbound data has been processed.
[INFO][12:42:45]: [Client #2] Outbound data is ready to be sent after being processed.
[INFO][12:42:53]: [Client #21] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:42:53]: [Client #2] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:42:54]: [Server #3536466] Received 507.38 MB of payload data from client #21 (simulated).
[INFO][12:42:55]: [Server #3536466] Received 507.38 MB of payload data from client #2 (simulated).
[INFO][12:42:55]: [Server #3536466] Selecting client #14 for training.
[INFO][12:42:55]: [Server #3536466] Sending the current model to client #14 (simulated).
[INFO][12:43:00]: [Server #3536466] Sending 507.38 MB of payload data to client #14 (simulated).
[INFO][12:43:00]: [Client #14] Selected by the server.
[INFO][12:43:00]: [Client #14] Loading its data source...
[INFO][12:43:00]: [Client #14] Dataset size: 2018
[INFO][12:43:00]: [Client #14] Sampler: iid
[INFO][12:43:02]: [Client #14] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:43:02]: [Client #14] Start to process inbound data.
[INFO][12:43:02]: [93m[1m[Client #14] Started training in communication round #79.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.22s/it]  4%|▍         | 2/48 [00:04<01:33,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.88it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][12:43:34]: [Client #14] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
{'train_runtime': 26.6914, 'train_samples_per_second': 226.814, 'train_steps_per_second': 1.798, 'train_loss': 2.5934998194376626, 'epoch': 3.0}
[INFO][12:43:36]: [Client #14] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
[INFO][12:43:36]: [Client #14] Model trained.
[INFO][12:43:36]: [Client #14] Inbound data has been processed.
[INFO][12:43:36]: [Client #14] Outbound data is ready to be sent after being processed.
[INFO][12:43:41]: [Client #14] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:43:42]: [Server #3536466] Received 507.38 MB of payload data from client #14 (simulated).
[INFO][12:43:42]: [Server #3536466] Adding client #33 to the list of clients for aggregation.
[INFO][12:43:42]: [Server #3536466] Adding client #46 to the list of clients for aggregation.
[INFO][12:43:42]: [Server #3536466] Adding client #55 to the list of clients for aggregation.
[INFO][12:43:42]: [Server #3536466] Adding client #97 to the list of clients for aggregation.
[INFO][12:43:42]: [Server #3536466] Adding client #14 to the list of clients for aggregation.
[INFO][12:43:42]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:43:42]: [Server #3536466] Updated weights have been received.
[INFO][12:43:43]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:43:43]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:43:43]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0687e+00  1e+02  1e+00  1e+00
 1:  2.9921e+00  2.0886e+00  3e+00  2e-02  2e-02
 2:  3.0742e+00  2.3863e+00  7e-01  3e-06  4e-07
 3:  3.0738e+00  3.0625e+00  1e-02  5e-08  6e-09
 4:  3.0717e+00  3.0693e+00  2e-03  1e-07  2e-08
 5:  3.0694e+00  3.0693e+00  1e-04  7e-07  1e-07
 6:  3.0693e+00  3.0693e+00  2e-06  2e-08  3e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 0.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 1.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.02it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.34it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.75it/s]100%|██████████| 8/8 [00:00<00:00, 11.55it/s]
[INFO][12:43:54]: [93m[1m[Server #3536466] Global model perplexity: 23.59
[0m
[INFO][12:43:54]: [Server #3536466] All client reports have been processed.
[INFO][12:43:54]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_79.pth.
[INFO][12:43:57]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_79.pth.
[INFO][12:43:57]: [93m[1m
[Server #3536466] Starting round 80/100.[0m
[INFO][12:43:57]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([3.06000396e-05, 3.06000396e-05, 3.01836074e-06, 3.06000396e-05,
       3.06000396e-05, 3.06000396e-05, 3.06000396e-05, 3.06000396e-05,
       3.06000396e-05, 3.69114257e-07, 3.01836074e-06, 3.06000396e-05,
       9.98670569e-01, 3.01836074e-06, 3.06000396e-05, 3.06000396e-05,
       3.06000396e-05, 3.01836074e-06, 1.11970778e-06, 2.52856307e-07,
       3.06000396e-05, 2.52856307e-07, 2.52856307e-07, 2.52856307e-07,
       3.06000396e-05, 3.01836074e-06, 5.92434610e-07, 3.01836074e-06,
       2.52856307e-07, 3.01836074e-06, 3.06000396e-05, 3.01836074e-06,
       3.01836074e-06, 3.01836074e-06, 3.06000396e-05, 3.01836074e-06,
       2.52856307e-07, 3.69114257e-07, 3.06000396e-05, 3.06000396e-05,
       3.06000396e-05, 3.69114257e-07, 3.06000396e-05, 3.06000396e-05,
       5.92434610e-07, 3.06000396e-05, 3.69114257e-07, 2.52856307e-07,
       2.52856307e-07, 3.69114257e-07, 3.06000396e-05, 3.06000396e-05,
       3.06000396e-05, 2.52856307e-07, 3.06000396e-05, 2.52856307e-07,
       3.06000396e-05, 3.06000396e-05, 3.06000396e-05, 3.06000396e-05,
       1.11970778e-06, 3.69114257e-07, 1.11970778e-06, 3.06000396e-05,
       1.11970778e-06, 3.01836074e-06, 3.06000396e-05, 3.06000396e-05,
       3.06000396e-05, 1.11970778e-06, 2.52856307e-07, 1.11970778e-06,
       3.06000396e-05, 3.06000396e-05, 3.06000396e-05, 3.01836074e-06,
       3.01836074e-06, 2.52856307e-07, 5.92434610e-07, 3.06000396e-05,
       2.52856307e-07, 2.52856307e-07, 3.06000396e-05, 3.06000396e-05,
       2.52856307e-07, 3.01836074e-06, 1.11970778e-06, 1.11970778e-06,
       3.01836074e-06, 3.01836074e-06, 3.01836074e-06, 3.06000396e-05,
       3.69114257e-07, 3.69114257e-07, 3.01836074e-06]),)
[INFO][12:43:57]: [Server #3536466] Selected clients: [14 48  3 54 10]
[INFO][12:43:57]: [Server #3536466] Selecting client #48 for training.
[INFO][12:43:57]: [Server #3536466] Sending the current model to client #48 (simulated).
[INFO][12:44:02]: [Server #3536466] Sending 507.38 MB of payload data to client #48 (simulated).
[INFO][12:44:02]: [Server #3536466] Selecting client #3 for training.
[INFO][12:44:02]: [Server #3536466] Sending the current model to client #3 (simulated).
[INFO][12:44:07]: [Server #3536466] Sending 507.38 MB of payload data to client #3 (simulated).
[INFO][12:44:07]: [Client #48] Selected by the server.
[INFO][12:44:07]: [Client #48] Loading its data source...
[INFO][12:44:07]: [Client #48] Dataset size: 2018
[INFO][12:44:07]: [Client #3] Selected by the server.
[INFO][12:44:07]: [Client #48] Sampler: iid
[INFO][12:44:07]: [Client #3] Loading its data source...
[INFO][12:44:07]: [Client #3] Dataset size: 2018
[INFO][12:44:07]: [Client #3] Sampler: iid
[INFO][12:44:08]: [Client #3] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:44:08]: [Client #3] Start to process inbound data.
[INFO][12:44:08]: [Client #48] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:44:08]: [Client #48] Start to process inbound data.
[INFO][12:44:09]: [93m[1m[Client #3] Started training in communication round #80.[0m
[INFO][12:44:09]: [93m[1m[Client #48] Started training in communication round #80.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:08,  4.02s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:35,  2.08s/it]  2%|▏         | 1/48 [00:04<03:35,  4.58s/it]  6%|▋         | 3/48 [00:05<01:11,  1.58s/it]  4%|▍         | 2/48 [00:05<01:56,  2.52s/it]  8%|▊         | 4/48 [00:06<01:00,  1.39s/it]  6%|▋         | 3/48 [00:06<01:24,  1.87s/it] 10%|█         | 5/48 [00:07<00:53,  1.26s/it]  8%|▊         | 4/48 [00:07<01:08,  1.55s/it] 12%|█▎        | 6/48 [00:08<00:47,  1.13s/it] 10%|█         | 5/48 [00:08<00:56,  1.32s/it] 15%|█▍        | 7/48 [00:09<00:42,  1.03s/it] 12%|█▎        | 6/48 [00:09<00:48,  1.16s/it] 17%|█▋        | 8/48 [00:10<00:39,  1.02it/s] 15%|█▍        | 7/48 [00:10<00:43,  1.06s/it] 19%|█▉        | 9/48 [00:11<00:36,  1.06it/s] 17%|█▋        | 8/48 [00:11<00:40,  1.01s/it] 21%|██        | 10/48 [00:12<00:35,  1.06it/s] 19%|█▉        | 9/48 [00:12<00:37,  1.03it/s] 23%|██▎       | 11/48 [00:13<00:33,  1.09it/s] 21%|██        | 10/48 [00:13<00:35,  1.06it/s] 25%|██▌       | 12/48 [00:14<00:33,  1.09it/s] 23%|██▎       | 11/48 [00:14<00:34,  1.08it/s] 27%|██▋       | 13/48 [00:14<00:31,  1.11it/s] 25%|██▌       | 12/48 [00:14<00:33,  1.07it/s] 29%|██▉       | 14/48 [00:15<00:30,  1.10it/s] 27%|██▋       | 13/48 [00:15<00:31,  1.10it/s] 31%|███▏      | 15/48 [00:16<00:30,  1.09it/s] 29%|██▉       | 14/48 [00:16<00:32,  1.03it/s] 33%|███▎      | 16/48 [00:17<00:28,  1.12it/s] 31%|███▏      | 15/48 [00:17<00:30,  1.08it/s] 35%|███▌      | 17/48 [00:18<00:26,  1.17it/s] 33%|███▎      | 16/48 [00:18<00:29,  1.08it/s] 38%|███▊      | 18/48 [00:19<00:27,  1.09it/s] 35%|███▌      | 17/48 [00:19<00:29,  1.05it/s] 40%|███▉      | 19/48 [00:20<00:27,  1.05it/s] 38%|███▊      | 18/48 [00:20<00:28,  1.07it/s] 42%|████▏     | 20/48 [00:21<00:27,  1.03it/s] 40%|███▉      | 19/48 [00:21<00:27,  1.07it/s] 44%|████▍     | 21/48 [00:22<00:25,  1.04it/s] 42%|████▏     | 20/48 [00:22<00:26,  1.04it/s] 46%|████▌     | 22/48 [00:23<00:24,  1.05it/s] 44%|████▍     | 21/48 [00:23<00:25,  1.07it/s] 48%|████▊     | 23/48 [00:24<00:23,  1.04it/s] 46%|████▌     | 22/48 [00:24<00:24,  1.06it/s] 50%|█████     | 24/48 [00:25<00:22,  1.07it/s] 48%|████▊     | 23/48 [00:25<00:23,  1.08it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.09it/s] 50%|█████     | 24/48 [00:26<00:21,  1.10it/s] 54%|█████▍    | 26/48 [00:26<00:20,  1.09it/s] 52%|█████▏    | 25/48 [00:26<00:20,  1.11it/s] 56%|█████▋    | 27/48 [00:27<00:19,  1.09it/s] 54%|█████▍    | 26/48 [00:27<00:19,  1.10it/s] 58%|█████▊    | 28/48 [00:28<00:18,  1.11it/s] 56%|█████▋    | 27/48 [00:28<00:18,  1.12it/s] 60%|██████    | 29/48 [00:29<00:17,  1.11it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.06it/s] 62%|██████▎   | 30/48 [00:30<00:16,  1.09it/s] 60%|██████    | 29/48 [00:30<00:17,  1.06it/s] 65%|██████▍   | 31/48 [00:31<00:15,  1.08it/s] 62%|██████▎   | 30/48 [00:31<00:17,  1.01it/s] 67%|██████▋   | 32/48 [00:32<00:15,  1.06it/s] 65%|██████▍   | 31/48 [00:32<00:15,  1.07it/s] 69%|██████▉   | 33/48 [00:33<00:13,  1.12it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.12it/s] 71%|███████   | 34/48 [00:34<00:12,  1.10it/s] 69%|██████▉   | 33/48 [00:34<00:13,  1.12it/s] 73%|███████▎  | 35/48 [00:35<00:11,  1.11it/s] 71%|███████   | 34/48 [00:35<00:12,  1.11it/s] 75%|███████▌  | 36/48 [00:36<00:11,  1.06it/s] 73%|███████▎  | 35/48 [00:36<00:11,  1.10it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.08it/s] 75%|███████▌  | 36/48 [00:37<00:10,  1.09it/s] 79%|███████▉  | 38/48 [00:37<00:09,  1.08it/s] 77%|███████▋  | 37/48 [00:38<00:09,  1.11it/s] 81%|████████▏ | 39/48 [00:38<00:08,  1.10it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.10it/s] 83%|████████▎ | 40/48 [00:39<00:07,  1.10it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.08it/s] 85%|████████▌ | 41/48 [00:40<00:06,  1.05it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.09it/s] 88%|████████▊ | 42/48 [00:41<00:05,  1.07it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.06it/s] 90%|████████▉ | 43/48 [00:42<00:04,  1.05it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.04it/s] 92%|█████████▏| 44/48 [00:43<00:03,  1.05it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.05it/s] 94%|█████████▍| 45/48 [00:44<00:02,  1.06it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.06it/s] 96%|█████████▌| 46/48 [00:45<00:01,  1.04it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.02it/s] 98%|█████████▊| 47/48 [00:46<00:00,  1.03it/s] 96%|█████████▌| 46/48 [00:46<00:02,  1.03s/it]100%|██████████| 48/48 [00:47<00:00,  1.03it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.03it/s]100%|██████████| 48/48 [00:47<00:00,  1.01it/s]
 98%|█████████▊| 47/48 [00:47<00:00,  1.11it/s]100%|██████████| 48/48 [00:47<00:00,  1.32it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.32it/s]100%|██████████| 48/48 [00:47<00:00,  1.00it/s]
[INFO][12:45:03]: [Client #48] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_48_3536584.pth.
{'train_runtime': 47.5664, 'train_samples_per_second': 127.275, 'train_steps_per_second': 1.009, 'train_loss': 2.799828847249349, 'epoch': 3.0}
[INFO][12:45:03]: [Client #3] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_3_3536585.pth.
{'train_runtime': 47.901, 'train_samples_per_second': 126.386, 'train_steps_per_second': 1.002, 'train_loss': 2.602968215942383, 'epoch': 3.0}
[INFO][12:45:04]: [Client #48] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_48_3536584.pth.
[INFO][12:45:04]: [Client #48] Model trained.
[INFO][12:45:04]: [Client #48] Inbound data has been processed.
[INFO][12:45:04]: [Client #48] Outbound data is ready to be sent after being processed.
[INFO][12:45:04]: [Client #3] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_3_3536585.pth.
[INFO][12:45:05]: [Client #3] Model trained.
[INFO][12:45:05]: [Client #3] Inbound data has been processed.
[INFO][12:45:05]: [Client #3] Outbound data is ready to be sent after being processed.
[INFO][12:45:13]: [Client #48] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:45:13]: [Client #3] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:45:14]: [Server #3536466] Received 507.38 MB of payload data from client #48 (simulated).
[INFO][12:45:15]: [Server #3536466] Received 507.38 MB of payload data from client #3 (simulated).
[INFO][12:45:15]: [Server #3536466] Selecting client #54 for training.
[INFO][12:45:15]: [Server #3536466] Sending the current model to client #54 (simulated).
[INFO][12:45:20]: [Server #3536466] Sending 507.38 MB of payload data to client #54 (simulated).
[INFO][12:45:20]: [Client #54] Selected by the server.
[INFO][12:45:20]: [Client #54] Loading its data source...
[INFO][12:45:20]: [Client #54] Dataset size: 2018
[INFO][12:45:20]: [Client #54] Sampler: iid
[INFO][12:45:21]: [Client #54] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:45:21]: [Client #54] Start to process inbound data.
[INFO][12:45:21]: [93m[1m[Client #54] Started training in communication round #80.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.18s/it]  4%|▍         | 2/48 [00:04<01:32,  2.00s/it]  6%|▋         | 3/48 [00:05<00:58,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.71it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.80it/s] 21%|██        | 10/48 [00:08<00:20,  1.87it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.92it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.96it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.98it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.00it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.01it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.13it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.10it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.09it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.09it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.08it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.07it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][12:45:54]: [Client #54] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_54_3536584.pth.
{'train_runtime': 26.7488, 'train_samples_per_second': 226.328, 'train_steps_per_second': 1.794, 'train_loss': 2.722672780354818, 'epoch': 3.0}
[INFO][12:45:55]: [Client #54] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_54_3536584.pth.
[INFO][12:45:55]: [Client #54] Model trained.
[INFO][12:45:55]: [Client #54] Inbound data has been processed.
[INFO][12:45:55]: [Client #54] Outbound data is ready to be sent after being processed.
[INFO][12:46:01]: [Client #54] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:46:02]: [Server #3536466] Received 507.38 MB of payload data from client #54 (simulated).
[INFO][12:46:02]: [Server #3536466] Selecting client #10 for training.
[INFO][12:46:02]: [Server #3536466] Sending the current model to client #10 (simulated).
[INFO][12:46:07]: [Server #3536466] Sending 507.38 MB of payload data to client #10 (simulated).
[INFO][12:46:07]: [Client #10] Selected by the server.
[INFO][12:46:07]: [Client #10] Loading its data source...
[INFO][12:46:07]: [Client #10] Dataset size: 2018
[INFO][12:46:07]: [Client #10] Sampler: iid
[INFO][12:46:08]: [Client #10] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:46:08]: [Client #10] Start to process inbound data.
[INFO][12:46:08]: [93m[1m[Client #10] Started training in communication round #80.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.17s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.07it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.07it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.07it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.07it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.11it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.06it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][12:46:41]: [Client #10] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
{'train_runtime': 26.6911, 'train_samples_per_second': 226.817, 'train_steps_per_second': 1.798, 'train_loss': 2.7140537897745767, 'epoch': 3.0}
[INFO][12:46:42]: [Client #10] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
[INFO][12:46:43]: [Client #10] Model trained.
[INFO][12:46:43]: [Client #10] Inbound data has been processed.
[INFO][12:46:43]: [Client #10] Outbound data is ready to be sent after being processed.
[INFO][12:46:48]: [Client #10] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:46:49]: [Server #3536466] Received 507.38 MB of payload data from client #10 (simulated).
[INFO][12:46:49]: [Server #3536466] Selecting client #14 for training.
[INFO][12:46:49]: [Server #3536466] Sending the current model to client #14 (simulated).
[INFO][12:46:54]: [Server #3536466] Sending 507.38 MB of payload data to client #14 (simulated).
[INFO][12:46:54]: [Client #14] Selected by the server.
[INFO][12:46:54]: [Client #14] Loading its data source...
[INFO][12:46:54]: [Client #14] Dataset size: 2018
[INFO][12:46:54]: [Client #14] Sampler: iid
[INFO][12:46:55]: [Client #14] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:46:55]: [Client #14] Start to process inbound data.
[INFO][12:46:55]: [93m[1m[Client #14] Started training in communication round #80.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.21s/it]  4%|▍         | 2/48 [00:04<01:32,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.97it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.03it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.12it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.10it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.09it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.08it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.06it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.06it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.06it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.06it/s] 60%|██████    | 29/48 [00:17<00:09,  2.06it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.06it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.06it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.16it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.13it/s] 71%|███████   | 34/48 [00:20<00:06,  2.11it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.09it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.08it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.07it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.07it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.06it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.06it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.06it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.06it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.06it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.06it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.06it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.16it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.16it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][12:47:28]: [Client #14] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
{'train_runtime': 26.8073, 'train_samples_per_second': 225.834, 'train_steps_per_second': 1.791, 'train_loss': 2.5223010381062827, 'epoch': 3.0}
[INFO][12:47:30]: [Client #14] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
[INFO][12:47:30]: [Client #14] Model trained.
[INFO][12:47:30]: [Client #14] Inbound data has been processed.
[INFO][12:47:30]: [Client #14] Outbound data is ready to be sent after being processed.
[INFO][12:47:35]: [Client #14] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:47:36]: [Server #3536466] Received 507.38 MB of payload data from client #14 (simulated).
[INFO][12:47:36]: [Server #3536466] Adding client #21 to the list of clients for aggregation.
[INFO][12:47:36]: [Server #3536466] Adding client #2 to the list of clients for aggregation.
[INFO][12:47:36]: [Server #3536466] Adding client #80 to the list of clients for aggregation.
[INFO][12:47:36]: [Server #3536466] Adding client #81 to the list of clients for aggregation.
[INFO][12:47:36]: [Server #3536466] Adding client #74 to the list of clients for aggregation.
[INFO][12:47:36]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:47:36]: [Server #3536466] Updated weights have been received.
[INFO][12:47:36]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:47:37]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:47:37]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0675e+00  1e+02  1e+00  1e+00
 1:  2.9908e+00  2.0875e+00  3e+00  2e-02  2e-02
 2:  3.0731e+00  2.3849e+00  7e-01  3e-06  4e-07
 3:  3.0726e+00  3.0603e+00  1e-02  6e-08  7e-09
 4:  3.0709e+00  3.0670e+00  4e-03  9e-08  2e-08
 5:  3.0693e+00  3.0660e+00  3e-03  1e-06  8e-07
 6:  3.0686e+00  3.0672e+00  1e-03  5e-07  4e-07
 7:  3.0678e+00  3.0673e+00  5e-04  2e-06  2e-06
 8:  3.0673e+00  3.0673e+00  4e-05  1e-06  9e-07
 9:  3.0673e+00  3.0673e+00  2e-06  6e-08  4e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 0.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.96it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.31it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.82it/s]100%|██████████| 8/8 [00:00<00:00, 11.60it/s]
[INFO][12:47:48]: [93m[1m[Server #3536466] Global model perplexity: 22.49
[0m
[INFO][12:47:48]: [Server #3536466] All client reports have been processed.
[INFO][12:47:48]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_80.pth.
[INFO][12:47:51]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_80.pth.
[INFO][12:47:51]: [93m[1m
[Server #3536466] Starting round 81/100.[0m
[INFO][12:47:51]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.43760866e-02, 2.43760866e-02, 2.47797798e-05, 2.43760866e-02,
       2.43760866e-02, 2.43760866e-02, 2.43760866e-02, 2.43760866e-02,
       1.39604331e-06, 2.47797798e-05, 2.43760866e-02, 2.47797798e-05,
       2.43760866e-02, 2.43760866e-02, 2.43760866e-02, 2.47797798e-05,
       6.62661414e-06, 2.43760866e-02, 8.26534873e-07, 2.43760866e-02,
       8.26534873e-07, 8.26534873e-07, 8.26534873e-07, 2.43760866e-02,
       2.47797798e-05, 2.75789847e-06, 2.47797798e-05, 8.26534873e-07,
       2.47797798e-05, 2.43760866e-02, 2.47797798e-05, 2.47797798e-05,
       2.47797798e-05, 2.43760866e-02, 2.47797798e-05, 8.26534873e-07,
       1.39604331e-06, 2.43760866e-02, 2.43760866e-02, 2.43760866e-02,
       1.39604331e-06, 2.43760866e-02, 2.43760866e-02, 2.75789847e-06,
       1.39604331e-06, 8.26534873e-07, 8.26534873e-07, 1.39604331e-06,
       2.43760866e-02, 2.43760866e-02, 8.26534873e-07, 2.43760866e-02,
       8.26534873e-07, 2.43760866e-02, 2.43760866e-02, 2.43760866e-02,
       2.43760866e-02, 6.62661414e-06, 1.39604331e-06, 6.62661414e-06,
       2.43760866e-02, 6.62661414e-06, 2.47797798e-05, 2.43760866e-02,
       2.43760866e-02, 2.43760866e-02, 6.62661414e-06, 8.26534873e-07,
       2.47797798e-05, 6.62661414e-06, 2.43760866e-02, 2.43760866e-02,
       2.43760866e-02, 2.47797798e-05, 2.43760866e-02, 2.43760866e-02,
       2.47797798e-05, 8.26534873e-07, 2.75789847e-06, 2.43760866e-02,
       8.26534873e-07, 8.26534873e-07, 2.43760866e-02, 2.43760866e-02,
       8.26534873e-07, 2.47797798e-05, 6.62661414e-06, 6.62661414e-06,
       2.47797798e-05, 2.47797798e-05, 2.47797798e-05, 2.43760866e-02,
       1.39604331e-06, 1.39604331e-06, 2.47797798e-05]),)
[INFO][12:47:51]: [Server #3536466] Selected clients: [60 97 80 43 69]
[INFO][12:47:51]: [Server #3536466] Selecting client #80 for training.
[INFO][12:47:51]: [Server #3536466] Sending the current model to client #80 (simulated).
[INFO][12:47:56]: [Server #3536466] Sending 507.38 MB of payload data to client #80 (simulated).
[INFO][12:47:56]: [Server #3536466] Selecting client #97 for training.
[INFO][12:47:56]: [Server #3536466] Sending the current model to client #97 (simulated).
[INFO][12:48:01]: [Server #3536466] Sending 507.38 MB of payload data to client #97 (simulated).
[INFO][12:48:01]: [Client #80] Selected by the server.
[INFO][12:48:01]: [Client #80] Loading its data source...
[INFO][12:48:01]: [Client #80] Dataset size: 2018
[INFO][12:48:01]: [Client #80] Sampler: iid
[INFO][12:48:01]: [Client #97] Selected by the server.
[INFO][12:48:01]: [Client #97] Loading its data source...
[INFO][12:48:01]: [Client #97] Dataset size: 2018
[INFO][12:48:01]: [Client #97] Sampler: iid
[INFO][12:48:02]: [Client #80] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:48:02]: [Client #80] Start to process inbound data.
[INFO][12:48:02]: [93m[1m[Client #80] Started training in communication round #81.[0m
[INFO][12:48:02]: [Client #97] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:48:02]: [Client #97] Start to process inbound data.
[INFO][12:48:03]: [93m[1m[Client #97] Started training in communication round #81.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:13,  4.12s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:39,  2.16s/it]  2%|▏         | 1/48 [00:04<03:40,  4.69s/it]  6%|▋         | 3/48 [00:05<01:09,  1.54s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  8%|▊         | 4/48 [00:06<00:54,  1.25s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it] 10%|█         | 5/48 [00:07<00:46,  1.07s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 15%|█▍        | 7/48 [00:08<00:36,  1.12it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 23%|██▎       | 11/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 25%|██▌       | 12/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.29it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.34it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.33it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
 98%|█████████▊| 47/48 [00:38<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.57it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.57it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][12:48:48]: [Client #80] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_80_3536584.pth.
{'train_runtime': 39.2152, 'train_samples_per_second': 154.379, 'train_steps_per_second': 1.224, 'train_loss': 2.6623172760009766, 'epoch': 3.0}
[INFO][12:48:48]: [Client #97] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_97_3536585.pth.
{'train_runtime': 39.3461, 'train_samples_per_second': 153.865, 'train_steps_per_second': 1.22, 'train_loss': 2.6282730102539062, 'epoch': 3.0}
[INFO][12:48:49]: [Client #80] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_80_3536584.pth.
[INFO][12:48:49]: [Client #80] Model trained.
[INFO][12:48:49]: [Client #80] Inbound data has been processed.
[INFO][12:48:49]: [Client #80] Outbound data is ready to be sent after being processed.
[INFO][12:48:49]: [Client #97] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_97_3536585.pth.
[INFO][12:48:50]: [Client #97] Model trained.
[INFO][12:48:50]: [Client #97] Inbound data has been processed.
[INFO][12:48:50]: [Client #97] Outbound data is ready to be sent after being processed.
[INFO][12:48:57]: [Client #80] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:48:58]: [Client #97] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:48:59]: [Server #3536466] Received 507.38 MB of payload data from client #80 (simulated).
[INFO][12:49:00]: [Server #3536466] Received 507.38 MB of payload data from client #97 (simulated).
[INFO][12:49:00]: [Server #3536466] Selecting client #60 for training.
[INFO][12:49:00]: [Server #3536466] Sending the current model to client #60 (simulated).
[INFO][12:49:05]: [Server #3536466] Sending 507.38 MB of payload data to client #60 (simulated).
[INFO][12:49:05]: [Server #3536466] Selecting client #69 for training.
[INFO][12:49:05]: [Server #3536466] Sending the current model to client #69 (simulated).
[INFO][12:49:09]: [Server #3536466] Sending 507.38 MB of payload data to client #69 (simulated).
[INFO][12:49:09]: [Client #60] Selected by the server.
[INFO][12:49:09]: [Client #60] Loading its data source...
[INFO][12:49:09]: [Client #69] Selected by the server.
[INFO][12:49:09]: [Client #69] Loading its data source...
[INFO][12:49:09]: [Client #60] Dataset size: 2018
[INFO][12:49:09]: [Client #60] Sampler: iid
[INFO][12:49:09]: [Client #69] Dataset size: 2018
[INFO][12:49:09]: [Client #69] Sampler: iid
[INFO][12:49:11]: [Client #69] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:49:11]: [Client #69] Start to process inbound data.
[INFO][12:49:11]: [Client #60] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:49:11]: [Client #60] Start to process inbound data.
[INFO][12:49:11]: [93m[1m[Client #69] Started training in communication round #81.[0m
[INFO][12:49:11]: [93m[1m[Client #60] Started training in communication round #81.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:28,  4.43s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:05<01:41,  2.21s/it]  2%|▏         | 1/48 [00:04<03:38,  4.64s/it]  6%|▋         | 3/48 [00:05<01:09,  1.54s/it]  4%|▍         | 2/48 [00:05<01:48,  2.36s/it]  8%|▊         | 4/48 [00:06<00:53,  1.22s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it] 12%|█▎        | 6/48 [00:08<00:39,  1.06it/s] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 23%|██▎       | 11/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:21,  1.32it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.31it/s] 42%|████▏     | 20/48 [00:18<00:21,  1.32it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.32it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.32it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.32it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 71%|███████   | 34/48 [00:28<00:10,  1.34it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.28it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.30it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.30it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.30it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.31it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
 98%|█████████▊| 47/48 [00:38<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.56it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.56it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][12:49:57]: [Client #60] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
{'train_runtime': 39.321, 'train_samples_per_second': 153.964, 'train_steps_per_second': 1.221, 'train_loss': 2.65126625696818, 'epoch': 3.0}
[INFO][12:49:57]: [Client #69] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536585.pth.
{'train_runtime': 39.3891, 'train_samples_per_second': 153.698, 'train_steps_per_second': 1.219, 'train_loss': 2.571873982747396, 'epoch': 3.0}
[INFO][12:49:58]: [Client #60] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
[INFO][12:49:58]: [Client #60] Model trained.
[INFO][12:49:58]: [Client #60] Inbound data has been processed.
[INFO][12:49:58]: [Client #60] Outbound data is ready to be sent after being processed.
[INFO][12:49:58]: [Client #69] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536585.pth.
[INFO][12:49:59]: [Client #69] Model trained.
[INFO][12:49:59]: [Client #69] Inbound data has been processed.
[INFO][12:49:59]: [Client #69] Outbound data is ready to be sent after being processed.
[INFO][12:50:07]: [Client #69] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:50:07]: [Client #60] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:50:08]: [Server #3536466] Received 507.38 MB of payload data from client #69 (simulated).
[INFO][12:50:09]: [Server #3536466] Received 507.38 MB of payload data from client #60 (simulated).
[INFO][12:50:09]: [Server #3536466] Selecting client #43 for training.
[INFO][12:50:09]: [Server #3536466] Sending the current model to client #43 (simulated).
[INFO][12:50:14]: [Server #3536466] Sending 507.38 MB of payload data to client #43 (simulated).
[INFO][12:50:14]: [Client #43] Selected by the server.
[INFO][12:50:14]: [Client #43] Loading its data source...
[INFO][12:50:14]: [Client #43] Dataset size: 2018
[INFO][12:50:14]: [Client #43] Sampler: iid
[INFO][12:50:15]: [Client #43] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:50:15]: [Client #43] Start to process inbound data.
[INFO][12:50:16]: [93m[1m[Client #43] Started training in communication round #81.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.20s/it]  4%|▍         | 2/48 [00:04<01:32,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.19it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.13it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][12:50:48]: [Client #43] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536584.pth.
{'train_runtime': 26.6739, 'train_samples_per_second': 226.963, 'train_steps_per_second': 1.8, 'train_loss': 2.5048063596089682, 'epoch': 3.0}
[INFO][12:50:49]: [Client #43] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536584.pth.
[INFO][12:50:50]: [Client #43] Model trained.
[INFO][12:50:50]: [Client #43] Inbound data has been processed.
[INFO][12:50:50]: [Client #43] Outbound data is ready to be sent after being processed.
[INFO][12:50:55]: [Client #43] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:50:56]: [Server #3536466] Received 507.38 MB of payload data from client #43 (simulated).
[INFO][12:50:56]: [Server #3536466] Adding client #10 to the list of clients for aggregation.
[INFO][12:50:56]: [Server #3536466] Adding client #14 to the list of clients for aggregation.
[INFO][12:50:56]: [Server #3536466] Adding client #48 to the list of clients for aggregation.
[INFO][12:50:56]: [Server #3536466] Adding client #54 to the list of clients for aggregation.
[INFO][12:50:56]: [Server #3536466] Adding client #3 to the list of clients for aggregation.
[INFO][12:50:56]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:50:56]: [Server #3536466] Updated weights have been received.
[INFO][12:50:57]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:50:58]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:50:58]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0716e+00  1e+02  1e+00  1e+00
 1:  2.9954e+00  2.0916e+00  3e+00  2e-02  2e-02
 2:  3.0772e+00  2.3901e+00  7e-01  3e-06  4e-07
 3:  3.0768e+00  3.0655e+00  1e-02  5e-08  6e-09
 4:  3.0747e+00  3.0722e+00  3e-03  1e-07  2e-08
 5:  3.0724e+00  3.0723e+00  1e-04  7e-07  1e-07
 6:  3.0723e+00  3.0723e+00  3e-06  2e-08  4e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.20it/s] 62%|██████▎   | 5/8 [00:00<00:00, 12.85it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.96it/s]100%|██████████| 8/8 [00:00<00:00, 11.68it/s]
[INFO][12:51:09]: [93m[1m[Server #3536466] Global model perplexity: 22.88
[0m
[INFO][12:51:09]: [Server #3536466] All client reports have been processed.
[INFO][12:51:09]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_81.pth.
[INFO][12:51:12]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_81.pth.
[INFO][12:51:12]: [93m[1m
[Server #3536466] Starting round 82/100.[0m
[INFO][12:51:12]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.43760866e-02, 2.43760866e-02, 2.43760866e-02, 2.47797798e-05,
       2.43760866e-02, 2.43760866e-02, 2.43760866e-02, 2.43760866e-02,
       2.43760866e-02, 2.43760866e-02, 1.39604331e-06, 2.47797798e-05,
       2.43760866e-02, 2.43760866e-02, 2.47797798e-05, 2.43760866e-02,
       2.43760866e-02, 2.43760866e-02, 2.47797798e-05, 6.62661414e-06,
       2.43760866e-02, 8.26534873e-07, 2.43760866e-02, 8.26534873e-07,
       8.26534873e-07, 8.26534873e-07, 2.43760866e-02, 2.47797798e-05,
       2.75789847e-06, 2.47797798e-05, 8.26534873e-07, 2.47797798e-05,
       2.43760866e-02, 2.47797798e-05, 2.47797798e-05, 2.47797798e-05,
       2.43760866e-02, 2.47797798e-05, 8.26534873e-07, 1.39604331e-06,
       2.43760866e-02, 2.43760866e-02, 1.39604331e-06, 2.43760866e-02,
       2.43760866e-02, 2.75789847e-06, 2.43760866e-02, 1.39604331e-06,
       8.26534873e-07, 8.26534873e-07, 1.39604331e-06, 2.43760866e-02,
       2.43760866e-02, 2.43760866e-02, 8.26534873e-07, 2.43760866e-02,
       8.26534873e-07, 2.43760866e-02, 2.43760866e-02, 2.43760866e-02,
       6.62661414e-06, 1.39604331e-06, 6.62661414e-06, 2.43760866e-02,
       6.62661414e-06, 2.47797798e-05, 2.43760866e-02, 2.43760866e-02,
       6.62661414e-06, 8.26534873e-07, 2.47797798e-05, 6.62661414e-06,
       2.43760866e-02, 2.43760866e-02, 2.43760866e-02, 2.47797798e-05,
       2.43760866e-02, 2.47797798e-05, 8.26534873e-07, 2.75789847e-06,
       2.43760866e-02, 8.26534873e-07, 8.26534873e-07, 2.43760866e-02,
       2.43760866e-02, 8.26534873e-07, 2.47797798e-05, 6.62661414e-06,
       6.62661414e-06, 2.47797798e-05, 2.47797798e-05, 2.47797798e-05,
       1.39604331e-06, 1.39604331e-06, 2.47797798e-05]),)
[INFO][12:51:12]: [Server #3536466] Selected clients: [66 42 45  8 23]
[INFO][12:51:12]: [Server #3536466] Selecting client #66 for training.
[INFO][12:51:12]: [Server #3536466] Sending the current model to client #66 (simulated).
[INFO][12:51:17]: [Server #3536466] Sending 507.38 MB of payload data to client #66 (simulated).
[INFO][12:51:17]: [Server #3536466] Selecting client #23 for training.
[INFO][12:51:17]: [Server #3536466] Sending the current model to client #23 (simulated).
[INFO][12:51:22]: [Server #3536466] Sending 507.38 MB of payload data to client #23 (simulated).
[INFO][12:51:22]: [Client #66] Selected by the server.
[INFO][12:51:22]: [Client #66] Loading its data source...
[INFO][12:51:22]: [Client #66] Dataset size: 2018
[INFO][12:51:22]: [Client #66] Sampler: iid
[INFO][12:51:22]: [Client #23] Selected by the server.
[INFO][12:51:22]: [Client #23] Loading its data source...
[INFO][12:51:22]: [Client #23] Dataset size: 2018
[INFO][12:51:22]: [Client #23] Sampler: iid
[INFO][12:51:23]: [Client #23] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:51:23]: [Client #23] Start to process inbound data.
[INFO][12:51:23]: [Client #66] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:51:23]: [Client #66] Start to process inbound data.
[INFO][12:51:24]: [93m[1m[Client #23] Started training in communication round #82.[0m
[INFO][12:51:24]: [93m[1m[Client #66] Started training in communication round #82.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.20s/it]  2%|▏         | 1/48 [00:04<03:48,  4.87s/it]  4%|▍         | 2/48 [00:04<01:38,  2.13s/it]  4%|▍         | 2/48 [00:05<01:56,  2.53s/it]  6%|▋         | 3/48 [00:05<01:10,  1.57s/it]  6%|▋         | 3/48 [00:06<01:21,  1.81s/it]  8%|▊         | 4/48 [00:06<00:58,  1.32s/it]  8%|▊         | 4/48 [00:07<01:03,  1.44s/it] 10%|█         | 5/48 [00:07<00:50,  1.17s/it] 10%|█         | 5/48 [00:08<00:52,  1.22s/it] 12%|█▎        | 6/48 [00:08<00:44,  1.06s/it] 12%|█▎        | 6/48 [00:09<00:44,  1.06s/it] 15%|█▍        | 7/48 [00:09<00:39,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:39,  1.05it/s] 17%|█▋        | 8/48 [00:09<00:35,  1.11it/s] 17%|█▋        | 8/48 [00:10<00:35,  1.14it/s] 19%|█▉        | 9/48 [00:10<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.20it/s] 21%|██        | 10/48 [00:11<00:30,  1.23it/s] 21%|██        | 10/48 [00:12<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.29it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:15<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.36it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.32it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:26<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.31it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.34it/s] 69%|██████▉   | 33/48 [00:29<00:11,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:40<00:00,  1.54it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.54it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
[INFO][12:52:10]: [Client #66] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
{'train_runtime': 39.6639, 'train_samples_per_second': 152.632, 'train_steps_per_second': 1.21, 'train_loss': 2.6025198300679526, 'epoch': 3.0}
[INFO][12:52:11]: [Client #23] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_23_3536585.pth.
{'train_runtime': 40.0364, 'train_samples_per_second': 151.212, 'train_steps_per_second': 1.199, 'train_loss': 2.505442460378011, 'epoch': 3.0}
[INFO][12:52:12]: [Client #66] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_66_3536584.pth.
[INFO][12:52:12]: [Client #23] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_23_3536585.pth.
[INFO][12:52:12]: [Client #66] Model trained.
[INFO][12:52:12]: [Client #66] Inbound data has been processed.
[INFO][12:52:12]: [Client #66] Outbound data is ready to be sent after being processed.
[INFO][12:52:13]: [Client #23] Model trained.
[INFO][12:52:13]: [Client #23] Inbound data has been processed.
[INFO][12:52:13]: [Client #23] Outbound data is ready to be sent after being processed.
[INFO][12:52:20]: [Client #66] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:52:21]: [Server #3536466] Received 507.38 MB of payload data from client #66 (simulated).
[INFO][12:52:22]: [Client #23] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:52:23]: [Server #3536466] Received 507.38 MB of payload data from client #23 (simulated).
[INFO][12:52:23]: [Server #3536466] Selecting client #8 for training.
[INFO][12:52:23]: [Server #3536466] Sending the current model to client #8 (simulated).
[INFO][12:52:27]: [Server #3536466] Sending 507.38 MB of payload data to client #8 (simulated).
[INFO][12:52:27]: [Server #3536466] Selecting client #45 for training.
[INFO][12:52:27]: [Server #3536466] Sending the current model to client #45 (simulated).
[INFO][12:52:32]: [Server #3536466] Sending 507.38 MB of payload data to client #45 (simulated).
[INFO][12:52:32]: [Client #8] Selected by the server.
[INFO][12:52:32]: [Client #8] Loading its data source...
[INFO][12:52:32]: [Client #8] Dataset size: 2018
[INFO][12:52:32]: [Client #45] Selected by the server.
[INFO][12:52:32]: [Client #8] Sampler: iid
[INFO][12:52:32]: [Client #45] Loading its data source...
[INFO][12:52:32]: [Client #45] Dataset size: 2018
[INFO][12:52:32]: [Client #45] Sampler: iid
[INFO][12:52:34]: [Client #8] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:52:34]: [Client #8] Start to process inbound data.
[INFO][12:52:34]: [Client #45] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:52:34]: [Client #45] Start to process inbound data.
[INFO][12:52:34]: [93m[1m[Client #8] Started training in communication round #82.[0m
[INFO][12:52:34]: [93m[1m[Client #45] Started training in communication round #82.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:09,  4.04s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:35,  2.07s/it]  2%|▏         | 1/48 [00:04<03:43,  4.76s/it]  6%|▋         | 3/48 [00:05<01:08,  1.51s/it]  4%|▍         | 2/48 [00:05<01:53,  2.46s/it]  8%|▊         | 4/48 [00:06<00:55,  1.26s/it]  6%|▋         | 3/48 [00:06<01:19,  1.76s/it] 10%|█         | 5/48 [00:07<00:49,  1.15s/it]  8%|▊         | 4/48 [00:07<01:01,  1.39s/it] 12%|█▎        | 6/48 [00:08<00:43,  1.04s/it] 10%|█         | 5/48 [00:08<00:52,  1.23s/it] 15%|█▍        | 7/48 [00:09<00:40,  1.01it/s] 12%|█▎        | 6/48 [00:09<00:46,  1.10s/it] 17%|█▋        | 8/48 [00:10<00:39,  1.02it/s] 15%|█▍        | 7/48 [00:10<00:42,  1.03s/it] 19%|█▉        | 9/48 [00:10<00:37,  1.05it/s] 17%|█▋        | 8/48 [00:11<00:40,  1.02s/it] 21%|██        | 10/48 [00:11<00:35,  1.07it/s] 19%|█▉        | 9/48 [00:11<00:38,  1.01it/s] 23%|██▎       | 11/48 [00:12<00:34,  1.08it/s] 21%|██        | 10/48 [00:12<00:36,  1.05it/s] 25%|██▌       | 12/48 [00:13<00:33,  1.08it/s] 23%|██▎       | 11/48 [00:13<00:34,  1.06it/s] 27%|██▋       | 13/48 [00:14<00:32,  1.08it/s] 25%|██▌       | 12/48 [00:14<00:33,  1.07it/s] 29%|██▉       | 14/48 [00:15<00:31,  1.09it/s] 27%|██▋       | 13/48 [00:15<00:32,  1.09it/s] 31%|███▏      | 15/48 [00:16<00:30,  1.08it/s] 29%|██▉       | 14/48 [00:16<00:32,  1.04it/s] 33%|███▎      | 16/48 [00:17<00:28,  1.11it/s] 31%|███▏      | 15/48 [00:17<00:30,  1.10it/s] 35%|███▌      | 17/48 [00:18<00:26,  1.17it/s] 33%|███▎      | 16/48 [00:18<00:28,  1.11it/s] 38%|███▊      | 18/48 [00:19<00:27,  1.10it/s] 35%|███▌      | 17/48 [00:19<00:28,  1.08it/s] 40%|███▉      | 19/48 [00:20<00:27,  1.06it/s] 38%|███▊      | 18/48 [00:20<00:27,  1.10it/s] 42%|████▏     | 20/48 [00:21<00:26,  1.07it/s] 40%|███▉      | 19/48 [00:21<00:26,  1.10it/s] 44%|████▍     | 21/48 [00:21<00:24,  1.08it/s] 42%|████▏     | 20/48 [00:21<00:25,  1.09it/s] 46%|████▌     | 22/48 [00:22<00:24,  1.07it/s] 44%|████▍     | 21/48 [00:22<00:24,  1.11it/s] 48%|████▊     | 23/48 [00:23<00:22,  1.09it/s] 46%|████▌     | 22/48 [00:23<00:23,  1.10it/s] 50%|█████     | 24/48 [00:24<00:22,  1.08it/s] 48%|████▊     | 23/48 [00:24<00:22,  1.10it/s] 52%|█████▏    | 25/48 [00:25<00:21,  1.07it/s] 50%|█████     | 24/48 [00:25<00:22,  1.07it/s] 54%|█████▍    | 26/48 [00:26<00:20,  1.09it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.09it/s] 56%|█████▋    | 27/48 [00:27<00:19,  1.09it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.08it/s] 58%|█████▊    | 28/48 [00:28<00:18,  1.10it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.08it/s] 60%|██████    | 29/48 [00:29<00:17,  1.10it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.10it/s] 62%|██████▎   | 30/48 [00:30<00:16,  1.08it/s] 60%|██████    | 29/48 [00:30<00:17,  1.11it/s] 65%|██████▍   | 31/48 [00:31<00:15,  1.07it/s] 62%|██████▎   | 30/48 [00:31<00:17,  1.02it/s] 67%|██████▋   | 32/48 [00:32<00:14,  1.09it/s] 65%|██████▍   | 31/48 [00:32<00:15,  1.07it/s] 69%|██████▉   | 33/48 [00:32<00:13,  1.14it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.07it/s] 71%|███████   | 34/48 [00:33<00:13,  1.07it/s] 69%|██████▉   | 33/48 [00:34<00:14,  1.03it/s] 73%|███████▎  | 35/48 [00:34<00:12,  1.03it/s] 71%|███████   | 34/48 [00:35<00:13,  1.05it/s] 75%|███████▌  | 36/48 [00:35<00:11,  1.03it/s] 73%|███████▎  | 35/48 [00:35<00:12,  1.06it/s] 77%|███████▋  | 37/48 [00:36<00:10,  1.02it/s] 75%|███████▌  | 36/48 [00:36<00:11,  1.07it/s] 79%|███████▉  | 38/48 [00:37<00:09,  1.06it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.09it/s] 81%|████████▏ | 39/48 [00:38<00:08,  1.07it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.09it/s] 83%|████████▎ | 40/48 [00:39<00:07,  1.06it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.08it/s] 85%|████████▌ | 41/48 [00:40<00:06,  1.06it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.04it/s] 88%|████████▊ | 42/48 [00:41<00:05,  1.03it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.06it/s] 90%|████████▉ | 43/48 [00:42<00:04,  1.03it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.05it/s] 92%|█████████▏| 44/48 [00:43<00:03,  1.04it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.05it/s] 94%|█████████▍| 45/48 [00:44<00:02,  1.06it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.04it/s] 96%|█████████▌| 46/48 [00:45<00:01,  1.05it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.06it/s] 98%|█████████▊| 47/48 [00:46<00:00,  1.07it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.00it/s]100%|██████████| 48/48 [00:47<00:00,  1.07it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.07it/s]100%|██████████| 48/48 [00:47<00:00,  1.02it/s]
 98%|█████████▊| 47/48 [00:47<00:00,  1.14it/s]100%|██████████| 48/48 [00:47<00:00,  1.35it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:47<00:00,  1.35it/s]100%|██████████| 48/48 [00:47<00:00,  1.01it/s]
[INFO][12:53:27]: [Client #8] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_8_3536584.pth.
{'train_runtime': 47.2541, 'train_samples_per_second': 128.116, 'train_steps_per_second': 1.016, 'train_loss': 2.786339441935221, 'epoch': 3.0}
[INFO][12:53:28]: [Client #45] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_45_3536585.pth.
{'train_runtime': 47.5418, 'train_samples_per_second': 127.341, 'train_steps_per_second': 1.01, 'train_loss': 2.4423414866129556, 'epoch': 3.0}
[INFO][12:53:29]: [Client #8] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_8_3536584.pth.
[INFO][12:53:29]: [Client #8] Model trained.
[INFO][12:53:29]: [Client #8] Inbound data has been processed.
[INFO][12:53:29]: [Client #8] Outbound data is ready to be sent after being processed.
[INFO][12:53:29]: [Client #45] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_45_3536585.pth.
[INFO][12:53:30]: [Client #45] Model trained.
[INFO][12:53:30]: [Client #45] Inbound data has been processed.
[INFO][12:53:30]: [Client #45] Outbound data is ready to be sent after being processed.
[INFO][12:53:39]: [Client #8] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:53:39]: [Client #45] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:53:40]: [Server #3536466] Received 507.38 MB of payload data from client #8 (simulated).
[INFO][12:53:41]: [Server #3536466] Received 507.38 MB of payload data from client #45 (simulated).
[INFO][12:53:41]: [Server #3536466] Selecting client #42 for training.
[INFO][12:53:41]: [Server #3536466] Sending the current model to client #42 (simulated).
[INFO][12:53:46]: [Server #3536466] Sending 507.38 MB of payload data to client #42 (simulated).
[INFO][12:53:46]: [Client #42] Selected by the server.
[INFO][12:53:46]: [Client #42] Loading its data source...
[INFO][12:53:46]: [Client #42] Dataset size: 2018
[INFO][12:53:46]: [Client #42] Sampler: iid
[INFO][12:53:47]: [Client #42] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:53:47]: [Client #42] Start to process inbound data.
[INFO][12:53:47]: [93m[1m[Client #42] Started training in communication round #82.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.19s/it]  4%|▍         | 2/48 [00:04<01:32,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.01it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.03it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.14it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.12it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.09it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.09it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.09it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.09it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.08it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][12:54:20]: [Client #42] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
{'train_runtime': 26.6625, 'train_samples_per_second': 227.06, 'train_steps_per_second': 1.8, 'train_loss': 2.7048069636027017, 'epoch': 3.0}
[INFO][12:54:21]: [Client #42] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
[INFO][12:54:21]: [Client #42] Model trained.
[INFO][12:54:21]: [Client #42] Inbound data has been processed.
[INFO][12:54:21]: [Client #42] Outbound data is ready to be sent after being processed.
[INFO][12:54:26]: [Client #42] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:54:28]: [Server #3536466] Received 507.38 MB of payload data from client #42 (simulated).
[INFO][12:54:28]: [Server #3536466] Adding client #43 to the list of clients for aggregation.
[INFO][12:54:28]: [Server #3536466] Adding client #69 to the list of clients for aggregation.
[INFO][12:54:28]: [Server #3536466] Adding client #80 to the list of clients for aggregation.
[INFO][12:54:28]: [Server #3536466] Adding client #60 to the list of clients for aggregation.
[INFO][12:54:28]: [Server #3536466] Adding client #97 to the list of clients for aggregation.
[INFO][12:54:28]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:54:28]: [Server #3536466] Updated weights have been received.
[INFO][12:54:28]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:54:29]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:54:29]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0716e+00  1e+02  1e+00  1e+00
 1:  2.9954e+00  2.0916e+00  3e+00  2e-02  2e-02
 2:  3.0772e+00  2.3901e+00  7e-01  3e-06  4e-07
 3:  3.0768e+00  3.0655e+00  1e-02  5e-08  6e-09
 4:  3.0747e+00  3.0722e+00  3e-03  1e-07  2e-08
 5:  3.0724e+00  3.0723e+00  1e-04  7e-07  1e-07
 6:  3.0723e+00  3.0723e+00  3e-06  2e-08  4e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.29it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.29it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.81it/s]100%|██████████| 8/8 [00:00<00:00, 11.67it/s]
[INFO][12:54:40]: [93m[1m[Server #3536466] Global model perplexity: 23.01
[0m
[INFO][12:54:40]: [Server #3536466] All client reports have been processed.
[INFO][12:54:40]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_82.pth.
[INFO][12:54:43]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_82.pth.
[INFO][12:54:43]: [93m[1m
[Server #3536466] Starting round 83/100.[0m
[INFO][12:54:43]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.43760866e-02, 2.43760866e-02, 2.43760866e-02, 2.47797798e-05,
       2.43760866e-02, 2.43760866e-02, 2.43760866e-02, 2.43760866e-02,
       2.43760866e-02, 1.39604331e-06, 2.47797798e-05, 2.43760866e-02,
       2.43760866e-02, 2.47797798e-05, 2.43760866e-02, 2.43760866e-02,
       2.43760866e-02, 2.47797798e-05, 6.62661414e-06, 2.43760866e-02,
       8.26534873e-07, 8.26534873e-07, 8.26534873e-07, 8.26534873e-07,
       2.43760866e-02, 2.47797798e-05, 2.75789847e-06, 2.47797798e-05,
       8.26534873e-07, 2.47797798e-05, 2.43760866e-02, 2.47797798e-05,
       2.47797798e-05, 2.47797798e-05, 2.43760866e-02, 2.47797798e-05,
       8.26534873e-07, 1.39604331e-06, 2.43760866e-02, 2.43760866e-02,
       1.39604331e-06, 2.43760866e-02, 2.75789847e-06, 2.43760866e-02,
       1.39604331e-06, 8.26534873e-07, 8.26534873e-07, 1.39604331e-06,
       2.43760866e-02, 2.43760866e-02, 2.43760866e-02, 8.26534873e-07,
       2.43760866e-02, 8.26534873e-07, 2.43760866e-02, 2.43760866e-02,
       2.43760866e-02, 2.43760866e-02, 6.62661414e-06, 1.39604331e-06,
       6.62661414e-06, 6.62661414e-06, 2.47797798e-05, 2.43760866e-02,
       2.43760866e-02, 2.43760866e-02, 6.62661414e-06, 8.26534873e-07,
       2.47797798e-05, 6.62661414e-06, 2.43760866e-02, 2.43760866e-02,
       2.43760866e-02, 2.47797798e-05, 2.43760866e-02, 2.43760866e-02,
       2.47797798e-05, 8.26534873e-07, 2.75789847e-06, 2.43760866e-02,
       8.26534873e-07, 8.26534873e-07, 2.43760866e-02, 2.43760866e-02,
       8.26534873e-07, 2.47797798e-05, 6.62661414e-06, 6.62661414e-06,
       2.47797798e-05, 2.47797798e-05, 2.47797798e-05, 2.43760866e-02,
       1.39604331e-06, 1.39604331e-06, 2.47797798e-05]),)
[INFO][12:54:43]: [Server #3536466] Selected clients: [ 7 69 46 43 81]
[INFO][12:54:43]: [Server #3536466] Selecting client #46 for training.
[INFO][12:54:43]: [Server #3536466] Sending the current model to client #46 (simulated).
[INFO][12:54:48]: [Server #3536466] Sending 507.38 MB of payload data to client #46 (simulated).
[INFO][12:54:48]: [Server #3536466] Selecting client #81 for training.
[INFO][12:54:48]: [Server #3536466] Sending the current model to client #81 (simulated).
[INFO][12:54:53]: [Server #3536466] Sending 507.38 MB of payload data to client #81 (simulated).
[INFO][12:54:53]: [Client #46] Selected by the server.
[INFO][12:54:53]: [Client #46] Loading its data source...
[INFO][12:54:53]: [Client #46] Dataset size: 2018
[INFO][12:54:53]: [Client #46] Sampler: iid
[INFO][12:54:53]: [Client #81] Selected by the server.
[INFO][12:54:53]: [Client #81] Loading its data source...
[INFO][12:54:53]: [Client #81] Dataset size: 2018
[INFO][12:54:53]: [Client #81] Sampler: iid
[INFO][12:54:54]: [Client #46] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:54:54]: [Client #46] Start to process inbound data.
[INFO][12:54:54]: [Client #81] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:54:54]: [Client #81] Start to process inbound data.
[INFO][12:54:55]: [93m[1m[Client #81] Started training in communication round #83.[0m
[INFO][12:54:55]: [93m[1m[Client #46] Started training in communication round #83.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:08,  4.01s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:38,  2.13s/it]  2%|▏         | 1/48 [00:04<03:41,  4.70s/it]  6%|▋         | 3/48 [00:05<01:07,  1.49s/it]  4%|▍         | 2/48 [00:05<01:48,  2.37s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  6%|▋         | 3/48 [00:06<01:13,  1.62s/it] 10%|█         | 5/48 [00:07<00:45,  1.05s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.36it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.32it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 50%|█████     | 24/48 [00:21<00:18,  1.32it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.33it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.41it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 83%|████████▎ | 40/48 [00:32<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 92%|█████████▏| 44/48 [00:35<00:02,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s]100%|██████████| 48/48 [00:38<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.38it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
 98%|█████████▊| 47/48 [00:38<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.57it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.57it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][12:55:40]: [Client #46] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
{'train_runtime': 38.889, 'train_samples_per_second': 155.674, 'train_steps_per_second': 1.234, 'train_loss': 2.7091903686523438, 'epoch': 3.0}
[INFO][12:55:41]: [Client #81] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_81_3536585.pth.
{'train_runtime': 39.1959, 'train_samples_per_second': 154.455, 'train_steps_per_second': 1.225, 'train_loss': 2.474151293436686, 'epoch': 3.0}
[INFO][12:55:41]: [Client #46] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
[INFO][12:55:42]: [Client #81] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_81_3536585.pth.
[INFO][12:55:42]: [Client #46] Model trained.
[INFO][12:55:42]: [Client #46] Inbound data has been processed.
[INFO][12:55:42]: [Client #46] Outbound data is ready to be sent after being processed.
[INFO][12:55:42]: [Client #81] Model trained.
[INFO][12:55:42]: [Client #81] Inbound data has been processed.
[INFO][12:55:42]: [Client #81] Outbound data is ready to be sent after being processed.
[INFO][12:55:50]: [Client #46] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:55:50]: [Client #81] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:55:51]: [Server #3536466] Received 507.38 MB of payload data from client #46 (simulated).
[INFO][12:55:52]: [Server #3536466] Received 507.38 MB of payload data from client #81 (simulated).
[INFO][12:55:52]: [Server #3536466] Selecting client #69 for training.
[INFO][12:55:52]: [Server #3536466] Sending the current model to client #69 (simulated).
[INFO][12:55:57]: [Server #3536466] Sending 507.38 MB of payload data to client #69 (simulated).
[INFO][12:55:57]: [Server #3536466] Selecting client #7 for training.
[INFO][12:55:57]: [Server #3536466] Sending the current model to client #7 (simulated).
[INFO][12:56:02]: [Server #3536466] Sending 507.38 MB of payload data to client #7 (simulated).
[INFO][12:56:02]: [Client #69] Selected by the server.
[INFO][12:56:02]: [Client #7] Selected by the server.
[INFO][12:56:02]: [Client #69] Loading its data source...
[INFO][12:56:02]: [Client #7] Loading its data source...
[INFO][12:56:02]: [Client #69] Dataset size: 2018
[INFO][12:56:02]: [Client #7] Dataset size: 2018
[INFO][12:56:02]: [Client #69] Sampler: iid
[INFO][12:56:02]: [Client #7] Sampler: iid
[INFO][12:56:03]: [Client #69] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:56:03]: [Client #69] Start to process inbound data.
[INFO][12:56:03]: [Client #7] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:56:03]: [Client #7] Start to process inbound data.
[INFO][12:56:04]: [93m[1m[Client #7] Started training in communication round #83.[0m
[INFO][12:56:04]: [93m[1m[Client #69] Started training in communication round #83.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:09,  4.04s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:34,  2.05s/it]  2%|▏         | 1/48 [00:04<03:32,  4.52s/it]  6%|▋         | 3/48 [00:05<01:05,  1.45s/it]  4%|▍         | 2/48 [00:05<01:46,  2.31s/it]  8%|▊         | 4/48 [00:06<00:51,  1.16s/it]  6%|▋         | 3/48 [00:06<01:11,  1.59s/it] 10%|█         | 5/48 [00:06<00:44,  1.03s/it]  8%|▊         | 4/48 [00:06<00:55,  1.26s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 17%|█▋        | 8/48 [00:09<00:32,  1.21it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 19%|█▉        | 9/48 [00:09<00:31,  1.25it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.35it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 50%|█████     | 24/48 [00:21<00:18,  1.32it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:16,  1.31it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 60%|██████    | 29/48 [00:24<00:14,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.41it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.35it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.30it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.30it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.31it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.31it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.31it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s]100%|██████████| 48/48 [00:38<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.39it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
 98%|█████████▊| 47/48 [00:38<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.57it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.57it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][12:56:49]: [Client #69] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536584.pth.
{'train_runtime': 38.9402, 'train_samples_per_second': 155.469, 'train_steps_per_second': 1.233, 'train_loss': 2.44674285252889, 'epoch': 3.0}
[INFO][12:56:49]: [Client #7] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536585.pth.
{'train_runtime': 39.2651, 'train_samples_per_second': 154.183, 'train_steps_per_second': 1.222, 'train_loss': 2.3784737586975098, 'epoch': 3.0}
[INFO][12:56:50]: [Client #69] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536584.pth.
[INFO][12:56:50]: [Client #7] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536585.pth.
[INFO][12:56:51]: [Client #69] Model trained.
[INFO][12:56:51]: [Client #69] Inbound data has been processed.
[INFO][12:56:51]: [Client #69] Outbound data is ready to be sent after being processed.
[INFO][12:56:51]: [Client #7] Model trained.
[INFO][12:56:51]: [Client #7] Inbound data has been processed.
[INFO][12:56:51]: [Client #7] Outbound data is ready to be sent after being processed.
[INFO][12:57:00]: [Client #69] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:57:00]: [Client #7] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:57:01]: [Server #3536466] Received 507.38 MB of payload data from client #69 (simulated).
[INFO][12:57:02]: [Server #3536466] Received 507.38 MB of payload data from client #7 (simulated).
[INFO][12:57:02]: [Server #3536466] Selecting client #43 for training.
[INFO][12:57:02]: [Server #3536466] Sending the current model to client #43 (simulated).
[INFO][12:57:07]: [Server #3536466] Sending 507.38 MB of payload data to client #43 (simulated).
[INFO][12:57:07]: [Client #43] Selected by the server.
[INFO][12:57:07]: [Client #43] Loading its data source...
[INFO][12:57:07]: [Client #43] Dataset size: 2018
[INFO][12:57:07]: [Client #43] Sampler: iid
[INFO][12:57:08]: [Client #43] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:57:08]: [Client #43] Start to process inbound data.
[INFO][12:57:08]: [93m[1m[Client #43] Started training in communication round #83.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.19s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.02it/s] 10%|█         | 5/48 [00:06<00:34,  1.25it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.71it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.80it/s] 21%|██        | 10/48 [00:08<00:20,  1.87it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.92it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.96it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.98it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.00it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.13it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.11it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.09it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.08it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.07it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.06it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.06it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.06it/s] 50%|█████     | 24/48 [00:15<00:11,  2.06it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.08it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][12:57:41]: [Client #43] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536584.pth.
{'train_runtime': 26.7391, 'train_samples_per_second': 226.41, 'train_steps_per_second': 1.795, 'train_loss': 2.380354563395182, 'epoch': 3.0}
[INFO][12:57:42]: [Client #43] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536584.pth.
[INFO][12:57:42]: [Client #43] Model trained.
[INFO][12:57:42]: [Client #43] Inbound data has been processed.
[INFO][12:57:42]: [Client #43] Outbound data is ready to be sent after being processed.
[INFO][12:57:48]: [Client #43] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:57:49]: [Server #3536466] Received 507.38 MB of payload data from client #43 (simulated).
[INFO][12:57:49]: [Server #3536466] Adding client #23 to the list of clients for aggregation.
[INFO][12:57:49]: [Server #3536466] Adding client #45 to the list of clients for aggregation.
[INFO][12:57:49]: [Server #3536466] Adding client #66 to the list of clients for aggregation.
[INFO][12:57:49]: [Server #3536466] Adding client #42 to the list of clients for aggregation.
[INFO][12:57:49]: [Server #3536466] Adding client #43 to the list of clients for aggregation.
[INFO][12:57:49]: [Server #3536466] Aggregating 5 clients in total.
[INFO][12:57:49]: [Server #3536466] Updated weights have been received.
[INFO][12:57:50]: [Server #3536466] Aggregating model weight deltas.
[INFO][12:57:50]: [Server #3536466] Finished aggregating updated weights.
[INFO][12:57:50]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0716e+00  1e+02  1e+00  1e+00
 1:  2.9954e+00  2.0916e+00  3e+00  2e-02  2e-02
 2:  3.0772e+00  2.3901e+00  7e-01  3e-06  4e-07
 3:  3.0768e+00  3.0655e+00  1e-02  5e-08  6e-09
 4:  3.0747e+00  3.0722e+00  3e-03  1e-07  2e-08
 5:  3.0724e+00  3.0723e+00  1e-04  7e-07  1e-07
 6:  3.0723e+00  3.0723e+00  3e-06  2e-08  4e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 1.1 1.1 1.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 0.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.26it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.42it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.02it/s]100%|██████████| 8/8 [00:00<00:00, 11.82it/s]
[INFO][12:58:01]: [93m[1m[Server #3536466] Global model perplexity: 23.61
[0m
[INFO][12:58:01]: [Server #3536466] All client reports have been processed.
[INFO][12:58:01]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_83.pth.
[INFO][12:58:05]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_83.pth.
[INFO][12:58:05]: [93m[1m
[Server #3536466] Starting round 84/100.[0m
[INFO][12:58:05]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([3.30884115e-05, 3.30884115e-05, 3.30884115e-05, 3.27163180e-06,
       3.30884115e-05, 3.30884115e-05, 3.30884115e-05, 3.30884115e-05,
       3.99803555e-07, 3.27163180e-06, 3.30884115e-05, 3.30884115e-05,
       3.27163180e-06, 3.30884115e-05, 3.30884115e-05, 3.30884115e-05,
       3.27163180e-06, 1.21321210e-06, 3.30884115e-05, 2.73857125e-07,
       3.30884115e-05, 2.73857125e-07, 2.73857125e-07, 2.73857125e-07,
       3.30884115e-05, 3.27163180e-06, 6.41771575e-07, 3.27163180e-06,
       2.73857125e-07, 3.27163180e-06, 3.30884115e-05, 3.27163180e-06,
       3.27163180e-06, 3.27163180e-06, 3.30884115e-05, 3.27163180e-06,
       2.73857125e-07, 3.99803555e-07, 3.30884115e-05, 3.30884115e-05,
       9.98592094e-01, 3.99803555e-07, 3.30884115e-05, 6.41771575e-07,
       3.30884115e-05, 3.99803555e-07, 2.73857125e-07, 2.73857125e-07,
       3.99803555e-07, 3.30884115e-05, 3.30884115e-05, 3.30884115e-05,
       2.73857125e-07, 3.30884115e-05, 2.73857125e-07, 3.30884115e-05,
       3.30884115e-05, 3.30884115e-05, 3.30884115e-05, 1.21321210e-06,
       3.99803555e-07, 1.21321210e-06, 3.30884115e-05, 1.21321210e-06,
       3.27163180e-06, 3.30884115e-05, 3.30884115e-05, 1.21321210e-06,
       2.73857125e-07, 3.27163180e-06, 1.21321210e-06, 3.30884115e-05,
       3.30884115e-05, 3.30884115e-05, 3.27163180e-06, 3.30884115e-05,
       3.27163180e-06, 2.73857125e-07, 6.41771575e-07, 3.30884115e-05,
       2.73857125e-07, 2.73857125e-07, 3.30884115e-05, 3.30884115e-05,
       2.73857125e-07, 3.27163180e-06, 1.21321210e-06, 1.21321210e-06,
       3.27163180e-06, 3.27163180e-06, 3.27163180e-06, 3.30884115e-05,
       3.99803555e-07, 3.99803555e-07, 3.27163180e-06]),)
[INFO][12:58:05]: [Server #3536466] Selected clients: [43  2 19 48 93]
[INFO][12:58:05]: [Server #3536466] Selecting client #48 for training.
[INFO][12:58:05]: [Server #3536466] Sending the current model to client #48 (simulated).
[INFO][12:58:10]: [Server #3536466] Sending 507.38 MB of payload data to client #48 (simulated).
[INFO][12:58:10]: [Server #3536466] Selecting client #19 for training.
[INFO][12:58:10]: [Server #3536466] Sending the current model to client #19 (simulated).
[INFO][12:58:14]: [Server #3536466] Sending 507.38 MB of payload data to client #19 (simulated).
[INFO][12:58:14]: [Client #48] Selected by the server.
[INFO][12:58:14]: [Client #48] Loading its data source...
[INFO][12:58:14]: [Client #48] Dataset size: 2018
[INFO][12:58:14]: [Client #19] Selected by the server.
[INFO][12:58:14]: [Client #48] Sampler: iid
[INFO][12:58:14]: [Client #19] Loading its data source...
[INFO][12:58:14]: [Client #19] Dataset size: 2018
[INFO][12:58:14]: [Client #19] Sampler: iid
[INFO][12:58:16]: [Client #48] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:58:16]: [Client #48] Start to process inbound data.
[INFO][12:58:16]: [Client #19] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:58:16]: [Client #19] Start to process inbound data.
[INFO][12:58:17]: [93m[1m[Client #19] Started training in communication round #84.[0m
[INFO][12:58:17]: [93m[1m[Client #48] Started training in communication round #84.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:08,  4.01s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:35,  2.08s/it]  2%|▏         | 1/48 [00:04<03:35,  4.59s/it]  6%|▋         | 3/48 [00:05<01:07,  1.49s/it]  4%|▍         | 2/48 [00:05<01:51,  2.43s/it]  8%|▊         | 4/48 [00:06<00:55,  1.27s/it]  6%|▋         | 3/48 [00:06<01:18,  1.75s/it] 10%|█         | 5/48 [00:07<00:48,  1.14s/it]  8%|▊         | 4/48 [00:07<01:02,  1.41s/it] 12%|█▎        | 6/48 [00:08<00:44,  1.06s/it] 10%|█         | 5/48 [00:08<00:52,  1.23s/it] 15%|█▍        | 7/48 [00:09<00:41,  1.01s/it] 12%|█▎        | 6/48 [00:09<00:47,  1.12s/it] 17%|█▋        | 8/48 [00:10<00:38,  1.05it/s] 15%|█▍        | 7/48 [00:10<00:43,  1.06s/it] 19%|█▉        | 9/48 [00:10<00:37,  1.05it/s] 17%|█▋        | 8/48 [00:10<00:39,  1.01it/s] 21%|██        | 10/48 [00:11<00:35,  1.07it/s] 19%|█▉        | 9/48 [00:11<00:38,  1.01it/s] 23%|██▎       | 11/48 [00:12<00:33,  1.10it/s] 21%|██        | 10/48 [00:12<00:36,  1.03it/s] 25%|██▌       | 12/48 [00:13<00:32,  1.09it/s] 23%|██▎       | 11/48 [00:13<00:34,  1.07it/s] 27%|██▋       | 13/48 [00:14<00:32,  1.09it/s] 25%|██▌       | 12/48 [00:14<00:33,  1.08it/s] 29%|██▉       | 14/48 [00:15<00:31,  1.09it/s] 27%|██▋       | 13/48 [00:15<00:32,  1.09it/s] 31%|███▏      | 15/48 [00:16<00:30,  1.08it/s] 29%|██▉       | 14/48 [00:16<00:33,  1.03it/s] 33%|███▎      | 16/48 [00:17<00:29,  1.09it/s] 31%|███▏      | 15/48 [00:17<00:31,  1.05it/s] 35%|███▌      | 17/48 [00:18<00:27,  1.11it/s] 33%|███▎      | 16/48 [00:18<00:28,  1.14it/s] 38%|███▊      | 18/48 [00:19<00:27,  1.10it/s] 35%|███▌      | 17/48 [00:19<00:27,  1.13it/s] 40%|███▉      | 19/48 [00:19<00:25,  1.12it/s] 38%|███▊      | 18/48 [00:20<00:26,  1.12it/s] 42%|████▏     | 20/48 [00:20<00:25,  1.10it/s] 40%|███▉      | 19/48 [00:20<00:25,  1.12it/s] 44%|████▍     | 21/48 [00:21<00:24,  1.08it/s] 42%|████▏     | 20/48 [00:21<00:25,  1.08it/s] 46%|████▌     | 22/48 [00:22<00:23,  1.09it/s] 44%|████▍     | 21/48 [00:22<00:25,  1.06it/s] 48%|████▊     | 23/48 [00:23<00:22,  1.09it/s] 46%|████▌     | 22/48 [00:23<00:24,  1.08it/s] 50%|█████     | 24/48 [00:24<00:21,  1.09it/s] 48%|████▊     | 23/48 [00:24<00:22,  1.11it/s] 52%|█████▏    | 25/48 [00:25<00:20,  1.10it/s] 50%|█████     | 24/48 [00:25<00:21,  1.11it/s] 54%|█████▍    | 26/48 [00:26<00:20,  1.09it/s] 52%|█████▏    | 25/48 [00:26<00:20,  1.12it/s] 56%|█████▋    | 27/48 [00:27<00:19,  1.10it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.09it/s] 58%|█████▊    | 28/48 [00:28<00:18,  1.10it/s] 56%|█████▋    | 27/48 [00:28<00:18,  1.11it/s] 60%|██████    | 29/48 [00:29<00:17,  1.09it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.10it/s] 62%|██████▎   | 30/48 [00:30<00:16,  1.07it/s] 60%|██████    | 29/48 [00:30<00:17,  1.10it/s] 65%|██████▍   | 31/48 [00:31<00:15,  1.07it/s] 62%|██████▎   | 30/48 [00:31<00:17,  1.03it/s] 67%|██████▋   | 32/48 [00:31<00:14,  1.10it/s] 65%|██████▍   | 31/48 [00:32<00:15,  1.08it/s] 69%|██████▉   | 33/48 [00:32<00:12,  1.16it/s] 67%|██████▋   | 32/48 [00:32<00:13,  1.16it/s] 71%|███████   | 34/48 [00:33<00:12,  1.14it/s] 69%|██████▉   | 33/48 [00:33<00:13,  1.12it/s] 73%|███████▎  | 35/48 [00:34<00:11,  1.13it/s] 71%|███████   | 34/48 [00:34<00:12,  1.14it/s] 75%|███████▌  | 36/48 [00:35<00:10,  1.13it/s] 73%|███████▎  | 35/48 [00:35<00:11,  1.13it/s] 77%|███████▋  | 37/48 [00:36<00:10,  1.08it/s] 75%|███████▌  | 36/48 [00:36<00:10,  1.09it/s] 79%|███████▉  | 38/48 [00:37<00:09,  1.10it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.09it/s] 81%|████████▏ | 39/48 [00:38<00:08,  1.10it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.11it/s] 83%|████████▎ | 40/48 [00:39<00:07,  1.09it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.10it/s] 85%|████████▌ | 41/48 [00:39<00:06,  1.10it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.10it/s] 88%|████████▊ | 42/48 [00:40<00:05,  1.09it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.09it/s] 90%|████████▉ | 43/48 [00:41<00:04,  1.06it/s] 88%|████████▊ | 42/48 [00:41<00:05,  1.08it/s] 92%|█████████▏| 44/48 [00:42<00:03,  1.08it/s] 90%|████████▉ | 43/48 [00:42<00:04,  1.08it/s] 94%|█████████▍| 45/48 [00:43<00:02,  1.09it/s] 92%|█████████▏| 44/48 [00:43<00:03,  1.07it/s] 96%|█████████▌| 46/48 [00:44<00:01,  1.08it/s] 94%|█████████▍| 45/48 [00:44<00:02,  1.06it/s] 98%|█████████▊| 47/48 [00:45<00:00,  1.07it/s] 96%|█████████▌| 46/48 [00:45<00:01,  1.00it/s]100%|██████████| 48/48 [00:46<00:00,  1.04it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:46<00:00,  1.04it/s]100%|██████████| 48/48 [00:46<00:00,  1.03it/s]
 98%|█████████▊| 47/48 [00:46<00:00,  1.13it/s]100%|██████████| 48/48 [00:46<00:00,  1.34it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:46<00:00,  1.34it/s]100%|██████████| 48/48 [00:46<00:00,  1.02it/s]
[INFO][12:59:10]: [Client #48] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_48_3536584.pth.
{'train_runtime': 46.648, 'train_samples_per_second': 129.78, 'train_steps_per_second': 1.029, 'train_loss': 2.6786416371663413, 'epoch': 3.0}
[INFO][12:59:10]: [Client #19] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_19_3536585.pth.
{'train_runtime': 46.9458, 'train_samples_per_second': 128.957, 'train_steps_per_second': 1.022, 'train_loss': 2.6603407859802246, 'epoch': 3.0}
[INFO][12:59:11]: [Client #48] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_48_3536584.pth.
[INFO][12:59:11]: [Client #48] Model trained.
[INFO][12:59:11]: [Client #48] Inbound data has been processed.
[INFO][12:59:11]: [Client #48] Outbound data is ready to be sent after being processed.
[INFO][12:59:11]: [Client #19] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_19_3536585.pth.
[INFO][12:59:12]: [Client #19] Model trained.
[INFO][12:59:12]: [Client #19] Inbound data has been processed.
[INFO][12:59:12]: [Client #19] Outbound data is ready to be sent after being processed.
[INFO][12:59:19]: [Client #19] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:59:20]: [Server #3536466] Received 507.38 MB of payload data from client #19 (simulated).
[INFO][12:59:21]: [Client #48] Sent 507.38 MB of payload data to the server (simulated).
[INFO][12:59:22]: [Server #3536466] Received 507.38 MB of payload data from client #48 (simulated).
[INFO][12:59:22]: [Server #3536466] Selecting client #2 for training.
[INFO][12:59:22]: [Server #3536466] Sending the current model to client #2 (simulated).
[INFO][12:59:26]: [Server #3536466] Sending 507.38 MB of payload data to client #2 (simulated).
[INFO][12:59:26]: [Server #3536466] Selecting client #43 for training.
[INFO][12:59:26]: [Server #3536466] Sending the current model to client #43 (simulated).
[INFO][12:59:31]: [Server #3536466] Sending 507.38 MB of payload data to client #43 (simulated).
[INFO][12:59:31]: [Client #43] Selected by the server.
[INFO][12:59:31]: [Client #43] Loading its data source...
[INFO][12:59:31]: [Client #2] Selected by the server.
[INFO][12:59:31]: [Client #2] Loading its data source...
[INFO][12:59:31]: [Client #43] Dataset size: 2018
[INFO][12:59:31]: [Client #43] Sampler: iid
[INFO][12:59:31]: [Client #2] Dataset size: 2018
[INFO][12:59:31]: [Client #2] Sampler: iid
[INFO][12:59:32]: [Client #2] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:59:32]: [Client #2] Start to process inbound data.
[INFO][12:59:32]: [Client #43] Received 507.38 MB of payload data from the server (simulated).
[INFO][12:59:32]: [Client #43] Start to process inbound data.
[INFO][12:59:33]: [93m[1m[Client #43] Started training in communication round #84.[0m
[INFO][12:59:33]: [93m[1m[Client #2] Started training in communication round #84.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:34,  4.56s/it]  2%|▏         | 1/48 [00:04<03:35,  4.59s/it]  4%|▍         | 2/48 [00:05<01:44,  2.28s/it]  4%|▍         | 2/48 [00:05<01:48,  2.36s/it]  6%|▋         | 3/48 [00:05<01:10,  1.57s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it]  8%|▊         | 4/48 [00:06<00:54,  1.23s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it] 10%|█         | 5/48 [00:07<00:45,  1.05s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:39,  1.05it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:27,  1.29it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.29it/s] 31%|███▏      | 15/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.29it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.34it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.32it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.33it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.34it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.33it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.32it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.34it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.34it/s] 71%|███████   | 34/48 [00:29<00:10,  1.34it/s] 71%|███████   | 34/48 [00:29<00:10,  1.34it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.29it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.31it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.31it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.31it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][13:00:19]: [Client #2] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
{'train_runtime': 39.6689, 'train_samples_per_second': 152.613, 'train_steps_per_second': 1.21, 'train_loss': 2.688903490702311, 'epoch': 3.0}
[INFO][13:00:20]: [Client #43] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536585.pth.
{'train_runtime': 39.6335, 'train_samples_per_second': 152.75, 'train_steps_per_second': 1.211, 'train_loss': 2.3723986943562827, 'epoch': 3.0}
[INFO][13:00:20]: [Client #2] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
[INFO][13:00:20]: [Client #2] Model trained.
[INFO][13:00:20]: [Client #2] Inbound data has been processed.
[INFO][13:00:20]: [Client #2] Outbound data is ready to be sent after being processed.
[INFO][13:00:21]: [Client #43] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536585.pth.
[INFO][13:00:21]: [Client #43] Model trained.
[INFO][13:00:21]: [Client #43] Inbound data has been processed.
[INFO][13:00:21]: [Client #43] Outbound data is ready to be sent after being processed.
[INFO][13:00:27]: [Client #2] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:00:29]: [Client #43] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:00:29]: [Server #3536466] Received 507.38 MB of payload data from client #2 (simulated).
[INFO][13:00:30]: [Server #3536466] Received 507.38 MB of payload data from client #43 (simulated).
[INFO][13:00:30]: [Server #3536466] Selecting client #93 for training.
[INFO][13:00:30]: [Server #3536466] Sending the current model to client #93 (simulated).
[INFO][13:00:35]: [Server #3536466] Sending 507.38 MB of payload data to client #93 (simulated).
[INFO][13:00:35]: [Client #93] Selected by the server.
[INFO][13:00:35]: [Client #93] Loading its data source...
[INFO][13:00:35]: [Client #93] Dataset size: 2018
[INFO][13:00:35]: [Client #93] Sampler: iid
[INFO][13:00:36]: [Client #93] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:00:36]: [Client #93] Start to process inbound data.
[INFO][13:00:36]: [93m[1m[Client #93] Started training in communication round #84.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:27,  4.41s/it]  4%|▍         | 2/48 [00:04<01:36,  2.10s/it]  6%|▋         | 3/48 [00:05<01:01,  1.36s/it]  8%|▊         | 4/48 [00:05<00:44,  1.01s/it] 10%|█         | 5/48 [00:06<00:35,  1.22it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.42it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.58it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.71it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.86it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.91it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.94it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.97it/s] 29%|██▉       | 14/48 [00:10<00:17,  1.99it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.00it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.11it/s] 35%|███▌      | 17/48 [00:12<00:14,  2.08it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.07it/s] 40%|███▉      | 19/48 [00:13<00:14,  2.06it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.05it/s] 44%|████▍     | 21/48 [00:14<00:13,  2.06it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.06it/s] 48%|████▊     | 23/48 [00:15<00:12,  2.06it/s] 50%|█████     | 24/48 [00:15<00:11,  2.06it/s] 52%|█████▏    | 25/48 [00:16<00:11,  2.06it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.06it/s] 56%|█████▋    | 27/48 [00:17<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.06it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.11it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:24<00:02,  2.06it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.06it/s] 92%|█████████▏| 44/48 [00:25<00:01,  2.06it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.06it/s] 96%|█████████▌| 46/48 [00:26<00:00,  2.06it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:27<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:27<00:00,  2.17it/s]100%|██████████| 48/48 [00:27<00:00,  1.78it/s]
[INFO][13:01:09]: [Client #93] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_93_3536584.pth.
{'train_runtime': 27.0355, 'train_samples_per_second': 223.927, 'train_steps_per_second': 1.775, 'train_loss': 2.657624880472819, 'epoch': 3.0}
[INFO][13:01:10]: [Client #93] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_93_3536584.pth.
[INFO][13:01:11]: [Client #93] Model trained.
[INFO][13:01:11]: [Client #93] Inbound data has been processed.
[INFO][13:01:11]: [Client #93] Outbound data is ready to be sent after being processed.
[INFO][13:01:15]: [Client #93] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:01:17]: [Server #3536466] Received 507.38 MB of payload data from client #93 (simulated).
[INFO][13:01:17]: [Server #3536466] Adding client #46 to the list of clients for aggregation.
[INFO][13:01:17]: [Server #3536466] Adding client #7 to the list of clients for aggregation.
[INFO][13:01:17]: [Server #3536466] Adding client #69 to the list of clients for aggregation.
[INFO][13:01:17]: [Server #3536466] Adding client #81 to the list of clients for aggregation.
[INFO][13:01:17]: [Server #3536466] Adding client #8 to the list of clients for aggregation.
[INFO][13:01:17]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:01:17]: [Server #3536466] Updated weights have been received.
[INFO][13:01:18]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:01:18]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:01:18]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0705e+00  1e+02  1e+00  1e+00
 1:  2.9941e+00  2.0905e+00  3e+00  2e-02  2e-02
 2:  3.0761e+00  2.3887e+00  7e-01  3e-06  4e-07
 3:  3.0756e+00  3.0632e+00  1e-02  6e-08  7e-09
 4:  3.0739e+00  3.0700e+00  4e-03  9e-08  1e-08
 5:  3.0723e+00  3.0690e+00  3e-03  1e-06  8e-07
 6:  3.0716e+00  3.0701e+00  1e-03  5e-07  4e-07
 7:  3.0707e+00  3.0702e+00  5e-04  2e-06  2e-06
 8:  3.0703e+00  3.0702e+00  4e-05  1e-06  9e-07
 9:  3.0702e+00  3.0702e+00  2e-06  6e-08  5e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 1.1 1.1 2.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 0.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.29it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.36it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.99it/s]100%|██████████| 8/8 [00:00<00:00, 11.79it/s]
[INFO][13:01:29]: [93m[1m[Server #3536466] Global model perplexity: 23.15
[0m
[INFO][13:01:29]: [Server #3536466] All client reports have been processed.
[INFO][13:01:29]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_84.pth.
[INFO][13:01:32]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_84.pth.
[INFO][13:01:32]: [93m[1m
[Server #3536466] Starting round 85/100.[0m
[INFO][13:01:32]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.37975089e-02, 2.37975089e-02, 2.18133437e-05, 2.37975089e-02,
       2.37975089e-02, 2.37975089e-02, 2.18133437e-05, 2.37975089e-02,
       2.37975089e-02, 1.19918132e-06, 2.18133437e-05, 2.37975089e-02,
       2.37975089e-02, 2.18133437e-05, 2.37975089e-02, 2.37975089e-02,
       2.37975089e-02, 5.86746144e-06, 2.37975089e-02, 6.96819462e-07,
       2.37975089e-02, 6.96819462e-07, 6.96819462e-07, 6.96819462e-07,
       2.37975089e-02, 2.18133437e-05, 2.41323224e-06, 2.18133437e-05,
       6.96819462e-07, 2.18133437e-05, 2.37975089e-02, 2.18133437e-05,
       2.18133437e-05, 2.18133437e-05, 2.37975089e-02, 2.18133437e-05,
       6.96819462e-07, 1.19918132e-06, 2.37975089e-02, 2.37975089e-02,
       1.19918132e-06, 2.37975089e-02, 2.37975089e-02, 2.41323224e-06,
       1.19918132e-06, 6.96819462e-07, 6.96819462e-07, 1.19918132e-06,
       2.37975089e-02, 2.37975089e-02, 2.37975089e-02, 6.96819462e-07,
       2.37975089e-02, 6.96819462e-07, 2.37975089e-02, 2.37975089e-02,
       2.37975089e-02, 2.37975089e-02, 5.86746144e-06, 1.19918132e-06,
       5.86746144e-06, 2.37975089e-02, 5.86746144e-06, 2.18133437e-05,
       2.37975089e-02, 2.37975089e-02, 2.37975089e-02, 5.86746144e-06,
       6.96819462e-07, 2.18133437e-05, 5.86746144e-06, 2.37975089e-02,
       2.37975089e-02, 2.37975089e-02, 2.18133437e-05, 2.37975089e-02,
       2.37975089e-02, 2.18133437e-05, 6.96819462e-07, 2.41323224e-06,
       2.37975089e-02, 6.96819462e-07, 6.96819462e-07, 2.37975089e-02,
       2.37975089e-02, 6.96819462e-07, 2.18133437e-05, 5.86746144e-06,
       2.18133437e-05, 2.18133437e-05, 2.18133437e-05, 2.37975089e-02,
       1.19918132e-06, 1.19918132e-06, 2.18133437e-05]),)
[INFO][13:01:33]: [Server #3536466] Selected clients: [ 7 62 46 71 10]
[INFO][13:01:33]: [Server #3536466] Selecting client #62 for training.
[INFO][13:01:33]: [Server #3536466] Sending the current model to client #62 (simulated).
[INFO][13:01:37]: [Server #3536466] Sending 507.38 MB of payload data to client #62 (simulated).
[INFO][13:01:37]: [Server #3536466] Selecting client #7 for training.
[INFO][13:01:37]: [Server #3536466] Sending the current model to client #7 (simulated).
[INFO][13:01:42]: [Server #3536466] Sending 507.38 MB of payload data to client #7 (simulated).
[INFO][13:01:42]: [Client #62] Selected by the server.
[INFO][13:01:42]: [Client #62] Loading its data source...
[INFO][13:01:42]: [Client #62] Dataset size: 2018
[INFO][13:01:42]: [Client #62] Sampler: iid
[INFO][13:01:42]: [Client #7] Selected by the server.
[INFO][13:01:42]: [Client #7] Loading its data source...
[INFO][13:01:42]: [Client #7] Dataset size: 2018
[INFO][13:01:42]: [Client #7] Sampler: iid
[INFO][13:01:44]: [Client #7] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:01:44]: [Client #7] Start to process inbound data.
[INFO][13:01:44]: [Client #62] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:01:44]: [Client #62] Start to process inbound data.
[INFO][13:01:44]: [93m[1m[Client #62] Started training in communication round #85.[0m
[INFO][13:01:44]: [93m[1m[Client #7] Started training in communication round #85.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:15,  4.16s/it]  2%|▏         | 1/48 [00:04<03:43,  4.75s/it]  4%|▍         | 2/48 [00:04<01:38,  2.14s/it]  4%|▍         | 2/48 [00:05<01:50,  2.41s/it]  6%|▋         | 3/48 [00:05<01:07,  1.50s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.42it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:32<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:35<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.31it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s]100%|██████████| 48/48 [00:38<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.36it/s]100%|██████████| 48/48 [00:38<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][13:02:30]: [Client #62] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_62_3536584.pth.
{'train_runtime': 38.9331, 'train_samples_per_second': 155.497, 'train_steps_per_second': 1.233, 'train_loss': 2.655946413675944, 'epoch': 3.0}
[INFO][13:02:30]: [Client #7] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536585.pth.
{'train_runtime': 39.3034, 'train_samples_per_second': 154.033, 'train_steps_per_second': 1.221, 'train_loss': 2.271064122517904, 'epoch': 3.0}
[INFO][13:02:31]: [Client #62] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_62_3536584.pth.
[INFO][13:02:31]: [Client #7] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536585.pth.
[INFO][13:02:31]: [Client #62] Model trained.
[INFO][13:02:31]: [Client #62] Inbound data has been processed.
[INFO][13:02:31]: [Client #62] Outbound data is ready to be sent after being processed.
[INFO][13:02:32]: [Client #7] Model trained.
[INFO][13:02:32]: [Client #7] Inbound data has been processed.
[INFO][13:02:32]: [Client #7] Outbound data is ready to be sent after being processed.
[INFO][13:02:40]: [Client #62] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:02:41]: [Client #7] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:02:41]: [Server #3536466] Received 507.38 MB of payload data from client #62 (simulated).
[INFO][13:02:42]: [Server #3536466] Received 507.38 MB of payload data from client #7 (simulated).
[INFO][13:02:42]: [Server #3536466] Selecting client #10 for training.
[INFO][13:02:42]: [Server #3536466] Sending the current model to client #10 (simulated).
[INFO][13:02:47]: [Server #3536466] Sending 507.38 MB of payload data to client #10 (simulated).
[INFO][13:02:47]: [Server #3536466] Selecting client #71 for training.
[INFO][13:02:47]: [Server #3536466] Sending the current model to client #71 (simulated).
[INFO][13:02:52]: [Server #3536466] Sending 507.38 MB of payload data to client #71 (simulated).
[INFO][13:02:52]: [Client #71] Selected by the server.
[INFO][13:02:52]: [Client #71] Loading its data source...
[INFO][13:02:52]: [Client #71] Dataset size: 2018
[INFO][13:02:52]: [Client #71] Sampler: iid
[INFO][13:02:52]: [Client #10] Selected by the server.
[INFO][13:02:52]: [Client #10] Loading its data source...
[INFO][13:02:52]: [Client #10] Dataset size: 2018
[INFO][13:02:52]: [Client #10] Sampler: iid
[INFO][13:02:53]: [Client #10] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:02:53]: [Client #10] Start to process inbound data.
[INFO][13:02:53]: [Client #71] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:02:53]: [Client #71] Start to process inbound data.
[INFO][13:02:54]: [93m[1m[Client #10] Started training in communication round #85.[0m
[INFO][13:02:54]: [93m[1m[Client #71] Started training in communication round #85.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:42,  4.72s/it]  2%|▏         | 1/48 [00:04<03:46,  4.82s/it]  4%|▍         | 2/48 [00:05<01:49,  2.39s/it]  4%|▍         | 2/48 [00:05<01:50,  2.41s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it]  8%|▊         | 4/48 [00:07<00:56,  1.28s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 71%|███████   | 34/48 [00:29<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.41it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.41it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][13:03:40]: [Client #71] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_71_3536585.pth.
{'train_runtime': 39.5166, 'train_samples_per_second': 153.201, 'train_steps_per_second': 1.215, 'train_loss': 2.44753090540568, 'epoch': 3.0}
[INFO][13:03:40]: [Client #10] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
{'train_runtime': 39.4969, 'train_samples_per_second': 153.278, 'train_steps_per_second': 1.215, 'train_loss': 2.637498378753662, 'epoch': 3.0}
[INFO][13:03:41]: [Client #71] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_71_3536585.pth.
[INFO][13:03:41]: [Client #10] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
[INFO][13:03:42]: [Client #71] Model trained.
[INFO][13:03:42]: [Client #71] Inbound data has been processed.
[INFO][13:03:42]: [Client #71] Outbound data is ready to be sent after being processed.
[INFO][13:03:42]: [Client #10] Model trained.
[INFO][13:03:42]: [Client #10] Inbound data has been processed.
[INFO][13:03:42]: [Client #10] Outbound data is ready to be sent after being processed.
[INFO][13:03:50]: [Client #71] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:03:50]: [Client #10] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:03:51]: [Server #3536466] Received 507.38 MB of payload data from client #71 (simulated).
[INFO][13:03:52]: [Server #3536466] Received 507.38 MB of payload data from client #10 (simulated).
[INFO][13:03:52]: [Server #3536466] Selecting client #46 for training.
[INFO][13:03:52]: [Server #3536466] Sending the current model to client #46 (simulated).
[INFO][13:03:56]: [Server #3536466] Sending 507.38 MB of payload data to client #46 (simulated).
[INFO][13:03:56]: [Client #46] Selected by the server.
[INFO][13:03:56]: [Client #46] Loading its data source...
[INFO][13:03:56]: [Client #46] Dataset size: 2018
[INFO][13:03:56]: [Client #46] Sampler: iid
[INFO][13:03:58]: [Client #46] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:03:58]: [Client #46] Start to process inbound data.
[INFO][13:03:58]: [93m[1m[Client #46] Started training in communication round #85.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:20,  4.27s/it]  4%|▍         | 2/48 [00:04<01:33,  2.04s/it]  6%|▋         | 3/48 [00:05<00:59,  1.33s/it]  8%|▊         | 4/48 [00:05<00:43,  1.00it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.12it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.09it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.07it/s] 40%|███▉      | 19/48 [00:12<00:14,  2.06it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.06it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.05it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.04it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.04it/s] 50%|█████     | 24/48 [00:15<00:11,  2.04it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.04it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.05it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.05it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.06it/s] 60%|██████    | 29/48 [00:17<00:09,  2.06it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.06it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.06it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.13it/s] 71%|███████   | 34/48 [00:20<00:06,  2.11it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.07it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:24<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:25<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.06it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][13:04:31]: [Client #46] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
{'train_runtime': 26.8696, 'train_samples_per_second': 225.311, 'train_steps_per_second': 1.786, 'train_loss': 2.573685646057129, 'epoch': 3.0}
[INFO][13:04:32]: [Client #46] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
[INFO][13:04:33]: [Client #46] Model trained.
[INFO][13:04:33]: [Client #46] Inbound data has been processed.
[INFO][13:04:33]: [Client #46] Outbound data is ready to be sent after being processed.
[INFO][13:04:38]: [Client #46] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:04:39]: [Server #3536466] Received 507.38 MB of payload data from client #46 (simulated).
[INFO][13:04:39]: [Server #3536466] Adding client #43 to the list of clients for aggregation.
[INFO][13:04:39]: [Server #3536466] Adding client #48 to the list of clients for aggregation.
[INFO][13:04:39]: [Server #3536466] Adding client #2 to the list of clients for aggregation.
[INFO][13:04:39]: [Server #3536466] Adding client #10 to the list of clients for aggregation.
[INFO][13:04:39]: [Server #3536466] Adding client #46 to the list of clients for aggregation.
[INFO][13:04:39]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:04:39]: [Server #3536466] Updated weights have been received.
[INFO][13:04:39]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:04:40]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:04:40]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0638e+00  1e+02  1e+00  1e+00
 1:  2.9867e+00  2.0838e+00  3e+00  2e-02  2e-02
 2:  3.0693e+00  2.3800e+00  7e-01  3e-06  4e-07
 3:  3.0689e+00  3.0576e+00  1e-02  5e-08  6e-09
 4:  3.0668e+00  3.0644e+00  2e-03  1e-07  2e-08
 5:  3.0646e+00  3.0645e+00  1e-04  7e-07  1e-07
 6:  3.0645e+00  3.0645e+00  3e-06  2e-08  3e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 1.1 1.1 2.1 1.1 0.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 0.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.82it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.43it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.04it/s]100%|██████████| 8/8 [00:00<00:00, 11.80it/s]
[INFO][13:04:51]: [93m[1m[Server #3536466] Global model perplexity: 23.01
[0m
[INFO][13:04:51]: [Server #3536466] All client reports have been processed.
[INFO][13:04:51]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_85.pth.
[INFO][13:04:54]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_85.pth.
[INFO][13:04:54]: [93m[1m
[Server #3536466] Starting round 86/100.[0m
[INFO][13:04:54]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([4.39498401e-06, 4.39498401e-06, 4.39498401e-06, 3.95349901e-07,
       4.39498401e-06, 4.39498401e-06, 3.95349901e-07, 4.39498401e-06,
       4.99907186e-01, 4.21526490e-08, 3.95349901e-07, 4.39498401e-06,
       4.39498401e-06, 3.95349901e-07, 4.39498401e-06, 4.39498401e-06,
       4.39498401e-06, 1.35481108e-07, 4.39498401e-06, 2.85327841e-08,
       4.39498401e-06, 2.85327841e-08, 2.85327841e-08, 2.85327841e-08,
       4.39498401e-06, 3.95349901e-07, 6.90301715e-08, 3.95349901e-07,
       2.85327841e-08, 3.95349901e-07, 4.39498401e-06, 3.95349901e-07,
       3.95349901e-07, 3.95349901e-07, 4.39498401e-06, 3.95349901e-07,
       2.85327841e-08, 4.21526490e-08, 4.39498401e-06, 4.39498401e-06,
       4.39498401e-06, 4.21526490e-08, 4.39498401e-06, 4.99907186e-01,
       6.90301715e-08, 4.39498401e-06, 4.21526490e-08, 2.85327841e-08,
       2.85327841e-08, 4.21526490e-08, 4.39498401e-06, 4.39498401e-06,
       4.39498401e-06, 2.85327841e-08, 4.39498401e-06, 2.85327841e-08,
       4.39498401e-06, 4.39498401e-06, 4.39498401e-06, 1.35481108e-07,
       4.21526490e-08, 1.35481108e-07, 4.39498401e-06, 1.35481108e-07,
       3.95349901e-07, 4.39498401e-06, 4.39498401e-06, 1.35481108e-07,
       2.85327841e-08, 3.95349901e-07, 1.35481108e-07, 4.39498401e-06,
       4.39498401e-06, 4.39498401e-06, 3.95349901e-07, 4.39498401e-06,
       4.39498401e-06, 3.95349901e-07, 2.85327841e-08, 6.90301715e-08,
       4.39498401e-06, 2.85327841e-08, 2.85327841e-08, 4.39498401e-06,
       4.39498401e-06, 2.85327841e-08, 3.95349901e-07, 1.35481108e-07,
       3.95349901e-07, 3.95349901e-07, 3.95349901e-07, 4.39498401e-06,
       4.21526490e-08, 4.21526490e-08, 3.95349901e-07]),)
[INFO][13:04:54]: [Server #3536466] Selected clients: [10 46 21 16  1]
[INFO][13:04:54]: [Server #3536466] Selecting client #16 for training.
[INFO][13:04:54]: [Server #3536466] Sending the current model to client #16 (simulated).
[INFO][13:04:59]: [Server #3536466] Sending 507.38 MB of payload data to client #16 (simulated).
[INFO][13:04:59]: [Server #3536466] Selecting client #1 for training.
[INFO][13:04:59]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][13:05:04]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][13:05:04]: [Client #16] Selected by the server.
[INFO][13:05:04]: [Client #16] Loading its data source...
[INFO][13:05:04]: [Client #1] Selected by the server.
[INFO][13:05:04]: [Client #1] Loading its data source...
[INFO][13:05:04]: [Client #16] Dataset size: 2018
[INFO][13:05:04]: [Client #16] Sampler: iid
[INFO][13:05:04]: [Client #1] Dataset size: 2018
[INFO][13:05:04]: [Client #1] Sampler: iid
[INFO][13:05:05]: [Client #16] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:05:05]: [Client #16] Start to process inbound data.
[INFO][13:05:05]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:05:05]: [Client #1] Start to process inbound data.
[INFO][13:05:06]: [93m[1m[Client #1] Started training in communication round #86.[0m
[INFO][13:05:06]: [93m[1m[Client #16] Started training in communication round #86.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.23s/it]  2%|▏         | 1/48 [00:04<03:46,  4.83s/it]  4%|▍         | 2/48 [00:04<01:39,  2.16s/it]  4%|▍         | 2/48 [00:05<01:50,  2.41s/it]  6%|▋         | 3/48 [00:05<01:08,  1.51s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.06it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.34it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.34it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.42it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.31it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][13:05:51]: [Client #16] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_16_3536584.pth.
{'train_runtime': 39.0385, 'train_samples_per_second': 155.078, 'train_steps_per_second': 1.23, 'train_loss': 2.68743101755778, 'epoch': 3.0}
[INFO][13:05:52]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 39.3859, 'train_samples_per_second': 153.71, 'train_steps_per_second': 1.219, 'train_loss': 2.1762213706970215, 'epoch': 3.0}
[INFO][13:05:52]: [Client #16] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_16_3536584.pth.
[INFO][13:05:53]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][13:05:53]: [Client #16] Model trained.
[INFO][13:05:53]: [Client #16] Inbound data has been processed.
[INFO][13:05:53]: [Client #16] Outbound data is ready to be sent after being processed.
[INFO][13:05:53]: [Client #1] Model trained.
[INFO][13:05:53]: [Client #1] Inbound data has been processed.
[INFO][13:05:53]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][13:06:01]: [Client #16] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:06:01]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:06:02]: [Server #3536466] Received 507.38 MB of payload data from client #16 (simulated).
[INFO][13:06:03]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][13:06:03]: [Server #3536466] Selecting client #10 for training.
[INFO][13:06:03]: [Server #3536466] Sending the current model to client #10 (simulated).
[INFO][13:06:07]: [Server #3536466] Sending 507.38 MB of payload data to client #10 (simulated).
[INFO][13:06:07]: [Server #3536466] Selecting client #21 for training.
[INFO][13:06:07]: [Server #3536466] Sending the current model to client #21 (simulated).
[INFO][13:06:12]: [Server #3536466] Sending 507.38 MB of payload data to client #21 (simulated).
[INFO][13:06:12]: [Client #10] Selected by the server.
[INFO][13:06:12]: [Client #10] Loading its data source...
[INFO][13:06:12]: [Client #21] Selected by the server.
[INFO][13:06:12]: [Client #10] Dataset size: 2018
[INFO][13:06:12]: [Client #21] Loading its data source...
[INFO][13:06:12]: [Client #10] Sampler: iid
[INFO][13:06:12]: [Client #21] Dataset size: 2018
[INFO][13:06:12]: [Client #21] Sampler: iid
[INFO][13:06:13]: [Client #10] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:06:13]: [Client #10] Start to process inbound data.
[INFO][13:06:13]: [Client #21] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:06:13]: [Client #21] Start to process inbound data.
[INFO][13:06:14]: [93m[1m[Client #21] Started training in communication round #86.[0m
[INFO][13:06:14]: [93m[1m[Client #10] Started training in communication round #86.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:40,  4.70s/it]  2%|▏         | 1/48 [00:04<03:48,  4.86s/it]  4%|▍         | 2/48 [00:05<01:48,  2.37s/it]  4%|▍         | 2/48 [00:05<01:51,  2.43s/it]  6%|▋         | 3/48 [00:06<01:13,  1.63s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it]  8%|▊         | 4/48 [00:07<00:57,  1.30s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.33it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.31it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.32it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.32it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.32it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.32it/s] 50%|█████     | 24/48 [00:21<00:17,  1.33it/s] 50%|█████     | 24/48 [00:21<00:18,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.31it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.31it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][13:07:00]: [Client #10] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
{'train_runtime': 39.7393, 'train_samples_per_second': 152.343, 'train_steps_per_second': 1.208, 'train_loss': 2.4906787872314453, 'epoch': 3.0}
[INFO][13:07:01]: [Client #21] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_21_3536585.pth.
{'train_runtime': 39.6253, 'train_samples_per_second': 152.781, 'train_steps_per_second': 1.211, 'train_loss': 2.4819119771321616, 'epoch': 3.0}
[INFO][13:07:01]: [Client #10] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
[INFO][13:07:02]: [Client #21] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_21_3536585.pth.
[INFO][13:07:02]: [Client #10] Model trained.
[INFO][13:07:02]: [Client #10] Inbound data has been processed.
[INFO][13:07:02]: [Client #10] Outbound data is ready to be sent after being processed.
[INFO][13:07:02]: [Client #21] Model trained.
[INFO][13:07:02]: [Client #21] Inbound data has been processed.
[INFO][13:07:02]: [Client #21] Outbound data is ready to be sent after being processed.
[INFO][13:07:10]: [Client #10] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:07:11]: [Client #21] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:07:11]: [Server #3536466] Received 507.38 MB of payload data from client #10 (simulated).
[INFO][13:07:13]: [Server #3536466] Received 507.38 MB of payload data from client #21 (simulated).
[INFO][13:07:13]: [Server #3536466] Selecting client #46 for training.
[INFO][13:07:13]: [Server #3536466] Sending the current model to client #46 (simulated).
[INFO][13:07:17]: [Server #3536466] Sending 507.38 MB of payload data to client #46 (simulated).
[INFO][13:07:17]: [Client #46] Selected by the server.
[INFO][13:07:17]: [Client #46] Loading its data source...
[INFO][13:07:17]: [Client #46] Dataset size: 2018
[INFO][13:07:17]: [Client #46] Sampler: iid
[INFO][13:07:19]: [Client #46] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:07:19]: [Client #46] Start to process inbound data.
[INFO][13:07:19]: [93m[1m[Client #46] Started training in communication round #86.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.20s/it]  4%|▍         | 2/48 [00:04<01:32,  2.01s/it]  6%|▋         | 3/48 [00:05<00:59,  1.31s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:15<00:11,  2.09it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.06it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.06it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.06it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.05it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.05it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.05it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.05it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.05it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.05it/s]100%|██████████| 48/48 [00:26<00:00,  2.15it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.15it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][13:07:52]: [Client #46] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
{'train_runtime': 26.715, 'train_samples_per_second': 226.614, 'train_steps_per_second': 1.797, 'train_loss': 2.4689653714497886, 'epoch': 3.0}
[INFO][13:07:53]: [Client #46] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_46_3536584.pth.
[INFO][13:07:53]: [Client #46] Model trained.
[INFO][13:07:53]: [Client #46] Inbound data has been processed.
[INFO][13:07:53]: [Client #46] Outbound data is ready to be sent after being processed.
[INFO][13:07:58]: [Client #46] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:07:59]: [Server #3536466] Received 507.38 MB of payload data from client #46 (simulated).
[INFO][13:07:59]: [Server #3536466] Adding client #62 to the list of clients for aggregation.
[INFO][13:07:59]: [Server #3536466] Adding client #71 to the list of clients for aggregation.
[INFO][13:07:59]: [Server #3536466] Adding client #7 to the list of clients for aggregation.
[INFO][13:07:59]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][13:07:59]: [Server #3536466] Adding client #10 to the list of clients for aggregation.
[INFO][13:07:59]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:07:59]: [Server #3536466] Updated weights have been received.
[INFO][13:08:00]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:08:01]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:08:01]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0616e+00  1e+02  1e+00  1e+00
 1:  2.9841e+00  2.0815e+00  3e+00  2e-02  2e-02
 2:  3.0670e+00  2.3771e+00  7e-01  3e-06  4e-07
 3:  3.0666e+00  3.0543e+00  1e-02  6e-08  7e-09
 4:  3.0649e+00  3.0610e+00  4e-03  9e-08  1e-08
 5:  3.0630e+00  3.0600e+00  3e-03  1e-06  7e-07
 6:  3.0623e+00  3.0612e+00  1e-03  5e-07  3e-07
 7:  3.0616e+00  3.0612e+00  4e-04  1e-06  8e-07
 8:  3.0612e+00  3.0612e+00  1e-05  4e-07  2e-07
 9:  3.0612e+00  3.0612e+00  2e-07  8e-09  5e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1 1.1 1.1 2.1 1.1 1.1 1.1 2.1 1.1 0.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 0.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.89it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.32it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.81it/s]100%|██████████| 8/8 [00:00<00:00, 11.60it/s]
[INFO][13:08:11]: [93m[1m[Server #3536466] Global model perplexity: 25.81
[0m
[INFO][13:08:11]: [Server #3536466] All client reports have been processed.
[INFO][13:08:12]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_86.pth.
[INFO][13:08:15]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_86.pth.
[INFO][13:08:15]: [93m[1m
[Server #3536466] Starting round 87/100.[0m
[INFO][13:08:15]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([4.99907186e-01, 4.39498401e-06, 4.39498401e-06, 3.95349901e-07,
       4.39498401e-06, 4.39498401e-06, 4.39498401e-06, 3.95349901e-07,
       4.39498401e-06, 4.99907186e-01, 4.21526490e-08, 3.95349901e-07,
       4.39498401e-06, 4.39498401e-06, 3.95349901e-07, 4.39498401e-06,
       4.39498401e-06, 1.35481108e-07, 2.85327841e-08, 4.39498401e-06,
       2.85327841e-08, 2.85327841e-08, 2.85327841e-08, 4.39498401e-06,
       3.95349901e-07, 6.90301715e-08, 3.95349901e-07, 2.85327841e-08,
       3.95349901e-07, 4.39498401e-06, 3.95349901e-07, 3.95349901e-07,
       3.95349901e-07, 4.39498401e-06, 3.95349901e-07, 2.85327841e-08,
       4.21526490e-08, 4.39498401e-06, 4.39498401e-06, 4.39498401e-06,
       4.21526490e-08, 4.39498401e-06, 6.90301715e-08, 4.39498401e-06,
       4.21526490e-08, 2.85327841e-08, 2.85327841e-08, 4.21526490e-08,
       4.39498401e-06, 4.39498401e-06, 4.39498401e-06, 2.85327841e-08,
       4.39498401e-06, 2.85327841e-08, 4.39498401e-06, 4.39498401e-06,
       4.39498401e-06, 4.39498401e-06, 1.35481108e-07, 4.21526490e-08,
       1.35481108e-07, 4.39498401e-06, 1.35481108e-07, 3.95349901e-07,
       4.39498401e-06, 4.39498401e-06, 4.39498401e-06, 1.35481108e-07,
       2.85327841e-08, 3.95349901e-07, 1.35481108e-07, 4.39498401e-06,
       4.39498401e-06, 4.39498401e-06, 3.95349901e-07, 4.39498401e-06,
       4.39498401e-06, 3.95349901e-07, 2.85327841e-08, 6.90301715e-08,
       4.39498401e-06, 2.85327841e-08, 2.85327841e-08, 4.39498401e-06,
       4.39498401e-06, 2.85327841e-08, 3.95349901e-07, 1.35481108e-07,
       3.95349901e-07, 3.95349901e-07, 3.95349901e-07, 4.39498401e-06,
       4.21526490e-08, 4.21526490e-08, 3.95349901e-07]),)
[INFO][13:08:15]: [Server #3536466] Selected clients: [ 1 10  2  7 62]
[INFO][13:08:15]: [Server #3536466] Selecting client #2 for training.
[INFO][13:08:15]: [Server #3536466] Sending the current model to client #2 (simulated).
[INFO][13:08:20]: [Server #3536466] Sending 507.38 MB of payload data to client #2 (simulated).
[INFO][13:08:20]: [Server #3536466] Selecting client #1 for training.
[INFO][13:08:20]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][13:08:25]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][13:08:25]: [Client #2] Selected by the server.
[INFO][13:08:25]: [Client #2] Loading its data source...
[INFO][13:08:25]: [Client #2] Dataset size: 2018
[INFO][13:08:25]: [Client #2] Sampler: iid
[INFO][13:08:25]: [Client #1] Selected by the server.
[INFO][13:08:25]: [Client #1] Loading its data source...
[INFO][13:08:25]: [Client #1] Dataset size: 2018
[INFO][13:08:25]: [Client #1] Sampler: iid
[INFO][13:08:26]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:08:26]: [Client #1] Start to process inbound data.
[INFO][13:08:26]: [Client #2] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:08:26]: [Client #2] Start to process inbound data.
[INFO][13:08:27]: [93m[1m[Client #2] Started training in communication round #87.[0m
[INFO][13:08:27]: [93m[1m[Client #1] Started training in communication round #87.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:16,  4.19s/it]  2%|▏         | 1/48 [00:04<03:44,  4.78s/it]  4%|▍         | 2/48 [00:04<01:38,  2.14s/it]  4%|▍         | 2/48 [00:05<01:50,  2.40s/it]  6%|▋         | 3/48 [00:05<01:07,  1.50s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.21it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:29,  1.28it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.31it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.33it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:21,  1.33it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.34it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.32it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.30it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][13:09:12]: [Client #2] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
{'train_runtime': 39.0908, 'train_samples_per_second': 154.87, 'train_steps_per_second': 1.228, 'train_loss': 2.612989584604899, 'epoch': 3.0}
[INFO][13:09:13]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 39.4444, 'train_samples_per_second': 153.482, 'train_steps_per_second': 1.217, 'train_loss': 2.056584040323893, 'epoch': 3.0}
[INFO][13:09:14]: [Client #2] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
[INFO][13:09:14]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][13:09:14]: [Client #2] Model trained.
[INFO][13:09:14]: [Client #2] Inbound data has been processed.
[INFO][13:09:14]: [Client #2] Outbound data is ready to be sent after being processed.
[INFO][13:09:15]: [Client #1] Model trained.
[INFO][13:09:15]: [Client #1] Inbound data has been processed.
[INFO][13:09:15]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][13:09:22]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:09:23]: [Client #2] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:09:23]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][13:09:24]: [Server #3536466] Received 507.38 MB of payload data from client #2 (simulated).
[INFO][13:09:24]: [Server #3536466] Selecting client #10 for training.
[INFO][13:09:24]: [Server #3536466] Sending the current model to client #10 (simulated).
[INFO][13:09:29]: [Server #3536466] Sending 507.38 MB of payload data to client #10 (simulated).
[INFO][13:09:29]: [Server #3536466] Selecting client #7 for training.
[INFO][13:09:29]: [Server #3536466] Sending the current model to client #7 (simulated).
[INFO][13:09:34]: [Server #3536466] Sending 507.38 MB of payload data to client #7 (simulated).
[INFO][13:09:34]: [Client #10] Selected by the server.
[INFO][13:09:34]: [Client #10] Loading its data source...
[INFO][13:09:34]: [Client #10] Dataset size: 2018
[INFO][13:09:34]: [Client #7] Selected by the server.
[INFO][13:09:34]: [Client #10] Sampler: iid
[INFO][13:09:34]: [Client #7] Loading its data source...
[INFO][13:09:34]: [Client #7] Dataset size: 2018
[INFO][13:09:34]: [Client #7] Sampler: iid
[INFO][13:09:35]: [Client #7] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:09:35]: [Client #7] Start to process inbound data.
[INFO][13:09:35]: [Client #10] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:09:35]: [Client #10] Start to process inbound data.
[INFO][13:09:36]: [93m[1m[Client #7] Started training in communication round #87.[0m
[INFO][13:09:36]: [93m[1m[Client #10] Started training in communication round #87.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:44,  4.78s/it]  2%|▏         | 1/48 [00:04<03:47,  4.85s/it]  4%|▍         | 2/48 [00:05<01:50,  2.40s/it]  4%|▍         | 2/48 [00:05<01:52,  2.45s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  6%|▋         | 3/48 [00:06<01:15,  1.67s/it]  8%|▊         | 4/48 [00:06<00:56,  1.29s/it]  8%|▊         | 4/48 [00:07<00:57,  1.31s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.31it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.30it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.31it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.31it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][13:10:22]: [Client #7] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536585.pth.
{'train_runtime': 39.5858, 'train_samples_per_second': 152.934, 'train_steps_per_second': 1.213, 'train_loss': 2.1923548380533853, 'epoch': 3.0}
[INFO][13:10:22]: [Client #10] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
{'train_runtime': 39.7023, 'train_samples_per_second': 152.485, 'train_steps_per_second': 1.209, 'train_loss': 2.4755261739095054, 'epoch': 3.0}
[INFO][13:10:23]: [Client #10] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
[INFO][13:10:23]: [Client #7] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536585.pth.
[INFO][13:10:24]: [Client #10] Model trained.
[INFO][13:10:24]: [Client #10] Inbound data has been processed.
[INFO][13:10:24]: [Client #10] Outbound data is ready to be sent after being processed.
[INFO][13:10:24]: [Client #7] Model trained.
[INFO][13:10:24]: [Client #7] Inbound data has been processed.
[INFO][13:10:24]: [Client #7] Outbound data is ready to be sent after being processed.
[INFO][13:10:32]: [Client #10] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:10:33]: [Server #3536466] Received 507.38 MB of payload data from client #10 (simulated).
[INFO][13:10:33]: [Client #7] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:10:35]: [Server #3536466] Received 507.38 MB of payload data from client #7 (simulated).
[INFO][13:10:35]: [Server #3536466] Selecting client #62 for training.
[INFO][13:10:35]: [Server #3536466] Sending the current model to client #62 (simulated).
[INFO][13:10:39]: [Server #3536466] Sending 507.38 MB of payload data to client #62 (simulated).
[INFO][13:10:39]: [Client #62] Selected by the server.
[INFO][13:10:39]: [Client #62] Loading its data source...
[INFO][13:10:39]: [Client #62] Dataset size: 2018
[INFO][13:10:39]: [Client #62] Sampler: iid
[INFO][13:10:41]: [Client #62] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:10:41]: [Client #62] Start to process inbound data.
[INFO][13:10:41]: [93m[1m[Client #62] Started training in communication round #87.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.33s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.02it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][13:11:14]: [Client #62] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_62_3536584.pth.
{'train_runtime': 26.679, 'train_samples_per_second': 226.92, 'train_steps_per_second': 1.799, 'train_loss': 2.5368860562642417, 'epoch': 3.0}
[INFO][13:11:15]: [Client #62] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_62_3536584.pth.
[INFO][13:11:15]: [Client #62] Model trained.
[INFO][13:11:15]: [Client #62] Inbound data has been processed.
[INFO][13:11:15]: [Client #62] Outbound data is ready to be sent after being processed.
[INFO][13:11:20]: [Client #62] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:11:21]: [Server #3536466] Received 507.38 MB of payload data from client #62 (simulated).
[INFO][13:11:21]: [Server #3536466] Adding client #21 to the list of clients for aggregation.
[INFO][13:11:21]: [Server #3536466] Adding client #46 to the list of clients for aggregation.
[INFO][13:11:21]: [Server #3536466] Adding client #16 to the list of clients for aggregation.
[INFO][13:11:21]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][13:11:21]: [Server #3536466] Adding client #10 to the list of clients for aggregation.
[INFO][13:11:21]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:11:21]: [Server #3536466] Updated weights have been received.
[INFO][13:11:22]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:11:22]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:11:22]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0616e+00  1e+02  1e+00  1e+00
 1:  2.9841e+00  2.0815e+00  3e+00  2e-02  2e-02
 2:  3.0670e+00  2.3771e+00  7e-01  3e-06  4e-07
 3:  3.0666e+00  3.0543e+00  1e-02  6e-08  7e-09
 4:  3.0649e+00  3.0610e+00  4e-03  9e-08  1e-08
 5:  3.0630e+00  3.0600e+00  3e-03  1e-06  7e-07
 6:  3.0623e+00  3.0612e+00  1e-03  5e-07  3e-07
 7:  3.0616e+00  3.0612e+00  4e-04  1e-06  8e-07
 8:  3.0612e+00  3.0612e+00  1e-05  4e-07  2e-07
 9:  3.0612e+00  3.0612e+00  2e-07  8e-09  5e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1 1.1 1.1 2.1 1.1 1.1 1.1 2.1 1.1 0.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 2.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.05it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.39it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.83it/s]100%|██████████| 8/8 [00:00<00:00, 11.61it/s]
[INFO][13:11:33]: [93m[1m[Server #3536466] Global model perplexity: 25.73
[0m
[INFO][13:11:33]: [Server #3536466] All client reports have been processed.
[INFO][13:11:33]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_87.pth.
[INFO][13:11:37]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_87.pth.
[INFO][13:11:37]: [93m[1m
[Server #3536466] Starting round 88/100.[0m
[INFO][13:11:37]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([4.99907186e-01, 4.39498401e-06, 3.95349901e-07, 4.39498401e-06,
       4.39498401e-06, 3.95349901e-07, 4.39498401e-06, 4.99907186e-01,
       4.21526490e-08, 3.95349901e-07, 4.39498401e-06, 4.39498401e-06,
       3.95349901e-07, 4.39498401e-06, 4.39498401e-06, 4.39498401e-06,
       1.35481108e-07, 4.39498401e-06, 2.85327841e-08, 4.39498401e-06,
       2.85327841e-08, 2.85327841e-08, 2.85327841e-08, 4.39498401e-06,
       3.95349901e-07, 6.90301715e-08, 3.95349901e-07, 2.85327841e-08,
       3.95349901e-07, 4.39498401e-06, 3.95349901e-07, 3.95349901e-07,
       3.95349901e-07, 4.39498401e-06, 3.95349901e-07, 2.85327841e-08,
       4.21526490e-08, 4.39498401e-06, 4.39498401e-06, 4.39498401e-06,
       4.21526490e-08, 4.39498401e-06, 4.39498401e-06, 6.90301715e-08,
       4.39498401e-06, 4.21526490e-08, 2.85327841e-08, 2.85327841e-08,
       4.21526490e-08, 4.39498401e-06, 4.39498401e-06, 4.39498401e-06,
       2.85327841e-08, 4.39498401e-06, 2.85327841e-08, 4.39498401e-06,
       4.39498401e-06, 4.39498401e-06, 1.35481108e-07, 4.21526490e-08,
       1.35481108e-07, 4.39498401e-06, 1.35481108e-07, 3.95349901e-07,
       4.39498401e-06, 4.39498401e-06, 4.39498401e-06, 1.35481108e-07,
       2.85327841e-08, 3.95349901e-07, 1.35481108e-07, 4.39498401e-06,
       4.39498401e-06, 4.39498401e-06, 3.95349901e-07, 4.39498401e-06,
       4.39498401e-06, 3.95349901e-07, 2.85327841e-08, 6.90301715e-08,
       4.39498401e-06, 2.85327841e-08, 2.85327841e-08, 4.39498401e-06,
       4.39498401e-06, 2.85327841e-08, 3.95349901e-07, 1.35481108e-07,
       3.95349901e-07, 3.95349901e-07, 3.95349901e-07, 4.39498401e-06,
       4.21526490e-08, 4.21526490e-08, 3.95349901e-07]),)
[INFO][13:11:37]: [Server #3536466] Selected clients: [ 1 10 69 88  5]
[INFO][13:11:37]: [Server #3536466] Selecting client #88 for training.
[INFO][13:11:37]: [Server #3536466] Sending the current model to client #88 (simulated).
[INFO][13:11:42]: [Server #3536466] Sending 507.38 MB of payload data to client #88 (simulated).
[INFO][13:11:42]: [Server #3536466] Selecting client #1 for training.
[INFO][13:11:42]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][13:11:47]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][13:11:47]: [Client #88] Selected by the server.
[INFO][13:11:47]: [Client #88] Loading its data source...
[INFO][13:11:47]: [Client #88] Dataset size: 2018
[INFO][13:11:47]: [Client #88] Sampler: iid
[INFO][13:11:47]: [Client #1] Selected by the server.
[INFO][13:11:47]: [Client #1] Loading its data source...
[INFO][13:11:47]: [Client #1] Dataset size: 2018
[INFO][13:11:47]: [Client #1] Sampler: iid
[INFO][13:11:48]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:11:48]: [Client #1] Start to process inbound data.
[INFO][13:11:48]: [Client #88] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:11:48]: [Client #88] Start to process inbound data.
[INFO][13:11:49]: [93m[1m[Client #1] Started training in communication round #88.[0m
[INFO][13:11:49]: [93m[1m[Client #88] Started training in communication round #88.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:46,  4.83s/it]  2%|▏         | 1/48 [00:04<03:47,  4.84s/it]  4%|▍         | 2/48 [00:05<01:53,  2.46s/it]  4%|▍         | 2/48 [00:05<01:53,  2.47s/it]  6%|▋         | 3/48 [00:06<01:16,  1.69s/it]  6%|▋         | 3/48 [00:06<01:16,  1.70s/it]  8%|▊         | 4/48 [00:07<00:58,  1.32s/it]  8%|▊         | 4/48 [00:07<00:58,  1.34s/it] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 10%|█         | 5/48 [00:07<00:48,  1.12s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.31it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][13:12:35]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 39.8147, 'train_samples_per_second': 152.054, 'train_steps_per_second': 1.206, 'train_loss': 2.0343103408813477, 'epoch': 3.0}
[INFO][13:12:35]: [Client #88] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_88_3536584.pth.
{'train_runtime': 39.7561, 'train_samples_per_second': 152.278, 'train_steps_per_second': 1.207, 'train_loss': 2.7089160283406577, 'epoch': 3.0}
[INFO][13:12:36]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][13:12:37]: [Client #88] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_88_3536584.pth.
[INFO][13:12:37]: [Client #1] Model trained.
[INFO][13:12:37]: [Client #1] Inbound data has been processed.
[INFO][13:12:37]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][13:12:37]: [Client #88] Model trained.
[INFO][13:12:37]: [Client #88] Inbound data has been processed.
[INFO][13:12:37]: [Client #88] Outbound data is ready to be sent after being processed.
[INFO][13:12:46]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:12:46]: [Client #88] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:12:47]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][13:12:47]: [Server #3536466] Received 507.38 MB of payload data from client #88 (simulated).
[INFO][13:12:47]: [Server #3536466] Selecting client #10 for training.
[INFO][13:12:47]: [Server #3536466] Sending the current model to client #10 (simulated).
[INFO][13:12:53]: [Server #3536466] Sending 507.38 MB of payload data to client #10 (simulated).
[INFO][13:12:53]: [Server #3536466] Selecting client #5 for training.
[INFO][13:12:53]: [Server #3536466] Sending the current model to client #5 (simulated).
[INFO][13:12:57]: [Server #3536466] Sending 507.38 MB of payload data to client #5 (simulated).
[INFO][13:12:57]: [Client #10] Selected by the server.
[INFO][13:12:57]: [Client #5] Selected by the server.
[INFO][13:12:57]: [Client #10] Loading its data source...
[INFO][13:12:57]: [Client #5] Loading its data source...
[INFO][13:12:57]: [Client #10] Dataset size: 2018
[INFO][13:12:57]: [Client #5] Dataset size: 2018
[INFO][13:12:57]: [Client #10] Sampler: iid
[INFO][13:12:57]: [Client #5] Sampler: iid
[INFO][13:12:59]: [Client #5] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:12:59]: [Client #5] Start to process inbound data.
[INFO][13:12:59]: [Client #10] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:12:59]: [Client #10] Start to process inbound data.
[INFO][13:13:00]: [93m[1m[Client #10] Started training in communication round #88.[0m
[INFO][13:13:00]: [93m[1m[Client #5] Started training in communication round #88.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  2%|▏         | 1/48 [00:04<03:50,  4.90s/it]  4%|▍         | 2/48 [00:04<01:39,  2.15s/it]  4%|▍         | 2/48 [00:05<01:58,  2.57s/it]  6%|▋         | 3/48 [00:05<01:12,  1.61s/it]  6%|▋         | 3/48 [00:06<01:19,  1.78s/it]  8%|▊         | 4/48 [00:06<00:57,  1.31s/it]  8%|▊         | 4/48 [00:07<01:00,  1.36s/it] 10%|█         | 5/48 [00:07<00:48,  1.12s/it] 10%|█         | 5/48 [00:08<00:48,  1.13s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.00it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.21it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:11<00:29,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.29it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.30it/s] 31%|███▏      | 15/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.36it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:21,  1.32it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.54it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.54it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
[INFO][13:13:46]: [Client #10] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
{'train_runtime': 39.5143, 'train_samples_per_second': 153.211, 'train_steps_per_second': 1.215, 'train_loss': 2.3799455960591636, 'epoch': 3.0}
[INFO][13:13:46]: [Client #5] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536585.pth.
{'train_runtime': 39.8623, 'train_samples_per_second': 151.873, 'train_steps_per_second': 1.204, 'train_loss': 2.369640827178955, 'epoch': 3.0}
[INFO][13:13:47]: [Client #10] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
[INFO][13:13:47]: [Client #5] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536585.pth.
[INFO][13:13:47]: [Client #10] Model trained.
[INFO][13:13:47]: [Client #10] Inbound data has been processed.
[INFO][13:13:47]: [Client #10] Outbound data is ready to be sent after being processed.
[INFO][13:13:48]: [Client #5] Model trained.
[INFO][13:13:48]: [Client #5] Inbound data has been processed.
[INFO][13:13:48]: [Client #5] Outbound data is ready to be sent after being processed.
[INFO][13:13:56]: [Client #10] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:13:57]: [Server #3536466] Received 507.38 MB of payload data from client #10 (simulated).
[INFO][13:13:57]: [Client #5] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:13:58]: [Server #3536466] Received 507.38 MB of payload data from client #5 (simulated).
[INFO][13:13:58]: [Server #3536466] Selecting client #69 for training.
[INFO][13:13:58]: [Server #3536466] Sending the current model to client #69 (simulated).
[INFO][13:14:03]: [Server #3536466] Sending 507.38 MB of payload data to client #69 (simulated).
[INFO][13:14:03]: [Client #69] Selected by the server.
[INFO][13:14:03]: [Client #69] Loading its data source...
[INFO][13:14:03]: [Client #69] Dataset size: 2018
[INFO][13:14:03]: [Client #69] Sampler: iid
[INFO][13:14:05]: [Client #69] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:14:05]: [Client #69] Start to process inbound data.
[INFO][13:14:05]: [93m[1m[Client #69] Started training in communication round #88.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:08,  4.00s/it]  4%|▍         | 2/48 [00:04<01:28,  1.93s/it]  6%|▋         | 3/48 [00:04<00:57,  1.27s/it]  8%|▊         | 4/48 [00:05<00:42,  1.04it/s] 10%|█         | 5/48 [00:05<00:33,  1.27it/s] 12%|█▎        | 6/48 [00:06<00:28,  1.46it/s] 15%|█▍        | 7/48 [00:06<00:25,  1.62it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:07<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:08<00:19,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:09<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:15<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:16<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:17<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:18<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.08it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.08it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.81it/s]
[INFO][13:14:38]: [Client #69] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536584.pth.
{'train_runtime': 26.4598, 'train_samples_per_second': 228.8, 'train_steps_per_second': 1.814, 'train_loss': 2.431002616882324, 'epoch': 3.0}
[INFO][13:14:39]: [Client #69] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536584.pth.
[INFO][13:14:39]: [Client #69] Model trained.
[INFO][13:14:39]: [Client #69] Inbound data has been processed.
[INFO][13:14:39]: [Client #69] Outbound data is ready to be sent after being processed.
[INFO][13:14:45]: [Client #69] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:14:46]: [Server #3536466] Received 507.38 MB of payload data from client #69 (simulated).
[INFO][13:14:46]: [Server #3536466] Adding client #62 to the list of clients for aggregation.
[INFO][13:14:46]: [Server #3536466] Adding client #2 to the list of clients for aggregation.
[INFO][13:14:46]: [Server #3536466] Adding client #7 to the list of clients for aggregation.
[INFO][13:14:46]: [Server #3536466] Adding client #19 to the list of clients for aggregation.
[INFO][13:14:46]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][13:14:46]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:14:46]: [Server #3536466] Updated weights have been received.
[INFO][13:14:46]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:14:47]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:14:47]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0616e+00  1e+02  1e+00  1e+00
 1:  2.9841e+00  2.0815e+00  3e+00  2e-02  2e-02
 2:  3.0670e+00  2.3771e+00  7e-01  3e-06  4e-07
 3:  3.0666e+00  3.0543e+00  1e-02  6e-08  7e-09
 4:  3.0649e+00  3.0610e+00  4e-03  9e-08  1e-08
 5:  3.0630e+00  3.0600e+00  3e-03  1e-06  7e-07
 6:  3.0623e+00  3.0612e+00  1e-03  5e-07  3e-07
 7:  3.0616e+00  3.0612e+00  4e-04  1e-06  8e-07
 8:  3.0612e+00  3.0612e+00  1e-05  4e-07  2e-07
 9:  3.0612e+00  3.0612e+00  2e-07  8e-09  5e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1 1.1 1.1 2.1 1.1 1.1 1.1 2.1 1.1 0.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 4.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.84it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.28it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.97it/s]100%|██████████| 8/8 [00:00<00:00, 11.72it/s]
[INFO][13:14:58]: [93m[1m[Server #3536466] Global model perplexity: 26.26
[0m
[INFO][13:14:58]: [Server #3536466] All client reports have been processed.
[INFO][13:14:58]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_88.pth.
[INFO][13:15:02]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_88.pth.
[INFO][13:15:02]: [93m[1m
[Server #3536466] Starting round 89/100.[0m
[INFO][13:15:02]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([9.98554986e-01, 3.39681679e-05, 3.39681679e-05, 3.36817922e-06,
       3.39681679e-05, 3.39681679e-05, 3.36817922e-06, 3.39681679e-05,
       4.12027693e-07, 3.36817922e-06, 3.39681679e-05, 3.39681679e-05,
       3.36817922e-06, 3.39681679e-05, 3.39681679e-05, 3.39681679e-05,
       6.61313353e-07, 1.24983946e-06, 3.39681679e-05, 2.82249599e-07,
       3.39681679e-05, 2.82249599e-07, 2.82249599e-07, 2.82249599e-07,
       3.39681679e-05, 3.36817922e-06, 6.61313353e-07, 3.36817922e-06,
       2.82249599e-07, 3.36817922e-06, 3.39681679e-05, 3.36817922e-06,
       3.36817922e-06, 3.36817922e-06, 3.39681679e-05, 3.36817922e-06,
       2.82249599e-07, 4.12027693e-07, 3.39681679e-05, 3.39681679e-05,
       3.39681679e-05, 4.12027693e-07, 3.39681679e-05, 3.39681679e-05,
       6.61313353e-07, 3.39681679e-05, 4.12027693e-07, 2.82249599e-07,
       2.82249599e-07, 4.12027693e-07, 3.39681679e-05, 3.39681679e-05,
       3.39681679e-05, 2.82249599e-07, 3.39681679e-05, 2.82249599e-07,
       3.39681679e-05, 3.39681679e-05, 3.39681679e-05, 3.39681679e-05,
       1.24983946e-06, 4.12027693e-07, 1.24983946e-06, 3.39681679e-05,
       1.24983946e-06, 3.36817922e-06, 3.39681679e-05, 3.39681679e-05,
       1.24983946e-06, 2.82249599e-07, 3.36817922e-06, 1.24983946e-06,
       3.39681679e-05, 3.39681679e-05, 3.39681679e-05, 3.36817922e-06,
       3.39681679e-05, 3.39681679e-05, 3.36817922e-06, 2.82249599e-07,
       6.61313353e-07, 3.39681679e-05, 2.82249599e-07, 2.82249599e-07,
       3.39681679e-05, 2.82249599e-07, 3.36817922e-06, 1.24983946e-06,
       3.36817922e-06, 3.36817922e-06, 3.36817922e-06, 3.39681679e-05,
       4.12027693e-07, 4.12027693e-07, 3.36817922e-06]),)
[INFO][13:15:02]: [Server #3536466] Selected clients: [ 1 53 81 43 80]
[INFO][13:15:02]: [Server #3536466] Selecting client #80 for training.
[INFO][13:15:02]: [Server #3536466] Sending the current model to client #80 (simulated).
[INFO][13:15:07]: [Server #3536466] Sending 507.38 MB of payload data to client #80 (simulated).
[INFO][13:15:07]: [Server #3536466] Selecting client #1 for training.
[INFO][13:15:07]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][13:15:12]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][13:15:12]: [Client #80] Selected by the server.
[INFO][13:15:12]: [Client #80] Loading its data source...
[INFO][13:15:12]: [Client #1] Selected by the server.
[INFO][13:15:12]: [Client #1] Loading its data source...
[INFO][13:15:12]: [Client #80] Dataset size: 2018
[INFO][13:15:12]: [Client #80] Sampler: iid
[INFO][13:15:12]: [Client #1] Dataset size: 2018
[INFO][13:15:12]: [Client #1] Sampler: iid
[INFO][13:15:13]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:15:13]: [Client #1] Start to process inbound data.
[INFO][13:15:14]: [Client #80] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:15:14]: [Client #80] Start to process inbound data.
[INFO][13:15:14]: [93m[1m[Client #1] Started training in communication round #89.[0m
[INFO][13:15:14]: [93m[1m[Client #80] Started training in communication round #89.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:12,  4.09s/it]  2%|▏         | 1/48 [00:04<03:35,  4.59s/it]  4%|▍         | 2/48 [00:04<01:37,  2.11s/it]  4%|▍         | 2/48 [00:05<01:46,  2.33s/it]  6%|▋         | 3/48 [00:05<01:06,  1.49s/it]  6%|▋         | 3/48 [00:06<01:11,  1.60s/it]  8%|▊         | 4/48 [00:06<00:52,  1.19s/it]  8%|▊         | 4/48 [00:06<00:55,  1.26s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.36it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:16,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:23<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:24<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.35it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:32<00:05,  1.35it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s]100%|██████████| 48/48 [00:38<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.39it/s]100%|██████████| 48/48 [00:38<00:00,  1.24it/s]
100%|██████████| 48/48 [00:39<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.40it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][13:15:59]: [Client #80] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_80_3536584.pth.
{'train_runtime': 39.2706, 'train_samples_per_second': 154.161, 'train_steps_per_second': 1.222, 'train_loss': 2.6272244453430176, 'epoch': 3.0}
[INFO][13:16:00]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 38.7855, 'train_samples_per_second': 156.089, 'train_steps_per_second': 1.238, 'train_loss': 1.9804217020670574, 'epoch': 3.0}
[INFO][13:16:00]: [Client #80] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_80_3536584.pth.
[INFO][13:16:01]: [Client #80] Model trained.
[INFO][13:16:01]: [Client #80] Inbound data has been processed.
[INFO][13:16:01]: [Client #80] Outbound data is ready to be sent after being processed.
[INFO][13:16:01]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][13:16:02]: [Client #1] Model trained.
[INFO][13:16:02]: [Client #1] Inbound data has been processed.
[INFO][13:16:02]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][13:16:10]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:16:11]: [Client #80] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:16:11]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][13:16:13]: [Server #3536466] Received 507.38 MB of payload data from client #80 (simulated).
[INFO][13:16:13]: [Server #3536466] Selecting client #81 for training.
[INFO][13:16:13]: [Server #3536466] Sending the current model to client #81 (simulated).
[INFO][13:16:18]: [Server #3536466] Sending 507.38 MB of payload data to client #81 (simulated).
[INFO][13:16:18]: [Server #3536466] Selecting client #53 for training.
[INFO][13:16:18]: [Server #3536466] Sending the current model to client #53 (simulated).
[INFO][13:16:23]: [Server #3536466] Sending 507.38 MB of payload data to client #53 (simulated).
[INFO][13:16:23]: [Client #81] Selected by the server.
[INFO][13:16:23]: [Client #81] Loading its data source...
[INFO][13:16:23]: [Client #53] Selected by the server.
[INFO][13:16:23]: [Client #81] Dataset size: 2018
[INFO][13:16:23]: [Client #81] Sampler: iid
[INFO][13:16:23]: [Client #53] Loading its data source...
[INFO][13:16:23]: [Client #53] Dataset size: 2018
[INFO][13:16:23]: [Client #53] Sampler: iid
[INFO][13:16:24]: [Client #81] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:16:24]: [Client #81] Start to process inbound data.
[INFO][13:16:24]: [Client #53] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:16:24]: [Client #53] Start to process inbound data.
[INFO][13:16:25]: [93m[1m[Client #81] Started training in communication round #89.[0m
[INFO][13:16:25]: [93m[1m[Client #53] Started training in communication round #89.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:39,  4.68s/it]  2%|▏         | 1/48 [00:04<03:43,  4.76s/it]  4%|▍         | 2/48 [00:05<01:48,  2.36s/it]  4%|▍         | 2/48 [00:05<01:50,  2.39s/it]  6%|▋         | 3/48 [00:06<01:12,  1.62s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  8%|▊         | 4/48 [00:06<00:56,  1.29s/it]  8%|▊         | 4/48 [00:06<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 10%|█         | 5/48 [00:07<00:47,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.22it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.35it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.31it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][13:17:11]: [Client #53] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_53_3536585.pth.
{'train_runtime': 39.5838, 'train_samples_per_second': 152.941, 'train_steps_per_second': 1.213, 'train_loss': 2.5555164019266763, 'epoch': 3.0}
[INFO][13:17:11]: [Client #81] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_81_3536584.pth.
{'train_runtime': 39.5461, 'train_samples_per_second': 153.087, 'train_steps_per_second': 1.214, 'train_loss': 2.4265356063842773, 'epoch': 3.0}
[INFO][13:17:12]: [Client #53] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_53_3536585.pth.
[INFO][13:17:12]: [Client #81] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_81_3536584.pth.
[INFO][13:17:13]: [Client #53] Model trained.
[INFO][13:17:13]: [Client #53] Inbound data has been processed.
[INFO][13:17:13]: [Client #53] Outbound data is ready to be sent after being processed.
[INFO][13:17:13]: [Client #81] Model trained.
[INFO][13:17:13]: [Client #81] Inbound data has been processed.
[INFO][13:17:13]: [Client #81] Outbound data is ready to be sent after being processed.
[INFO][13:17:23]: [Client #81] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:17:23]: [Client #53] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:17:24]: [Server #3536466] Received 507.38 MB of payload data from client #81 (simulated).
[INFO][13:17:25]: [Server #3536466] Received 507.38 MB of payload data from client #53 (simulated).
[INFO][13:17:25]: [Server #3536466] Selecting client #43 for training.
[INFO][13:17:25]: [Server #3536466] Sending the current model to client #43 (simulated).
[INFO][13:17:30]: [Server #3536466] Sending 507.38 MB of payload data to client #43 (simulated).
[INFO][13:17:30]: [Client #43] Selected by the server.
[INFO][13:17:30]: [Client #43] Loading its data source...
[INFO][13:17:30]: [Client #43] Dataset size: 2018
[INFO][13:17:30]: [Client #43] Sampler: iid
[INFO][13:17:31]: [Client #43] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:17:31]: [Client #43] Start to process inbound data.
[INFO][13:17:32]: [93m[1m[Client #43] Started training in communication round #89.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.21s/it]  4%|▍         | 2/48 [00:04<01:32,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.71it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.80it/s] 21%|██        | 10/48 [00:08<00:20,  1.88it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.93it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.96it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.99it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.01it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.13it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.11it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.09it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.07it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.07it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.06it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.06it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.06it/s] 50%|█████     | 24/48 [00:15<00:11,  2.05it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.05it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.05it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.06it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.06it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.08it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][13:18:05]: [Client #43] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536584.pth.
{'train_runtime': 26.7723, 'train_samples_per_second': 226.13, 'train_steps_per_second': 1.793, 'train_loss': 2.3270090421040854, 'epoch': 3.0}
[INFO][13:18:06]: [Client #43] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536584.pth.
[INFO][13:18:06]: [Client #43] Model trained.
[INFO][13:18:06]: [Client #43] Inbound data has been processed.
[INFO][13:18:06]: [Client #43] Outbound data is ready to be sent after being processed.
[INFO][13:18:11]: [Client #43] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:18:13]: [Server #3536466] Received 507.38 MB of payload data from client #43 (simulated).
[INFO][13:18:13]: [Server #3536466] Adding client #5 to the list of clients for aggregation.
[INFO][13:18:13]: [Server #3536466] Adding client #10 to the list of clients for aggregation.
[INFO][13:18:13]: [Server #3536466] Adding client #88 to the list of clients for aggregation.
[INFO][13:18:13]: [Server #3536466] Adding client #69 to the list of clients for aggregation.
[INFO][13:18:13]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][13:18:13]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:18:13]: [Server #3536466] Updated weights have been received.
[INFO][13:18:13]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:18:14]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:18:14]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0772e+00  1e+02  1e+00  1e+00
 1:  3.0015e+00  2.0972e+00  3e+00  2e-02  2e-02
 2:  3.0827e+00  2.3973e+00  7e-01  3e-06  4e-07
 3:  3.0823e+00  3.0699e+00  1e-02  6e-08  7e-09
 4:  3.0806e+00  3.0767e+00  4e-03  9e-08  2e-08
 5:  3.0789e+00  3.0757e+00  3e-03  1e-06  8e-07
 6:  3.0782e+00  3.0768e+00  1e-03  5e-07  4e-07
 7:  3.0774e+00  3.0769e+00  5e-04  2e-06  2e-06
 8:  3.0769e+00  3.0769e+00  4e-05  1e-06  9e-07
 9:  3.0769e+00  3.0769e+00  2e-06  6e-08  5e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1 1.1 1.1 2.1 1.1 1.1 1.1 2.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 4.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.13it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.42it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.86it/s]100%|██████████| 8/8 [00:00<00:00, 11.63it/s]
[INFO][13:18:24]: [93m[1m[Server #3536466] Global model perplexity: 26.77
[0m
[INFO][13:18:24]: [Server #3536466] All client reports have been processed.
[INFO][13:18:25]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_89.pth.
[INFO][13:18:28]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_89.pth.
[INFO][13:18:28]: [93m[1m
[Server #3536466] Starting round 90/100.[0m
[INFO][13:18:28]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([9.98554986e-01, 3.39681679e-05, 3.39681679e-05, 3.36817922e-06,
       3.39681679e-05, 3.39681679e-05, 3.39681679e-05, 3.36817922e-06,
       3.39681679e-05, 3.39681679e-05, 4.12027693e-07, 3.36817922e-06,
       3.39681679e-05, 3.39681679e-05, 3.36817922e-06, 3.39681679e-05,
       3.39681679e-05, 3.39681679e-05, 6.61313353e-07, 1.24983946e-06,
       3.39681679e-05, 2.82249599e-07, 3.39681679e-05, 2.82249599e-07,
       2.82249599e-07, 2.82249599e-07, 3.39681679e-05, 3.36817922e-06,
       6.61313353e-07, 3.36817922e-06, 2.82249599e-07, 3.36817922e-06,
       3.39681679e-05, 3.36817922e-06, 3.36817922e-06, 3.36817922e-06,
       3.39681679e-05, 3.36817922e-06, 2.82249599e-07, 4.12027693e-07,
       3.39681679e-05, 3.39681679e-05, 4.12027693e-07, 3.39681679e-05,
       3.39681679e-05, 6.61313353e-07, 3.39681679e-05, 4.12027693e-07,
       2.82249599e-07, 2.82249599e-07, 4.12027693e-07, 3.39681679e-05,
       3.39681679e-05, 2.82249599e-07, 3.39681679e-05, 2.82249599e-07,
       3.39681679e-05, 3.39681679e-05, 3.39681679e-05, 3.39681679e-05,
       1.24983946e-06, 4.12027693e-07, 1.24983946e-06, 3.39681679e-05,
       1.24983946e-06, 3.36817922e-06, 3.39681679e-05, 3.39681679e-05,
       3.39681679e-05, 1.24983946e-06, 2.82249599e-07, 3.36817922e-06,
       1.24983946e-06, 3.39681679e-05, 3.39681679e-05, 3.39681679e-05,
       3.36817922e-06, 3.36817922e-06, 2.82249599e-07, 6.61313353e-07,
       3.39681679e-05, 2.82249599e-07, 2.82249599e-07, 3.39681679e-05,
       3.39681679e-05, 2.82249599e-07, 3.36817922e-06, 1.24983946e-06,
       3.36817922e-06, 3.36817922e-06, 3.36817922e-06, 3.39681679e-05,
       4.12027693e-07, 4.12027693e-07, 3.36817922e-06]),)
[INFO][13:18:28]: [Server #3536466] Selected clients: [ 1 61  9  6 78]
[INFO][13:18:28]: [Server #3536466] Selecting client #6 for training.
[INFO][13:18:28]: [Server #3536466] Sending the current model to client #6 (simulated).
[INFO][13:18:33]: [Server #3536466] Sending 507.38 MB of payload data to client #6 (simulated).
[INFO][13:18:33]: [Server #3536466] Selecting client #1 for training.
[INFO][13:18:33]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][13:18:38]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][13:18:38]: [Client #6] Selected by the server.
[INFO][13:18:38]: [Client #6] Loading its data source...
[INFO][13:18:38]: [Client #6] Dataset size: 2018
[INFO][13:18:38]: [Client #6] Sampler: iid
[INFO][13:18:38]: [Client #1] Selected by the server.
[INFO][13:18:38]: [Client #1] Loading its data source...
[INFO][13:18:38]: [Client #1] Dataset size: 2018
[INFO][13:18:38]: [Client #1] Sampler: iid
[INFO][13:18:40]: [Client #6] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:18:40]: [Client #6] Start to process inbound data.
[INFO][13:18:40]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:18:40]: [Client #1] Start to process inbound data.
[INFO][13:18:41]: [93m[1m[Client #1] Started training in communication round #90.[0m
[INFO][13:18:41]: [93m[1m[Client #6] Started training in communication round #90.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:36,  4.60s/it]  2%|▏         | 1/48 [00:04<03:37,  4.62s/it]  4%|▍         | 2/48 [00:05<01:46,  2.31s/it]  4%|▍         | 2/48 [00:05<01:48,  2.36s/it]  6%|▋         | 3/48 [00:06<01:11,  1.58s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  8%|▊         | 4/48 [00:06<00:54,  1.24s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it] 10%|█         | 5/48 [00:07<00:45,  1.06s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 12%|█▎        | 6/48 [00:08<00:39,  1.05it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.14it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.35it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.34it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.30it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.31it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.54it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.54it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][13:19:26]: [Client #6] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_6_3536584.pth.
{'train_runtime': 39.4736, 'train_samples_per_second': 153.368, 'train_steps_per_second': 1.216, 'train_loss': 2.8176937103271484, 'epoch': 3.0}
[INFO][13:19:27]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 39.3864, 'train_samples_per_second': 153.708, 'train_steps_per_second': 1.219, 'train_loss': 1.9321053822835286, 'epoch': 3.0}
[INFO][13:19:27]: [Client #6] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_6_3536584.pth.
[INFO][13:19:28]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][13:19:28]: [Client #6] Model trained.
[INFO][13:19:28]: [Client #6] Inbound data has been processed.
[INFO][13:19:28]: [Client #6] Outbound data is ready to be sent after being processed.
[INFO][13:19:28]: [Client #1] Model trained.
[INFO][13:19:28]: [Client #1] Inbound data has been processed.
[INFO][13:19:28]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][13:19:37]: [Client #6] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:19:38]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:19:38]: [Server #3536466] Received 507.38 MB of payload data from client #6 (simulated).
[INFO][13:19:39]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][13:19:39]: [Server #3536466] Selecting client #78 for training.
[INFO][13:19:39]: [Server #3536466] Sending the current model to client #78 (simulated).
[INFO][13:19:44]: [Server #3536466] Sending 507.38 MB of payload data to client #78 (simulated).
[INFO][13:19:44]: [Server #3536466] Selecting client #9 for training.
[INFO][13:19:44]: [Server #3536466] Sending the current model to client #9 (simulated).
[INFO][13:19:49]: [Server #3536466] Sending 507.38 MB of payload data to client #9 (simulated).
[INFO][13:19:49]: [Client #78] Selected by the server.
[INFO][13:19:49]: [Client #78] Loading its data source...
[INFO][13:19:49]: [Client #9] Selected by the server.
[INFO][13:19:49]: [Client #9] Loading its data source...
[INFO][13:19:49]: [Client #78] Dataset size: 2018
[INFO][13:19:49]: [Client #78] Sampler: iid
[INFO][13:19:49]: [Client #9] Dataset size: 2018
[INFO][13:19:49]: [Client #9] Sampler: iid
[INFO][13:19:50]: [Client #9] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:19:50]: [Client #9] Start to process inbound data.
[INFO][13:19:50]: [Client #78] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:19:50]: [Client #78] Start to process inbound data.
[INFO][13:19:51]: [93m[1m[Client #78] Started training in communication round #90.[0m
[INFO][13:19:51]: [93m[1m[Client #9] Started training in communication round #90.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:29,  4.46s/it]  2%|▏         | 1/48 [00:04<03:40,  4.69s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  4%|▍         | 2/48 [00:05<01:58,  2.57s/it]  6%|▋         | 3/48 [00:06<01:20,  1.80s/it]  6%|▋         | 3/48 [00:06<01:25,  1.89s/it]  8%|▊         | 4/48 [00:07<01:06,  1.50s/it]  8%|▊         | 4/48 [00:07<01:08,  1.56s/it] 10%|█         | 5/48 [00:08<00:55,  1.30s/it] 10%|█         | 5/48 [00:08<00:59,  1.38s/it] 12%|█▎        | 6/48 [00:09<00:48,  1.15s/it] 12%|█▎        | 6/48 [00:09<00:50,  1.21s/it] 15%|█▍        | 7/48 [00:10<00:43,  1.07s/it] 15%|█▍        | 7/48 [00:10<00:45,  1.12s/it] 17%|█▋        | 8/48 [00:11<00:40,  1.02s/it] 17%|█▋        | 8/48 [00:11<00:42,  1.07s/it] 19%|█▉        | 9/48 [00:12<00:39,  1.02s/it] 19%|█▉        | 9/48 [00:12<00:38,  1.01it/s] 21%|██        | 10/48 [00:13<00:36,  1.03it/s] 21%|██        | 10/48 [00:13<00:36,  1.04it/s] 23%|██▎       | 11/48 [00:13<00:34,  1.08it/s] 23%|██▎       | 11/48 [00:14<00:34,  1.06it/s] 25%|██▌       | 12/48 [00:14<00:33,  1.07it/s] 25%|██▌       | 12/48 [00:15<00:33,  1.08it/s] 27%|██▋       | 13/48 [00:15<00:32,  1.08it/s] 27%|██▋       | 13/48 [00:16<00:32,  1.08it/s] 29%|██▉       | 14/48 [00:16<00:31,  1.09it/s] 29%|██▉       | 14/48 [00:17<00:31,  1.09it/s] 31%|███▏      | 15/48 [00:17<00:29,  1.10it/s] 31%|███▏      | 15/48 [00:18<00:31,  1.03it/s] 33%|███▎      | 16/48 [00:18<00:29,  1.10it/s] 33%|███▎      | 16/48 [00:18<00:27,  1.15it/s] 35%|███▌      | 17/48 [00:19<00:28,  1.08it/s] 35%|███▌      | 17/48 [00:19<00:28,  1.08it/s] 38%|███▊      | 18/48 [00:20<00:27,  1.11it/s] 38%|███▊      | 18/48 [00:20<00:27,  1.10it/s] 40%|███▉      | 19/48 [00:21<00:26,  1.11it/s] 40%|███▉      | 19/48 [00:21<00:26,  1.11it/s] 42%|████▏     | 20/48 [00:22<00:25,  1.10it/s] 42%|████▏     | 20/48 [00:22<00:25,  1.12it/s] 44%|████▍     | 21/48 [00:22<00:24,  1.10it/s] 44%|████▍     | 21/48 [00:23<00:24,  1.08it/s] 46%|████▌     | 22/48 [00:23<00:23,  1.11it/s] 46%|████▌     | 22/48 [00:24<00:23,  1.11it/s] 48%|████▊     | 23/48 [00:24<00:22,  1.12it/s] 48%|████▊     | 23/48 [00:25<00:22,  1.12it/s] 50%|█████     | 24/48 [00:25<00:22,  1.08it/s] 50%|█████     | 24/48 [00:26<00:21,  1.11it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.09it/s] 52%|█████▏    | 25/48 [00:27<00:20,  1.10it/s] 54%|█████▍    | 26/48 [00:27<00:19,  1.11it/s] 54%|█████▍    | 26/48 [00:27<00:19,  1.10it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.09it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.10it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.09it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.07it/s] 60%|██████    | 29/48 [00:30<00:17,  1.10it/s] 60%|██████    | 29/48 [00:30<00:17,  1.09it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.09it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.10it/s] 65%|██████▍   | 31/48 [00:32<00:15,  1.09it/s] 65%|██████▍   | 31/48 [00:32<00:16,  1.04it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.10it/s] 67%|██████▋   | 32/48 [00:33<00:13,  1.15it/s] 69%|██████▉   | 33/48 [00:34<00:14,  1.05it/s] 69%|██████▉   | 33/48 [00:34<00:13,  1.08it/s] 71%|███████   | 34/48 [00:35<00:13,  1.05it/s] 71%|███████   | 34/48 [00:35<00:13,  1.03it/s] 73%|███████▎  | 35/48 [00:35<00:12,  1.07it/s] 73%|███████▎  | 35/48 [00:36<00:12,  1.05it/s] 75%|███████▌  | 36/48 [00:36<00:11,  1.09it/s] 75%|███████▌  | 36/48 [00:37<00:11,  1.06it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.08it/s] 77%|███████▋  | 37/48 [00:38<00:10,  1.08it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.08it/s] 79%|███████▉  | 38/48 [00:39<00:09,  1.05it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.04it/s] 81%|████████▏ | 39/48 [00:40<00:08,  1.06it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.06it/s] 83%|████████▎ | 40/48 [00:41<00:07,  1.06it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.05it/s] 85%|████████▌ | 41/48 [00:42<00:06,  1.06it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.07it/s] 88%|████████▊ | 42/48 [00:43<00:05,  1.04it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.06it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.05it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.06it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.08it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.07it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.08it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.07it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.09it/s] 98%|█████████▊| 47/48 [00:47<00:00,  1.07it/s] 98%|█████████▊| 47/48 [00:47<00:00,  1.03it/s]100%|██████████| 48/48 [00:48<00:00,  1.08it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:48<00:00,  1.08it/s]100%|██████████| 48/48 [00:48<00:00,  1.00s/it]
100%|██████████| 48/48 [00:48<00:00,  1.19it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:48<00:00,  1.19it/s]100%|██████████| 48/48 [00:48<00:00,  1.01s/it]
[INFO][13:20:46]: [Client #78] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
{'train_runtime': 48.0569, 'train_samples_per_second': 125.976, 'train_steps_per_second': 0.999, 'train_loss': 2.5360066095987954, 'epoch': 3.0}
[INFO][13:20:46]: [Client #9] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
{'train_runtime': 48.2888, 'train_samples_per_second': 125.371, 'train_steps_per_second': 0.994, 'train_loss': 1.7502679824829102, 'epoch': 3.0}
[INFO][13:20:47]: [Client #78] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
[INFO][13:20:47]: [Client #9] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_9_3536585.pth.
[INFO][13:20:48]: [Client #78] Model trained.
[INFO][13:20:48]: [Client #78] Inbound data has been processed.
[INFO][13:20:48]: [Client #78] Outbound data is ready to be sent after being processed.
[INFO][13:20:48]: [Client #9] Model trained.
[INFO][13:20:48]: [Client #9] Inbound data has been processed.
[INFO][13:20:48]: [Client #9] Outbound data is ready to be sent after being processed.
[INFO][13:20:58]: [Client #78] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:20:58]: [Client #9] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:20:59]: [Server #3536466] Received 507.38 MB of payload data from client #78 (simulated).
[INFO][13:21:00]: [Server #3536466] Received 507.38 MB of payload data from client #9 (simulated).
[INFO][13:21:00]: [Server #3536466] Selecting client #61 for training.
[INFO][13:21:00]: [Server #3536466] Sending the current model to client #61 (simulated).
[INFO][13:21:05]: [Server #3536466] Sending 507.38 MB of payload data to client #61 (simulated).
[INFO][13:21:05]: [Client #61] Selected by the server.
[INFO][13:21:05]: [Client #61] Loading its data source...
[INFO][13:21:05]: [Client #61] Dataset size: 2018
[INFO][13:21:05]: [Client #61] Sampler: iid
[INFO][13:21:06]: [Client #61] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:21:06]: [Client #61] Start to process inbound data.
[INFO][13:21:06]: [93m[1m[Client #61] Started training in communication round #90.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:20,  4.26s/it]  4%|▍         | 2/48 [00:04<01:33,  2.04s/it]  6%|▋         | 3/48 [00:05<00:59,  1.33s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:09<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.02it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.07it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.06it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.06it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.06it/s] 50%|█████     | 24/48 [00:15<00:11,  2.06it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.06it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.05it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.05it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.05it/s] 60%|██████    | 29/48 [00:17<00:09,  2.05it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.05it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.05it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.15it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.12it/s] 71%|███████   | 34/48 [00:20<00:06,  2.10it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.09it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.07it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.07it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.06it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.06it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.05it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.05it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.05it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.05it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.05it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.04it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.05it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.04it/s]100%|██████████| 48/48 [00:26<00:00,  2.16it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.16it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][13:21:39]: [Client #61] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536584.pth.
{'train_runtime': 26.8481, 'train_samples_per_second': 225.491, 'train_steps_per_second': 1.788, 'train_loss': 2.2262519200642905, 'epoch': 3.0}
[INFO][13:21:40]: [Client #61] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536584.pth.
[INFO][13:21:40]: [Client #61] Model trained.
[INFO][13:21:40]: [Client #61] Inbound data has been processed.
[INFO][13:21:40]: [Client #61] Outbound data is ready to be sent after being processed.
[INFO][13:21:46]: [Client #61] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:21:47]: [Server #3536466] Received 507.38 MB of payload data from client #61 (simulated).
[INFO][13:21:47]: [Server #3536466] Adding client #43 to the list of clients for aggregation.
[INFO][13:21:47]: [Server #3536466] Adding client #53 to the list of clients for aggregation.
[INFO][13:21:47]: [Server #3536466] Adding client #80 to the list of clients for aggregation.
[INFO][13:21:47]: [Server #3536466] Adding client #81 to the list of clients for aggregation.
[INFO][13:21:47]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][13:21:47]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:21:47]: [Server #3536466] Updated weights have been received.
[INFO][13:21:48]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:21:48]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:21:48]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0772e+00  1e+02  1e+00  1e+00
 1:  3.0015e+00  2.0972e+00  3e+00  2e-02  2e-02
 2:  3.0827e+00  2.3973e+00  7e-01  3e-06  4e-07
 3:  3.0823e+00  3.0699e+00  1e-02  6e-08  7e-09
 4:  3.0806e+00  3.0767e+00  4e-03  9e-08  2e-08
 5:  3.0789e+00  3.0757e+00  3e-03  1e-06  8e-07
 6:  3.0782e+00  3.0768e+00  1e-03  5e-07  4e-07
 7:  3.0774e+00  3.0769e+00  5e-04  2e-06  2e-06
 8:  3.0769e+00  3.0769e+00  4e-05  1e-06  9e-07
 9:  3.0769e+00  3.0769e+00  2e-06  6e-08  5e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1 1.1 1.1 2.1 1.1 1.1 1.1 2.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 4.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 3.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.93it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.30it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.95it/s]100%|██████████| 8/8 [00:00<00:00, 11.73it/s]
[INFO][13:21:59]: [93m[1m[Server #3536466] Global model perplexity: 26.23
[0m
[INFO][13:21:59]: [Server #3536466] All client reports have been processed.
[INFO][13:21:59]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_90.pth.
[INFO][13:22:03]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_90.pth.
[INFO][13:22:03]: [93m[1m
[Server #3536466] Starting round 91/100.[0m
[INFO][13:22:03]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([9.98554986e-01, 3.39681679e-05, 3.39681679e-05, 3.36817922e-06,
       3.39681679e-05, 3.39681679e-05, 3.36817922e-06, 3.39681679e-05,
       4.12027693e-07, 3.36817922e-06, 3.39681679e-05, 3.39681679e-05,
       3.36817922e-06, 3.39681679e-05, 3.39681679e-05, 3.39681679e-05,
       6.61313353e-07, 1.24983946e-06, 3.39681679e-05, 2.82249599e-07,
       3.39681679e-05, 2.82249599e-07, 2.82249599e-07, 2.82249599e-07,
       3.39681679e-05, 3.36817922e-06, 6.61313353e-07, 3.36817922e-06,
       2.82249599e-07, 3.36817922e-06, 3.39681679e-05, 3.36817922e-06,
       3.36817922e-06, 3.36817922e-06, 3.39681679e-05, 3.36817922e-06,
       2.82249599e-07, 4.12027693e-07, 3.39681679e-05, 3.39681679e-05,
       3.39681679e-05, 4.12027693e-07, 3.39681679e-05, 3.39681679e-05,
       6.61313353e-07, 3.39681679e-05, 4.12027693e-07, 2.82249599e-07,
       2.82249599e-07, 4.12027693e-07, 3.39681679e-05, 3.39681679e-05,
       3.39681679e-05, 2.82249599e-07, 3.39681679e-05, 2.82249599e-07,
       3.39681679e-05, 3.39681679e-05, 3.39681679e-05, 1.24983946e-06,
       4.12027693e-07, 1.24983946e-06, 3.39681679e-05, 1.24983946e-06,
       3.36817922e-06, 3.39681679e-05, 3.39681679e-05, 3.39681679e-05,
       1.24983946e-06, 2.82249599e-07, 3.36817922e-06, 1.24983946e-06,
       3.39681679e-05, 3.39681679e-05, 3.36817922e-06, 3.39681679e-05,
       3.39681679e-05, 3.36817922e-06, 2.82249599e-07, 6.61313353e-07,
       3.39681679e-05, 2.82249599e-07, 2.82249599e-07, 3.39681679e-05,
       3.39681679e-05, 2.82249599e-07, 3.36817922e-06, 1.24983946e-06,
       3.36817922e-06, 3.36817922e-06, 3.36817922e-06, 3.39681679e-05,
       4.12027693e-07, 4.12027693e-07, 3.36817922e-06]),)
[INFO][13:22:03]: [Server #3536466] Selected clients: [ 1 81 89 76 23]
[INFO][13:22:03]: [Server #3536466] Selecting client #76 for training.
[INFO][13:22:03]: [Server #3536466] Sending the current model to client #76 (simulated).
[INFO][13:22:08]: [Server #3536466] Sending 507.38 MB of payload data to client #76 (simulated).
[INFO][13:22:08]: [Server #3536466] Selecting client #1 for training.
[INFO][13:22:08]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][13:22:13]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][13:22:13]: [Client #76] Selected by the server.
[INFO][13:22:13]: [Client #76] Loading its data source...
[INFO][13:22:13]: [Client #76] Dataset size: 2018
[INFO][13:22:13]: [Client #76] Sampler: iid
[INFO][13:22:13]: [Client #1] Selected by the server.
[INFO][13:22:13]: [Client #1] Loading its data source...
[INFO][13:22:13]: [Client #1] Dataset size: 2018
[INFO][13:22:13]: [Client #1] Sampler: iid
[INFO][13:22:14]: [Client #76] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:22:14]: [Client #76] Start to process inbound data.
[INFO][13:22:14]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:22:14]: [Client #1] Start to process inbound data.
[INFO][13:22:15]: [93m[1m[Client #76] Started training in communication round #91.[0m
[INFO][13:22:15]: [93m[1m[Client #1] Started training in communication round #91.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:13,  4.11s/it]  2%|▏         | 1/48 [00:04<03:47,  4.85s/it]  4%|▍         | 2/48 [00:04<01:37,  2.11s/it]  4%|▍         | 2/48 [00:05<01:52,  2.46s/it]  6%|▋         | 3/48 [00:05<01:07,  1.49s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:07<00:57,  1.30s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:29,  1.28it/s] 21%|██        | 10/48 [00:11<00:30,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.36it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 35%|███▌      | 17/48 [00:15<00:23,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:21,  1.33it/s] 44%|████▍     | 21/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.32it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.33it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:22<00:18,  1.32it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:24<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.54it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.54it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][13:23:01]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 39.0612, 'train_samples_per_second': 154.988, 'train_steps_per_second': 1.229, 'train_loss': 1.8786665598551433, 'epoch': 3.0}
[INFO][13:23:01]: [Client #76] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_76_3536584.pth.
{'train_runtime': 39.5557, 'train_samples_per_second': 153.05, 'train_steps_per_second': 1.213, 'train_loss': 2.6374384562174478, 'epoch': 3.0}
[INFO][13:23:02]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][13:23:02]: [Client #76] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_76_3536584.pth.
[INFO][13:23:02]: [Client #1] Model trained.
[INFO][13:23:02]: [Client #1] Inbound data has been processed.
[INFO][13:23:02]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][13:23:03]: [Client #76] Model trained.
[INFO][13:23:03]: [Client #76] Inbound data has been processed.
[INFO][13:23:03]: [Client #76] Outbound data is ready to be sent after being processed.
[INFO][13:23:11]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:23:12]: [Client #76] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:23:13]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][13:23:14]: [Server #3536466] Received 507.38 MB of payload data from client #76 (simulated).
[INFO][13:23:14]: [Server #3536466] Selecting client #81 for training.
[INFO][13:23:14]: [Server #3536466] Sending the current model to client #81 (simulated).
[INFO][13:23:18]: [Server #3536466] Sending 507.38 MB of payload data to client #81 (simulated).
[INFO][13:23:18]: [Server #3536466] Selecting client #23 for training.
[INFO][13:23:18]: [Server #3536466] Sending the current model to client #23 (simulated).
[INFO][13:23:23]: [Server #3536466] Sending 507.38 MB of payload data to client #23 (simulated).
[INFO][13:23:23]: [Client #81] Selected by the server.
[INFO][13:23:23]: [Client #81] Loading its data source...
[INFO][13:23:23]: [Client #23] Selected by the server.
[INFO][13:23:23]: [Client #23] Loading its data source...
[INFO][13:23:23]: [Client #81] Dataset size: 2018
[INFO][13:23:23]: [Client #81] Sampler: iid
[INFO][13:23:23]: [Client #23] Dataset size: 2018
[INFO][13:23:23]: [Client #23] Sampler: iid
[INFO][13:23:25]: [Client #23] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:23:25]: [Client #23] Start to process inbound data.
[INFO][13:23:25]: [Client #81] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:23:25]: [Client #81] Start to process inbound data.
[INFO][13:23:25]: [93m[1m[Client #23] Started training in communication round #91.[0m
[INFO][13:23:26]: [93m[1m[Client #81] Started training in communication round #91.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:23,  4.33s/it]  2%|▏         | 1/48 [00:04<03:49,  4.89s/it]  4%|▍         | 2/48 [00:05<01:48,  2.35s/it]  4%|▍         | 2/48 [00:05<02:01,  2.65s/it]  6%|▋         | 3/48 [00:06<01:19,  1.77s/it]  6%|▋         | 3/48 [00:06<01:25,  1.91s/it]  8%|▊         | 4/48 [00:07<01:06,  1.52s/it]  8%|▊         | 4/48 [00:07<01:05,  1.50s/it] 10%|█         | 5/48 [00:08<00:55,  1.29s/it] 10%|█         | 5/48 [00:08<00:54,  1.27s/it] 12%|█▎        | 6/48 [00:09<00:48,  1.16s/it] 12%|█▎        | 6/48 [00:09<00:47,  1.14s/it] 15%|█▍        | 7/48 [00:10<00:44,  1.08s/it] 15%|█▍        | 7/48 [00:10<00:44,  1.07s/it] 17%|█▋        | 8/48 [00:11<00:40,  1.01s/it] 17%|█▋        | 8/48 [00:11<00:40,  1.02s/it] 19%|█▉        | 9/48 [00:12<00:38,  1.00it/s] 19%|█▉        | 9/48 [00:12<00:38,  1.01it/s] 21%|██        | 10/48 [00:12<00:36,  1.04it/s] 21%|██        | 10/48 [00:13<00:37,  1.02it/s] 23%|██▎       | 11/48 [00:13<00:35,  1.05it/s] 23%|██▎       | 11/48 [00:14<00:35,  1.04it/s] 25%|██▌       | 12/48 [00:14<00:33,  1.08it/s] 25%|██▌       | 12/48 [00:15<00:33,  1.07it/s] 27%|██▋       | 13/48 [00:15<00:33,  1.04it/s] 27%|██▋       | 13/48 [00:16<00:32,  1.07it/s] 29%|██▉       | 14/48 [00:16<00:32,  1.05it/s] 29%|██▉       | 14/48 [00:17<00:31,  1.07it/s] 31%|███▏      | 15/48 [00:17<00:30,  1.08it/s] 31%|███▏      | 15/48 [00:18<00:32,  1.03it/s] 33%|███▎      | 16/48 [00:18<00:28,  1.10it/s] 33%|███▎      | 16/48 [00:18<00:28,  1.12it/s] 35%|███▌      | 17/48 [00:19<00:28,  1.10it/s] 35%|███▌      | 17/48 [00:19<00:28,  1.10it/s] 38%|███▊      | 18/48 [00:20<00:26,  1.11it/s] 38%|███▊      | 18/48 [00:20<00:27,  1.10it/s] 40%|███▉      | 19/48 [00:21<00:25,  1.13it/s] 40%|███▉      | 19/48 [00:21<00:26,  1.10it/s] 42%|████▏     | 20/48 [00:21<00:25,  1.11it/s] 42%|████▏     | 20/48 [00:22<00:25,  1.10it/s] 44%|████▍     | 21/48 [00:23<00:25,  1.07it/s] 44%|████▍     | 21/48 [00:23<00:24,  1.09it/s] 46%|████▌     | 22/48 [00:23<00:24,  1.07it/s] 46%|████▌     | 22/48 [00:24<00:23,  1.10it/s] 48%|████▊     | 23/48 [00:24<00:23,  1.06it/s] 48%|████▊     | 23/48 [00:25<00:23,  1.08it/s] 50%|█████     | 24/48 [00:25<00:22,  1.07it/s] 50%|█████     | 24/48 [00:26<00:22,  1.05it/s] 52%|█████▏    | 25/48 [00:26<00:21,  1.07it/s] 52%|█████▏    | 25/48 [00:27<00:22,  1.04it/s] 54%|█████▍    | 26/48 [00:27<00:20,  1.06it/s] 54%|█████▍    | 26/48 [00:28<00:20,  1.07it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.09it/s] 56%|█████▋    | 27/48 [00:28<00:19,  1.09it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.06it/s] 58%|█████▊    | 28/48 [00:29<00:18,  1.08it/s] 60%|██████    | 29/48 [00:30<00:17,  1.08it/s] 60%|██████    | 29/48 [00:30<00:17,  1.08it/s] 62%|██████▎   | 30/48 [00:31<00:16,  1.09it/s] 62%|██████▎   | 30/48 [00:31<00:17,  1.05it/s] 65%|██████▍   | 31/48 [00:32<00:16,  1.05it/s] 65%|██████▍   | 31/48 [00:32<00:16,  1.01it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.07it/s] 67%|██████▋   | 32/48 [00:33<00:14,  1.12it/s] 69%|██████▉   | 33/48 [00:34<00:13,  1.07it/s] 69%|██████▉   | 33/48 [00:34<00:13,  1.10it/s] 71%|███████   | 34/48 [00:35<00:13,  1.06it/s] 71%|███████   | 34/48 [00:35<00:12,  1.08it/s] 73%|███████▎  | 35/48 [00:36<00:11,  1.09it/s] 73%|███████▎  | 35/48 [00:36<00:11,  1.09it/s] 75%|███████▌  | 36/48 [00:36<00:11,  1.08it/s] 75%|███████▌  | 36/48 [00:37<00:11,  1.08it/s] 77%|███████▋  | 37/48 [00:37<00:10,  1.07it/s] 77%|███████▋  | 37/48 [00:38<00:10,  1.06it/s] 79%|███████▉  | 38/48 [00:38<00:09,  1.04it/s] 79%|███████▉  | 38/48 [00:39<00:09,  1.05it/s] 81%|████████▏ | 39/48 [00:39<00:08,  1.06it/s] 81%|████████▏ | 39/48 [00:40<00:08,  1.06it/s] 83%|████████▎ | 40/48 [00:40<00:07,  1.07it/s] 83%|████████▎ | 40/48 [00:41<00:07,  1.09it/s] 85%|████████▌ | 41/48 [00:41<00:06,  1.07it/s] 85%|████████▌ | 41/48 [00:42<00:06,  1.08it/s] 88%|████████▊ | 42/48 [00:42<00:05,  1.08it/s] 88%|████████▊ | 42/48 [00:43<00:05,  1.04it/s] 90%|████████▉ | 43/48 [00:43<00:04,  1.08it/s] 90%|████████▉ | 43/48 [00:44<00:04,  1.05it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.07it/s] 92%|█████████▏| 44/48 [00:44<00:03,  1.07it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.08it/s] 94%|█████████▍| 45/48 [00:45<00:02,  1.09it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.09it/s] 96%|█████████▌| 46/48 [00:46<00:01,  1.06it/s] 98%|█████████▊| 47/48 [00:47<00:00,  1.04it/s] 98%|█████████▊| 47/48 [00:47<00:00,  1.01it/s]100%|██████████| 48/48 [00:48<00:00,  1.07it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:48<00:00,  1.07it/s]100%|██████████| 48/48 [00:48<00:00,  1.01s/it]
100%|██████████| 48/48 [00:48<00:00,  1.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:48<00:00,  1.17it/s]100%|██████████| 48/48 [00:48<00:00,  1.01s/it]
[INFO][13:24:20]: [Client #23] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_23_3536585.pth.
{'train_runtime': 48.2572, 'train_samples_per_second': 125.453, 'train_steps_per_second': 0.995, 'train_loss': 2.359221617380778, 'epoch': 3.0}
[INFO][13:24:20]: [Client #81] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_81_3536584.pth.
{'train_runtime': 48.4406, 'train_samples_per_second': 124.978, 'train_steps_per_second': 0.991, 'train_loss': 2.2967448234558105, 'epoch': 3.0}
[INFO][13:24:21]: [Client #81] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_81_3536584.pth.
[INFO][13:24:22]: [Client #23] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_23_3536585.pth.
[INFO][13:24:22]: [Client #81] Model trained.
[INFO][13:24:22]: [Client #81] Inbound data has been processed.
[INFO][13:24:22]: [Client #81] Outbound data is ready to be sent after being processed.
[INFO][13:24:22]: [Client #23] Model trained.
[INFO][13:24:22]: [Client #23] Inbound data has been processed.
[INFO][13:24:22]: [Client #23] Outbound data is ready to be sent after being processed.
[INFO][13:24:32]: [Client #23] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:24:32]: [Client #81] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:24:33]: [Server #3536466] Received 507.38 MB of payload data from client #23 (simulated).
[INFO][13:24:34]: [Server #3536466] Received 507.38 MB of payload data from client #81 (simulated).
[INFO][13:24:34]: [Server #3536466] Selecting client #89 for training.
[INFO][13:24:34]: [Server #3536466] Sending the current model to client #89 (simulated).
[INFO][13:24:39]: [Server #3536466] Sending 507.38 MB of payload data to client #89 (simulated).
[INFO][13:24:39]: [Client #89] Selected by the server.
[INFO][13:24:39]: [Client #89] Loading its data source...
[INFO][13:24:39]: [Client #89] Dataset size: 2018
[INFO][13:24:39]: [Client #89] Sampler: iid
[INFO][13:24:40]: [Client #89] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:24:40]: [Client #89] Start to process inbound data.
[INFO][13:24:40]: [93m[1m[Client #89] Started training in communication round #91.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.83it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.93it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.97it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.99it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.01it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.13it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.11it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.09it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.08it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.07it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.07it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.07it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:20<00:06,  2.13it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.08it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.08it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.08it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][13:25:13]: [Client #89] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_89_3536584.pth.
{'train_runtime': 26.7201, 'train_samples_per_second': 226.571, 'train_steps_per_second': 1.796, 'train_loss': 2.4933921496073403, 'epoch': 3.0}
[INFO][13:25:14]: [Client #89] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_89_3536584.pth.
[INFO][13:25:15]: [Client #89] Model trained.
[INFO][13:25:15]: [Client #89] Inbound data has been processed.
[INFO][13:25:15]: [Client #89] Outbound data is ready to be sent after being processed.
[INFO][13:25:20]: [Client #89] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:25:21]: [Server #3536466] Received 507.38 MB of payload data from client #89 (simulated).
[INFO][13:25:21]: [Server #3536466] Adding client #9 to the list of clients for aggregation.
[INFO][13:25:21]: [Server #3536466] Adding client #78 to the list of clients for aggregation.
[INFO][13:25:21]: [Server #3536466] Adding client #61 to the list of clients for aggregation.
[INFO][13:25:21]: [Server #3536466] Adding client #93 to the list of clients for aggregation.
[INFO][13:25:21]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][13:25:21]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:25:21]: [Server #3536466] Updated weights have been received.
[INFO][13:25:22]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:25:22]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:25:22]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.0772e+00  1e+02  1e+00  1e+00
 1:  3.0015e+00  2.0972e+00  3e+00  2e-02  2e-02
 2:  3.0827e+00  2.3973e+00  7e-01  3e-06  4e-07
 3:  3.0823e+00  3.0699e+00  1e-02  6e-08  7e-09
 4:  3.0806e+00  3.0767e+00  4e-03  9e-08  2e-08
 5:  3.0789e+00  3.0757e+00  3e-03  1e-06  8e-07
 6:  3.0782e+00  3.0768e+00  1e-03  5e-07  4e-07
 7:  3.0774e+00  3.0769e+00  5e-04  2e-06  2e-06
 8:  3.0769e+00  3.0769e+00  4e-05  1e-06  9e-07
 9:  3.0769e+00  3.0769e+00  2e-06  6e-08  5e-08
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1 1.1 1.1 2.1 1.1 1.1 1.1 2.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 4.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 7.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.97it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.37it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.77it/s]100%|██████████| 8/8 [00:00<00:00, 11.65it/s]
[INFO][13:25:33]: [93m[1m[Server #3536466] Global model perplexity: 30.48
[0m
[INFO][13:25:33]: [Server #3536466] All client reports have been processed.
[INFO][13:25:33]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_91.pth.
[INFO][13:25:37]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_91.pth.
[INFO][13:25:37]: [93m[1m
[Server #3536466] Starting round 92/100.[0m
[INFO][13:25:37]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([9.99946724e-01, 1.27220182e-06, 1.27220182e-06, 1.41434811e-07,
       1.27220182e-06, 1.27220182e-06, 1.41434811e-07, 1.27220182e-06,
       1.27220182e-06, 1.80266398e-08, 1.41434811e-07, 1.27220182e-06,
       1.27220182e-06, 1.41434811e-07, 1.27220182e-06, 1.27220182e-06,
       1.27220182e-06, 2.87943544e-08, 5.38804120e-08, 1.27220182e-06,
       1.23817565e-08, 1.23817565e-08, 1.23817565e-08, 1.23817565e-08,
       1.27220182e-06, 1.41434811e-07, 2.87943544e-08, 1.41434811e-07,
       1.23817565e-08, 1.41434811e-07, 1.27220182e-06, 1.41434811e-07,
       1.41434811e-07, 1.41434811e-07, 1.27220182e-06, 1.41434811e-07,
       1.23817565e-08, 1.80266398e-08, 1.27220182e-06, 1.27220182e-06,
       1.27220182e-06, 1.80266398e-08, 1.27220182e-06, 1.27220182e-06,
       2.87943544e-08, 1.27220182e-06, 1.80266398e-08, 1.23817565e-08,
       1.23817565e-08, 1.80266398e-08, 1.27220182e-06, 1.27220182e-06,
       1.27220182e-06, 1.23817565e-08, 1.27220182e-06, 1.23817565e-08,
       1.27220182e-06, 1.27220182e-06, 1.27220182e-06, 1.27220182e-06,
       5.38804120e-08, 1.80266398e-08, 5.38804120e-08, 1.27220182e-06,
       5.38804120e-08, 1.41434811e-07, 1.27220182e-06, 1.27220182e-06,
       1.27220182e-06, 5.38804120e-08, 1.23817565e-08, 1.41434811e-07,
       5.38804120e-08, 1.27220182e-06, 1.27220182e-06, 1.41434811e-07,
       1.27220182e-06, 1.41434811e-07, 1.23817565e-08, 2.87943544e-08,
       1.27220182e-06, 1.23817565e-08, 1.23817565e-08, 1.27220182e-06,
       1.23817565e-08, 1.41434811e-07, 5.38804120e-08, 9.04236990e-09,
       1.41434811e-07, 1.41434811e-07, 1.41434811e-07, 1.27220182e-06,
       1.80266398e-08, 1.80266398e-08, 1.41434811e-07]),)
[INFO][13:25:37]: [Server #3536466] Selected clients: [ 1 60 28 69 80]
[INFO][13:25:37]: [Server #3536466] Selecting client #80 for training.
[INFO][13:25:37]: [Server #3536466] Sending the current model to client #80 (simulated).
[INFO][13:25:42]: [Server #3536466] Sending 507.38 MB of payload data to client #80 (simulated).
[INFO][13:25:42]: [Server #3536466] Selecting client #1 for training.
[INFO][13:25:42]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][13:25:47]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][13:25:47]: [Client #80] Selected by the server.
[INFO][13:25:47]: [Client #80] Loading its data source...
[INFO][13:25:47]: [Client #80] Dataset size: 2018
[INFO][13:25:47]: [Client #80] Sampler: iid
[INFO][13:25:47]: [Client #1] Selected by the server.
[INFO][13:25:47]: [Client #1] Loading its data source...
[INFO][13:25:47]: [Client #1] Dataset size: 2018
[INFO][13:25:47]: [Client #1] Sampler: iid
[INFO][13:25:48]: [Client #80] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:25:48]: [Client #80] Start to process inbound data.
[INFO][13:25:48]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:25:48]: [Client #1] Start to process inbound data.
[INFO][13:25:49]: [93m[1m[Client #1] Started training in communication round #92.[0m
[INFO][13:25:49]: [93m[1m[Client #80] Started training in communication round #92.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:49,  4.89s/it]  2%|▏         | 1/48 [00:04<03:49,  4.89s/it]  4%|▍         | 2/48 [00:05<01:58,  2.57s/it]  4%|▍         | 2/48 [00:05<01:58,  2.58s/it]  6%|▋         | 3/48 [00:06<01:21,  1.82s/it]  6%|▋         | 3/48 [00:06<01:22,  1.83s/it]  8%|▊         | 4/48 [00:07<01:03,  1.45s/it]  8%|▊         | 4/48 [00:07<01:04,  1.46s/it] 10%|█         | 5/48 [00:08<00:52,  1.22s/it] 10%|█         | 5/48 [00:08<00:52,  1.23s/it] 12%|█▎        | 6/48 [00:09<00:44,  1.07s/it] 12%|█▎        | 6/48 [00:09<00:45,  1.08s/it] 15%|█▍        | 7/48 [00:09<00:39,  1.05it/s] 15%|█▍        | 7/48 [00:10<00:40,  1.02it/s] 17%|█▋        | 8/48 [00:10<00:35,  1.13it/s] 17%|█▋        | 8/48 [00:10<00:35,  1.11it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.20it/s] 19%|█▉        | 9/48 [00:11<00:33,  1.18it/s] 21%|██        | 10/48 [00:12<00:30,  1.23it/s] 21%|██        | 10/48 [00:12<00:30,  1.23it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:13<00:29,  1.26it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:15<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:15<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.37it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:20<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:20<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:21<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:22<00:18,  1.32it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:24<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:26<00:14,  1.33it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:27<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:29<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.33it/s] 71%|███████   | 34/48 [00:29<00:10,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.32it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:36<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:39<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:40<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.39it/s]100%|██████████| 48/48 [00:40<00:00,  1.19it/s]
100%|██████████| 48/48 [00:40<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.40it/s]100%|██████████| 48/48 [00:40<00:00,  1.19it/s]
[INFO][13:26:35]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 40.3195, 'train_samples_per_second': 150.151, 'train_steps_per_second': 1.19, 'train_loss': 1.8660496075948079, 'epoch': 3.0}
[INFO][13:26:36]: [Client #80] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_80_3536584.pth.
{'train_runtime': 40.4037, 'train_samples_per_second': 149.838, 'train_steps_per_second': 1.188, 'train_loss': 2.6286706924438477, 'epoch': 3.0}
[INFO][13:26:36]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][13:26:37]: [Client #1] Model trained.
[INFO][13:26:37]: [Client #1] Inbound data has been processed.
[INFO][13:26:37]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][13:26:37]: [Client #80] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_80_3536584.pth.
[INFO][13:26:37]: [Client #80] Model trained.
[INFO][13:26:37]: [Client #80] Inbound data has been processed.
[INFO][13:26:37]: [Client #80] Outbound data is ready to be sent after being processed.
[INFO][13:26:44]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:26:46]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][13:26:46]: [Client #80] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:26:47]: [Server #3536466] Received 507.38 MB of payload data from client #80 (simulated).
[INFO][13:26:47]: [Server #3536466] Selecting client #28 for training.
[INFO][13:26:47]: [Server #3536466] Sending the current model to client #28 (simulated).
[INFO][13:26:51]: [Server #3536466] Sending 507.38 MB of payload data to client #28 (simulated).
[INFO][13:26:51]: [Server #3536466] Selecting client #69 for training.
[INFO][13:26:51]: [Server #3536466] Sending the current model to client #69 (simulated).
[INFO][13:26:56]: [Server #3536466] Sending 507.38 MB of payload data to client #69 (simulated).
[INFO][13:26:56]: [Client #28] Selected by the server.
[INFO][13:26:56]: [Client #28] Loading its data source...
[INFO][13:26:56]: [Client #28] Dataset size: 2018
[INFO][13:26:56]: [Client #69] Selected by the server.
[INFO][13:26:56]: [Client #28] Sampler: iid
[INFO][13:26:56]: [Client #69] Loading its data source...
[INFO][13:26:56]: [Client #69] Dataset size: 2018
[INFO][13:26:56]: [Client #69] Sampler: iid
[INFO][13:26:58]: [Client #28] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:26:58]: [Client #28] Start to process inbound data.
[INFO][13:26:58]: [Client #69] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:26:58]: [Client #69] Start to process inbound data.
[INFO][13:26:58]: [93m[1m[Client #69] Started training in communication round #92.[0m
[INFO][13:26:58]: [93m[1m[Client #28] Started training in communication round #92.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:32,  4.51s/it]  2%|▏         | 1/48 [00:05<04:02,  5.16s/it]  4%|▍         | 2/48 [00:05<01:46,  2.32s/it]  4%|▍         | 2/48 [00:05<01:58,  2.58s/it]  6%|▋         | 3/48 [00:06<01:11,  1.58s/it]  6%|▋         | 3/48 [00:06<01:18,  1.75s/it]  8%|▊         | 4/48 [00:06<00:54,  1.24s/it]  8%|▊         | 4/48 [00:07<00:59,  1.35s/it] 10%|█         | 5/48 [00:07<00:45,  1.06s/it] 10%|█         | 5/48 [00:08<00:48,  1.14s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.05it/s] 12%|█▎        | 6/48 [00:08<00:42,  1.01s/it] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.08it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.16it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.20it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.36it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.32it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:26<00:14,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.54it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.54it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
[INFO][13:27:44]: [Client #28] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_28_3536584.pth.
{'train_runtime': 39.4207, 'train_samples_per_second': 153.574, 'train_steps_per_second': 1.218, 'train_loss': 2.764834721883138, 'epoch': 3.0}
[INFO][13:27:45]: [Client #69] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536585.pth.
{'train_runtime': 39.8822, 'train_samples_per_second': 151.797, 'train_steps_per_second': 1.204, 'train_loss': 2.354703744252523, 'epoch': 3.0}
[INFO][13:27:45]: [Client #28] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_28_3536584.pth.
[INFO][13:27:46]: [Client #69] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_69_3536585.pth.
[INFO][13:27:46]: [Client #28] Model trained.
[INFO][13:27:46]: [Client #28] Inbound data has been processed.
[INFO][13:27:46]: [Client #28] Outbound data is ready to be sent after being processed.
[INFO][13:27:46]: [Client #69] Model trained.
[INFO][13:27:46]: [Client #69] Inbound data has been processed.
[INFO][13:27:46]: [Client #69] Outbound data is ready to be sent after being processed.
[INFO][13:27:54]: [Client #28] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:27:56]: [Server #3536466] Received 507.38 MB of payload data from client #28 (simulated).
[INFO][13:27:56]: [Client #69] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:27:57]: [Server #3536466] Received 507.38 MB of payload data from client #69 (simulated).
[INFO][13:27:57]: [Server #3536466] Selecting client #60 for training.
[INFO][13:27:57]: [Server #3536466] Sending the current model to client #60 (simulated).
[INFO][13:28:02]: [Server #3536466] Sending 507.38 MB of payload data to client #60 (simulated).
[INFO][13:28:02]: [Client #60] Selected by the server.
[INFO][13:28:02]: [Client #60] Loading its data source...
[INFO][13:28:02]: [Client #60] Dataset size: 2018
[INFO][13:28:02]: [Client #60] Sampler: iid
[INFO][13:28:03]: [Client #60] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:28:03]: [Client #60] Start to process inbound data.
[INFO][13:28:03]: [93m[1m[Client #60] Started training in communication round #92.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.23s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.88it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.93it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.97it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.00it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.02it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.03it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.12it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.07it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.10it/s] 71%|███████   | 34/48 [00:20<00:06,  2.09it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.07it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.06it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.06it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.05it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.04it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.04it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.04it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.04it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.04it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.04it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.04it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.04it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.03it/s]100%|██████████| 48/48 [00:26<00:00,  2.13it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.13it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][13:28:36]: [Client #60] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
{'train_runtime': 26.8719, 'train_samples_per_second': 225.291, 'train_steps_per_second': 1.786, 'train_loss': 2.5825271606445312, 'epoch': 3.0}
[INFO][13:28:37]: [Client #60] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
[INFO][13:28:38]: [Client #60] Model trained.
[INFO][13:28:38]: [Client #60] Inbound data has been processed.
[INFO][13:28:38]: [Client #60] Outbound data is ready to be sent after being processed.
[INFO][13:28:43]: [Client #60] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:28:44]: [Server #3536466] Received 507.38 MB of payload data from client #60 (simulated).
[INFO][13:28:44]: [Server #3536466] Adding client #23 to the list of clients for aggregation.
[INFO][13:28:44]: [Server #3536466] Adding client #89 to the list of clients for aggregation.
[INFO][13:28:44]: [Server #3536466] Adding client #76 to the list of clients for aggregation.
[INFO][13:28:44]: [Server #3536466] Adding client #81 to the list of clients for aggregation.
[INFO][13:28:44]: [Server #3536466] Adding client #6 to the list of clients for aggregation.
[INFO][13:28:44]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:28:44]: [Server #3536466] Updated weights have been received.
[INFO][13:28:45]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:28:46]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:28:46]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.1215e+00  1e+02  1e+00  1e+00
 1:  3.0164e+00  2.1418e+00  4e+00  3e-02  3e-02
 2:  3.1279e+00  2.3787e+00  8e-01  3e-05  3e-05
 3:  3.1276e+00  3.1137e+00  1e-02  5e-07  5e-07
 4:  3.1255e+00  3.1210e+00  4e-03  2e-07  2e-07
 5:  3.1234e+00  3.1197e+00  4e-03  8e-07  6e-07
 6:  3.1226e+00  3.1212e+00  1e-03  4e-07  3e-07
 7:  3.1219e+00  3.1213e+00  7e-04  2e-06  2e-06
 8:  3.1213e+00  3.1213e+00  7e-05  1e-06  1e-06
 9:  3.1213e+00  3.1213e+00  5e-06  1e-07  1e-07
10:  3.1213e+00  3.1213e+00  6e-08  2e-09  1e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [0.1 1.1 1.1 2.1 1.1 2.1 1.1 2.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 4.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 7.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.91it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.40it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.81it/s]100%|██████████| 8/8 [00:00<00:00, 11.61it/s]
[INFO][13:28:56]: [93m[1m[Server #3536466] Global model perplexity: 23.84
[0m
[INFO][13:28:56]: [Server #3536466] All client reports have been processed.
[INFO][13:28:57]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_92.pth.
[INFO][13:29:00]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_92.pth.
[INFO][13:29:00]: [93m[1m
[Server #3536466] Starting round 93/100.[0m
[INFO][13:29:00]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.49997246e-02, 2.49997246e-02, 4.72247478e-07, 2.49997246e-02,
       4.72247478e-07, 2.49997246e-02, 4.72247478e-07, 2.49997246e-02,
       2.49997246e-02, 2.84911153e-08, 4.72247478e-07, 2.49997246e-02,
       2.49997246e-02, 4.72247478e-07, 2.49997246e-02, 2.49997246e-02,
       2.49997246e-02, 5.31558469e-08, 1.22512846e-07, 2.49997246e-02,
       1.74891767e-08, 2.49997246e-02, 1.74891767e-08, 1.74891767e-08,
       1.74891767e-08, 2.49997246e-02, 5.31558469e-08, 4.72247478e-07,
       1.74891767e-08, 4.72247478e-07, 2.49997246e-02, 4.72247478e-07,
       4.72247478e-07, 4.72247478e-07, 2.49997246e-02, 4.72247478e-07,
       1.74891767e-08, 2.84911153e-08, 2.49997246e-02, 2.49997246e-02,
       2.49997246e-02, 2.84911153e-08, 2.49997246e-02, 2.49997246e-02,
       5.31558469e-08, 2.49997246e-02, 2.84911153e-08, 1.74891767e-08,
       1.74891767e-08, 2.84911153e-08, 2.49997246e-02, 2.49997246e-02,
       2.49997246e-02, 1.74891767e-08, 2.49997246e-02, 1.74891767e-08,
       2.49997246e-02, 2.49997246e-02, 2.49997246e-02, 1.22512846e-07,
       2.84911153e-08, 1.22512846e-07, 2.49997246e-02, 1.22512846e-07,
       4.72247478e-07, 2.49997246e-02, 2.49997246e-02, 1.22512846e-07,
       1.74891767e-08, 4.72247478e-07, 1.22512846e-07, 2.49997246e-02,
       2.49997246e-02, 2.49997246e-02, 4.72247478e-07, 2.49997246e-02,
       4.72247478e-07, 1.74891767e-08, 5.31558469e-08, 2.49997246e-02,
       1.74891767e-08, 1.74891767e-08, 2.49997246e-02, 2.49997246e-02,
       1.74891767e-08, 4.72247478e-07, 1.22512846e-07, 1.21086450e-08,
       4.72247478e-07, 4.72247478e-07, 4.72247478e-07, 2.49997246e-02,
       2.84911153e-08, 2.84911153e-08, 4.72247478e-07]),)
[INFO][13:29:00]: [Server #3536466] Selected clients: [70 43 16  3 27]
[INFO][13:29:00]: [Server #3536466] Selecting client #16 for training.
[INFO][13:29:00]: [Server #3536466] Sending the current model to client #16 (simulated).
[INFO][13:29:05]: [Server #3536466] Sending 507.38 MB of payload data to client #16 (simulated).
[INFO][13:29:05]: [Server #3536466] Selecting client #3 for training.
[INFO][13:29:05]: [Server #3536466] Sending the current model to client #3 (simulated).
[INFO][13:29:10]: [Server #3536466] Sending 507.38 MB of payload data to client #3 (simulated).
[INFO][13:29:10]: [Client #16] Selected by the server.
[INFO][13:29:10]: [Client #16] Loading its data source...
[INFO][13:29:10]: [Client #16] Dataset size: 2018
[INFO][13:29:10]: [Client #16] Sampler: iid
[INFO][13:29:10]: [Client #3] Selected by the server.
[INFO][13:29:10]: [Client #3] Loading its data source...
[INFO][13:29:10]: [Client #3] Dataset size: 2018
[INFO][13:29:10]: [Client #3] Sampler: iid
[INFO][13:29:11]: [Client #16] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:29:11]: [Client #16] Start to process inbound data.
[INFO][13:29:11]: [Client #3] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:29:11]: [Client #3] Start to process inbound data.
[INFO][13:29:12]: [93m[1m[Client #16] Started training in communication round #93.[0m
[INFO][13:29:12]: [93m[1m[Client #3] Started training in communication round #93.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.22s/it]  2%|▏         | 1/48 [00:04<03:48,  4.86s/it]  4%|▍         | 2/48 [00:04<01:38,  2.15s/it]  4%|▍         | 2/48 [00:05<01:53,  2.47s/it]  6%|▋         | 3/48 [00:05<01:09,  1.54s/it]  6%|▋         | 3/48 [00:06<01:17,  1.72s/it]  8%|▊         | 4/48 [00:06<00:55,  1.26s/it]  8%|▊         | 4/48 [00:07<00:59,  1.35s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 10%|█         | 5/48 [00:07<00:48,  1.12s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:30,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.34it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.32it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.34it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.31it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.33it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.32it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.31it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.32it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][13:29:58]: [Client #16] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_16_3536584.pth.
{'train_runtime': 39.3145, 'train_samples_per_second': 153.989, 'train_steps_per_second': 1.221, 'train_loss': 2.62604554494222, 'epoch': 3.0}
[INFO][13:29:58]: [Client #3] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_3_3536585.pth.
{'train_runtime': 39.6668, 'train_samples_per_second': 152.621, 'train_steps_per_second': 1.21, 'train_loss': 2.5069327354431152, 'epoch': 3.0}
[INFO][13:29:59]: [Client #16] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_16_3536584.pth.
[INFO][13:29:59]: [Client #3] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_3_3536585.pth.
[INFO][13:29:59]: [Client #16] Model trained.
[INFO][13:29:59]: [Client #16] Inbound data has been processed.
[INFO][13:29:59]: [Client #16] Outbound data is ready to be sent after being processed.
[INFO][13:30:00]: [Client #3] Model trained.
[INFO][13:30:00]: [Client #3] Inbound data has been processed.
[INFO][13:30:00]: [Client #3] Outbound data is ready to be sent after being processed.
[INFO][13:30:08]: [Client #16] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:30:09]: [Client #3] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:30:09]: [Server #3536466] Received 507.38 MB of payload data from client #16 (simulated).
[INFO][13:30:10]: [Server #3536466] Received 507.38 MB of payload data from client #3 (simulated).
[INFO][13:30:10]: [Server #3536466] Selecting client #70 for training.
[INFO][13:30:10]: [Server #3536466] Sending the current model to client #70 (simulated).
[INFO][13:30:15]: [Server #3536466] Sending 507.38 MB of payload data to client #70 (simulated).
[INFO][13:30:15]: [Server #3536466] Selecting client #27 for training.
[INFO][13:30:15]: [Server #3536466] Sending the current model to client #27 (simulated).
[INFO][13:30:20]: [Server #3536466] Sending 507.38 MB of payload data to client #27 (simulated).
[INFO][13:30:20]: [Client #70] Selected by the server.
[INFO][13:30:20]: [Client #70] Loading its data source...
[INFO][13:30:20]: [Client #70] Dataset size: 2018
[INFO][13:30:20]: [Client #70] Sampler: iid
[INFO][13:30:20]: [Client #27] Selected by the server.
[INFO][13:30:20]: [Client #27] Loading its data source...
[INFO][13:30:20]: [Client #27] Dataset size: 2018
[INFO][13:30:20]: [Client #27] Sampler: iid
[INFO][13:30:21]: [Client #27] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:30:21]: [Client #27] Start to process inbound data.
[INFO][13:30:21]: [Client #70] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:30:21]: [Client #70] Start to process inbound data.
[INFO][13:30:21]: [93m[1m[Client #70] Started training in communication round #93.[0m
[INFO][13:30:22]: [93m[1m[Client #27] Started training in communication round #93.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:30,  4.47s/it]  2%|▏         | 1/48 [00:04<03:40,  4.69s/it]  4%|▍         | 2/48 [00:05<01:46,  2.31s/it]  4%|▍         | 2/48 [00:05<01:51,  2.43s/it]  6%|▋         | 3/48 [00:06<01:12,  1.62s/it]  6%|▋         | 3/48 [00:06<01:14,  1.66s/it]  8%|▊         | 4/48 [00:06<00:56,  1.29s/it]  8%|▊         | 4/48 [00:06<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.22it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.30it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.29it/s] 60%|██████    | 29/48 [00:25<00:14,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.31it/s] 65%|██████▍   | 31/48 [00:27<00:13,  1.31it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.31it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.30it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.31it/s]100%|██████████| 48/48 [00:39<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][13:31:08]: [Client #70] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_70_3536584.pth.
{'train_runtime': 39.6424, 'train_samples_per_second': 152.715, 'train_steps_per_second': 1.211, 'train_loss': 2.578746795654297, 'epoch': 3.0}
[INFO][13:31:08]: [Client #27] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_27_3536585.pth.
{'train_runtime': 39.7039, 'train_samples_per_second': 152.479, 'train_steps_per_second': 1.209, 'train_loss': 2.4223883946736655, 'epoch': 3.0}
[INFO][13:31:09]: [Client #70] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_70_3536584.pth.
[INFO][13:31:09]: [Client #27] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_27_3536585.pth.
[INFO][13:31:10]: [Client #70] Model trained.
[INFO][13:31:10]: [Client #70] Inbound data has been processed.
[INFO][13:31:10]: [Client #70] Outbound data is ready to be sent after being processed.
[INFO][13:31:10]: [Client #27] Model trained.
[INFO][13:31:10]: [Client #27] Inbound data has been processed.
[INFO][13:31:10]: [Client #27] Outbound data is ready to be sent after being processed.
[INFO][13:31:19]: [Client #70] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:31:19]: [Client #27] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:31:20]: [Server #3536466] Received 507.38 MB of payload data from client #70 (simulated).
[INFO][13:31:21]: [Server #3536466] Received 507.38 MB of payload data from client #27 (simulated).
[INFO][13:31:21]: [Server #3536466] Selecting client #43 for training.
[INFO][13:31:21]: [Server #3536466] Sending the current model to client #43 (simulated).
[INFO][13:31:26]: [Server #3536466] Sending 507.38 MB of payload data to client #43 (simulated).
[INFO][13:31:26]: [Client #43] Selected by the server.
[INFO][13:31:26]: [Client #43] Loading its data source...
[INFO][13:31:26]: [Client #43] Dataset size: 2018
[INFO][13:31:26]: [Client #43] Sampler: iid
[INFO][13:31:27]: [Client #43] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:31:27]: [Client #43] Start to process inbound data.
[INFO][13:31:27]: [93m[1m[Client #43] Started training in communication round #93.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.23s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.09it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.08it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.07it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.06it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.06it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.05it/s] 50%|█████     | 24/48 [00:15<00:11,  2.05it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.05it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.05it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.05it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.05it/s] 60%|██████    | 29/48 [00:17<00:09,  2.05it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.05it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.04it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.15it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.11it/s] 71%|███████   | 34/48 [00:20<00:06,  2.09it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.08it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.07it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.06it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.06it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.05it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.04it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.04it/s] 88%|████████▊ | 42/48 [00:24<00:02,  2.04it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.04it/s] 92%|█████████▏| 44/48 [00:25<00:01,  2.04it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.04it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.04it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.04it/s]100%|██████████| 48/48 [00:26<00:00,  2.15it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.15it/s]100%|██████████| 48/48 [00:26<00:00,  1.78it/s]
[INFO][13:32:00]: [Client #43] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536584.pth.
{'train_runtime': 26.8957, 'train_samples_per_second': 225.092, 'train_steps_per_second': 1.785, 'train_loss': 2.2139755884806314, 'epoch': 3.0}
[INFO][13:32:02]: [Client #43] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536584.pth.
[INFO][13:32:02]: [Client #43] Model trained.
[INFO][13:32:02]: [Client #43] Inbound data has been processed.
[INFO][13:32:02]: [Client #43] Outbound data is ready to be sent after being processed.
[INFO][13:32:07]: [Client #43] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:32:09]: [Server #3536466] Received 507.38 MB of payload data from client #43 (simulated).
[INFO][13:32:09]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][13:32:09]: [Server #3536466] Adding client #69 to the list of clients for aggregation.
[INFO][13:32:09]: [Server #3536466] Adding client #80 to the list of clients for aggregation.
[INFO][13:32:09]: [Server #3536466] Adding client #43 to the list of clients for aggregation.
[INFO][13:32:09]: [Server #3536466] Adding client #60 to the list of clients for aggregation.
[INFO][13:32:09]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:32:09]: [Server #3536466] Updated weights have been received.
[INFO][13:32:09]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:32:10]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:32:10]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.1226e+00  1e+02  1e+00  1e+00
 1:  3.0176e+00  2.1429e+00  4e+00  3e-02  3e-02
 2:  3.1290e+00  2.3800e+00  8e-01  3e-05  3e-05
 3:  3.1287e+00  3.1158e+00  1e-02  5e-07  4e-07
 4:  3.1262e+00  3.1231e+00  3e-03  2e-07  1e-07
 5:  3.1233e+00  3.1232e+00  2e-04  7e-07  1e-07
 6:  3.1232e+00  3.1232e+00  5e-06  2e-08  4e-09
 7:  3.1232e+00  3.1232e+00  6e-08  3e-10  5e-11
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 2.1 1.1 2.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 4.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 0.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 7.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.03it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.34it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.82it/s]100%|██████████| 8/8 [00:00<00:00, 11.68it/s]
[INFO][13:32:20]: [93m[1m[Server #3536466] Global model perplexity: 26.66
[0m
[INFO][13:32:20]: [Server #3536466] All client reports have been processed.
[INFO][13:32:21]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_93.pth.
[INFO][13:32:24]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_93.pth.
[INFO][13:32:24]: [93m[1m
[Server #3536466] Starting round 94/100.[0m
[INFO][13:32:24]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([1.27220182e-06, 1.27220182e-06, 1.41434811e-07, 1.27220182e-06,
       1.41434811e-07, 1.27220182e-06, 1.41434811e-07, 1.27220182e-06,
       1.27220182e-06, 1.80266398e-08, 1.41434811e-07, 1.27220182e-06,
       1.27220182e-06, 1.41434811e-07, 1.27220182e-06, 1.27220182e-06,
       2.87943544e-08, 5.38804120e-08, 1.27220182e-06, 1.23817565e-08,
       1.27220182e-06, 1.23817565e-08, 1.23817565e-08, 1.23817565e-08,
       2.87943544e-08, 1.41434811e-07, 1.23817565e-08, 1.41434811e-07,
       1.27220182e-06, 1.41434811e-07, 1.41434811e-07, 1.41434811e-07,
       1.27220182e-06, 1.41434811e-07, 1.23817565e-08, 1.80266398e-08,
       1.27220182e-06, 1.27220182e-06, 9.99946724e-01, 1.80266398e-08,
       1.27220182e-06, 1.27220182e-06, 2.87943544e-08, 1.27220182e-06,
       1.80266398e-08, 1.23817565e-08, 1.23817565e-08, 1.80266398e-08,
       1.27220182e-06, 1.27220182e-06, 1.27220182e-06, 1.23817565e-08,
       1.27220182e-06, 1.23817565e-08, 1.27220182e-06, 1.27220182e-06,
       1.27220182e-06, 1.27220182e-06, 5.38804120e-08, 1.80266398e-08,
       5.38804120e-08, 1.27220182e-06, 5.38804120e-08, 1.41434811e-07,
       1.27220182e-06, 1.27220182e-06, 5.38804120e-08, 1.23817565e-08,
       1.41434811e-07, 5.38804120e-08, 1.27220182e-06, 1.27220182e-06,
       1.27220182e-06, 1.41434811e-07, 1.27220182e-06, 1.27220182e-06,
       1.41434811e-07, 1.23817565e-08, 2.87943544e-08, 1.27220182e-06,
       1.23817565e-08, 1.23817565e-08, 1.27220182e-06, 1.27220182e-06,
       1.23817565e-08, 1.41434811e-07, 5.38804120e-08, 9.04236990e-09,
       1.41434811e-07, 1.41434811e-07, 1.41434811e-07, 1.27220182e-06,
       1.80266398e-08, 1.80266398e-08, 1.41434811e-07]),)
[INFO][13:32:24]: [Server #3536466] Selected clients: [43 54  2 10 14]
[INFO][13:32:24]: [Server #3536466] Selecting client #2 for training.
[INFO][13:32:24]: [Server #3536466] Sending the current model to client #2 (simulated).
[INFO][13:32:29]: [Server #3536466] Sending 507.38 MB of payload data to client #2 (simulated).
[INFO][13:32:29]: [Server #3536466] Selecting client #43 for training.
[INFO][13:32:29]: [Server #3536466] Sending the current model to client #43 (simulated).
[INFO][13:32:34]: [Server #3536466] Sending 507.38 MB of payload data to client #43 (simulated).
[INFO][13:32:34]: [Client #2] Selected by the server.
[INFO][13:32:34]: [Client #2] Loading its data source...
[INFO][13:32:34]: [Client #2] Dataset size: 2018
[INFO][13:32:34]: [Client #2] Sampler: iid
[INFO][13:32:34]: [Client #43] Selected by the server.
[INFO][13:32:34]: [Client #43] Loading its data source...
[INFO][13:32:34]: [Client #43] Dataset size: 2018
[INFO][13:32:34]: [Client #43] Sampler: iid
[INFO][13:32:36]: [Client #2] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:32:36]: [Client #2] Start to process inbound data.
[INFO][13:32:36]: [Client #43] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:32:36]: [Client #43] Start to process inbound data.
[INFO][13:32:36]: [93m[1m[Client #43] Started training in communication round #94.[0m
[INFO][13:32:37]: [93m[1m[Client #2] Started training in communication round #94.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.21s/it]  2%|▏         | 1/48 [00:04<03:48,  4.87s/it]  4%|▍         | 2/48 [00:04<01:38,  2.14s/it]  4%|▍         | 2/48 [00:05<01:57,  2.56s/it]  6%|▋         | 3/48 [00:05<01:11,  1.59s/it]  6%|▋         | 3/48 [00:06<01:19,  1.76s/it]  8%|▊         | 4/48 [00:06<00:56,  1.29s/it]  8%|▊         | 4/48 [00:07<00:59,  1.35s/it] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 10%|█         | 5/48 [00:08<00:48,  1.13s/it] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 12%|█▎        | 6/48 [00:08<00:42,  1.00s/it] 15%|█▍        | 7/48 [00:08<00:37,  1.10it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.22it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.21it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.32it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.54it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.54it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][13:33:22]: [Client #2] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
{'train_runtime': 39.3695, 'train_samples_per_second': 153.774, 'train_steps_per_second': 1.219, 'train_loss': 2.5620827674865723, 'epoch': 3.0}
[INFO][13:33:23]: [Client #43] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536585.pth.
{'train_runtime': 39.7256, 'train_samples_per_second': 152.395, 'train_steps_per_second': 1.208, 'train_loss': 2.1602161725362143, 'epoch': 3.0}
[INFO][13:33:23]: [Client #2] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_2_3536584.pth.
[INFO][13:33:24]: [Client #43] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536585.pth.
[INFO][13:33:24]: [Client #2] Model trained.
[INFO][13:33:24]: [Client #2] Inbound data has been processed.
[INFO][13:33:24]: [Client #2] Outbound data is ready to be sent after being processed.
[INFO][13:33:24]: [Client #43] Model trained.
[INFO][13:33:24]: [Client #43] Inbound data has been processed.
[INFO][13:33:24]: [Client #43] Outbound data is ready to be sent after being processed.
[INFO][13:33:32]: [Client #2] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:33:33]: [Client #43] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:33:33]: [Server #3536466] Received 507.38 MB of payload data from client #2 (simulated).
[INFO][13:33:34]: [Server #3536466] Received 507.38 MB of payload data from client #43 (simulated).
[INFO][13:33:34]: [Server #3536466] Selecting client #54 for training.
[INFO][13:33:34]: [Server #3536466] Sending the current model to client #54 (simulated).
[INFO][13:33:40]: [Server #3536466] Sending 507.38 MB of payload data to client #54 (simulated).
[INFO][13:33:40]: [Client #54] Selected by the server.
[INFO][13:33:40]: [Client #54] Loading its data source...
[INFO][13:33:40]: [Client #54] Dataset size: 2018
[INFO][13:33:40]: [Client #54] Sampler: iid
[INFO][13:33:41]: [Client #54] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:33:41]: [Client #54] Start to process inbound data.
[INFO][13:33:41]: [93m[1m[Client #54] Started training in communication round #94.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:20,  4.26s/it]  4%|▍         | 2/48 [00:04<01:34,  2.05s/it]  6%|▋         | 3/48 [00:05<01:00,  1.34s/it]  8%|▊         | 4/48 [00:05<00:44,  1.00s/it] 10%|█         | 5/48 [00:06<00:35,  1.22it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.42it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.58it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.70it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.79it/s] 21%|██        | 10/48 [00:08<00:20,  1.86it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.91it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.95it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.98it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.00it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.02it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.14it/s] 35%|███▌      | 17/48 [00:12<00:14,  2.12it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.11it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.10it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.10it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.10it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.10it/s] 50%|█████     | 24/48 [00:15<00:11,  2.10it/s] 52%|█████▏    | 25/48 [00:15<00:10,  2.10it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.10it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.09it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.09it/s] 60%|██████    | 29/48 [00:17<00:09,  2.09it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.10it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.10it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.21it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.17it/s] 71%|███████   | 34/48 [00:20<00:06,  2.14it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.12it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.11it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.10it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.10it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.09it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.06it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.06it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.05it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.05it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.05it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.05it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.05it/s]100%|██████████| 48/48 [00:26<00:00,  2.15it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.15it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][13:34:14]: [Client #54] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_54_3536584.pth.
{'train_runtime': 26.7798, 'train_samples_per_second': 226.066, 'train_steps_per_second': 1.792, 'train_loss': 2.5830537478129068, 'epoch': 3.0}
[INFO][13:34:15]: [Client #54] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_54_3536584.pth.
[INFO][13:34:16]: [Client #54] Model trained.
[INFO][13:34:16]: [Client #54] Inbound data has been processed.
[INFO][13:34:16]: [Client #54] Outbound data is ready to be sent after being processed.
[INFO][13:34:21]: [Client #54] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:34:22]: [Server #3536466] Received 507.38 MB of payload data from client #54 (simulated).
[INFO][13:34:22]: [Server #3536466] Selecting client #10 for training.
[INFO][13:34:22]: [Server #3536466] Sending the current model to client #10 (simulated).
[INFO][13:34:27]: [Server #3536466] Sending 507.38 MB of payload data to client #10 (simulated).
[INFO][13:34:27]: [Client #10] Selected by the server.
[INFO][13:34:27]: [Client #10] Loading its data source...
[INFO][13:34:27]: [Client #10] Dataset size: 2018
[INFO][13:34:27]: [Client #10] Sampler: iid
[INFO][13:34:29]: [Client #10] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:34:29]: [Client #10] Start to process inbound data.
[INFO][13:34:29]: [93m[1m[Client #10] Started training in communication round #94.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.10it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.05it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.05it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.15it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.11it/s] 71%|███████   | 34/48 [00:20<00:06,  2.09it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.08it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.07it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.06it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.05it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.06it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.06it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.06it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][13:35:02]: [Client #10] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
{'train_runtime': 26.7476, 'train_samples_per_second': 226.338, 'train_steps_per_second': 1.795, 'train_loss': 2.405170281728109, 'epoch': 3.0}
[INFO][13:35:03]: [Client #10] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_10_3536584.pth.
[INFO][13:35:03]: [Client #10] Model trained.
[INFO][13:35:03]: [Client #10] Inbound data has been processed.
[INFO][13:35:03]: [Client #10] Outbound data is ready to be sent after being processed.
[INFO][13:35:08]: [Client #10] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:35:09]: [Server #3536466] Received 507.38 MB of payload data from client #10 (simulated).
[INFO][13:35:09]: [Server #3536466] Selecting client #14 for training.
[INFO][13:35:09]: [Server #3536466] Sending the current model to client #14 (simulated).
[INFO][13:35:15]: [Server #3536466] Sending 507.38 MB of payload data to client #14 (simulated).
[INFO][13:35:15]: [Client #14] Selected by the server.
[INFO][13:35:15]: [Client #14] Loading its data source...
[INFO][13:35:15]: [Client #14] Dataset size: 2018
[INFO][13:35:15]: [Client #14] Sampler: iid
[INFO][13:35:16]: [Client #14] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:35:16]: [Client #14] Start to process inbound data.
[INFO][13:35:16]: [93m[1m[Client #14] Started training in communication round #94.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.25s/it]  4%|▍         | 2/48 [00:04<01:33,  2.04s/it]  6%|▋         | 3/48 [00:05<00:59,  1.33s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.90it/s] 23%|██▎       | 11/48 [00:09<00:18,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.02it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.04it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.15it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.12it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.10it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.09it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.07it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.07it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.06it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.05it/s] 50%|█████     | 24/48 [00:15<00:11,  2.05it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.05it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.05it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.05it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.05it/s] 60%|██████    | 29/48 [00:17<00:09,  2.05it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.05it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.05it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.15it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.12it/s] 71%|███████   | 34/48 [00:20<00:06,  2.10it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.08it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.08it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.07it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.07it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][13:35:50]: [Client #14] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
{'train_runtime': 26.8101, 'train_samples_per_second': 225.811, 'train_steps_per_second': 1.79, 'train_loss': 2.4556562105814614, 'epoch': 3.0}
[INFO][13:35:51]: [Client #14] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_14_3536584.pth.
[INFO][13:35:51]: [Client #14] Model trained.
[INFO][13:35:51]: [Client #14] Inbound data has been processed.
[INFO][13:35:51]: [Client #14] Outbound data is ready to be sent after being processed.
[INFO][13:35:56]: [Client #14] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:35:57]: [Server #3536466] Received 507.38 MB of payload data from client #14 (simulated).
[INFO][13:35:57]: [Server #3536466] Adding client #3 to the list of clients for aggregation.
[INFO][13:35:57]: [Server #3536466] Adding client #27 to the list of clients for aggregation.
[INFO][13:35:57]: [Server #3536466] Adding client #70 to the list of clients for aggregation.
[INFO][13:35:57]: [Server #3536466] Adding client #16 to the list of clients for aggregation.
[INFO][13:35:57]: [Server #3536466] Adding client #28 to the list of clients for aggregation.
[INFO][13:35:57]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:35:57]: [Server #3536466] Updated weights have been received.
[INFO][13:35:58]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:35:58]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:35:58]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.1215e+00  1e+02  1e+00  1e+00
 1:  3.0164e+00  2.1418e+00  4e+00  3e-02  3e-02
 2:  3.1279e+00  2.3787e+00  8e-01  3e-05  3e-05
 3:  3.1276e+00  3.1137e+00  1e-02  5e-07  5e-07
 4:  3.1255e+00  3.1210e+00  4e-03  2e-07  2e-07
 5:  3.1234e+00  3.1197e+00  4e-03  8e-07  6e-07
 6:  3.1226e+00  3.1212e+00  1e-03  4e-07  3e-07
 7:  3.1219e+00  3.1213e+00  7e-04  2e-06  2e-06
 8:  3.1213e+00  3.1213e+00  7e-05  1e-06  1e-06
 9:  3.1213e+00  3.1213e+00  5e-06  1e-07  1e-07
10:  3.1213e+00  3.1213e+00  6e-08  2e-09  1e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 2.1 1.1 2.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 4.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 0.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 7.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.97it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.12it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.65it/s]100%|██████████| 8/8 [00:00<00:00, 11.47it/s]
[INFO][13:36:09]: [93m[1m[Server #3536466] Global model perplexity: 23.23
[0m
[INFO][13:36:09]: [Server #3536466] All client reports have been processed.
[INFO][13:36:09]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_94.pth.
[INFO][13:36:13]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_94.pth.
[INFO][13:36:13]: [93m[1m
[Server #3536466] Starting round 95/100.[0m
[INFO][13:36:13]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.56406788e-02, 2.56406788e-02, 5.55419706e-07, 2.56406788e-02,
       5.55419706e-07, 2.56406788e-02, 5.55419706e-07, 2.56406788e-02,
       3.41048408e-08, 5.55419706e-07, 2.56406788e-02, 5.55419706e-07,
       2.56406788e-02, 2.56406788e-02, 2.56406788e-02, 6.28556244e-08,
       1.43653808e-07, 2.56406788e-02, 2.11948241e-08, 2.56406788e-02,
       2.11948241e-08, 2.11948241e-08, 2.11948241e-08, 2.56406788e-02,
       5.55419706e-07, 6.28556244e-08, 5.55419706e-07, 2.11948241e-08,
       5.55419706e-07, 2.56406788e-02, 5.55419706e-07, 5.55419706e-07,
       5.55419706e-07, 2.56406788e-02, 5.55419706e-07, 2.11948241e-08,
       3.41048408e-08, 2.56406788e-02, 2.56406788e-02, 3.41048408e-08,
       2.56406788e-02, 2.56406788e-02, 6.28556244e-08, 2.56406788e-02,
       3.41048408e-08, 2.11948241e-08, 2.11948241e-08, 3.41048408e-08,
       2.56406788e-02, 2.56406788e-02, 2.11948241e-08, 2.56406788e-02,
       2.11948241e-08, 2.56406788e-02, 2.56406788e-02, 2.56406788e-02,
       2.56406788e-02, 1.43653808e-07, 3.41048408e-08, 1.43653808e-07,
       2.56406788e-02, 1.43653808e-07, 5.55419706e-07, 2.56406788e-02,
       2.56406788e-02, 2.56406788e-02, 1.43653808e-07, 2.11948241e-08,
       5.55419706e-07, 1.43653808e-07, 2.56406788e-02, 2.56406788e-02,
       2.56406788e-02, 5.55419706e-07, 2.56406788e-02, 2.56406788e-02,
       5.55419706e-07, 2.11948241e-08, 6.28556244e-08, 2.56406788e-02,
       2.11948241e-08, 2.11948241e-08, 2.56406788e-02, 2.56406788e-02,
       2.11948241e-08, 5.55419706e-07, 1.43653808e-07, 1.48000940e-08,
       5.55419706e-07, 5.55419706e-07, 5.55419706e-07, 2.56406788e-02,
       3.41048408e-08, 3.41048408e-08, 5.55419706e-07]),)
[INFO][13:36:13]: [Server #3536466] Selected clients: [37  5 60 53 61]
[INFO][13:36:13]: [Server #3536466] Selecting client #60 for training.
[INFO][13:36:13]: [Server #3536466] Sending the current model to client #60 (simulated).
[INFO][13:36:18]: [Server #3536466] Sending 507.38 MB of payload data to client #60 (simulated).
[INFO][13:36:18]: [Server #3536466] Selecting client #5 for training.
[INFO][13:36:18]: [Server #3536466] Sending the current model to client #5 (simulated).
[INFO][13:36:22]: [Server #3536466] Sending 507.38 MB of payload data to client #5 (simulated).
[INFO][13:36:22]: [Client #60] Selected by the server.
[INFO][13:36:22]: [Client #60] Loading its data source...
[INFO][13:36:22]: [Client #60] Dataset size: 2018
[INFO][13:36:22]: [Client #60] Sampler: iid
[INFO][13:36:22]: [Client #5] Selected by the server.
[INFO][13:36:22]: [Client #5] Loading its data source...
[INFO][13:36:22]: [Client #5] Dataset size: 2018
[INFO][13:36:22]: [Client #5] Sampler: iid
[INFO][13:36:23]: [Client #60] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:36:23]: [Client #60] Start to process inbound data.
[INFO][13:36:24]: [Client #5] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:36:24]: [Client #5] Start to process inbound data.
[INFO][13:36:24]: [93m[1m[Client #60] Started training in communication round #95.[0m
[INFO][13:36:24]: [93m[1m[Client #5] Started training in communication round #95.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:45,  4.79s/it]  2%|▏         | 1/48 [00:04<03:43,  4.76s/it]  4%|▍         | 2/48 [00:05<01:50,  2.40s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:30,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.31it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.37it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][13:37:10]: [Client #60] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
{'train_runtime': 39.5784, 'train_samples_per_second': 152.962, 'train_steps_per_second': 1.213, 'train_loss': 2.5467983881632485, 'epoch': 3.0}
[INFO][13:37:10]: [Client #5] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536585.pth.
{'train_runtime': 39.5556, 'train_samples_per_second': 153.051, 'train_steps_per_second': 1.213, 'train_loss': 2.281935214996338, 'epoch': 3.0}
[INFO][13:37:11]: [Client #60] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
[INFO][13:37:11]: [Client #5] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536585.pth.
[INFO][13:37:12]: [Client #60] Model trained.
[INFO][13:37:12]: [Client #60] Inbound data has been processed.
[INFO][13:37:12]: [Client #60] Outbound data is ready to be sent after being processed.
[INFO][13:37:12]: [Client #5] Model trained.
[INFO][13:37:12]: [Client #5] Inbound data has been processed.
[INFO][13:37:12]: [Client #5] Outbound data is ready to be sent after being processed.
[INFO][13:37:21]: [Client #60] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:37:21]: [Client #5] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:37:22]: [Server #3536466] Received 507.38 MB of payload data from client #60 (simulated).
[INFO][13:37:23]: [Server #3536466] Received 507.38 MB of payload data from client #5 (simulated).
[INFO][13:37:23]: [Server #3536466] Selecting client #37 for training.
[INFO][13:37:23]: [Server #3536466] Sending the current model to client #37 (simulated).
[INFO][13:37:28]: [Server #3536466] Sending 507.38 MB of payload data to client #37 (simulated).
[INFO][13:37:28]: [Server #3536466] Selecting client #53 for training.
[INFO][13:37:28]: [Server #3536466] Sending the current model to client #53 (simulated).
[INFO][13:37:33]: [Server #3536466] Sending 507.38 MB of payload data to client #53 (simulated).
[INFO][13:37:33]: [Client #37] Selected by the server.
[INFO][13:37:33]: [Client #53] Selected by the server.
[INFO][13:37:33]: [Client #37] Loading its data source...
[INFO][13:37:33]: [Client #53] Loading its data source...
[INFO][13:37:33]: [Client #37] Dataset size: 2018
[INFO][13:37:33]: [Client #53] Dataset size: 2018
[INFO][13:37:33]: [Client #37] Sampler: iid
[INFO][13:37:33]: [Client #53] Sampler: iid
[INFO][13:37:34]: [Client #53] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:37:34]: [Client #53] Start to process inbound data.
[INFO][13:37:35]: [Client #37] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:37:35]: [Client #37] Start to process inbound data.
[INFO][13:37:35]: [93m[1m[Client #53] Started training in communication round #95.[0m
[INFO][13:37:35]: [93m[1m[Client #37] Started training in communication round #95.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:37,  4.64s/it]  2%|▏         | 1/48 [00:04<03:40,  4.69s/it]  4%|▍         | 2/48 [00:05<01:47,  2.34s/it]  4%|▍         | 2/48 [00:05<01:48,  2.36s/it]  6%|▋         | 3/48 [00:06<01:12,  1.61s/it]  6%|▋         | 3/48 [00:06<01:12,  1.62s/it]  8%|▊         | 4/48 [00:06<00:55,  1.27s/it]  8%|▊         | 4/48 [00:06<00:55,  1.27s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.30it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.35it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.35it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.31it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.31it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.31it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.31it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][13:38:21]: [Client #53] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_53_3536585.pth.
{'train_runtime': 39.4863, 'train_samples_per_second': 153.319, 'train_steps_per_second': 1.216, 'train_loss': 2.4405948321024575, 'epoch': 3.0}
[INFO][13:38:21]: [Client #37] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_37_3536584.pth.
{'train_runtime': 39.4874, 'train_samples_per_second': 153.315, 'train_steps_per_second': 1.216, 'train_loss': 2.52921454111735, 'epoch': 3.0}
[INFO][13:38:22]: [Client #53] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_53_3536585.pth.
[INFO][13:38:23]: [Client #37] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_37_3536584.pth.
[INFO][13:38:24]: [Client #53] Model trained.
[INFO][13:38:24]: [Client #53] Inbound data has been processed.
[INFO][13:38:24]: [Client #53] Outbound data is ready to be sent after being processed.
[INFO][13:38:24]: [Client #37] Model trained.
[INFO][13:38:24]: [Client #37] Inbound data has been processed.
[INFO][13:38:24]: [Client #37] Outbound data is ready to be sent after being processed.
[INFO][13:38:32]: [Client #53] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:38:33]: [Server #3536466] Received 507.38 MB of payload data from client #53 (simulated).
[INFO][13:38:33]: [Client #37] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:38:34]: [Server #3536466] Received 507.38 MB of payload data from client #37 (simulated).
[INFO][13:38:34]: [Server #3536466] Selecting client #61 for training.
[INFO][13:38:34]: [Server #3536466] Sending the current model to client #61 (simulated).
[INFO][13:38:39]: [Server #3536466] Sending 507.38 MB of payload data to client #61 (simulated).
[INFO][13:38:39]: [Client #61] Selected by the server.
[INFO][13:38:39]: [Client #61] Loading its data source...
[INFO][13:38:39]: [Client #61] Dataset size: 2018
[INFO][13:38:39]: [Client #61] Sampler: iid
[INFO][13:38:41]: [Client #61] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:38:41]: [Client #61] Start to process inbound data.
[INFO][13:38:41]: [93m[1m[Client #61] Started training in communication round #95.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.22s/it]  4%|▍         | 2/48 [00:04<01:32,  2.02s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.12it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.11it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.10it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][13:39:13]: [Client #61] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536584.pth.
{'train_runtime': 26.645, 'train_samples_per_second': 227.209, 'train_steps_per_second': 1.801, 'train_loss': 2.178717295328776, 'epoch': 3.0}
[INFO][13:39:15]: [Client #61] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_61_3536584.pth.
[INFO][13:39:15]: [Client #61] Model trained.
[INFO][13:39:15]: [Client #61] Inbound data has been processed.
[INFO][13:39:15]: [Client #61] Outbound data is ready to be sent after being processed.
[INFO][13:39:20]: [Client #61] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:39:21]: [Server #3536466] Received 507.38 MB of payload data from client #61 (simulated).
[INFO][13:39:21]: [Server #3536466] Adding client #10 to the list of clients for aggregation.
[INFO][13:39:21]: [Server #3536466] Adding client #14 to the list of clients for aggregation.
[INFO][13:39:21]: [Server #3536466] Adding client #43 to the list of clients for aggregation.
[INFO][13:39:21]: [Server #3536466] Adding client #54 to the list of clients for aggregation.
[INFO][13:39:21]: [Server #3536466] Adding client #2 to the list of clients for aggregation.
[INFO][13:39:21]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:39:21]: [Server #3536466] Updated weights have been received.
[INFO][13:39:22]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:39:22]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:39:22]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.1254e+00  1e+02  1e+00  1e+00
 1:  3.0208e+00  2.1457e+00  4e+00  3e-02  3e-02
 2:  3.1318e+00  2.3835e+00  8e-01  3e-05  3e-05
 3:  3.1315e+00  3.1186e+00  1e-02  4e-07  4e-07
 4:  3.1291e+00  3.1260e+00  3e-03  2e-07  1e-07
 5:  3.1262e+00  3.1260e+00  2e-04  8e-07  1e-07
 6:  3.1260e+00  3.1260e+00  6e-06  3e-08  5e-09
 7:  3.1260e+00  3.1260e+00  7e-08  3e-10  6e-11
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 2.1 1.1 2.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 4.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 7.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.15it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.33it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.75it/s]100%|██████████| 8/8 [00:00<00:00, 11.60it/s]
[INFO][13:39:33]: [93m[1m[Server #3536466] Global model perplexity: 25.26
[0m
[INFO][13:39:33]: [Server #3536466] All client reports have been processed.
[INFO][13:39:33]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_95.pth.
[INFO][13:39:36]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_95.pth.
[INFO][13:39:37]: [93m[1m
[Server #3536466] Starting round 96/100.[0m
[INFO][13:39:37]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.56406788e-02, 2.56406788e-02, 2.56406788e-02, 5.55419706e-07,
       5.55419706e-07, 2.56406788e-02, 5.55419706e-07, 2.56406788e-02,
       2.56406788e-02, 3.41048408e-08, 5.55419706e-07, 2.56406788e-02,
       2.56406788e-02, 5.55419706e-07, 2.56406788e-02, 2.56406788e-02,
       2.56406788e-02, 6.28556244e-08, 1.43653808e-07, 2.56406788e-02,
       2.11948241e-08, 2.56406788e-02, 2.11948241e-08, 2.11948241e-08,
       2.11948241e-08, 2.56406788e-02, 5.55419706e-07, 6.28556244e-08,
       5.55419706e-07, 2.11948241e-08, 5.55419706e-07, 2.56406788e-02,
       5.55419706e-07, 5.55419706e-07, 5.55419706e-07, 5.55419706e-07,
       2.11948241e-08, 3.41048408e-08, 2.56406788e-02, 2.56406788e-02,
       2.56406788e-02, 3.41048408e-08, 2.56406788e-02, 2.56406788e-02,
       6.28556244e-08, 2.56406788e-02, 3.41048408e-08, 2.11948241e-08,
       2.11948241e-08, 3.41048408e-08, 2.56406788e-02, 2.56406788e-02,
       2.11948241e-08, 2.56406788e-02, 2.11948241e-08, 2.56406788e-02,
       2.56406788e-02, 1.43653808e-07, 3.41048408e-08, 1.43653808e-07,
       2.56406788e-02, 1.43653808e-07, 5.55419706e-07, 2.56406788e-02,
       2.56406788e-02, 2.56406788e-02, 1.43653808e-07, 2.11948241e-08,
       5.55419706e-07, 1.43653808e-07, 2.56406788e-02, 2.56406788e-02,
       2.56406788e-02, 5.55419706e-07, 2.56406788e-02, 2.56406788e-02,
       5.55419706e-07, 2.11948241e-08, 6.28556244e-08, 2.56406788e-02,
       2.11948241e-08, 2.11948241e-08, 2.56406788e-02, 2.56406788e-02,
       2.11948241e-08, 5.55419706e-07, 1.43653808e-07, 1.48000940e-08,
       5.55419706e-07, 5.55419706e-07, 5.55419706e-07, 2.56406788e-02,
       3.41048408e-08, 3.41048408e-08, 5.55419706e-07]),)
[INFO][13:39:37]: [Server #3536466] Selected clients: [42 80 43  1 81]
[INFO][13:39:37]: [Server #3536466] Selecting client #80 for training.
[INFO][13:39:37]: [Server #3536466] Sending the current model to client #80 (simulated).
[INFO][13:39:42]: [Server #3536466] Sending 507.38 MB of payload data to client #80 (simulated).
[INFO][13:39:42]: [Server #3536466] Selecting client #1 for training.
[INFO][13:39:42]: [Server #3536466] Sending the current model to client #1 (simulated).
[INFO][13:39:47]: [Server #3536466] Sending 507.38 MB of payload data to client #1 (simulated).
[INFO][13:39:47]: [Client #80] Selected by the server.
[INFO][13:39:47]: [Client #80] Loading its data source...
[INFO][13:39:47]: [Client #80] Dataset size: 2018
[INFO][13:39:47]: [Client #80] Sampler: iid
[INFO][13:39:47]: [Client #1] Selected by the server.
[INFO][13:39:47]: [Client #1] Loading its data source...
[INFO][13:39:47]: [Client #1] Dataset size: 2018
[INFO][13:39:47]: [Client #1] Sampler: iid
[INFO][13:39:48]: [Client #80] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:39:48]: [Client #80] Start to process inbound data.
[INFO][13:39:48]: [Client #1] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:39:48]: [Client #1] Start to process inbound data.
[INFO][13:39:49]: [93m[1m[Client #80] Started training in communication round #96.[0m
[INFO][13:39:49]: [93m[1m[Client #1] Started training in communication round #96.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:14,  4.14s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:04<01:36,  2.10s/it]  2%|▏         | 1/48 [00:04<03:46,  4.82s/it]  6%|▋         | 3/48 [00:05<01:06,  1.49s/it]  4%|▍         | 2/48 [00:05<01:52,  2.45s/it]  8%|▊         | 4/48 [00:06<00:51,  1.18s/it]  6%|▋         | 3/48 [00:06<01:15,  1.67s/it] 10%|█         | 5/48 [00:07<00:43,  1.02s/it]  8%|▊         | 4/48 [00:07<00:57,  1.30s/it] 12%|█▎        | 6/48 [00:07<00:38,  1.09it/s] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.16it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 17%|█▋        | 8/48 [00:09<00:32,  1.22it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 19%|█▉        | 9/48 [00:09<00:30,  1.26it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.19it/s] 21%|██        | 10/48 [00:10<00:29,  1.29it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.31it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.32it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.34it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.36it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.39it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 50%|█████     | 24/48 [00:20<00:17,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 58%|█████▊    | 28/48 [00:23<00:14,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 67%|██████▋   | 32/48 [00:26<00:11,  1.41it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.35it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 71%|███████   | 34/48 [00:28<00:10,  1.37it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.38it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 75%|███████▌  | 36/48 [00:29<00:08,  1.34it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 83%|████████▎ | 40/48 [00:32<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.34it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 92%|█████████▏| 44/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s]100%|██████████| 48/48 [00:38<00:00,  1.40it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:38<00:00,  1.40it/s]100%|██████████| 48/48 [00:38<00:00,  1.24it/s]
 98%|█████████▊| 47/48 [00:38<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.56it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.56it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][13:40:34]: [Client #80] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_80_3536584.pth.
{'train_runtime': 38.7631, 'train_samples_per_second': 156.179, 'train_steps_per_second': 1.238, 'train_loss': 2.4926112492879233, 'epoch': 3.0}
[INFO][13:40:34]: [Client #1] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
{'train_runtime': 39.3454, 'train_samples_per_second': 153.868, 'train_steps_per_second': 1.22, 'train_loss': 1.7898850440979004, 'epoch': 3.0}
[INFO][13:40:35]: [Client #80] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_80_3536584.pth.
[INFO][13:40:35]: [Client #80] Model trained.
[INFO][13:40:35]: [Client #80] Inbound data has been processed.
[INFO][13:40:35]: [Client #80] Outbound data is ready to be sent after being processed.
[INFO][13:40:35]: [Client #1] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_1_3536585.pth.
[INFO][13:40:36]: [Client #1] Model trained.
[INFO][13:40:36]: [Client #1] Inbound data has been processed.
[INFO][13:40:36]: [Client #1] Outbound data is ready to be sent after being processed.
[INFO][13:40:45]: [Client #80] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:40:45]: [Client #1] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:40:46]: [Server #3536466] Received 507.38 MB of payload data from client #80 (simulated).
[INFO][13:40:46]: [Server #3536466] Received 507.38 MB of payload data from client #1 (simulated).
[INFO][13:40:46]: [Server #3536466] Selecting client #42 for training.
[INFO][13:40:46]: [Server #3536466] Sending the current model to client #42 (simulated).
[INFO][13:40:52]: [Server #3536466] Sending 507.38 MB of payload data to client #42 (simulated).
[INFO][13:40:52]: [Server #3536466] Selecting client #81 for training.
[INFO][13:40:52]: [Server #3536466] Sending the current model to client #81 (simulated).
[INFO][13:40:56]: [Server #3536466] Sending 507.38 MB of payload data to client #81 (simulated).
[INFO][13:40:56]: [Client #42] Selected by the server.
[INFO][13:40:56]: [Client #81] Selected by the server.
[INFO][13:40:56]: [Client #81] Loading its data source...
[INFO][13:40:56]: [Client #42] Loading its data source...
[INFO][13:40:56]: [Client #81] Dataset size: 2018
[INFO][13:40:56]: [Client #42] Dataset size: 2018
[INFO][13:40:56]: [Client #81] Sampler: iid
[INFO][13:40:56]: [Client #42] Sampler: iid
[INFO][13:40:57]: [Client #42] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:40:57]: [Client #42] Start to process inbound data.
[INFO][13:40:57]: [Client #81] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:40:57]: [Client #81] Start to process inbound data.
[INFO][13:40:58]: [93m[1m[Client #42] Started training in communication round #96.[0m
[INFO][13:40:58]: [93m[1m[Client #81] Started training in communication round #96.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:23,  4.32s/it]  2%|▏         | 1/48 [00:04<03:53,  4.97s/it]  4%|▍         | 2/48 [00:05<01:46,  2.32s/it]  4%|▍         | 2/48 [00:05<02:00,  2.63s/it]  6%|▋         | 3/48 [00:06<01:16,  1.70s/it]  6%|▋         | 3/48 [00:06<01:21,  1.81s/it]  8%|▊         | 4/48 [00:06<00:58,  1.32s/it]  8%|▊         | 4/48 [00:07<01:01,  1.40s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 10%|█         | 5/48 [00:08<00:49,  1.16s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.02it/s] 12%|█▎        | 6/48 [00:09<00:42,  1.02s/it] 15%|█▍        | 7/48 [00:09<00:36,  1.11it/s] 15%|█▍        | 7/48 [00:09<00:38,  1.06it/s] 17%|█▋        | 8/48 [00:09<00:34,  1.17it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.22it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.20it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:12<00:31,  1.22it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.29it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:15<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:17<00:23,  1.34it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.39it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:29<00:11,  1.34it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.31it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.30it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.30it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.31it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.31it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.31it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
100%|██████████| 48/48 [00:40<00:00,  1.54it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.54it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
[INFO][13:41:44]: [Client #81] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_81_3536585.pth.
{'train_runtime': 39.6755, 'train_samples_per_second': 152.588, 'train_steps_per_second': 1.21, 'train_loss': 2.376315116882324, 'epoch': 3.0}
[INFO][13:41:44]: [Client #42] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
{'train_runtime': 40.0766, 'train_samples_per_second': 151.061, 'train_steps_per_second': 1.198, 'train_loss': 2.5798460642496743, 'epoch': 3.0}
[INFO][13:41:45]: [Client #81] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_81_3536585.pth.
[INFO][13:41:45]: [Client #42] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
[INFO][13:41:46]: [Client #81] Model trained.
[INFO][13:41:46]: [Client #81] Inbound data has been processed.
[INFO][13:41:46]: [Client #81] Outbound data is ready to be sent after being processed.
[INFO][13:41:46]: [Client #42] Model trained.
[INFO][13:41:46]: [Client #42] Inbound data has been processed.
[INFO][13:41:46]: [Client #42] Outbound data is ready to be sent after being processed.
[INFO][13:41:55]: [Client #81] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:41:56]: [Client #42] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:41:56]: [Server #3536466] Received 507.38 MB of payload data from client #81 (simulated).
[INFO][13:41:57]: [Server #3536466] Received 507.38 MB of payload data from client #42 (simulated).
[INFO][13:41:57]: [Server #3536466] Selecting client #43 for training.
[INFO][13:41:57]: [Server #3536466] Sending the current model to client #43 (simulated).
[INFO][13:42:02]: [Server #3536466] Sending 507.38 MB of payload data to client #43 (simulated).
[INFO][13:42:02]: [Client #43] Selected by the server.
[INFO][13:42:02]: [Client #43] Loading its data source...
[INFO][13:42:02]: [Client #43] Dataset size: 2018
[INFO][13:42:02]: [Client #43] Sampler: iid
[INFO][13:42:03]: [Client #43] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:42:03]: [Client #43] Start to process inbound data.
[INFO][13:42:04]: [93m[1m[Client #43] Started training in communication round #96.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:20,  4.26s/it]  4%|▍         | 2/48 [00:04<01:33,  2.04s/it]  6%|▋         | 3/48 [00:05<00:59,  1.33s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.71it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.88it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.08it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.08it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.08it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][13:42:37]: [Client #43] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536584.pth.
{'train_runtime': 26.7092, 'train_samples_per_second': 226.663, 'train_steps_per_second': 1.797, 'train_loss': 2.0852767626444497, 'epoch': 3.0}
[INFO][13:42:38]: [Client #43] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_43_3536584.pth.
[INFO][13:42:38]: [Client #43] Model trained.
[INFO][13:42:38]: [Client #43] Inbound data has been processed.
[INFO][13:42:38]: [Client #43] Outbound data is ready to be sent after being processed.
[INFO][13:42:44]: [Client #43] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:42:45]: [Server #3536466] Received 507.38 MB of payload data from client #43 (simulated).
[INFO][13:42:45]: [Server #3536466] Adding client #5 to the list of clients for aggregation.
[INFO][13:42:45]: [Server #3536466] Adding client #37 to the list of clients for aggregation.
[INFO][13:42:45]: [Server #3536466] Adding client #53 to the list of clients for aggregation.
[INFO][13:42:45]: [Server #3536466] Adding client #61 to the list of clients for aggregation.
[INFO][13:42:45]: [Server #3536466] Adding client #60 to the list of clients for aggregation.
[INFO][13:42:45]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:42:45]: [Server #3536466] Updated weights have been received.
[INFO][13:42:45]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:42:46]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:42:46]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.1254e+00  1e+02  1e+00  1e+00
 1:  3.0208e+00  2.1457e+00  4e+00  3e-02  3e-02
 2:  3.1318e+00  2.3835e+00  8e-01  3e-05  3e-05
 3:  3.1315e+00  3.1186e+00  1e-02  4e-07  4e-07
 4:  3.1291e+00  3.1260e+00  3e-03  2e-07  1e-07
 5:  3.1262e+00  3.1260e+00  2e-04  8e-07  1e-07
 6:  3.1260e+00  3.1260e+00  6e-06  3e-08  5e-09
 7:  3.1260e+00  3.1260e+00  7e-08  3e-10  6e-11
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 2.1 1.1 2.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 4.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 7.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.87it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.33it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.76it/s]100%|██████████| 8/8 [00:00<00:00, 11.66it/s]
[INFO][13:42:57]: [93m[1m[Server #3536466] Global model perplexity: 24.80
[0m
[INFO][13:42:57]: [Server #3536466] All client reports have been processed.
[INFO][13:42:57]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_96.pth.
[INFO][13:43:00]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_96.pth.
[INFO][13:43:00]: [93m[1m
[Server #3536466] Starting round 97/100.[0m
[INFO][13:43:00]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.56406788e-02, 2.56406788e-02, 5.55419706e-07, 2.56406788e-02,
       5.55419706e-07, 2.56406788e-02, 5.55419706e-07, 2.56406788e-02,
       2.56406788e-02, 3.41048408e-08, 5.55419706e-07, 2.56406788e-02,
       2.56406788e-02, 5.55419706e-07, 2.56406788e-02, 2.56406788e-02,
       2.56406788e-02, 6.28556244e-08, 1.43653808e-07, 2.56406788e-02,
       2.11948241e-08, 2.56406788e-02, 2.11948241e-08, 2.11948241e-08,
       2.11948241e-08, 2.56406788e-02, 5.55419706e-07, 6.28556244e-08,
       5.55419706e-07, 2.11948241e-08, 5.55419706e-07, 2.56406788e-02,
       5.55419706e-07, 5.55419706e-07, 5.55419706e-07, 2.56406788e-02,
       5.55419706e-07, 2.11948241e-08, 3.41048408e-08, 2.56406788e-02,
       3.41048408e-08, 2.56406788e-02, 2.56406788e-02, 6.28556244e-08,
       2.56406788e-02, 3.41048408e-08, 2.11948241e-08, 2.11948241e-08,
       3.41048408e-08, 2.56406788e-02, 2.56406788e-02, 2.56406788e-02,
       2.11948241e-08, 2.56406788e-02, 2.11948241e-08, 2.56406788e-02,
       2.56406788e-02, 2.56406788e-02, 2.56406788e-02, 1.43653808e-07,
       3.41048408e-08, 1.43653808e-07, 2.56406788e-02, 1.43653808e-07,
       5.55419706e-07, 2.56406788e-02, 2.56406788e-02, 2.56406788e-02,
       1.43653808e-07, 2.11948241e-08, 5.55419706e-07, 1.43653808e-07,
       2.56406788e-02, 2.56406788e-02, 2.56406788e-02, 5.55419706e-07,
       5.55419706e-07, 2.11948241e-08, 6.28556244e-08, 2.56406788e-02,
       2.11948241e-08, 2.11948241e-08, 2.56406788e-02, 2.56406788e-02,
       2.11948241e-08, 5.55419706e-07, 1.43653808e-07, 1.48000940e-08,
       5.55419706e-07, 5.55419706e-07, 5.55419706e-07, 2.56406788e-02,
       3.41048408e-08, 3.41048408e-08, 5.55419706e-07]),)
[INFO][13:43:00]: [Server #3536466] Selected clients: [60 76 89  3 17]
[INFO][13:43:00]: [Server #3536466] Selecting client #76 for training.
[INFO][13:43:00]: [Server #3536466] Sending the current model to client #76 (simulated).
[INFO][13:43:05]: [Server #3536466] Sending 507.38 MB of payload data to client #76 (simulated).
[INFO][13:43:05]: [Server #3536466] Selecting client #17 for training.
[INFO][13:43:05]: [Server #3536466] Sending the current model to client #17 (simulated).
[INFO][13:43:10]: [Server #3536466] Sending 507.38 MB of payload data to client #17 (simulated).
[INFO][13:43:10]: [Client #76] Selected by the server.
[INFO][13:43:10]: [Client #76] Loading its data source...
[INFO][13:43:10]: [Client #76] Dataset size: 2018
[INFO][13:43:10]: [Client #76] Sampler: iid
[INFO][13:43:10]: [Client #17] Selected by the server.
[INFO][13:43:10]: [Client #17] Loading its data source...
[INFO][13:43:10]: [Client #17] Dataset size: 2018
[INFO][13:43:10]: [Client #17] Sampler: iid
[INFO][13:43:12]: [Client #76] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:43:12]: [Client #76] Start to process inbound data.
[INFO][13:43:12]: [Client #17] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:43:12]: [Client #17] Start to process inbound data.
[INFO][13:43:13]: [93m[1m[Client #76] Started training in communication round #97.[0m
[INFO][13:43:13]: [93m[1m[Client #17] Started training in communication round #97.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:51,  4.92s/it]  2%|▏         | 1/48 [00:04<03:51,  4.92s/it]  4%|▍         | 2/48 [00:05<01:59,  2.59s/it]  4%|▍         | 2/48 [00:05<01:59,  2.59s/it]  6%|▋         | 3/48 [00:06<01:22,  1.83s/it]  6%|▋         | 3/48 [00:06<01:22,  1.84s/it]  8%|▊         | 4/48 [00:07<01:01,  1.40s/it]  8%|▊         | 4/48 [00:07<01:03,  1.43s/it] 10%|█         | 5/48 [00:08<00:49,  1.15s/it] 10%|█         | 5/48 [00:08<00:50,  1.18s/it] 12%|█▎        | 6/48 [00:08<00:42,  1.01s/it] 12%|█▎        | 6/48 [00:09<00:43,  1.03s/it] 15%|█▍        | 7/48 [00:09<00:37,  1.09it/s] 15%|█▍        | 7/48 [00:09<00:38,  1.07it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.16it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.15it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.22it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.21it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 21%|██        | 10/48 [00:12<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.28it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.31it/s] 29%|██▉       | 14/48 [00:15<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.32it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.39it/s] 33%|███▎      | 16/48 [00:16<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.39it/s] 35%|███▌      | 17/48 [00:17<00:22,  1.38it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:20<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:22<00:18,  1.33it/s] 50%|█████     | 24/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:23<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:25<00:15,  1.33it/s] 60%|██████    | 29/48 [00:26<00:14,  1.34it/s] 60%|██████    | 29/48 [00:26<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.40it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.39it/s] 69%|██████▉   | 33/48 [00:29<00:10,  1.38it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:09,  1.33it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:32<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.35it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:35<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.34it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:38<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.31it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:40<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.37it/s]100%|██████████| 48/48 [00:40<00:00,  1.20it/s]
100%|██████████| 48/48 [00:40<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:40<00:00,  1.39it/s]100%|██████████| 48/48 [00:40<00:00,  1.19it/s]
[INFO][13:43:59]: [Client #17] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
{'train_runtime': 40.2287, 'train_samples_per_second': 150.49, 'train_steps_per_second': 1.193, 'train_loss': 2.2690943082173667, 'epoch': 3.0}
[INFO][13:44:00]: [Client #76] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_76_3536584.pth.
{'train_runtime': 40.1622, 'train_samples_per_second': 150.739, 'train_steps_per_second': 1.195, 'train_loss': 2.529256820678711, 'epoch': 3.0}
[INFO][13:44:00]: [Client #17] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_17_3536585.pth.
[INFO][13:44:01]: [Client #76] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_76_3536584.pth.
[INFO][13:44:01]: [Client #17] Model trained.
[INFO][13:44:01]: [Client #17] Inbound data has been processed.
[INFO][13:44:01]: [Client #17] Outbound data is ready to be sent after being processed.
[INFO][13:44:01]: [Client #76] Model trained.
[INFO][13:44:01]: [Client #76] Inbound data has been processed.
[INFO][13:44:01]: [Client #76] Outbound data is ready to be sent after being processed.
[INFO][13:44:11]: [Client #76] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:44:11]: [Client #17] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:44:12]: [Server #3536466] Received 507.38 MB of payload data from client #76 (simulated).
[INFO][13:44:12]: [Server #3536466] Received 507.38 MB of payload data from client #17 (simulated).
[INFO][13:44:12]: [Server #3536466] Selecting client #60 for training.
[INFO][13:44:12]: [Server #3536466] Sending the current model to client #60 (simulated).
[INFO][13:44:17]: [Server #3536466] Sending 507.38 MB of payload data to client #60 (simulated).
[INFO][13:44:17]: [Server #3536466] Selecting client #3 for training.
[INFO][13:44:17]: [Server #3536466] Sending the current model to client #3 (simulated).
[INFO][13:44:22]: [Server #3536466] Sending 507.38 MB of payload data to client #3 (simulated).
[INFO][13:44:22]: [Client #60] Selected by the server.
[INFO][13:44:22]: [Client #60] Loading its data source...
[INFO][13:44:22]: [Client #60] Dataset size: 2018
[INFO][13:44:22]: [Client #60] Sampler: iid
[INFO][13:44:22]: [Client #3] Selected by the server.
[INFO][13:44:22]: [Client #3] Loading its data source...
[INFO][13:44:22]: [Client #3] Dataset size: 2018
[INFO][13:44:22]: [Client #3] Sampler: iid
[INFO][13:44:24]: [Client #3] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:44:24]: [Client #3] Start to process inbound data.
[INFO][13:44:24]: [Client #60] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:44:24]: [Client #60] Start to process inbound data.
[INFO][13:44:25]: [93m[1m[Client #3] Started training in communication round #97.[0m
[INFO][13:44:25]: [93m[1m[Client #60] Started training in communication round #97.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:13,  4.12s/it]  2%|▏         | 1/48 [00:04<03:44,  4.79s/it]  4%|▍         | 2/48 [00:04<01:37,  2.11s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  6%|▋         | 3/48 [00:05<01:06,  1.48s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:52,  1.18s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:43,  1.02s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:07<00:38,  1.08it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.16it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:32,  1.22it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:09<00:31,  1.25it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:12<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.35it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 60%|██████    | 29/48 [00:24<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.31it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.30it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.31it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.31it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.30it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.31it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.31it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.31it/s]100%|██████████| 48/48 [00:39<00:00,  1.35it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.35it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.52it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.52it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][13:45:10]: [Client #3] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_3_3536585.pth.
{'train_runtime': 39.0827, 'train_samples_per_second': 154.902, 'train_steps_per_second': 1.228, 'train_loss': 2.3663838704427085, 'epoch': 3.0}
[INFO][13:45:10]: [Client #60] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
{'train_runtime': 39.5882, 'train_samples_per_second': 152.924, 'train_steps_per_second': 1.212, 'train_loss': 2.4442192713419595, 'epoch': 3.0}
[INFO][13:45:11]: [Client #3] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_3_3536585.pth.
[INFO][13:45:11]: [Client #60] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_60_3536584.pth.
[INFO][13:45:12]: [Client #3] Model trained.
[INFO][13:45:12]: [Client #3] Inbound data has been processed.
[INFO][13:45:12]: [Client #3] Outbound data is ready to be sent after being processed.
[INFO][13:45:12]: [Client #60] Model trained.
[INFO][13:45:12]: [Client #60] Inbound data has been processed.
[INFO][13:45:12]: [Client #60] Outbound data is ready to be sent after being processed.
[INFO][13:45:21]: [Client #3] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:45:21]: [Client #60] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:45:22]: [Server #3536466] Received 507.38 MB of payload data from client #3 (simulated).
[INFO][13:45:23]: [Server #3536466] Received 507.38 MB of payload data from client #60 (simulated).
[INFO][13:45:23]: [Server #3536466] Selecting client #89 for training.
[INFO][13:45:23]: [Server #3536466] Sending the current model to client #89 (simulated).
[INFO][13:45:28]: [Server #3536466] Sending 507.38 MB of payload data to client #89 (simulated).
[INFO][13:45:28]: [Client #89] Selected by the server.
[INFO][13:45:28]: [Client #89] Loading its data source...
[INFO][13:45:28]: [Client #89] Dataset size: 2018
[INFO][13:45:28]: [Client #89] Sampler: iid
[INFO][13:45:30]: [Client #89] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:45:30]: [Client #89] Start to process inbound data.
[INFO][13:45:30]: [93m[1m[Client #89] Started training in communication round #97.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:21,  4.29s/it]  4%|▍         | 2/48 [00:04<01:34,  2.06s/it]  6%|▋         | 3/48 [00:05<01:00,  1.34s/it]  8%|▊         | 4/48 [00:05<00:44,  1.00s/it] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.43it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.59it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.72it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.81it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.10it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.08it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.08it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.08it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.07it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.06it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.17it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.11it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.06it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.06it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.06it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.06it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.06it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.06it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][13:46:03]: [Client #89] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_89_3536584.pth.
{'train_runtime': 26.8135, 'train_samples_per_second': 225.782, 'train_steps_per_second': 1.79, 'train_loss': 2.3648484547932944, 'epoch': 3.0}
[INFO][13:46:04]: [Client #89] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_89_3536584.pth.
[INFO][13:46:05]: [Client #89] Model trained.
[INFO][13:46:05]: [Client #89] Inbound data has been processed.
[INFO][13:46:05]: [Client #89] Outbound data is ready to be sent after being processed.
[INFO][13:46:10]: [Client #89] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:46:11]: [Server #3536466] Received 507.38 MB of payload data from client #89 (simulated).
[INFO][13:46:11]: [Server #3536466] Adding client #1 to the list of clients for aggregation.
[INFO][13:46:11]: [Server #3536466] Adding client #43 to the list of clients for aggregation.
[INFO][13:46:11]: [Server #3536466] Adding client #42 to the list of clients for aggregation.
[INFO][13:46:11]: [Server #3536466] Adding client #80 to the list of clients for aggregation.
[INFO][13:46:11]: [Server #3536466] Adding client #81 to the list of clients for aggregation.
[INFO][13:46:11]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:46:11]: [Server #3536466] Updated weights have been received.
[INFO][13:46:12]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:46:12]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:46:12]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.1254e+00  1e+02  1e+00  1e+00
 1:  3.0208e+00  2.1457e+00  4e+00  3e-02  3e-02
 2:  3.1318e+00  2.3835e+00  8e-01  3e-05  3e-05
 3:  3.1315e+00  3.1186e+00  1e-02  4e-07  4e-07
 4:  3.1291e+00  3.1260e+00  3e-03  2e-07  1e-07
 5:  3.1262e+00  3.1260e+00  2e-04  8e-07  1e-07
 6:  3.1260e+00  3.1260e+00  6e-06  3e-08  5e-09
 7:  3.1260e+00  3.1260e+00  7e-08  3e-10  6e-11
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 2.1 1.1 2.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 4.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 7.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.20it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.32it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.85it/s]100%|██████████| 8/8 [00:00<00:00, 11.64it/s]
[INFO][13:46:23]: [93m[1m[Server #3536466] Global model perplexity: 28.66
[0m
[INFO][13:46:23]: [Server #3536466] All client reports have been processed.
[INFO][13:46:23]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_97.pth.
[INFO][13:46:27]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_97.pth.
[INFO][13:46:27]: [93m[1m
[Server #3536466] Starting round 98/100.[0m
[INFO][13:46:27]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.56406788e-02, 2.56406788e-02, 5.55419706e-07, 2.56406788e-02,
       5.55419706e-07, 2.56406788e-02, 5.55419706e-07, 2.56406788e-02,
       2.56406788e-02, 3.41048408e-08, 5.55419706e-07, 2.56406788e-02,
       2.56406788e-02, 5.55419706e-07, 2.56406788e-02, 2.56406788e-02,
       6.28556244e-08, 1.43653808e-07, 2.56406788e-02, 2.11948241e-08,
       2.56406788e-02, 2.11948241e-08, 2.11948241e-08, 2.11948241e-08,
       2.56406788e-02, 5.55419706e-07, 6.28556244e-08, 5.55419706e-07,
       2.11948241e-08, 5.55419706e-07, 2.56406788e-02, 5.55419706e-07,
       5.55419706e-07, 5.55419706e-07, 2.56406788e-02, 5.55419706e-07,
       2.11948241e-08, 3.41048408e-08, 2.56406788e-02, 2.56406788e-02,
       2.56406788e-02, 3.41048408e-08, 2.56406788e-02, 2.56406788e-02,
       6.28556244e-08, 2.56406788e-02, 3.41048408e-08, 2.11948241e-08,
       2.11948241e-08, 3.41048408e-08, 2.56406788e-02, 2.56406788e-02,
       2.56406788e-02, 2.11948241e-08, 2.56406788e-02, 2.11948241e-08,
       2.56406788e-02, 2.56406788e-02, 2.56406788e-02, 1.43653808e-07,
       3.41048408e-08, 1.43653808e-07, 2.56406788e-02, 1.43653808e-07,
       5.55419706e-07, 2.56406788e-02, 2.56406788e-02, 2.56406788e-02,
       1.43653808e-07, 2.11948241e-08, 5.55419706e-07, 1.43653808e-07,
       2.56406788e-02, 2.56406788e-02, 5.55419706e-07, 2.56406788e-02,
       2.56406788e-02, 5.55419706e-07, 2.11948241e-08, 6.28556244e-08,
       2.56406788e-02, 2.11948241e-08, 2.11948241e-08, 2.56406788e-02,
       2.11948241e-08, 5.55419706e-07, 1.43653808e-07, 1.48000940e-08,
       5.55419706e-07, 5.55419706e-07, 5.55419706e-07, 2.56406788e-02,
       3.41048408e-08, 3.41048408e-08, 5.55419706e-07]),)
[INFO][13:46:27]: [Server #3536466] Selected clients: [ 5 42 78  7 45]
[INFO][13:46:27]: [Server #3536466] Selecting client #42 for training.
[INFO][13:46:27]: [Server #3536466] Sending the current model to client #42 (simulated).
[INFO][13:46:31]: [Server #3536466] Sending 507.38 MB of payload data to client #42 (simulated).
[INFO][13:46:31]: [Server #3536466] Selecting client #5 for training.
[INFO][13:46:31]: [Server #3536466] Sending the current model to client #5 (simulated).
[INFO][13:46:36]: [Server #3536466] Sending 507.38 MB of payload data to client #5 (simulated).
[INFO][13:46:36]: [Client #42] Selected by the server.
[INFO][13:46:36]: [Client #42] Loading its data source...
[INFO][13:46:36]: [Client #42] Dataset size: 2018
[INFO][13:46:36]: [Client #42] Sampler: iid
[INFO][13:46:36]: [Client #5] Selected by the server.
[INFO][13:46:36]: [Client #5] Loading its data source...
[INFO][13:46:36]: [Client #5] Dataset size: 2018
[INFO][13:46:36]: [Client #5] Sampler: iid
[INFO][13:46:38]: [Client #5] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:46:38]: [Client #5] Start to process inbound data.
[INFO][13:46:38]: [Client #42] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:46:38]: [Client #42] Start to process inbound data.
[INFO][13:46:39]: [93m[1m[Client #5] Started training in communication round #98.[0m
[INFO][13:46:39]: [93m[1m[Client #42] Started training in communication round #98.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
  0%|          | 0/48 [00:00<?, ?it/s]***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:17,  4.21s/it]  2%|▏         | 1/48 [00:04<03:43,  4.76s/it]  4%|▍         | 2/48 [00:04<01:38,  2.14s/it]  4%|▍         | 2/48 [00:05<01:50,  2.40s/it]  6%|▋         | 3/48 [00:05<01:07,  1.50s/it]  6%|▋         | 3/48 [00:06<01:13,  1.64s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  8%|▊         | 4/48 [00:06<00:56,  1.28s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.08it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.16it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 17%|█▋        | 8/48 [00:09<00:32,  1.21it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.26it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:29,  1.27it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.30it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:27,  1.29it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:15<00:22,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 44%|████▍     | 21/48 [00:18<00:19,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.32it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.31it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.29it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.31it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.31it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:36<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.29it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.31it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.31it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.35it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.35it/s]100%|██████████| 48/48 [00:39<00:00,  1.23it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][13:47:24]: [Client #5] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536585.pth.
{'train_runtime': 39.1061, 'train_samples_per_second': 154.81, 'train_steps_per_second': 1.227, 'train_loss': 2.266286532084147, 'epoch': 3.0}
[INFO][13:47:25]: [Client #42] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
{'train_runtime': 39.4752, 'train_samples_per_second': 153.362, 'train_steps_per_second': 1.216, 'train_loss': 2.47084903717041, 'epoch': 3.0}
[INFO][13:47:25]: [Client #5] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536585.pth.
[INFO][13:47:26]: [Client #5] Model trained.
[INFO][13:47:26]: [Client #5] Inbound data has been processed.
[INFO][13:47:26]: [Client #5] Outbound data is ready to be sent after being processed.
[INFO][13:47:26]: [Client #42] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
[INFO][13:47:26]: [Client #42] Model trained.
[INFO][13:47:26]: [Client #42] Inbound data has been processed.
[INFO][13:47:26]: [Client #42] Outbound data is ready to be sent after being processed.
[INFO][13:47:33]: [Client #5] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:47:34]: [Client #42] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:47:34]: [Server #3536466] Received 507.38 MB of payload data from client #5 (simulated).
[INFO][13:47:35]: [Server #3536466] Received 507.38 MB of payload data from client #42 (simulated).
[INFO][13:47:35]: [Server #3536466] Selecting client #78 for training.
[INFO][13:47:35]: [Server #3536466] Sending the current model to client #78 (simulated).
[INFO][13:47:40]: [Server #3536466] Sending 507.38 MB of payload data to client #78 (simulated).
[INFO][13:47:40]: [Server #3536466] Selecting client #7 for training.
[INFO][13:47:40]: [Server #3536466] Sending the current model to client #7 (simulated).
[INFO][13:47:44]: [Server #3536466] Sending 507.38 MB of payload data to client #7 (simulated).
[INFO][13:47:44]: [Client #78] Selected by the server.
[INFO][13:47:44]: [Client #7] Selected by the server.
[INFO][13:47:44]: [Client #78] Loading its data source...
[INFO][13:47:44]: [Client #7] Loading its data source...
[INFO][13:47:44]: [Client #78] Dataset size: 2018
[INFO][13:47:44]: [Client #7] Dataset size: 2018
[INFO][13:47:44]: [Client #78] Sampler: iid
[INFO][13:47:44]: [Client #7] Sampler: iid
[INFO][13:47:46]: [Client #78] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:47:46]: [Client #78] Start to process inbound data.
[INFO][13:47:46]: [Client #7] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:47:46]: [Client #7] Start to process inbound data.
[INFO][13:47:47]: [93m[1m[Client #7] Started training in communication round #98.[0m
[INFO][13:47:47]: [93m[1m[Client #78] Started training in communication round #98.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:15,  4.17s/it]  2%|▏         | 1/48 [00:04<03:45,  4.79s/it]  4%|▍         | 2/48 [00:04<01:37,  2.12s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  6%|▋         | 3/48 [00:05<01:07,  1.51s/it]  6%|▋         | 3/48 [00:06<01:14,  1.64s/it]  8%|▊         | 4/48 [00:06<00:53,  1.22s/it]  8%|▊         | 4/48 [00:07<00:57,  1.30s/it] 10%|█         | 5/48 [00:07<00:45,  1.05s/it] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.06it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 19%|█▉        | 9/48 [00:10<00:32,  1.21it/s] 21%|██        | 10/48 [00:10<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.28it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.33it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.36it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.37it/s] 38%|███▊      | 18/48 [00:16<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.32it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.34it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.31it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.32it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.32it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.32it/s] 50%|█████     | 24/48 [00:21<00:18,  1.32it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.32it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.32it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.33it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.32it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.33it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.35it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.33it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.31it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.32it/s]100%|██████████| 48/48 [00:39<00:00,  1.35it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.35it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.52it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.52it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][13:48:33]: [Client #7] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536585.pth.
{'train_runtime': 39.2761, 'train_samples_per_second': 154.14, 'train_steps_per_second': 1.222, 'train_loss': 2.2311526934305825, 'epoch': 3.0}
[INFO][13:48:33]: [Client #78] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
{'train_runtime': 39.6405, 'train_samples_per_second': 152.722, 'train_steps_per_second': 1.211, 'train_loss': 2.448495070139567, 'epoch': 3.0}
[INFO][13:48:34]: [Client #78] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_78_3536584.pth.
[INFO][13:48:34]: [Client #7] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_7_3536585.pth.
[INFO][13:48:34]: [Client #78] Model trained.
[INFO][13:48:34]: [Client #78] Inbound data has been processed.
[INFO][13:48:34]: [Client #78] Outbound data is ready to be sent after being processed.
[INFO][13:48:34]: [Client #7] Model trained.
[INFO][13:48:34]: [Client #7] Inbound data has been processed.
[INFO][13:48:34]: [Client #7] Outbound data is ready to be sent after being processed.
[INFO][13:48:42]: [Client #78] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:48:42]: [Client #7] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:48:43]: [Server #3536466] Received 507.38 MB of payload data from client #78 (simulated).
[INFO][13:48:44]: [Server #3536466] Received 507.38 MB of payload data from client #7 (simulated).
[INFO][13:48:44]: [Server #3536466] Selecting client #45 for training.
[INFO][13:48:44]: [Server #3536466] Sending the current model to client #45 (simulated).
[INFO][13:48:49]: [Server #3536466] Sending 507.38 MB of payload data to client #45 (simulated).
[INFO][13:48:49]: [Client #45] Selected by the server.
[INFO][13:48:49]: [Client #45] Loading its data source...
[INFO][13:48:49]: [Client #45] Dataset size: 2018
[INFO][13:48:49]: [Client #45] Sampler: iid
[INFO][13:48:50]: [Client #45] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:48:50]: [Client #45] Start to process inbound data.
[INFO][13:48:51]: [93m[1m[Client #45] Started training in communication round #98.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:18,  4.23s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.23it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.42it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.58it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.70it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.79it/s] 21%|██        | 10/48 [00:08<00:20,  1.86it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.92it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.95it/s] 27%|██▋       | 13/48 [00:10<00:17,  1.98it/s] 29%|██▉       | 14/48 [00:10<00:17,  2.00it/s] 31%|███▏      | 15/48 [00:11<00:16,  2.01it/s] 33%|███▎      | 16/48 [00:11<00:15,  2.12it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.09it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.08it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.08it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.08it/s] 44%|████▍     | 21/48 [00:13<00:13,  2.07it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.07it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.07it/s] 50%|█████     | 24/48 [00:15<00:11,  2.07it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.07it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.07it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.07it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.07it/s] 60%|██████    | 29/48 [00:17<00:09,  2.07it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:07,  2.14it/s] 71%|███████   | 34/48 [00:20<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.10it/s] 75%|███████▌  | 36/48 [00:21<00:05,  2.09it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.08it/s] 79%|███████▉  | 38/48 [00:22<00:04,  2.07it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.07it/s] 83%|████████▎ | 40/48 [00:23<00:03,  2.07it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.07it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.17it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.17it/s]100%|██████████| 48/48 [00:26<00:00,  1.79it/s]
[INFO][13:49:24]: [Client #45] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_45_3536584.pth.
{'train_runtime': 26.825, 'train_samples_per_second': 225.685, 'train_steps_per_second': 1.789, 'train_loss': 2.3238229751586914, 'epoch': 3.0}
[INFO][13:49:25]: [Client #45] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_45_3536584.pth.
[INFO][13:49:25]: [Client #45] Model trained.
[INFO][13:49:25]: [Client #45] Inbound data has been processed.
[INFO][13:49:25]: [Client #45] Outbound data is ready to be sent after being processed.
[INFO][13:49:30]: [Client #45] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:49:31]: [Server #3536466] Received 507.38 MB of payload data from client #45 (simulated).
[INFO][13:49:31]: [Server #3536466] Adding client #17 to the list of clients for aggregation.
[INFO][13:49:31]: [Server #3536466] Adding client #89 to the list of clients for aggregation.
[INFO][13:49:31]: [Server #3536466] Adding client #3 to the list of clients for aggregation.
[INFO][13:49:31]: [Server #3536466] Adding client #76 to the list of clients for aggregation.
[INFO][13:49:31]: [Server #3536466] Adding client #5 to the list of clients for aggregation.
[INFO][13:49:31]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:49:31]: [Server #3536466] Updated weights have been received.
[INFO][13:49:32]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:49:32]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:49:32]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.1254e+00  1e+02  1e+00  1e+00
 1:  3.0208e+00  2.1457e+00  4e+00  3e-02  3e-02
 2:  3.1318e+00  2.3835e+00  8e-01  3e-05  3e-05
 3:  3.1315e+00  3.1186e+00  1e-02  4e-07  4e-07
 4:  3.1291e+00  3.1260e+00  3e-03  2e-07  1e-07
 5:  3.1262e+00  3.1260e+00  2e-04  8e-07  1e-07
 6:  3.1260e+00  3.1260e+00  6e-06  3e-08  5e-09
 7:  3.1260e+00  3.1260e+00  7e-08  3e-10  6e-11
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 0.1 2.1 1.1 2.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 4.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 1.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 7.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.08it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.61it/s] 88%|████████▊ | 7/8 [00:00<00:00, 12.09it/s]100%|██████████| 8/8 [00:00<00:00, 11.83it/s]
[INFO][13:49:43]: [93m[1m[Server #3536466] Global model perplexity: 25.31
[0m
[INFO][13:49:43]: [Server #3536466] All client reports have been processed.
[INFO][13:49:43]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_98.pth.
[INFO][13:49:47]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_98.pth.
[INFO][13:49:47]: [93m[1m
[Server #3536466] Starting round 99/100.[0m
[INFO][13:49:47]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([1.31227233e-06, 1.31227233e-06, 1.31227233e-06, 1.45672257e-07,
       9.99946219e-01, 1.45672257e-07, 1.45672257e-07, 1.31227233e-06,
       1.31227233e-06, 1.85433158e-08, 1.45672257e-07, 1.31227233e-06,
       1.31227233e-06, 1.45672257e-07, 1.31227233e-06, 1.31227233e-06,
       1.31227233e-06, 2.96241654e-08, 5.54506398e-08, 1.31227233e-06,
       1.27355383e-08, 1.31227233e-06, 1.27355383e-08, 1.27355383e-08,
       1.27355383e-08, 1.31227233e-06, 1.45672257e-07, 2.96241654e-08,
       1.45672257e-07, 1.27355383e-08, 1.45672257e-07, 1.31227233e-06,
       1.45672257e-07, 1.45672257e-07, 1.45672257e-07, 1.31227233e-06,
       1.45672257e-07, 1.27355383e-08, 1.85433158e-08, 1.31227233e-06,
       1.31227233e-06, 1.85433158e-08, 1.31227233e-06, 2.96241654e-08,
       1.31227233e-06, 1.85433158e-08, 1.27355383e-08, 1.27355383e-08,
       1.85433158e-08, 1.31227233e-06, 1.31227233e-06, 1.31227233e-06,
       1.27355383e-08, 1.31227233e-06, 1.27355383e-08, 1.31227233e-06,
       1.31227233e-06, 1.31227233e-06, 5.54506398e-08, 1.85433158e-08,
       5.54506398e-08, 1.31227233e-06, 5.54506398e-08, 1.45672257e-07,
       1.31227233e-06, 1.31227233e-06, 1.31227233e-06, 5.54506398e-08,
       1.27355383e-08, 1.45672257e-07, 5.54506398e-08, 1.31227233e-06,
       1.31227233e-06, 1.45672257e-07, 1.31227233e-06, 1.31227233e-06,
       1.45672257e-07, 1.27355383e-08, 2.96241654e-08, 1.31227233e-06,
       1.27355383e-08, 1.27355383e-08, 1.31227233e-06, 1.31227233e-06,
       1.27355383e-08, 1.45672257e-07, 5.54506398e-08, 9.30022250e-09,
       1.45672257e-07, 1.45672257e-07, 1.45672257e-07, 1.31227233e-06,
       1.85433158e-08, 1.85433158e-08, 1.45672257e-07]),)
[INFO][13:49:47]: [Server #3536466] Selected clients: [ 5 18 89 59 97]
[INFO][13:49:47]: [Server #3536466] Selecting client #18 for training.
[INFO][13:49:47]: [Server #3536466] Sending the current model to client #18 (simulated).
[INFO][13:49:52]: [Server #3536466] Sending 507.38 MB of payload data to client #18 (simulated).
[INFO][13:49:52]: [Server #3536466] Selecting client #97 for training.
[INFO][13:49:52]: [Server #3536466] Sending the current model to client #97 (simulated).
[INFO][13:49:57]: [Server #3536466] Sending 507.38 MB of payload data to client #97 (simulated).
[INFO][13:49:57]: [Client #18] Selected by the server.
[INFO][13:49:57]: [Client #18] Loading its data source...
[INFO][13:49:57]: [Client #18] Dataset size: 2018
[INFO][13:49:57]: [Client #18] Sampler: iid
[INFO][13:49:57]: [Client #97] Selected by the server.
[INFO][13:49:57]: [Client #97] Loading its data source...
[INFO][13:49:57]: [Client #97] Dataset size: 2018
[INFO][13:49:57]: [Client #97] Sampler: iid
[INFO][13:49:58]: [Client #18] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:49:58]: [Client #18] Start to process inbound data.
[INFO][13:49:58]: [Client #97] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:49:58]: [Client #97] Start to process inbound data.
[INFO][13:49:59]: [93m[1m[Client #18] Started training in communication round #99.[0m
[INFO][13:49:59]: [93m[1m[Client #97] Started training in communication round #99.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  2%|▏         | 1/48 [00:04<03:47,  4.84s/it]  4%|▍         | 2/48 [00:04<01:39,  2.17s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  6%|▋         | 3/48 [00:05<01:08,  1.51s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it]  8%|▊         | 4/48 [00:06<00:53,  1.21s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 10%|█         | 5/48 [00:07<00:44,  1.04s/it] 10%|█         | 5/48 [00:07<00:46,  1.09s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 15%|█▍        | 7/48 [00:08<00:35,  1.14it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.11it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 21%|██        | 10/48 [00:10<00:29,  1.27it/s] 21%|██        | 10/48 [00:11<00:30,  1.24it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.27it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.37it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.38it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.36it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.35it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.35it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.35it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.30it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.32it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.32it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.36it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 69%|██████▉   | 33/48 [00:27<00:11,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.32it/s] 77%|███████▋  | 37/48 [00:30<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 85%|████████▌ | 41/48 [00:33<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.32it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.37it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.37it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.54it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.54it/s]100%|██████████| 48/48 [00:39<00:00,  1.21it/s]
[INFO][13:50:45]: [Client #18] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
{'train_runtime': 39.2041, 'train_samples_per_second': 154.423, 'train_steps_per_second': 1.224, 'train_loss': 2.5612282752990723, 'epoch': 3.0}
[INFO][13:50:45]: [Client #97] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_97_3536585.pth.
{'train_runtime': 39.5655, 'train_samples_per_second': 153.012, 'train_steps_per_second': 1.213, 'train_loss': 2.4034293492635093, 'epoch': 3.0}
[INFO][13:50:46]: [Client #18] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_18_3536584.pth.
[INFO][13:50:46]: [Client #97] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_97_3536585.pth.
[INFO][13:50:46]: [Client #18] Model trained.
[INFO][13:50:46]: [Client #18] Inbound data has been processed.
[INFO][13:50:46]: [Client #18] Outbound data is ready to be sent after being processed.
[INFO][13:50:47]: [Client #97] Model trained.
[INFO][13:50:47]: [Client #97] Inbound data has been processed.
[INFO][13:50:47]: [Client #97] Outbound data is ready to be sent after being processed.
[INFO][13:50:54]: [Client #18] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:50:55]: [Client #97] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:50:55]: [Server #3536466] Received 507.38 MB of payload data from client #18 (simulated).
[INFO][13:50:56]: [Server #3536466] Received 507.38 MB of payload data from client #97 (simulated).
[INFO][13:50:56]: [Server #3536466] Selecting client #5 for training.
[INFO][13:50:56]: [Server #3536466] Sending the current model to client #5 (simulated).
[INFO][13:51:01]: [Server #3536466] Sending 507.38 MB of payload data to client #5 (simulated).
[INFO][13:51:01]: [Server #3536466] Selecting client #89 for training.
[INFO][13:51:01]: [Server #3536466] Sending the current model to client #89 (simulated).
[INFO][13:51:06]: [Server #3536466] Sending 507.38 MB of payload data to client #89 (simulated).
[INFO][13:51:06]: [Client #5] Selected by the server.
[INFO][13:51:06]: [Client #5] Loading its data source...
[INFO][13:51:06]: [Client #5] Dataset size: 2018
[INFO][13:51:06]: [Client #5] Sampler: iid
[INFO][13:51:06]: [Client #89] Selected by the server.
[INFO][13:51:06]: [Client #89] Loading its data source...
[INFO][13:51:06]: [Client #89] Dataset size: 2018
[INFO][13:51:06]: [Client #89] Sampler: iid
[INFO][13:51:07]: [Client #5] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:51:07]: [Client #5] Start to process inbound data.
[INFO][13:51:07]: [93m[1m[Client #5] Started training in communication round #99.[0m
[INFO][13:51:07]: [Client #89] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:51:07]: [Client #89] Start to process inbound data.
[INFO][13:51:08]: [93m[1m[Client #89] Started training in communication round #99.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:32,  4.51s/it]  4%|▍         | 2/48 [00:05<01:39,  2.15s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  6%|▋         | 3/48 [00:05<01:08,  1.52s/it]  2%|▏         | 1/48 [00:04<03:51,  4.92s/it]  8%|▊         | 4/48 [00:06<00:52,  1.20s/it]  4%|▍         | 2/48 [00:05<01:53,  2.46s/it] 10%|█         | 5/48 [00:07<00:44,  1.03s/it]  6%|▋         | 3/48 [00:06<01:15,  1.67s/it] 12%|█▎        | 6/48 [00:07<00:39,  1.07it/s]  8%|▊         | 4/48 [00:07<00:57,  1.31s/it] 15%|█▍        | 7/48 [00:08<00:35,  1.15it/s] 10%|█         | 5/48 [00:07<00:47,  1.11s/it] 17%|█▋        | 8/48 [00:09<00:33,  1.20it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.02it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.11it/s] 21%|██        | 10/48 [00:10<00:30,  1.26it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.22it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 23%|██▎       | 11/48 [00:12<00:28,  1.29it/s] 29%|██▉       | 14/48 [00:13<00:25,  1.32it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.30it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.31it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 38%|███▊      | 18/48 [00:16<00:22,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.39it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.33it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.34it/s] 46%|████▌     | 22/48 [00:19<00:19,  1.33it/s] 42%|████▏     | 20/48 [00:19<00:21,  1.33it/s] 48%|████▊     | 23/48 [00:20<00:19,  1.31it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.33it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.33it/s] 54%|█████▍    | 26/48 [00:22<00:16,  1.34it/s] 50%|█████     | 24/48 [00:22<00:18,  1.33it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.32it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 58%|█████▊    | 28/48 [00:24<00:15,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.33it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.36it/s] 71%|███████   | 34/48 [00:28<00:10,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.39it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.31it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:09,  1.29it/s] 71%|███████   | 34/48 [00:29<00:10,  1.31it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.30it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.30it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.32it/s] 75%|███████▌  | 36/48 [00:31<00:09,  1.31it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.32it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.33it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.32it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.30it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.31it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.31it/s]100%|██████████| 48/48 [00:39<00:00,  1.39it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.39it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
 96%|█████████▌| 46/48 [00:38<00:01,  1.36it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.51it/s][INFO][13:51:53]: [Client #5] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536584.pth.
{'train_runtime': 39.3442, 'train_samples_per_second': 153.873, 'train_steps_per_second': 1.22, 'train_loss': 2.061915397644043, 'epoch': 3.0}
100%|██████████| 48/48 [00:39<00:00,  1.70it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.70it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][13:51:54]: [Client #89] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_89_3536585.pth.
{'train_runtime': 39.4472, 'train_samples_per_second': 153.471, 'train_steps_per_second': 1.217, 'train_loss': 2.254840056101481, 'epoch': 3.0}
[INFO][13:51:54]: [Client #5] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_5_3536584.pth.
[INFO][13:51:54]: [Client #5] Model trained.
[INFO][13:51:54]: [Client #5] Inbound data has been processed.
[INFO][13:51:54]: [Client #5] Outbound data is ready to be sent after being processed.
[INFO][13:51:55]: [Client #89] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_89_3536585.pth.
[INFO][13:51:56]: [Client #89] Model trained.
[INFO][13:51:56]: [Client #89] Inbound data has been processed.
[INFO][13:51:56]: [Client #89] Outbound data is ready to be sent after being processed.
[INFO][13:52:02]: [Client #5] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:52:03]: [Server #3536466] Received 507.38 MB of payload data from client #5 (simulated).
[INFO][13:52:03]: [Client #89] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:52:04]: [Server #3536466] Received 507.38 MB of payload data from client #89 (simulated).
[INFO][13:52:04]: [Server #3536466] Selecting client #59 for training.
[INFO][13:52:04]: [Server #3536466] Sending the current model to client #59 (simulated).
[INFO][13:52:09]: [Server #3536466] Sending 507.38 MB of payload data to client #59 (simulated).
[INFO][13:52:09]: [Client #59] Selected by the server.
[INFO][13:52:09]: [Client #59] Loading its data source...
[INFO][13:52:09]: [Client #59] Dataset size: 2018
[INFO][13:52:09]: [Client #59] Sampler: iid
[INFO][13:52:10]: [Client #59] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:52:10]: [Client #59] Start to process inbound data.
[INFO][13:52:10]: [93m[1m[Client #59] Started training in communication round #99.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.88it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.94it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.98it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.04it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.11it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:11,  2.09it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.08it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.08it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.12it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.09it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.07it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.07it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.08it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.08it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.07it/s]100%|██████████| 48/48 [00:26<00:00,  2.18it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.18it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][13:52:43]: [Client #59] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_59_3536584.pth.
{'train_runtime': 26.6643, 'train_samples_per_second': 227.045, 'train_steps_per_second': 1.8, 'train_loss': 2.532766819000244, 'epoch': 3.0}
[INFO][13:52:45]: [Client #59] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_59_3536584.pth.
[INFO][13:52:45]: [Client #59] Model trained.
[INFO][13:52:45]: [Client #59] Inbound data has been processed.
[INFO][13:52:45]: [Client #59] Outbound data is ready to be sent after being processed.
[INFO][13:52:50]: [Client #59] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:52:51]: [Server #3536466] Received 507.38 MB of payload data from client #59 (simulated).
[INFO][13:52:51]: [Server #3536466] Adding client #45 to the list of clients for aggregation.
[INFO][13:52:51]: [Server #3536466] Adding client #60 to the list of clients for aggregation.
[INFO][13:52:51]: [Server #3536466] Adding client #78 to the list of clients for aggregation.
[INFO][13:52:51]: [Server #3536466] Adding client #7 to the list of clients for aggregation.
[INFO][13:52:51]: [Server #3536466] Adding client #42 to the list of clients for aggregation.
[INFO][13:52:51]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:52:51]: [Server #3536466] Updated weights have been received.
[INFO][13:52:51]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:52:52]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:52:52]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.1243e+00  1e+02  1e+00  1e+00
 1:  3.0196e+00  2.1446e+00  4e+00  3e-02  3e-02
 2:  3.1307e+00  2.3822e+00  8e-01  3e-05  3e-05
 3:  3.1305e+00  3.1165e+00  1e-02  5e-07  5e-07
 4:  3.1284e+00  3.1238e+00  5e-03  2e-07  1e-07
 5:  3.1262e+00  3.1225e+00  4e-03  8e-07  7e-07
 6:  3.1255e+00  3.1240e+00  1e-03  4e-07  3e-07
 7:  3.1247e+00  3.1241e+00  7e-04  2e-06  2e-06
 8:  3.1241e+00  3.1241e+00  7e-05  1e-06  1e-06
 9:  3.1241e+00  3.1241e+00  5e-06  1e-07  1e-07
10:  3.1241e+00  3.1241e+00  6e-08  2e-09  1e-09
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 0.1 2.1 1.1 2.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 4.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 1.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 2.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 7.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 19.08it/s] 62%|██████▎   | 5/8 [00:00<00:00, 12.61it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.97it/s]100%|██████████| 8/8 [00:00<00:00, 11.76it/s]
[INFO][13:53:03]: [93m[1m[Server #3536466] Global model perplexity: 25.14
[0m
[INFO][13:53:03]: [Server #3536466] All client reports have been processed.
[INFO][13:53:03]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_99.pth.
[INFO][13:53:06]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_99.pth.
[INFO][13:53:07]: [93m[1m
[Server #3536466] Starting round 100/100.[0m
[INFO][13:53:07]: Calculating selection probabitliy ... 
--- Logging error ---
Traceback (most recent call last):
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 1083, in emit
    msg = self.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 927, in format
    return fmt.format(record)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 663, in format
    record.message = record.getMessage()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/logging/__init__.py", line 367, in getMessage
    msg = msg % self.args
TypeError: not all arguments converted during string formatting
Call stack:
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 24, in <module>
    main()
  File "/home/ykang/plato/examples/async_selection/async_selection.py", line 20, in main
    server.run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 295, in run
    self.start()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 317, in start
    web.run_app(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/aiohttp/web.py", line 516, in run_app
    loop.run_until_complete(main_task)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 634, in run_until_complete
    self.run_forever()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 601, in run_forever
    self._run_once()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/base_events.py", line 1905, in _run_once
    handle._run()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 524, in _handle_event_internal
    r = await server._trigger_event(data[0], namespace, sid, *data[1:])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_server.py", line 569, in _trigger_event
    return await self.namespace_handlers[namespace].trigger_event(
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/socketio/asyncio_namespace.py", line 37, in trigger_event
    ret = await handler(*args)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 51, in on_client_report
    await self.plato_server.client_report_arrived(sid, data["id"], data["report"])
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 795, in client_report_arrived
    await self.process_client_info(client_id, sid)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 893, in process_client_info
    await self.process_clients(client_info)
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 1048, in process_clients
    await self.select_clients()
  File "/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/plato/servers/base.py", line 476, in select_clients
    self.selected_clients = self.choose_clients(
  File "/home/ykang/plato/examples/async_selection/async_selection_server.py", line 57, in choose_clients
    logging.info(f"The calculated probability is: ", p)
Message: 'The calculated probability is: '
Arguments: (array([2.63153517e-02, 2.63153517e-02, 2.63153517e-02, 6.55472411e-07,
       6.55472411e-07, 2.63153517e-02, 6.55472411e-07, 2.63153517e-02,
       2.63153517e-02, 4.09638518e-08, 6.55472411e-07, 2.63153517e-02,
       2.63153517e-02, 6.55472411e-07, 2.63153517e-02, 2.63153517e-02,
       7.46511083e-08, 1.69228097e-07, 2.63153517e-02, 2.57398704e-08,
       2.63153517e-02, 2.57398704e-08, 2.57398704e-08, 2.57398704e-08,
       2.63153517e-02, 6.55472411e-07, 7.46511083e-08, 6.55472411e-07,
       2.57398704e-08, 6.55472411e-07, 2.63153517e-02, 6.55472411e-07,
       6.55472411e-07, 6.55472411e-07, 2.63153517e-02, 6.55472411e-07,
       2.57398704e-08, 4.09638518e-08, 2.63153517e-02, 2.63153517e-02,
       2.63153517e-02, 4.09638518e-08, 2.63153517e-02, 2.63153517e-02,
       7.46511083e-08, 2.63153517e-02, 4.09638518e-08, 2.57398704e-08,
       2.57398704e-08, 4.09638518e-08, 2.63153517e-02, 2.63153517e-02,
       2.63153517e-02, 2.57398704e-08, 2.63153517e-02, 2.57398704e-08,
       6.55472411e-07, 2.63153517e-02, 2.63153517e-02, 1.69228097e-07,
       4.09638518e-08, 1.69228097e-07, 2.63153517e-02, 1.69228097e-07,
       6.55472411e-07, 2.63153517e-02, 2.63153517e-02, 2.63153517e-02,
       1.69228097e-07, 2.57398704e-08, 6.55472411e-07, 1.69228097e-07,
       2.63153517e-02, 2.63153517e-02, 2.63153517e-02, 6.55472411e-07,
       2.63153517e-02, 2.63153517e-02, 6.55472411e-07, 2.57398704e-08,
       7.46511083e-08, 2.63153517e-02, 2.57398704e-08, 2.57398704e-08,
       2.63153517e-02, 2.57398704e-08, 6.55472411e-07, 1.69228097e-07,
       1.81084735e-08, 6.55472411e-07, 6.55472411e-07, 6.55472411e-07,
       4.09638518e-08, 4.09638518e-08, 6.55472411e-07]),)
[INFO][13:53:07]: [Server #3536466] Selected clients: [33 80 42 16 81]
[INFO][13:53:07]: [Server #3536466] Selecting client #80 for training.
[INFO][13:53:07]: [Server #3536466] Sending the current model to client #80 (simulated).
[INFO][13:53:11]: [Server #3536466] Sending 507.38 MB of payload data to client #80 (simulated).
[INFO][13:53:11]: [Server #3536466] Selecting client #33 for training.
[INFO][13:53:11]: [Server #3536466] Sending the current model to client #33 (simulated).
[INFO][13:53:16]: [Server #3536466] Sending 507.38 MB of payload data to client #33 (simulated).
[INFO][13:53:16]: [Client #80] Selected by the server.
[INFO][13:53:16]: [Client #80] Loading its data source...
[INFO][13:53:16]: [Client #80] Dataset size: 2018
[INFO][13:53:16]: [Client #80] Sampler: iid
[INFO][13:53:16]: [Client #33] Selected by the server.
[INFO][13:53:16]: [Client #33] Loading its data source...
[INFO][13:53:16]: [Client #33] Dataset size: 2018
[INFO][13:53:16]: [Client #33] Sampler: iid
[INFO][13:53:18]: [Client #80] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:53:18]: [Client #80] Start to process inbound data.
[INFO][13:53:18]: [93m[1m[Client #80] Started training in communication round #100.[0m
[INFO][13:53:18]: [Client #33] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:53:18]: [Client #33] Start to process inbound data.
[INFO][13:53:18]: [93m[1m[Client #33] Started training in communication round #100.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:30,  4.47s/it]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  4%|▍         | 2/48 [00:05<01:46,  2.31s/it]  2%|▏         | 1/48 [00:04<03:47,  4.84s/it]  6%|▋         | 3/48 [00:06<01:12,  1.60s/it]  4%|▍         | 2/48 [00:05<01:51,  2.42s/it]  8%|▊         | 4/48 [00:06<00:55,  1.26s/it]  6%|▋         | 3/48 [00:06<01:14,  1.65s/it] 10%|█         | 5/48 [00:07<00:46,  1.08s/it]  8%|▊         | 4/48 [00:07<00:56,  1.29s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.04it/s] 10%|█         | 5/48 [00:07<00:47,  1.10s/it] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 12%|█▎        | 6/48 [00:08<00:40,  1.03it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 15%|█▍        | 7/48 [00:09<00:36,  1.12it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 17%|█▋        | 8/48 [00:10<00:33,  1.18it/s] 21%|██        | 10/48 [00:11<00:29,  1.28it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.23it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.29it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.31it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.28it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.30it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.32it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.34it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.33it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.41it/s] 31%|███▏      | 15/48 [00:15<00:24,  1.34it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 33%|███▎      | 16/48 [00:15<00:22,  1.40it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.38it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.37it/s] 38%|███▊      | 18/48 [00:17<00:21,  1.37it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.36it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.36it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 44%|████▍     | 21/48 [00:19<00:19,  1.36it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.35it/s] 50%|█████     | 24/48 [00:21<00:17,  1.35it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.35it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:25<00:13,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.41it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.34it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.35it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.40it/s] 71%|███████   | 34/48 [00:28<00:10,  1.35it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.35it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.34it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.34it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:33<00:06,  1.32it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.32it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.32it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.33it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.33it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 92%|█████████▏| 44/48 [00:36<00:02,  1.34it/s] 96%|█████████▌| 46/48 [00:37<00:01,  1.34it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.34it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.34it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.38it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.38it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
 98%|█████████▊| 47/48 [00:38<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.57it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.57it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
[INFO][13:54:03]: [Client #80] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_80_3536584.pth.
{'train_runtime': 39.3445, 'train_samples_per_second': 153.872, 'train_steps_per_second': 1.22, 'train_loss': 2.4178924560546875, 'epoch': 3.0}
[INFO][13:54:04]: [Client #33] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
{'train_runtime': 39.3139, 'train_samples_per_second': 153.991, 'train_steps_per_second': 1.221, 'train_loss': 2.2068309783935547, 'epoch': 3.0}
[INFO][13:54:05]: [Client #80] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_80_3536584.pth.
[INFO][13:54:05]: [Client #80] Model trained.
[INFO][13:54:05]: [Client #80] Inbound data has been processed.
[INFO][13:54:05]: [Client #80] Outbound data is ready to be sent after being processed.
[INFO][13:54:05]: [Client #33] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_33_3536585.pth.
[INFO][13:54:06]: [Client #33] Model trained.
[INFO][13:54:06]: [Client #33] Inbound data has been processed.
[INFO][13:54:06]: [Client #33] Outbound data is ready to be sent after being processed.
[INFO][13:54:14]: [Client #33] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:54:14]: [Client #80] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:54:15]: [Server #3536466] Received 507.38 MB of payload data from client #33 (simulated).
[INFO][13:54:16]: [Server #3536466] Received 507.38 MB of payload data from client #80 (simulated).
[INFO][13:54:16]: [Server #3536466] Selecting client #16 for training.
[INFO][13:54:16]: [Server #3536466] Sending the current model to client #16 (simulated).
[INFO][13:54:21]: [Server #3536466] Sending 507.38 MB of payload data to client #16 (simulated).
[INFO][13:54:21]: [Server #3536466] Selecting client #81 for training.
[INFO][13:54:21]: [Server #3536466] Sending the current model to client #81 (simulated).
[INFO][13:54:25]: [Server #3536466] Sending 507.38 MB of payload data to client #81 (simulated).
[INFO][13:54:25]: [Client #16] Selected by the server.
[INFO][13:54:25]: [Client #16] Loading its data source...
[INFO][13:54:25]: [Client #16] Dataset size: 2018
[INFO][13:54:25]: [Client #16] Sampler: iid
[INFO][13:54:25]: [Client #81] Selected by the server.
[INFO][13:54:25]: [Client #81] Loading its data source...
[INFO][13:54:25]: [Client #81] Dataset size: 2018
[INFO][13:54:25]: [Client #81] Sampler: iid
[INFO][13:54:27]: [Client #81] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:54:27]: [Client #81] Start to process inbound data.
[INFO][13:54:27]: [Client #16] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:54:27]: [Client #16] Start to process inbound data.
[INFO][13:54:28]: [93m[1m[Client #81] Started training in communication round #100.[0m
[INFO][13:54:28]: [93m[1m[Client #16] Started training in communication round #100.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:32,  4.52s/it]  2%|▏         | 1/48 [00:05<03:55,  5.01s/it]  4%|▍         | 2/48 [00:05<01:44,  2.28s/it]  4%|▍         | 2/48 [00:05<01:55,  2.52s/it]  6%|▋         | 3/48 [00:05<01:10,  1.57s/it]  6%|▋         | 3/48 [00:06<01:17,  1.72s/it]  8%|▊         | 4/48 [00:06<00:54,  1.24s/it]  8%|▊         | 4/48 [00:07<00:59,  1.34s/it] 10%|█         | 5/48 [00:07<00:45,  1.06s/it] 10%|█         | 5/48 [00:08<00:48,  1.13s/it] 12%|█▎        | 6/48 [00:08<00:40,  1.05it/s] 12%|█▎        | 6/48 [00:08<00:41,  1.01it/s] 15%|█▍        | 7/48 [00:08<00:36,  1.13it/s] 15%|█▍        | 7/48 [00:09<00:37,  1.10it/s] 17%|█▋        | 8/48 [00:09<00:33,  1.19it/s] 17%|█▋        | 8/48 [00:10<00:34,  1.17it/s] 19%|█▉        | 9/48 [00:10<00:31,  1.24it/s] 19%|█▉        | 9/48 [00:11<00:32,  1.19it/s] 21%|██        | 10/48 [00:11<00:30,  1.26it/s] 21%|██        | 10/48 [00:11<00:30,  1.25it/s] 23%|██▎       | 11/48 [00:11<00:28,  1.28it/s] 23%|██▎       | 11/48 [00:12<00:29,  1.26it/s] 25%|██▌       | 12/48 [00:12<00:27,  1.29it/s] 25%|██▌       | 12/48 [00:13<00:27,  1.29it/s] 27%|██▋       | 13/48 [00:13<00:26,  1.30it/s] 27%|██▋       | 13/48 [00:14<00:26,  1.31it/s] 29%|██▉       | 14/48 [00:14<00:25,  1.32it/s] 29%|██▉       | 14/48 [00:14<00:26,  1.31it/s] 31%|███▏      | 15/48 [00:14<00:24,  1.32it/s] 31%|███▏      | 15/48 [00:15<00:25,  1.31it/s] 33%|███▎      | 16/48 [00:15<00:23,  1.36it/s] 33%|███▎      | 16/48 [00:16<00:23,  1.39it/s] 35%|███▌      | 17/48 [00:16<00:23,  1.34it/s] 35%|███▌      | 17/48 [00:16<00:22,  1.36it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 38%|███▊      | 18/48 [00:17<00:22,  1.35it/s] 40%|███▉      | 19/48 [00:17<00:21,  1.35it/s] 40%|███▉      | 19/48 [00:18<00:21,  1.35it/s] 42%|████▏     | 20/48 [00:18<00:20,  1.35it/s] 42%|████▏     | 20/48 [00:19<00:21,  1.32it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 44%|████▍     | 21/48 [00:19<00:20,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 46%|████▌     | 22/48 [00:20<00:19,  1.34it/s] 48%|████▊     | 23/48 [00:20<00:18,  1.34it/s] 48%|████▊     | 23/48 [00:21<00:18,  1.32it/s] 50%|█████     | 24/48 [00:21<00:18,  1.33it/s] 50%|█████     | 24/48 [00:22<00:18,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.33it/s] 52%|█████▏    | 25/48 [00:22<00:17,  1.34it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.33it/s] 54%|█████▍    | 26/48 [00:23<00:16,  1.34it/s] 56%|█████▋    | 27/48 [00:23<00:15,  1.34it/s] 56%|█████▋    | 27/48 [00:24<00:15,  1.34it/s] 58%|█████▊    | 28/48 [00:24<00:14,  1.34it/s] 58%|█████▊    | 28/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 60%|██████    | 29/48 [00:25<00:14,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.34it/s] 62%|██████▎   | 30/48 [00:26<00:13,  1.33it/s] 65%|██████▍   | 31/48 [00:26<00:12,  1.33it/s] 65%|██████▍   | 31/48 [00:27<00:12,  1.33it/s] 67%|██████▋   | 32/48 [00:27<00:11,  1.37it/s] 67%|██████▋   | 32/48 [00:28<00:11,  1.41it/s] 69%|██████▉   | 33/48 [00:28<00:11,  1.36it/s] 69%|██████▉   | 33/48 [00:28<00:10,  1.37it/s] 71%|███████   | 34/48 [00:28<00:10,  1.36it/s] 71%|███████   | 34/48 [00:29<00:10,  1.36it/s] 73%|███████▎  | 35/48 [00:29<00:09,  1.36it/s] 73%|███████▎  | 35/48 [00:30<00:09,  1.34it/s] 75%|███████▌  | 36/48 [00:30<00:08,  1.35it/s] 75%|███████▌  | 36/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.34it/s] 77%|███████▋  | 37/48 [00:31<00:08,  1.33it/s] 79%|███████▉  | 38/48 [00:31<00:07,  1.33it/s] 79%|███████▉  | 38/48 [00:32<00:07,  1.34it/s] 81%|████████▏ | 39/48 [00:32<00:06,  1.33it/s] 81%|████████▏ | 39/48 [00:33<00:06,  1.34it/s] 83%|████████▎ | 40/48 [00:33<00:05,  1.33it/s] 83%|████████▎ | 40/48 [00:34<00:06,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.33it/s] 85%|████████▌ | 41/48 [00:34<00:05,  1.34it/s] 88%|████████▊ | 42/48 [00:34<00:04,  1.33it/s] 88%|████████▊ | 42/48 [00:35<00:04,  1.34it/s] 90%|████████▉ | 43/48 [00:35<00:03,  1.34it/s] 90%|████████▉ | 43/48 [00:36<00:03,  1.30it/s] 92%|█████████▏| 44/48 [00:36<00:03,  1.32it/s] 92%|█████████▏| 44/48 [00:37<00:03,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.32it/s] 94%|█████████▍| 45/48 [00:37<00:02,  1.33it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.32it/s] 96%|█████████▌| 46/48 [00:38<00:01,  1.33it/s] 98%|█████████▊| 47/48 [00:38<00:00,  1.33it/s] 98%|█████████▊| 47/48 [00:39<00:00,  1.33it/s]100%|██████████| 48/48 [00:39<00:00,  1.36it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.36it/s]100%|██████████| 48/48 [00:39<00:00,  1.22it/s]
100%|██████████| 48/48 [00:39<00:00,  1.53it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:39<00:00,  1.53it/s]100%|██████████| 48/48 [00:39<00:00,  1.20it/s]
[INFO][13:55:14]: [Client #81] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_81_3536585.pth.
{'train_runtime': 39.4774, 'train_samples_per_second': 153.353, 'train_steps_per_second': 1.216, 'train_loss': 2.2547755241394043, 'epoch': 3.0}
[INFO][13:55:14]: [Client #16] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_16_3536584.pth.
{'train_runtime': 39.8428, 'train_samples_per_second': 151.947, 'train_steps_per_second': 1.205, 'train_loss': 2.5702430407206216, 'epoch': 3.0}
[INFO][13:55:15]: [Client #16] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_16_3536584.pth.
[INFO][13:55:15]: [Client #81] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_81_3536585.pth.
[INFO][13:55:16]: [Client #16] Model trained.
[INFO][13:55:16]: [Client #16] Inbound data has been processed.
[INFO][13:55:16]: [Client #16] Outbound data is ready to be sent after being processed.
[INFO][13:55:16]: [Client #81] Model trained.
[INFO][13:55:16]: [Client #81] Inbound data has been processed.
[INFO][13:55:16]: [Client #81] Outbound data is ready to be sent after being processed.
[INFO][13:55:24]: [Client #81] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:55:25]: [Server #3536466] Received 507.38 MB of payload data from client #81 (simulated).
[INFO][13:55:25]: [Client #16] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:55:26]: [Server #3536466] Received 507.38 MB of payload data from client #16 (simulated).
[INFO][13:55:26]: [Server #3536466] Selecting client #42 for training.
[INFO][13:55:26]: [Server #3536466] Sending the current model to client #42 (simulated).
[INFO][13:55:31]: [Server #3536466] Sending 507.38 MB of payload data to client #42 (simulated).
[INFO][13:55:31]: [Client #42] Selected by the server.
[INFO][13:55:31]: [Client #42] Loading its data source...
[INFO][13:55:31]: [Client #42] Dataset size: 2018
[INFO][13:55:31]: [Client #42] Sampler: iid
[INFO][13:55:33]: [Client #42] Received 507.38 MB of payload data from the server (simulated).
[INFO][13:55:33]: [Client #42] Start to process inbound data.
[INFO][13:55:33]: [93m[1m[Client #42] Started training in communication round #100.[0m
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/transformers/optimization.py:306: FutureWarning: This implementation of AdamW is deprecated and will be removed in a future version. Use the PyTorch implementation torch.optim.AdamW instead, or set `no_deprecation_warning=True` to disable this warning
  warnings.warn(
***** Running training *****
  Num examples = 2018
  Num Epochs = 3
  Instantaneous batch size per device = 32
  Total train batch size (w. parallel, distributed & accumulation) = 64
  Gradient Accumulation steps = 1
  Total optimization steps = 48
  0%|          | 0/48 [00:00<?, ?it/s]/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  2%|▏         | 1/48 [00:04<03:19,  4.24s/it]  4%|▍         | 2/48 [00:04<01:33,  2.03s/it]  6%|▋         | 3/48 [00:05<00:59,  1.32s/it]  8%|▊         | 4/48 [00:05<00:43,  1.01it/s] 10%|█         | 5/48 [00:06<00:34,  1.24it/s] 12%|█▎        | 6/48 [00:06<00:29,  1.44it/s] 15%|█▍        | 7/48 [00:07<00:25,  1.60it/s] 17%|█▋        | 8/48 [00:07<00:23,  1.73it/s] 19%|█▉        | 9/48 [00:08<00:21,  1.82it/s] 21%|██        | 10/48 [00:08<00:20,  1.89it/s] 23%|██▎       | 11/48 [00:09<00:19,  1.95it/s] 25%|██▌       | 12/48 [00:09<00:18,  1.99it/s] 27%|██▋       | 13/48 [00:10<00:17,  2.01it/s] 29%|██▉       | 14/48 [00:10<00:16,  2.03it/s] 31%|███▏      | 15/48 [00:10<00:16,  2.05it/s] 33%|███▎      | 16/48 [00:11<00:14,  2.16it/s] 35%|███▌      | 17/48 [00:11<00:14,  2.13it/s] 38%|███▊      | 18/48 [00:12<00:14,  2.12it/s] 40%|███▉      | 19/48 [00:12<00:13,  2.10it/s] 42%|████▏     | 20/48 [00:13<00:13,  2.09it/s] 44%|████▍     | 21/48 [00:13<00:12,  2.09it/s] 46%|████▌     | 22/48 [00:14<00:12,  2.09it/s] 48%|████▊     | 23/48 [00:14<00:12,  2.08it/s] 50%|█████     | 24/48 [00:15<00:11,  2.08it/s] 52%|█████▏    | 25/48 [00:15<00:11,  2.08it/s] 54%|█████▍    | 26/48 [00:16<00:10,  2.08it/s] 56%|█████▋    | 27/48 [00:16<00:10,  2.08it/s] 58%|█████▊    | 28/48 [00:17<00:09,  2.08it/s] 60%|██████    | 29/48 [00:17<00:09,  2.08it/s] 62%|██████▎   | 30/48 [00:18<00:08,  2.07it/s] 65%|██████▍   | 31/48 [00:18<00:08,  2.07it/s] 67%|██████▋   | 32/48 [00:19<00:07,  2.18it/s] 69%|██████▉   | 33/48 [00:19<00:06,  2.15it/s] 71%|███████   | 34/48 [00:19<00:06,  2.13it/s] 73%|███████▎  | 35/48 [00:20<00:06,  2.11it/s] 75%|███████▌  | 36/48 [00:20<00:05,  2.10it/s] 77%|███████▋  | 37/48 [00:21<00:05,  2.09it/s] 79%|███████▉  | 38/48 [00:21<00:04,  2.08it/s] 81%|████████▏ | 39/48 [00:22<00:04,  2.08it/s] 83%|████████▎ | 40/48 [00:22<00:03,  2.08it/s] 85%|████████▌ | 41/48 [00:23<00:03,  2.08it/s] 88%|████████▊ | 42/48 [00:23<00:02,  2.08it/s] 90%|████████▉ | 43/48 [00:24<00:02,  2.08it/s] 92%|█████████▏| 44/48 [00:24<00:01,  2.07it/s] 94%|█████████▍| 45/48 [00:25<00:01,  2.07it/s] 96%|█████████▌| 46/48 [00:25<00:00,  2.07it/s] 98%|█████████▊| 47/48 [00:26<00:00,  2.05it/s]100%|██████████| 48/48 [00:26<00:00,  2.15it/s]

Training completed. Do not forget to share your model on huggingface.co/models =)


                                               100%|██████████| 48/48 [00:26<00:00,  2.15it/s]100%|██████████| 48/48 [00:26<00:00,  1.80it/s]
[INFO][13:56:06]: [Client #42] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
{'train_runtime': 26.6763, 'train_samples_per_second': 226.943, 'train_steps_per_second': 1.799, 'train_loss': 2.396573543548584, 'epoch': 3.0}
[INFO][13:56:07]: [Client #42] Loading a model from /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased_42_3536584.pth.
[INFO][13:56:07]: [Client #42] Model trained.
[INFO][13:56:07]: [Client #42] Inbound data has been processed.
[INFO][13:56:07]: [Client #42] Outbound data is ready to be sent after being processed.
[INFO][13:56:13]: [Client #42] Sent 507.38 MB of payload data to the server (simulated).
[INFO][13:56:14]: [Server #3536466] Received 507.38 MB of payload data from client #42 (simulated).
[INFO][13:56:14]: [Server #3536466] Adding client #5 to the list of clients for aggregation.
[INFO][13:56:14]: [Server #3536466] Adding client #89 to the list of clients for aggregation.
[INFO][13:56:14]: [Server #3536466] Adding client #33 to the list of clients for aggregation.
[INFO][13:56:14]: [Server #3536466] Adding client #59 to the list of clients for aggregation.
[INFO][13:56:14]: [Server #3536466] Adding client #18 to the list of clients for aggregation.
[INFO][13:56:14]: [Server #3536466] Aggregating 5 clients in total.
[INFO][13:56:14]: [Server #3536466] Updated weights have been received.
[INFO][13:56:14]: [Server #3536466] Aggregating model weight deltas.
[INFO][13:56:15]: [Server #3536466] Finished aggregating updated weights.
[INFO][13:56:15]: [Server #3536466] Started model testing.
     pcost       dcost       gap    pres   dres
 0:  0.0000e+00  3.1282e+00  1e+02  1e+00  1e+00
 1:  3.0240e+00  2.1485e+00  4e+00  3e-02  3e-02
 2:  3.1346e+00  2.3869e+00  7e-01  3e-05  3e-05
 3:  3.1344e+00  3.1214e+00  1e-02  4e-07  4e-07
 4:  3.1320e+00  3.1288e+00  3e-03  2e-07  1e-07
 5:  3.1290e+00  3.1288e+00  2e-04  8e-07  1e-07
 6:  3.1289e+00  3.1288e+00  7e-06  3e-08  5e-09
 7:  3.1288e+00  3.1288e+00  8e-08  4e-10  6e-11
Optimal solution found.
!!!!!!The squared deltas bound of this round are:  [0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0. 0.
 0. 0. 0. 0.]
!!!The staleness of this round are:  [1.1 1.1 1.1 2.1 1.1 2.1 1.1 2.1 1.1 1.1 5.1 2.1 1.1 1.1 2.1 1.1 1.1 1.1
 4.1 3.1 1.1 6.1 1.1 6.1 6.1 6.1 1.1 2.1 4.1 2.1 6.1 2.1 0.1 2.1 2.1 2.1
 1.1 2.1 6.1 5.1 1.1 1.1 1.1 5.1 1.1 1.1 4.1 1.1 5.1 6.1 6.1 5.1 1.1 1.1
 1.1 6.1 1.1 6.1 1.1 2.1 1.1 1.1 3.1 5.1 3.1 1.1 3.1 2.1 1.1 1.1 1.1 3.1
 6.1 2.1 3.1 1.1 1.1 1.1 2.1 1.1 1.1 2.1 6.1 4.1 1.1 6.1 6.1 1.1 1.1 6.1
 2.1 3.1 7.1 2.1 2.1 2.1 1.1 5.1 5.1 2.1]
local_gradient_bounds:  [0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5
 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5]
!!!!!!The aggregation weights of this round are:  [0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2
 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2]
huggingface/tokenizers: The current process just got forked, after parallelism has already been used. Disabling parallelism to avoid deadlocks...
To disable this warning, you can either:
	- Avoid using `tokenizers` before the fork if possible
	- Explicitly set the environment variable TOKENIZERS_PARALLELISM=(true | false)
***** Running Evaluation *****
  Num examples = 120
  Batch size = 16
/home/ykang/miniforge3/envs/federated/lib/python3.9/site-packages/torch/nn/parallel/_functions.py:68: UserWarning: Was asked to gather along dimension 0, but all input tensors were scalars; will instead unsqueeze and return a vector.
  warnings.warn('Was asked to gather along dimension 0, but all '
  0%|          | 0/8 [00:00<?, ?it/s] 38%|███▊      | 3/8 [00:00<00:00, 18.88it/s] 62%|██████▎   | 5/8 [00:00<00:00, 13.34it/s] 88%|████████▊ | 7/8 [00:00<00:00, 11.80it/s]100%|██████████| 8/8 [00:00<00:00, 11.56it/s]
[INFO][13:56:26]: [93m[1m[Server #3536466] Global model perplexity: 26.57
[0m
[INFO][13:56:26]: [Server #3536466] All client reports have been processed.
[INFO][13:56:26]: [Server #3536466] Saving the checkpoint to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_100.pth.
[INFO][13:56:29]: [Server #3536466] Model saved to /data/ykang/plato/checkpoints/huggingface/fedavg/checkpoint_bert-base-uncased_100.pth.
[INFO][13:56:29]: Target number of training rounds reached.
[INFO][13:56:29]: [Server #3536466] Training concluded.
[INFO][13:56:33]: [Server #3536466] Model saved to /data/ykang/plato/models/huggingface/fedavg/bert-base-uncased.pth.
[INFO][13:56:33]: [Server #3536466] Closing the server.
[INFO][13:56:33]: Closing the connection to client #2.
[INFO][13:56:33]: Closing the connection to client #1.
[INFO][13:56:33]: [Client #2] The server disconnected the connection.
[INFO][13:56:33]: [Client #1] The server disconnected the connection.
/home/ykang/miniforge3/envs/federated/lib/python3.9/multiprocessing/resource_tracker.py:216: UserWarning: resource_tracker: There appear to be 2 leaked semaphore objects to clean up at shutdown
  warnings.warn('resource_tracker: There appear to be %d '
