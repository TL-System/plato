name: Continuous Integration Tests

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
    branches: [main]

jobs:
  Tests:
    runs-on: ubuntu-20.04

    steps:
      - uses: actions/checkout@v3

      - name: Install uv
        uses: astral-sh/setup-uv@v4

      - name: Install CUDA
        env:
          cuda: "11.3"
        run: bash ./scripts/actions/install_cuda_ubuntu.sh
        shell: bash

      - name: Training workloads
        run: |
          mkdir ./models/pretrained
          wget https://kubeedge.obs.cn-north-1.myhuaweicloud.com/model/yolov5.pth
          mv yolov5.pth ./models/pretrained
          uv run plato.py --config=configs/MNIST/fedavg_lenet5.yml
          uv run plato.py --config=configs/MNIST/mistnet_lenet5.yml
          uv run plato.py --config=.github/workflows/configs/fedavg_yolov5.yml
          uv run plato.py --config=.github/workflows/configs/mistnet_yolov5.yml
